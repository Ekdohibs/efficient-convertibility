
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module STerm</title>
<meta name="description" content="Documentation of Coq module STerm" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module STerm</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Arith.html">Arith</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Freevar.html">Freevar</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Misc.html">Misc</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.micromega.Psatz.html">Psatz</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.Eqdep_dec.html">Coq.Logic.Eqdep_dec</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="FEnv.html">FEnv</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="kwd">Inductive</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="renaming">renaming</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>.<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="renv">renv</a></span> (<span class="id">L</span> : <span class="id"><a href="STerm.html#renaming">renaming</a></span>) (<span class="id">n</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">L</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">k</span> :: <span class="id">L</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> <span class="id">k</span> <span class="id">n</span> <span class="kwd">then</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">k</span> + <span class="id">renv</span> <span class="id">L</span> (<span class="id">n</span> - <span class="id">k</span>)) <span class="kwd">else</span> <span class="id">n</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="renv_car">renv_car</a></span> : <span class="kwd">forall</span> <span class="id">L</span>, { <span class="id">C</span> | (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L</span> <span class="id">n</span> &lt; <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)) /\ (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L</span> (<span class="id">n</span> + <span class="id">C</span>) = <span class="id">n</span> + <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L</span> <span class="id">C</span>) }.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">L</span> <span class="kwd">as</span> [|<span class="id">k</span> <span class="id">L</span>].<br/>
&nbsp;&nbsp;- <span class="kwd">exists</span> 0. <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">n</span>. <span class="id">simpl</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">n</span>. <span class="id">simpl</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">IHL</span> <span class="kwd">as</span> (<span class="id">C</span> &amp; <span class="id">HC1</span> &amp; <span class="id">HC2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id">k</span> + <span class="id">C</span>). <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#renv">renv</a></span>; <span class="id">fold</span> <span class="id"><a href="STerm.html#renv">renv</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Lt.html#lt_n_S">lt_n_S</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Plus.html#plus_lt_compat_l">plus_lt_compat_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> - <span class="id">k</span>) <span class="kwd">with</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">n</span> - <span class="id">k</span>)); [<span class="id">apply</span> <span class="id">HC1</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Minus.html#minus_Sn_m">minus_Sn_m</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; <span class="id">try</span> <span class="id">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (<span class="id">n</span> + (<span class="id">k</span> + <span class="id">C</span>) - <span class="id">k</span>) <span class="kwd">with</span> (<span class="id">n</span> + <span class="id">C</span>) <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (<span class="id">k</span> + <span class="id">C</span> - <span class="id">k</span>) <span class="kwd">with</span> <span class="id">C</span> <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">HC2</span>. <span class="id">lia</span>.<br/>
Defined.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="renv_add">renv_add</a></span> : <span class="kwd">forall</span> <span class="id">k</span>, { <span class="id">L</span> | <span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L</span> <span class="id">n</span> = <span class="id">k</span> + <span class="id">n</span> }.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">k</span> <span class="kwd">as</span> [|<span class="id">k</span>].<br/>
&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>. <span class="id">simpl</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">IHk</span> <span class="kwd">as</span> (<span class="id">L</span> &amp; <span class="id">HL</span>). <span class="kwd">exists</span> (0 :: <span class="id">L</span>). <span class="id">intros</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id">HL</span>. <span class="id">lia</span>.<br/>
Defined.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="plus_ren">plus_ren</a></span> <span class="id">k</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="STerm.html#renv_add">renv_add</a></span> <span class="id">k</span>).<br/>
<span class="kwd">Definition</span> <span class="id"><a name="plus_ren_correct">plus_ren_correct</a></span> <span class="id">k</span> : <span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#renv">renv</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> <span class="id">k</span>) <span class="id">n</span> = <span class="id">k</span> + <span class="id">n</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span> (<span class="id"><a href="STerm.html#renv_add">renv_add</a></span> <span class="id">k</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="f_strict_mono_le">f_strict_mono_le</a></span> : <span class="kwd">forall</span> <span class="id">f</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">f</span> <span class="id">n</span> &lt; <span class="id">f</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)) -&gt; (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">n</span> &lt;= <span class="id">f</span> <span class="id">n</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">induction</span> <span class="id">n</span> <span class="kwd">as</span> [|<span class="id">n</span>].<br/>
&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">H</span> <span class="id">n</span>). <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="f_strict_mono_f0">f_strict_mono_f0</a></span> : <span class="kwd">forall</span> <span class="id">f</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">f</span> <span class="id">n</span> &lt; <span class="id">f</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)) -&gt; (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">f</span> 0 &lt;= <span class="id">f</span> <span class="id">n</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">induction</span> <span class="id">n</span> <span class="kwd">as</span> [|<span class="id">n</span>].<br/>
&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">H</span> <span class="id">n</span>). <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="f_strict_mono">f_strict_mono</a></span> : <span class="kwd">forall</span> <span class="id">f</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">f</span> <span class="id">n</span> &lt; <span class="id">f</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)) -&gt; (<span class="kwd">forall</span> <span class="id">n</span> <span class="id">m</span>, <span class="id">n</span> &lt; <span class="id">m</span> -&gt; <span class="id">f</span> <span class="id">n</span> &lt; <span class="id">f</span> <span class="id">m</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">f</span> <span class="id">H</span> <span class="id">n</span> <span class="id">m</span> <span class="id">Hlt</span>. <span class="id">induction</span> <span class="id">Hlt</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">H</span> <span class="id">m</span>). <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="renv_repeat0">renv_repeat0</a></span> : <span class="kwd">forall</span> <span class="id">k</span> <span class="id">L</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#renv">renv</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#repeat">repeat</a></span> 0 <span class="id">k</span> ++ <span class="id">L</span>) <span class="id">n</span> = <span class="id">k</span> + <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L</span> <span class="id">n</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">k</span> <span class="kwd">as</span> [|<span class="id">k</span>].<br/>
&nbsp;&nbsp;- <span class="id">intros</span>. <span class="id">simpl</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span>. <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id">IHk</span>. <span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="lift">lift</a></span> (<span class="id">L</span> : <span class="id"><a href="STerm.html#renaming">renaming</a></span>) : <span class="id"><a href="STerm.html#renaming">renaming</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">L</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;| <span class="id">k</span> :: <span class="id">L</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">k</span> :: <span class="id">L</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_renv">lift_renv</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">L</span>, <span class="id"><a href="STerm.html#renv">renv</a></span> (<span class="id"><a href="STerm.html#lift">lift</a></span> <span class="id">L</span>) <span class="id">n</span> = <span class="kwd">match</span> <span class="id">n</span> <span class="kwd">with</span> 0 =&gt; 0 | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L</span> <span class="id">n</span>) <span class="kwd">end</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>] [|<span class="id">k</span> <span class="id">L</span>]; <span class="id">try</span> <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#lift">lift</a></span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#renv">renv</a></span>; <span class="id">fold</span> <span class="id"><a href="STerm.html#renv">renv</a></span>.<br/>
&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; <span class="id">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;<span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="liftn">liftn</a></span> <span class="id">p</span> (<span class="id">L</span> : <span class="id"><a href="STerm.html#renaming">renaming</a></span>) : <span class="id"><a href="STerm.html#renaming">renaming</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">L</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;| <span class="id">k</span> :: <span class="id">L</span> =&gt; <span class="id">p</span> + <span class="id">k</span> :: <span class="id">L</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_renv_small">liftn_renv_small</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">p</span> <span class="id">L</span>, <span class="id">n</span> &lt; <span class="id">p</span> -&gt; <span class="id"><a href="STerm.html#renv">renv</a></span> (<span class="id"><a href="STerm.html#liftn">liftn</a></span> <span class="id">p</span> <span class="id">L</span>) <span class="id">n</span> = <span class="id">n</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span> <span class="id">p</span> [|<span class="id">k</span> <span class="id">L</span>] <span class="id">Hp</span>; <span class="id">simpl</span>; <span class="id">try</span> <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_renv_large">liftn_renv_large</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">p</span> <span class="id">L</span>, <span class="id">p</span> &lt;= <span class="id">n</span> -&gt; <span class="id"><a href="STerm.html#renv">renv</a></span> (<span class="id"><a href="STerm.html#liftn">liftn</a></span> <span class="id">p</span> <span class="id">L</span>) <span class="id">n</span> = <span class="id">p</span> + <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L</span> (<span class="id">n</span> - <span class="id">p</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span> <span class="id">p</span> [|<span class="id">k</span> <span class="id">L</span>] <span class="id">Hp</span>; <span class="id">simpl</span>; <span class="id">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; <span class="id">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;<span class="id">replace</span> (<span class="id">n</span> - <span class="id">p</span> - <span class="id">k</span>) <span class="kwd">with</span> (<span class="id">n</span> - (<span class="id">p</span> + <span class="id">k</span>)) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="renv_uncar">renv_uncar</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>, { <span class="id">C</span> | (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">f</span> <span class="id">n</span> &lt; <span class="id">f</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)) /\ (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">f</span> (<span class="id">n</span> + <span class="id">C</span>) = <span class="id">n</span> + <span class="id">f</span> <span class="id">C</span>) } -&gt; { <span class="id">L</span> | <span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L</span> <span class="id">n</span> = <span class="id">f</span> <span class="id">n</span> }.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">f</span> (<span class="id">C</span> &amp; <span class="id">HC1</span> &amp; <span class="id">HC2</span>). <span class="id">revert</span> <span class="id">f</span> <span class="id">HC1</span> <span class="id">HC2</span>; <span class="id">induction</span> <span class="id">C</span> <span class="kwd">as</span> [|<span class="id">C</span>]; <span class="id">intros</span> <span class="id">f</span> <span class="id">HC1</span> <span class="id">HC2</span>.<br/>
&nbsp;&nbsp;- <span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="STerm.html#renv_add">renv_add</a></span> (<span class="id">f</span> 0))). <span class="id">intros</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="STerm.html#renv_add">renv_add</a></span> <span class="kwd">as</span> (<span class="id">L</span> &amp; <span class="id">HL</span>). <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id">HL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">HC2</span> <span class="id">n</span>). <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Peano.html#plus_n_O">plus_n_O</a></span> <span class="kwd">in</span> <span class="id">HC2</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHC</span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id">f</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) - <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">f</span> 0))). <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">IHC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHC</span> <span class="kwd">as</span> (<span class="id">L</span> &amp; <span class="id">HL</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>. <span class="id">assert</span> (<span class="id">H</span> := <span class="id">HC1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)). <span class="id">assert</span> (<span class="id">H2</span> := <span class="id"><a href="STerm.html#f_strict_mono_f0">f_strict_mono_f0</a></span> <span class="id">f</span> <span class="id">HC1</span> <span class="id">n</span>). <span class="id">specialize</span> (<span class="id">HC1</span> <span class="id">n</span>). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Peano.html#plus_n_Sm">plus_n_Sm</a></span>, <span class="id">HC2</span>. <span class="id">assert</span> (<span class="id">H</span> := <span class="id"><a href="STerm.html#f_strict_mono_f0">f_strict_mono_f0</a></span> <span class="id">f</span> <span class="id">HC1</span> <span class="id">C</span>). <span class="id">specialize</span> (<span class="id">HC1</span> <span class="id">C</span>). <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">exists</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#repeat">repeat</a></span> 0 (<span class="id">f</span> 0) ++ <span class="id"><a href="STerm.html#lift">lift</a></span> <span class="id">L</span>). <span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">rewrite</span> <span class="id"><a href="STerm.html#renv_repeat0">renv_repeat0</a></span>, <span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id">HL</span>. <span class="id">assert</span> (<span class="id">H</span> := <span class="id">HC1</span> <span class="id">n</span>). <span class="id">assert</span> (<span class="id">H2</span> := <span class="id"><a href="STerm.html#f_strict_mono_f0">f_strict_mono_f0</a></span> <span class="id">f</span> <span class="id">HC1</span> <span class="id">n</span>). <span class="id">lia</span>.<br/>
Defined.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="renv_comp_def">renv_comp_def</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L1</span> <span class="id">L2</span>, { <span class="id">L3</span> | <span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L3</span> <span class="id">n</span> = <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L1</span> (<span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L2</span> <span class="id">n</span>) }.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">L1</span> <span class="id">L2</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#renv_uncar">renv_uncar</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="STerm.html#renv_car">renv_car</a></span> <span class="id">L1</span>) <span class="kwd">as</span> (<span class="id">C1</span> &amp; <span class="id">HC1a</span> &amp; <span class="id">HC1b</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="STerm.html#renv_car">renv_car</a></span> <span class="id">L2</span>) <span class="kwd">as</span> (<span class="id">C2</span> &amp; <span class="id">HC2a</span> &amp; <span class="id">HC2b</span>).<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id">C1</span> + <span class="id">C2</span>). <span class="id">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">n</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#f_strict_mono">f_strict_mono</a></span>; [<span class="id">assumption</span>|]. <span class="id">apply</span> <span class="id">HC2a</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">n</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_assoc">Nat.add_assoc</a></span>, !<span class="id">HC2b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_comm">Nat.add_comm</a></span> <span class="kwd">with</span> (<span class="id">n</span> := <span class="id">C1</span>), <span class="id">HC1b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_comm">Nat.add_comm</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.add_assoc">Nat.add_assoc</a></span>, <span class="id">HC1b</span>. <span class="id">lia</span>.<br/>
Defined.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="renv_comp">renv_comp</a></span> <span class="id">L1</span> <span class="id">L2</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="STerm.html#renv_comp_def">renv_comp_def</a></span> <span class="id">L1</span> <span class="id">L2</span>).<br/>
<span class="kwd">Definition</span> <span class="id"><a name="renv_comp_correct">renv_comp_correct</a></span> <span class="id">L1</span> <span class="id">L2</span> : <span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#renv">renv</a></span> (<span class="id"><a href="STerm.html#renv_comp">renv_comp</a></span> <span class="id">L1</span> <span class="id">L2</span>) <span class="id">n</span> = <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L1</span> (<span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L2</span> <span class="id">n</span>) := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span> (<span class="id"><a href="STerm.html#renv_comp_def">renv_comp_def</a></span> <span class="id">L1</span> <span class="id">L2</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="renv_ext">renv_ext</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">L1</span> <span class="id">L2</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L1</span> <span class="id">n</span> = <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">L2</span> <span class="id">n</span>) -&gt; <span class="id">L1</span> = <span class="id">L2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">L1</span> <span class="kwd">as</span> [|<span class="id">x1</span> <span class="id">L1</span>]; <span class="id">destruct</span> <span class="id">L2</span> <span class="kwd">as</span> [|<span class="id">x2</span> <span class="id">L2</span>].<br/>
&nbsp;&nbsp;- <span class="id">intros</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">H</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">x2</span>). <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">H</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">x1</span>). <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">H</span>. <span class="id">assert</span> (<span class="id">x1</span> = <span class="id">x2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assert</span> (<span class="id">H1</span> := <span class="id">H</span> <span class="id">x1</span>). <span class="id">assert</span> (<span class="id">H2</span> := <span class="id">H</span> <span class="id">x2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">subst</span>. <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id">IHL1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span>. <span class="id">specialize</span> (<span class="id">H</span> (<span class="id">x2</span> + <span class="id">n</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (<span class="id">x2</span> + <span class="id">n</span> - <span class="id">x2</span>) <span class="kwd">with</span> <span class="id">n</span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="shiftn">shiftn</a></span> <span class="id">k</span> : <span class="id"><a href="STerm.html#renaming">renaming</a></span> := <span class="id">k</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="renv_shiftn">renv_shiftn</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#renv">renv</a></span> (<span class="id"><a href="STerm.html#shiftn">shiftn</a></span> <span class="id">k</span>) <span class="id">n</span> = <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> <span class="id">k</span> <span class="id">n</span> <span class="kwd">then</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> <span class="kwd">else</span> <span class="id">n</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">k</span> <span class="id">n</span>. <span class="id">simpl</span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="comp">comp</a></span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> : <span class="kwd">Type</span>} (<span class="id">f</span> : <span class="id">B</span> -&gt; <span class="id">C</span>) (<span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id">B</span>) <span class="id">x</span> := <span class="id">f</span> (<span class="id">g</span> <span class="id">x</span>).<br/>
<span class="kwd">Definition</span> <span class="id"><a name="scons">scons</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">x</span> : <span class="id">A</span>) (<span class="id">f</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id">A</span>) <span class="id">n</span> := <span class="kwd">match</span> <span class="id">n</span> <span class="kwd">with</span> 0 =&gt; <span class="id">x</span> | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> =&gt; <span class="id">f</span> <span class="id">n</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="id_ren">id_ren</a></span> : <span class="id"><a href="STerm.html#renaming">renaming</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pointwise_eq">pointwise_eq</a></span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">f</span> <span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id">B</span>) := <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">f</span> <span class="id">x</span> = <span class="id">g</span> <span class="id">x</span>.<br/>
<span class="kwd">Infix</span> ".=" := <span class="id"><a href="STerm.html#pointwise_eq">pointwise_eq</a></span> (<span class="kwd">at</span> <span class="id">level</span> 70).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="scons_0_S">scons_0_S</a></span> : <span class="id"><a href="STerm.html#scons">scons</a></span> 0 <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> .= <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#id">id</a></span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="comp_l">comp_l</a></span> : <span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>) (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">B</span>), <span class="id"><a href="STerm.html#comp">comp</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#id">id</a></span> <span class="id">f</span> .= <span class="id">f</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">f</span> <span class="id">x</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="comp_r">comp_r</a></span> : <span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>) (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">B</span>), <span class="id"><a href="STerm.html#comp">comp</a></span> <span class="id">f</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#id">id</a></span> .= <span class="id">f</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">f</span> <span class="id">x</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="comp_scons">comp_scons</a></span> : <span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>) (<span class="id">x</span> : <span class="id">A</span>) <span class="id">f</span> (<span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id">B</span>), <span class="id"><a href="STerm.html#comp">comp</a></span> <span class="id">g</span> (<span class="id"><a href="STerm.html#scons">scons</a></span> <span class="id">x</span> <span class="id">f</span>) .= <span class="id"><a href="STerm.html#scons">scons</a></span> (<span class="id">g</span> <span class="id">x</span>) (<span class="id"><a href="STerm.html#comp">comp</a></span> <span class="id">g</span> <span class="id">f</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">x</span> <span class="id">f</span> <span class="id">g</span> [|<span class="id">n</span>]; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>; <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="scons_comp_id">scons_comp_id</a></span> : <span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>) (<span class="id">f</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id">A</span>), <span class="id"><a href="STerm.html#scons">scons</a></span> (<span class="id">f</span> 0) (<span class="id"><a href="STerm.html#comp">comp</a></span> <span class="id">f</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span>) .= <span class="id">f</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">f</span> [|<span class="id">n</span>]; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>; <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="scons_comp_S">scons_comp_S</a></span> : <span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>) (<span class="id">x</span> : <span class="id">A</span>) <span class="id">f</span>, <span class="id"><a href="STerm.html#comp">comp</a></span> (<span class="id"><a href="STerm.html#scons">scons</a></span> <span class="id">x</span> <span class="id">f</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> .= <span class="id">f</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">x</span> <span class="id">f</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>. <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="term">term</a></span> :=<br/>
| <span class="id"><a name="var">var</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id">term</span><br/>
| <span class="id"><a name="dvar">dvar</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id">term</span><br/>
| <span class="id"><a name="abs">abs</a></span> : <span class="id">term</span> -&gt; <span class="id">term</span><br/>
| <span class="id"><a name="app">app</a></span> : <span class="id">term</span> -&gt; <span class="id">term</span> -&gt; <span class="id">term</span><br/>
| <span class="id"><a name="constr">constr</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">term</span> -&gt; <span class="id">term</span><br/>
| <span class="id"><a name="switch">switch</a></span> : <span class="id">term</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id">term</span>) -&gt; <span class="id">term</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="term_ind2">term_ind2</a></span> (<span class="id">P</span> : <span class="id"><a href="STerm.html#term">term</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hvar</span> : <span class="kwd">forall</span> <span class="id">n</span>, <span class="id">P</span> (<span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hdvar</span> : <span class="kwd">forall</span> <span class="id">n</span>, <span class="id">P</span> (<span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Habs</span> : <span class="kwd">forall</span> <span class="id">t</span>, <span class="id">P</span> <span class="id">t</span> -&gt; <span class="id">P</span> (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Happ</span> : <span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id">P</span> <span class="id">t1</span> -&gt; <span class="id">P</span> <span class="id">t2</span> -&gt; <span class="id">P</span> (<span class="id"><a href="STerm.html#app">app</a></span> <span class="id">t1</span> <span class="id">t2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hconstr</span> : <span class="kwd">forall</span> <span class="id">tag</span> <span class="id">l</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> <span class="id">l</span> -&gt; <span class="id">P</span> (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hswitch</span> : <span class="kwd">forall</span> <span class="id">t</span> <span class="id">m</span>, <span class="id">P</span> <span class="id">t</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">p</span>, <span class="id">t2</span>) =&gt; <span class="id">P</span> <span class="id">t2</span>) <span class="id">m</span> -&gt; <span class="id">P</span> (<span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">t</span> : <span class="id"><a href="STerm.html#term">term</a></span>) : <span class="id">P</span> <span class="id">t</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> =&gt; <span class="id">Hvar</span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span> =&gt; <span class="id">Hdvar</span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span> =&gt; <span class="id">Habs</span> <span class="id">t</span> (<span class="id">term_ind2</span> <span class="id">P</span> <span class="id">Hvar</span> <span class="id">Hdvar</span> <span class="id">Habs</span> <span class="id">Happ</span> <span class="id">Hconstr</span> <span class="id">Hswitch</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#app">app</a></span> <span class="id">t1</span> <span class="id">t2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Happ</span> <span class="id">t1</span> <span class="id">t2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">term_ind2</span> <span class="id">P</span> <span class="id">Hvar</span> <span class="id">Hdvar</span> <span class="id">Habs</span> <span class="id">Happ</span> <span class="id">Hconstr</span> <span class="id">Hswitch</span> <span class="id">t1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">term_ind2</span> <span class="id">P</span> <span class="id">Hvar</span> <span class="id">Hdvar</span> <span class="id">Habs</span> <span class="id">Happ</span> <span class="id">Hconstr</span> <span class="id">Hswitch</span> <span class="id">t2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hconstr</span> <span class="id">tag</span> <span class="id">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="kwd">fix</span> <span class="id">H</span> (<span class="id">l</span> : <span class="id">_</span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> <span class="id">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; @<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_nil">Forall_nil</a></span> <span class="id">_</span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#cons">cons</a></span> <span class="id">t</span> <span class="id">l</span> =&gt; @<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_cons">Forall_cons</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">t</span> <span class="id">l</span> (<span class="id">term_ind2</span> <span class="id">P</span> <span class="id">Hvar</span> <span class="id">Hdvar</span> <span class="id">Habs</span> <span class="id">Happ</span> <span class="id">Hconstr</span> <span class="id">Hswitch</span> <span class="id">t</span>) (<span class="id">H</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">m</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hswitch</span> <span class="id">t</span> <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">term_ind2</span> <span class="id">P</span> <span class="id">Hvar</span> <span class="id">Hdvar</span> <span class="id">Habs</span> <span class="id">Happ</span> <span class="id">Hconstr</span> <span class="id">Hswitch</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="kwd">fix</span> <span class="id">H</span> (<span class="id">m</span> : <span class="id">_</span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> '(<span class="id">p</span>, <span class="id">t2</span>) =&gt; <span class="id">P</span> <span class="id">t2</span>) <span class="id">m</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; @<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_nil">Forall_nil</a></span> <span class="id">_</span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#cons">cons</a></span> (<span class="id">p</span>, <span class="id">t2</span>) <span class="id">m</span> =&gt; @<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_cons">Forall_cons</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id">p</span>, <span class="id">t2</span>) <span class="id">m</span> (<span class="id">term_ind2</span> <span class="id">P</span> <span class="id">Hvar</span> <span class="id">Hdvar</span> <span class="id">Habs</span> <span class="id">Happ</span> <span class="id">Hconstr</span> <span class="id">Hswitch</span> <span class="id">t2</span>) (<span class="id">H</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">m</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="ren_term">ren_term</a></span> (<span class="id">r</span> : <span class="id"><a href="STerm.html#renaming">renaming</a></span>) <span class="id">t</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> (<span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">r</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span> =&gt; <span class="id"><a href="STerm.html#abs">abs</a></span> (<span class="id">ren_term</span> (<span class="id"><a href="STerm.html#lift">lift</a></span> <span class="id">r</span>) <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#app">app</a></span> <span class="id">t1</span> <span class="id">t2</span> =&gt; <span class="id"><a href="STerm.html#app">app</a></span> (<span class="id">ren_term</span> <span class="id">r</span> <span class="id">t1</span>) (<span class="id">ren_term</span> <span class="id">r</span> <span class="id">t2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span> =&gt; <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id">ren_term</span> <span class="id">r</span>) <span class="id">l</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">l</span> =&gt; <span class="id"><a href="STerm.html#switch">switch</a></span> (<span class="id">ren_term</span> <span class="id">r</span> <span class="id">t</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">pt2</span> =&gt; (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt2</span>, <span class="id">ren_term</span> (<span class="id"><a href="STerm.html#liftn">liftn</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt2</span>) <span class="id">r</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt2</span>))) <span class="id">l</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="lift_subst">lift_subst</a></span> <span class="id">us</span> := <span class="id"><a href="STerm.html#scons">scons</a></span> (<span class="id"><a href="STerm.html#var">var</a></span> 0) (<span class="id"><a href="STerm.html#comp">comp</a></span> (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> 1)) <span class="id">us</span>).<br/>
<span class="kwd">Definition</span> <span class="id"><a name="liftn_subst">liftn_subst</a></span> <span class="id">p</span> <span class="id">us</span> <span class="id">n</span> := <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> <span class="id">p</span> <span class="id">n</span> <span class="kwd">then</span> <span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> <span class="id">p</span>) (<span class="id">us</span> (<span class="id">n</span> - <span class="id">p</span>)) <span class="kwd">else</span> <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="subst">subst</a></span> <span class="id">us</span> <span class="id">t</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> =&gt; <span class="id">us</span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span> =&gt; <span class="id"><a href="STerm.html#abs">abs</a></span> (<span class="id">subst</span> (<span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span> <span class="id">us</span>) <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#app">app</a></span> <span class="id">t1</span> <span class="id">t2</span> =&gt; <span class="id"><a href="STerm.html#app">app</a></span> (<span class="id">subst</span> <span class="id">us</span> <span class="id">t1</span>) (<span class="id">subst</span> <span class="id">us</span> <span class="id">t2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span> =&gt; <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id">subst</span> <span class="id">us</span>) <span class="id">l</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">l</span> =&gt; <span class="id"><a href="STerm.html#switch">switch</a></span> (<span class="id">subst</span> <span class="id">us</span> <span class="id">t</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">pt2</span> =&gt; (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt2</span>, <span class="id">subst</span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt2</span>) <span class="id">us</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt2</span>))) <span class="id">l</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="subst1">subst1</a></span> <span class="id">u</span> <span class="id">t</span> := <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#scons">scons</a></span> <span class="id">u</span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span>)) <span class="id">t</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst_ext">subst_ext</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">us1</span> <span class="id">us2</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">us1</span> <span class="id">n</span> = <span class="id">us2</span> <span class="id">n</span>) -&gt; <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us1</span> <span class="id">t</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us2</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">us1</span> <span class="id">us2</span> <span class="id">Heq</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id">IHt</span>. <span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">simpl</span>; [<span class="id">reflexivity</span>|<span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">f_equal</span>; <span class="id">apply</span> <span class="id">Heq</span>].<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt1</span>|<span class="id">apply</span> <span class="id">IHt2</span>]; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>. <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt</span>; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>. <span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>. <span class="id">simpl</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">reflexivity</span>]. <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id">Heq</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="ren">ren</a></span> <span class="id">r</span> := <span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> (<span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">r</span> <span class="id">n</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ren_term_is_subst">ren_term_is_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">r</span>, <span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">r</span> <span class="id">t</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#ren">ren</a></span> <span class="id">r</span>) <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">r</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id">IHt</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">unfold</span> <span class="id"><a href="STerm.html#ren">ren</a></span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">unfold</span> <span class="id"><a href="STerm.html#ren">ren</a></span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt1</span>|<span class="id">apply</span> <span class="id">IHt2</span>].<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>. <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>. <span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>. <span class="id">simpl</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [<span class="id">apply</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span>)|]. <span class="id">intros</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>, <span class="id"><a href="STerm.html#ren">ren</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span>, <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>; [<span class="id">reflexivity</span>|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_small">liftn_renv_small</a></span>; [<span class="id">reflexivity</span>|<span class="id">assumption</span>].<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unfold_lift_subst">unfold_lift_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span> <span class="id">us</span> <span class="id">n</span> = <span class="kwd">match</span> <span class="id">n</span> <span class="kwd">with</span> 0 =&gt; <span class="id"><a href="STerm.html#var">var</a></span> 0 | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#ren">ren</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> 1)) (<span class="id">us</span> <span class="id">n</span>) <span class="kwd">end</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> [|<span class="id">n</span>]; <span class="id">simpl</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unfold_liftn_subst">unfold_liftn_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">us</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> <span class="id">us</span> <span class="id">n</span> = <span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> <span class="id">p</span> <span class="id">n</span> <span class="kwd">then</span> <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#ren">ren</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> <span class="id">p</span>)) (<span class="id">us</span> (<span class="id">n</span> - <span class="id">p</span>)) <span class="kwd">else</span> <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">p</span> <span class="id">us</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unfold_subst">unfold_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">us</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> =&gt; <span class="id">us</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span> =&gt; <span class="id"><a href="STerm.html#abs">abs</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span> <span class="id">us</span>) <span class="id">t</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="STerm.html#app">app</a></span> <span class="id">t1</span> <span class="id">t2</span> =&gt; <span class="id"><a href="STerm.html#app">app</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t1</span>) (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span> =&gt; <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span>) <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">l</span> =&gt; <span class="id"><a href="STerm.html#switch">switch</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">pt2</span> =&gt; (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt2</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt2</span>) <span class="id">us</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt2</span>))) <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t</span>; <span class="id">intros</span> <span class="id">us</span>; <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ren_ren">ren_ren</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">r1</span> <span class="id">r2</span>, <span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">r1</span> (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">r2</span> <span class="id">t</span>) = <span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#renv_comp">renv_comp</a></span> <span class="id">r1</span> <span class="id">r2</span>) <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">r1</span> <span class="id">r2</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="STerm.html#renv_comp_correct">renv_comp_correct</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id">IHt</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="STerm.html#renv_ext">renv_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">rewrite</span> !<span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>, !<span class="id"><a href="STerm.html#renv_comp_correct">renv_comp_correct</a></span>, !<span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">IHt1</span>, <span class="id">IHt2</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>. <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt</span>|]. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>. <span class="id">simpl</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span>). <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#renv_ext">renv_ext</a></span>. <span class="id">intros</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> <span class="id">p</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#renv_comp_correct">renv_comp_correct</a></span>, !<span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span>, <span class="id"><a href="STerm.html#renv_comp_correct">renv_comp_correct</a></span>; <span class="id">try</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#renv_comp_correct">renv_comp_correct</a></span>, !<span class="id"><a href="STerm.html#liftn_renv_small">liftn_renv_small</a></span>; <span class="id">try</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_small">liftn_renv_small</a></span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ren_subst">ren_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">r</span> <span class="id">us</span>, <span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">r</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t</span>) = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#comp">comp</a></span> (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">r</span>) <span class="id">us</span>) <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">r</span> <span class="id">us</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id">IHt</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">rewrite</span> !<span class="id"><a href="STerm.html#ren_ren">ren_ren</a></span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="STerm.html#renv_ext">renv_ext</a></span>. <span class="id">intros</span> [|<span class="id">m</span>]; <span class="id">rewrite</span> !<span class="id"><a href="STerm.html#renv_comp_correct">renv_comp_correct</a></span>, <span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">IHt1</span>, <span class="id">IHt2</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>. <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt</span>|]. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>. <span class="id">simpl</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">rewrite</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span>). <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> !<span class="id"><a href="STerm.html#ren_ren">ren_ren</a></span>. <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#renv_ext">renv_ext</a></span>. <span class="id">intros</span> <span class="id">n2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="STerm.html#renv_comp_correct">renv_comp_correct</a></span>, !<span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>, <span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span> <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_small">liftn_renv_small</a></span>; [<span class="id">reflexivity</span>|<span class="id">assumption</span>].<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst_ren">subst_ren</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">r</span> <span class="id">us</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">r</span> <span class="id">t</span>) = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#comp">comp</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span>) (<span class="id"><a href="STerm.html#ren">ren</a></span> <span class="id">r</span>)) <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">r</span> <span class="id">us</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id">IHt</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>. <span class="id">simpl</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">IHt1</span>, <span class="id">IHt2</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>. <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt</span>|]. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>. <span class="id">simpl</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">rewrite</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span>). <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>, <span class="id"><a href="STerm.html#ren">ren</a></span>; <span class="id">simpl</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> <span class="id">p</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">unfold</span> <span class="id"><a href="STerm.html#ren">ren</a></span>. <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span> <span class="kwd">by</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">lia</span>]. <span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">unfold</span> <span class="id"><a href="STerm.html#ren">ren</a></span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_small">liftn_renv_small</a></span> <span class="kwd">by</span> <span class="id">assumption</span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [<span class="id">lia</span>|<span class="id">reflexivity</span>].<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst_subst">subst_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">us1</span> <span class="id">us2</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us2</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us1</span> <span class="id">t</span>) = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#comp">comp</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us2</span>) <span class="id">us1</span>) <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">us1</span> <span class="id">us2</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id">IHt</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span>, <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">simpl</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#ren_subst">ren_subst</a></span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_ren">subst_ren</a></span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">m</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">IHt1</span>, <span class="id">IHt2</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt</span>|]. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>. <span class="id">simpl</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">rewrite</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span>). <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>; <span class="id">simpl</span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_ren">subst_ren</a></span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#ren_subst">ren_subst</a></span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n2</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [<span class="id">lia</span>|]. <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst_id">subst_id</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span>) <span class="id">t</span> = <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">simpl</span>; <span class="id">f_equal</span>; <span class="id">try</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">unfold</span> <span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span>, <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>; [<span class="id">reflexivity</span>|<span class="id">f_equal</span>; <span class="id">lia</span>].<br/>
&nbsp;&nbsp;- <span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>; [<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_id">map_id</a></span>|]. <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>; [<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_id">map_id</a></span>|]. <span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [<span class="id">apply</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span>)|]. <span class="id">intros</span> <span class="id">n</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">reflexivity</span>]. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>; <span class="id">f_equal</span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_subst_comp">liftn_subst_comp</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">us1</span> <span class="id">us2</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#comp">comp</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> <span class="id">us1</span>)) (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> <span class="id">us2</span>) <span class="id">n</span> = <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> (<span class="id"><a href="STerm.html#comp">comp</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us1</span>) <span class="id">us2</span>) <span class="id">n</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">p</span> <span class="id">us1</span> <span class="id">us2</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="STerm.html#ren_subst">ren_subst</a></span>, <span class="id"><a href="STerm.html#subst_ren">subst_ren</a></span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">m</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [<span class="id">lia</span>|]. <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_subst_1">liftn_subst_1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> 1 <span class="id">us</span> <span class="id">n</span> = <span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span> <span class="id">us</span> <span class="id">n</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>, <span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n</span> <span class="kwd">as</span> [|<span class="id">n</span>]; <span class="id">simpl</span> <span class="kwd">in</span> *; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.sub_0_r">Nat.sub_0_r</a></span>. <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_subst_add">liftn_subst_add</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">p</span> <span class="id">q</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">q</span> <span class="id">us</span>) <span class="id">n</span> = <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> (<span class="id">p</span> + <span class="id">q</span>) <span class="id">us</span> <span class="id">n</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">p</span> <span class="id">q</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>.<br/>
&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; <span class="id">try</span> <span class="id">lia</span>; <span class="id">try</span> <span class="id">rewrite</span> !<span class="id"><a href="STerm.html#ren_ren">ren_ren</a></span>; <span class="id">simpl</span>; <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="STerm.html#renv_ext">renv_ext</a></span>; <span class="id">intros</span> <span class="id">m</span>; <span class="id">rewrite</span> <span class="id"><a href="STerm.html#renv_comp_correct">renv_comp_correct</a></span>, !<span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_subst_0">liftn_subst_0</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> 0 <span class="id">us</span> <span class="id">n</span> = <span class="id">us</span> <span class="id">n</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.sub_0_r">Nat.sub_0_r</a></span>, <span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>, <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>, <span class="id"><a href="STerm.html#subst_id">subst_id</a></span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="read_env">read_env</a></span> (<span class="id">e</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="STerm.html#term">term</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">e</span> <span class="id">n</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">u</span> =&gt; <span class="id">u</span> | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> (<span class="id">n</span> - <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>) <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_env_0">read_env_0</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">e</span>, <span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id">t</span> :: <span class="id">e</span>) 0 = <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_env_S">read_env_S</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">e</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id">t</span> :: <span class="id">e</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) = <span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">e</span> <span class="id">n</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_env_app">read_env_app</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id">e1</span> ++ <span class="id">e2</span>) <span class="id">n</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">e1</span>) (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e1</span>) (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">e2</span>) <span class="id">n</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">by</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">Hn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>, <span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_id">subst_id</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">m</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_None_rw">nth_error_None_rw</a></span> <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_None_rw">nth_error_None_rw</a></span> <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app1">nth_error_app1</a></span> <span class="kwd">by</span> <span class="id">assumption</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">Hnth</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="size">size</a></span> <span class="id">t</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> =&gt; 0<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span> =&gt; 0<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">size</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#app">app</a></span> <span class="id">t1</span> <span class="id">t2</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">size</span> <span class="id">t1</span> + <span class="id">size</span> <span class="id">t2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="Misc.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">t</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">size</span> <span class="id">t</span>)) <span class="id">l</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">m</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">size</span> <span class="id">t</span> + <span class="id"><a href="Misc.html#list_sum">list_sum</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">pt2</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">size</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt2</span>))) <span class="id">m</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="closed_at">closed_at</a></span> : <span class="id"><a href="STerm.html#term">term</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="closed_at_var">closed_at_var</a></span> : <span class="kwd">forall</span> <span class="id">n</span> <span class="id">k</span>, <span class="id">n</span> &lt; <span class="id">k</span> -&gt; <span class="id">closed_at</span> (<span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span>) <span class="id">k</span><br/>
| <span class="id"><a name="closed_at_dvar">closed_at_dvar</a></span> : <span class="kwd">forall</span> <span class="id">n</span> <span class="id">k</span>, <span class="id">closed_at</span> (<span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span>) <span class="id">k</span><br/>
| <span class="id"><a name="closed_at_app">closed_at_app</a></span> : <span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">k</span>, <span class="id">closed_at</span> <span class="id">t1</span> <span class="id">k</span> -&gt; <span class="id">closed_at</span> <span class="id">t2</span> <span class="id">k</span> -&gt; <span class="id">closed_at</span> (<span class="id"><a href="STerm.html#app">app</a></span> <span class="id">t1</span> <span class="id">t2</span>) <span class="id">k</span><br/>
| <span class="id"><a name="closed_at_abs">closed_at_abs</a></span> : <span class="kwd">forall</span> <span class="id">t</span> <span class="id">k</span>, <span class="id">closed_at</span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">k</span>) -&gt; <span class="id">closed_at</span> (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span>) <span class="id">k</span><br/>
| <span class="id"><a name="closed_at_constr">closed_at_constr</a></span> : <span class="kwd">forall</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">k</span>, (<span class="kwd">forall</span> <span class="id">t</span>, <span class="id">t</span> \<span class="kwd">in</span> <span class="id">l</span> -&gt; <span class="id">closed_at</span> <span class="id">t</span> <span class="id">k</span>) -&gt; <span class="id">closed_at</span> (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span>) <span class="id">k</span><br/>
| <span class="id"><a name="closed_at_switch">closed_at_switch</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">m</span> <span class="id">k</span>, <span class="id">closed_at</span> <span class="id">t</span> <span class="id">k</span> -&gt; (<span class="kwd">forall</span> <span class="id">p</span> <span class="id">t2</span>, (<span class="id">p</span>, <span class="id">t2</span>) \<span class="kwd">in</span> <span class="id">m</span> -&gt; <span class="id">closed_at</span> <span class="id">t2</span> (<span class="id">p</span> + <span class="id">k</span>)) -&gt; <span class="id">closed_at</span> (<span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">m</span>) <span class="id">k</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst_closed_at_ext">subst_closed_at_ext</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">k</span> <span class="id">us1</span> <span class="id">us2</span>, <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> <span class="id">k</span> -&gt; (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">n</span> &lt; <span class="id">k</span> -&gt; <span class="id">us1</span> <span class="id">n</span> = <span class="id">us2</span> <span class="id">n</span>) -&gt; <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us1</span> <span class="id">t</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us2</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">k</span> <span class="id">us1</span> <span class="id">us2</span> <span class="id">Hclosed</span> <span class="id">Hext</span>; <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">Hext</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">eapply</span> <span class="id">IHt</span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>] <span class="id">Hn</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id">Hext</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">eapply</span> <span class="id">IHt1</span> | <span class="id">eapply</span> <span class="id">IHt2</span>]; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>; <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">eapply</span> <span class="id">H</span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H3</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">eapply</span> <span class="id">IHt</span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>; <span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>. <span class="id">simpl</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">eapply</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span>); [<span class="id">apply</span> <span class="id">H4</span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span> <span class="id">Hn</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id">Hext</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst_closed_at_id">subst_closed_at_id</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">t</span> <span class="id">k</span>, <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> <span class="id">k</span> -&gt; (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">n</span> &lt; <span class="id">k</span> -&gt; <span class="id">us</span> <span class="id">n</span> = <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span>) -&gt; <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t</span> = <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">t</span> <span class="id">k</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_closed_at_ext">subst_closed_at_ext</a></span>; [<span class="id">apply</span> <span class="id"><a href="STerm.html#subst_id">subst_id</a></span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="closed_at_ren">closed_at_ren</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">ren</span> <span class="id">k1</span> <span class="id">k2</span>, <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> <span class="id">k1</span> -&gt; (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id">n</span> &lt; <span class="id">k1</span> -&gt; <span class="id"><a href="STerm.html#renv">renv</a></span> <span class="id">ren</span> <span class="id">n</span> &lt; <span class="id">k2</span>) -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">ren</span> <span class="id">t</span>) <span class="id">k2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">ren</span> <span class="id">k1</span> <span class="id">k2</span> <span class="id">Ht</span> <span class="id">Hren</span>; <span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">Hren</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">eapply</span> <span class="id">IHt</span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">rewrite</span> <span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>; [<span class="id">lia</span>|]. <span class="id">intros</span>; <span class="id">specialize</span> (<span class="id">Hren</span> <span class="id">n</span>); <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; [<span class="id">eapply</span> <span class="id">IHt1</span>|<span class="id">eapply</span> <span class="id">IHt2</span>]; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">rewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">apply</span> <span class="id">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> [<span class="id">IH</span> <span class="id">Ht2</span>]; <span class="id">eapply</span> <span class="id">IH</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; [<span class="id">eapply</span> <span class="id">IHt</span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">p</span> <span class="id">t2</span> <span class="id">Hpt2</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hpt2</span>; <span class="id">destruct</span> <span class="id">Hpt2</span> <span class="kwd">as</span> [[<span class="id">p3</span> <span class="id">t3</span>] [<span class="id">Hpt2</span> <span class="id">Hpt3</span>]]; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">injection</span> <span class="id">Hpt2</span> <span class="kwd">as</span> <span class="id">Hpt2</span>; <span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt3</span>); <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">H</span>; [<span class="id">apply</span> <span class="id">H4</span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span> <span class="id">Hn</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> <span class="id">p</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span> <span class="kwd">by</span> <span class="id">assumption</span>. <span class="id">specialize</span> (<span class="id">Hren</span> (<span class="id">n</span> - <span class="id">p</span>)); <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_small">liftn_renv_small</a></span> <span class="kwd">by</span> <span class="id">assumption</span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="closed_at_plus_ren">closed_at_plus_ren</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">p</span> <span class="id">k</span>, <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> <span class="id">k</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> <span class="id">p</span>) <span class="id">t</span>) (<span class="id">p</span> + <span class="id">k</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">p</span> <span class="id">k</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="STerm.html#closed_at_ren">closed_at_ren</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span> <span class="id">Hn</span>; <span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="closed_at_subst_read_env_lift">closed_at_subst_read_env_lift</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">k</span> <span class="id">p</span> <span class="id">el</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">t</span> =&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> <span class="id">k</span>) <span class="id">el</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id">p</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">el</span> + <span class="id">k</span>) -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>)) <span class="id">t</span>) (<span class="id">p</span> + <span class="id">k</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">k</span> <span class="id">p</span> <span class="id">el</span> <span class="id">Hel</span> <span class="id">Ht</span>; <span class="id">revert</span> <span class="id">p</span> <span class="id">Ht</span>; <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">p</span> <span class="id">Ht</span>; <span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="STerm.html#closed_at_plus_ren">closed_at_plus_ren</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hel</span>. <span class="id">eapply</span> <span class="id">Hel</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>, <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">simpl</span>. <span class="id">constructor</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [|<span class="id">intros</span> <span class="id">n</span>; <span class="id">rewrite</span> &lt;- <span class="id"><a href="STerm.html#liftn_subst_1">liftn_subst_1</a></span>; <span class="id">apply</span> <span class="id"><a href="STerm.html#liftn_subst_add">liftn_subst_add</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHt</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; [<span class="id">apply</span> <span class="id">IHt1</span>|<span class="id">apply</span> <span class="id">IHt2</span>]; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">rewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">apply</span> <span class="id">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> [<span class="id">IH</span> <span class="id">Ht2</span>]; <span class="id">eapply</span> <span class="id">IH</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; [<span class="id">apply</span> <span class="id">IHt</span>; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">p2</span> <span class="id">t2</span> <span class="id">Hpt2</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hpt2</span>; <span class="id">destruct</span> <span class="id">Hpt2</span> <span class="kwd">as</span> [[<span class="id">p3</span> <span class="id">t3</span>] [<span class="id">Hpt2</span> <span class="id">Hpt3</span>]]; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">injection</span> <span class="id">Hpt2</span> <span class="kwd">as</span> <span class="id">Hpt2</span>; <span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt3</span>); <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Plus.html#plus_assoc">plus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [|<span class="id">apply</span> <span class="id"><a href="STerm.html#liftn_subst_add">liftn_subst_add</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">H</span>. <span class="id">specialize</span> (<span class="id">H4</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hpt3</span>). <span class="id">rewrite</span> !<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Plus.html#plus_assoc">plus_assoc</a></span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="closed_at_subst_read_env">closed_at_subst_read_env</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">k</span> <span class="id">el</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">t</span> =&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> <span class="id">k</span>) <span class="id">el</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">el</span> + <span class="id">k</span>) -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>) <span class="id">t</span>) <span class="id">k</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">k</span> <span class="id">el</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">assert</span> (<span class="id">H</span> := <span class="id"><a href="STerm.html#closed_at_subst_read_env_lift">closed_at_subst_read_env_lift</a></span> <span class="id">t</span> <span class="id">k</span> 0 <span class="id">el</span> <span class="id">H1</span> <span class="id">H2</span>).<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span> <span class="kwd">in</span> <span class="id">H</span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#liftn_subst_0">liftn_subst_0</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="closed_at_mono">closed_at_mono</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">n</span> <span class="id">m</span>, <span class="id">n</span> &lt;= <span class="id">m</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> <span class="id">n</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> <span class="id">m</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">n</span> <span class="id">m</span> <span class="id">Hnm</span> <span class="id">H</span>; <span class="id">revert</span> <span class="id">m</span> <span class="id">Hnm</span>. <span class="id">induction</span> <span class="id">H</span>; <span class="id">intros</span> <span class="id">n2</span> <span class="id">Hn</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHclosed_at1</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHclosed_at2</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHclosed_at</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>; <span class="id">apply</span> <span class="id">H0</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHclosed_at</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span>; <span class="id">eapply</span> <span class="id">H1</span>; [<span class="id">eassumption</span>|<span class="id">lia</span>].<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_subst_read_env">liftn_subst_read_env</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">p</span> <span class="id">e</span>, <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id">p</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>) -&gt; <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">e</span>)) <span class="id">t</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="STerm.html#var">var</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> 0 <span class="id">p</span>) ++ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#ren">ren</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> <span class="id">p</span>))) <span class="id">e</span>)) <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">p</span> <span class="id">e</span> <span class="id">Ht</span>. <span class="id">eapply</span> <span class="id"><a href="STerm.html#subst_closed_at_ext">subst_closed_at_ext</a></span>; [<span class="id">eassumption</span>|]. <span class="id">intros</span> <span class="id">n</span> <span class="id">Hn</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>, <span class="id"><a href="STerm.html#read_env">read_env</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span>; [|<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_length">seq_length</a></span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_length">seq_length</a></span>, <span class="id"><a href="Misc.html#nth_error_map">nth_error_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app1">nth_error_app1</a></span> <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_length">seq_length</a></span>; <span class="id">assumption</span>). <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_map">nth_error_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#seq_nth_error">seq_nth_error</a></span> <span class="kwd">by</span> <span class="id">assumption</span>. <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="env_get_maybe_var">env_get_maybe_var</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">env</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) <span class="id">t</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">env</span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="env_get_maybe_var_in">env_get_maybe_var_in</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>) <span class="id">t</span> (<span class="id">env</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) <span class="id">x</span>, <span class="id"><a href="STerm.html#env_get_maybe_var">env_get_maybe_var</a></span> <span class="id">env</span> <span class="id">t</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> -&gt; <span class="id">x</span> \<span class="kwd">in</span> <span class="id">env</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">t</span> <span class="id">env</span> <span class="id">x</span> <span class="id">H</span>. <span class="id">destruct</span> <span class="id">t</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>. <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst_subst1">subst_subst1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> (<span class="id"><a href="STerm.html#subst1">subst1</a></span> <span class="id">t1</span> <span class="id">t2</span>) = <span class="id"><a href="STerm.html#subst1">subst1</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t1</span>) (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span> <span class="id">us</span>) <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">t1</span> <span class="id">t2</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#subst1">subst1</a></span>. <span class="id">rewrite</span> !<span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">intros</span> [|<span class="id">n</span>].<br/>
&nbsp;&nbsp;* <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;* <span class="id">simpl</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_ren">subst_ren</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etransitivity</span>; [<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_id">subst_id</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>. <span class="id">intros</span> <span class="id">n1</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_ren">lift_ren</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">n</span>, <span class="id"><a href="STerm.html#ren">ren</a></span> (<span class="id"><a href="STerm.html#lift">lift</a></span> <span class="id">r</span>) <span class="id">n</span> = <span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span> (<span class="id"><a href="STerm.html#ren">ren</a></span> <span class="id">r</span>) <span class="id">n</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">r</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#ren">ren</a></span>, <span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span>, <span class="id"><a href="STerm.html#comp">comp</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;<span class="id">f_equal</span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ren_subst1">ren_subst1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">r</span> (<span class="id"><a href="STerm.html#subst1">subst1</a></span> <span class="id">t1</span> <span class="id">t2</span>) = <span class="id"><a href="STerm.html#subst1">subst1</a></span> (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">r</span> <span class="id">t1</span>) (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#lift">lift</a></span> <span class="id">r</span>) <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">r</span> <span class="id">t1</span> <span class="id">t2</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>, <span class="id"><a href="STerm.html#subst_subst1">subst_subst1</a></span>.<br/>
&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span>; <span class="id">rewrite</span> <span class="id"><a href="STerm.html#lift_ren">lift_ren</a></span>; <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst_read_env">subst_read_env</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">l</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">l</span>) <span class="id">t</span>) = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span>) <span class="id">l</span>)) (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>) <span class="id">us</span>) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">l</span> <span class="id">t</span>. <span class="id">rewrite</span> !<span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; <span class="id">intros</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>, <span class="id"><a href="STerm.html#read_env">read_env</a></span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="kwd">as</span> [<span class="id">u</span>|] <span class="id">eqn</span>:<span class="id">Hln</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">l0</span>; <span class="id">congruence</span>|]. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_map">nth_error_map</a></span>, <span class="id">Hln</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hln</span>; <span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_ren">subst_ren</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etransitivity</span>; [<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_id">subst_id</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">m</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>, <span class="id"><a href="STerm.html#ren">ren</a></span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">with</span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="STerm.html#term">term</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">symmetry</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="ren_read_env">ren_read_env</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">l</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">r</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">l</span>) <span class="id">t</span>) = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">r</span>) <span class="id">l</span>)) (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#liftn">liftn</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>) <span class="id">r</span>) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">r</span> <span class="id">l</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>, <span class="id"><a href="STerm.html#subst_read_env">subst_read_env</a></span>.<br/>
&nbsp;&nbsp;<span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext">map_ext</a></span>. <span class="id">intros</span>; <span class="id">rewrite</span> <span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>. <span class="id">intros</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>, <span class="id"><a href="STerm.html#ren">ren</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span>; [<span class="id">reflexivity</span>|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_small">liftn_renv_small</a></span>; [<span class="id">reflexivity</span>|<span class="id">assumption</span>].<br/>
Qed.</details>
<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_liftn_1">lift_liftn_1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="STerm.html#lift">lift</a></span> <span class="id">r</span> = <span class="id"><a href="STerm.html#liftn">liftn</a></span> 1 <span class="id">r</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">r</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#renv_ext">renv_ext</a></span>. <span class="id">intros</span> [|<span class="id">n</span>].<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>, <span class="id"><a href="STerm.html#liftn_renv_small">liftn_renv_small</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="STerm.html#lift_renv">lift_renv</a></span>, <span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span> <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_liftn">liftn_liftn</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span> <span class="id">k1</span> <span class="id">k2</span>, <span class="id"><a href="STerm.html#liftn">liftn</a></span> <span class="id">k1</span> (<span class="id"><a href="STerm.html#liftn">liftn</a></span> <span class="id">k2</span> <span class="id">r</span>) = <span class="id"><a href="STerm.html#liftn">liftn</a></span> (<span class="id">k1</span> + <span class="id">k2</span>) <span class="id">r</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">r</span> <span class="id">k1</span> <span class="id">k2</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#renv_ext">renv_ext</a></span>. <span class="id">intros</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> <span class="id">k1</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span> <span class="kwd">by</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> <span class="id">k2</span> (<span class="id">n</span> - <span class="id">k1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> !<span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span> <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (<span class="id">n</span> - (<span class="id">k1</span> + <span class="id">k2</span>)) <span class="kwd">with</span> (<span class="id">n</span> - <span class="id">k1</span> - <span class="id">k2</span>) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> !<span class="id"><a href="STerm.html#liftn_renv_small">liftn_renv_small</a></span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> !<span class="id"><a href="STerm.html#liftn_renv_small">liftn_renv_small</a></span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_0">liftn_0</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">r</span>, <span class="id"><a href="STerm.html#liftn">liftn</a></span> 0 <span class="id">r</span> = <span class="id">r</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#renv_ext">renv_ext</a></span>. <span class="id">intros</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span> <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_subst_1_subst">liftn_subst_1_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> 1 <span class="id">us</span>) <span class="id">t</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span> <span class="id">us</span>) <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">t</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>, <span class="id"><a href="STerm.html#liftn_subst_1">liftn_subst_1</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_subst_add_subst">liftn_subst_add_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">t</span> <span class="id">k1</span> <span class="id">k2</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">k1</span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">k2</span> <span class="id">us</span>)) <span class="id">t</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> (<span class="id">k1</span> + <span class="id">k2</span>) <span class="id">us</span>) <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>, <span class="id"><a href="STerm.html#liftn_subst_add">liftn_subst_add</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="liftn_subst_0_subst">liftn_subst_0_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> 0 <span class="id">us</span>) <span class="id">t</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">t</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>, <span class="id"><a href="STerm.html#liftn_subst_0">liftn_subst_0</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst1_read_env">subst1_read_env</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="STerm.html#subst1">subst1</a></span> <span class="id">t1</span> <span class="id">t2</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id">t1</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>. <span class="id">intros</span> [|<span class="id">n</span>].<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>. <span class="id">simpl</span>. <span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span>; <span class="id">f_equal</span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_env_app_subst">read_env_app_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">e1</span> <span class="id">e2</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id">e1</span> ++ <span class="id">e2</span>)) <span class="id">t</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">e1</span>) (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e1</span>) (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">e2</span>)) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">e1</span> <span class="id">e2</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#read_env_app">read_env_app</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_env_app_subst1">read_env_app_subst1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">e</span> <span class="id">t2</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id">t2</span> :: <span class="id">e</span>)) <span class="id">t</span> = <span class="id"><a href="STerm.html#subst1">subst1</a></span> <span class="id">t2</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">e</span>)) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">e</span> <span class="id">t2</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst1_read_env">subst1_read_env</a></span>, &lt;- <span class="id"><a href="STerm.html#liftn_subst_1_subst">liftn_subst_1_subst</a></span>, &lt;- <span class="id"><a href="STerm.html#read_env_app_subst">read_env_app_subst</a></span>. <span class="id">reflexivity</span>.<br/>
Qed.</details>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
