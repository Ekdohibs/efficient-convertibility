
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module GenInd</title>
<meta name="description" content="Documentation of Coq module GenInd" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module GenInd</h1>
<div class="coq">
<span class="kwd">From</span> <span class="kwd">Ltac2</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="kwd">Ltac2</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Rewrite.html">Rewrite</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Misc.html">Misc</a></span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">eassumption_tac</span> () := <span class="id">ltac1</span>:(<span class="id">eassumption</span>).<br/>
<span class="kwd">Ltac2</span> <span class="kwd">Notation</span> <span class="id">eassumption</span> := <span class="id">eassumption_tac</span> ().<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="proj1_transparent">proj1_transparent</a></span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Prop</span>} (<span class="id">H</span> : <span class="id">A</span> /\ <span class="id">B</span>) : <span class="id">A</span> := <span class="kwd">match</span> <span class="id">H</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">P</span> <span class="id">Q</span> =&gt; <span class="id">P</span> <span class="kwd">end</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="proj2_transparent">proj2_transparent</a></span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Prop</span>} (<span class="id">H</span> : <span class="id">A</span> /\ <span class="id">B</span>) : <span class="id">B</span> := <span class="kwd">match</span> <span class="id">H</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">P</span> <span class="id">Q</span> =&gt; <span class="id">Q</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Exists_impl_transparent">Exists_impl_transparent</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>) (<span class="id">P</span> <span class="id">Q</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>) (<span class="id">L</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>), (<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">P</span> <span class="id">x</span> -&gt; <span class="id">Q</span> <span class="id">x</span>) -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> <span class="id">P</span> <span class="id">L</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> <span class="id">Q</span> <span class="id">L</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">L</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">induction</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_cons_hd">Exists_cons_hd</a></span>, <span class="id">H1</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_cons_tl">Exists_cons_tl</a></span>, <span class="id">IHExists</span>.<br/>
Defined.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Exists_impl_strong_transparent">Exists_impl_strong_transparent</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>) (<span class="id">P</span> <span class="id">Q</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>) (<span class="id">L</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>), (<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">P</span> <span class="id">x</span> -&gt; <span class="id">Q</span> <span class="id">x</span>) -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> <span class="id">P</span> <span class="id">L</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">P</span> <span class="id">x</span> /\ <span class="id">Q</span> <span class="id">x</span>) <span class="id">L</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">L</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">eapply</span> <span class="id"><a href="GenInd.html#Exists_impl_transparent">Exists_impl_transparent</a></span> &gt; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">split</span> &gt; [<span class="id">apply</span> <span class="id">Hx</span>|<span class="id">apply</span> <span class="id">H1</span>, <span class="id">Hx</span>].<br/>
Defined.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Forall3_impl_transparent">Forall3_impl_transparent</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> : <span class="kwd">Type</span>) (<span class="id">P</span> <span class="id">Q</span> : <span class="id">A</span> -&gt; <span class="id">B</span> -&gt; <span class="id">C</span> -&gt; <span class="kwd">Prop</span>) (<span class="id">l1</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">l2</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">B</span>) (<span class="id">l3</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">C</span>), (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">P</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> -&gt; <span class="id">Q</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>) -&gt; <span class="id"><a href="Misc.html#Forall3">Forall3</a></span> <span class="id">P</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">l3</span> -&gt; <span class="id"><a href="Misc.html#Forall3">Forall3</a></span> <span class="id">Q</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">l3</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">l3</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">induction</span> <span class="id">H2</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">H1</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
Defined.</details>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="if_Some">if_Some</a></span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="if_Some_None">if_Some_None</a></span> : <span class="id">if_Some</span> <span class="id">P</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a name="if_Some_Some">if_Some_Some</a></span> : <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">P</span> <span class="id">x</span> -&gt; <span class="id">if_Some</span> <span class="id">P</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="if_Some_impl_transparent">if_Some_impl_transparent</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>) (<span class="id">P</span> <span class="id">Q</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>) (<span class="id">x</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span>), (<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">P</span> <span class="id">x</span> -&gt; <span class="id">Q</span> <span class="id">x</span>) -&gt; <span class="id"><a href="GenInd.html#if_Some">if_Some</a></span> <span class="id">P</span> <span class="id">x</span> -&gt; <span class="id"><a href="GenInd.html#if_Some">if_Some</a></span> <span class="id">Q</span> <span class="id">x</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">x</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">apply</span> <span class="id">H1</span>. <span class="id">assumption</span>.<br/>
Defined.</details>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="if_Some2">if_Some2</a></span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="id">B</span> -&gt; <span class="kwd">Prop</span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">B</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="if_Some2_None">if_Some2_None</a></span> : <span class="id">if_Some2</span> <span class="id">P</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a name="if_Some2_Some">if_Some2_Some</a></span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">P</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">if_Some2</span> <span class="id">P</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="if_Some2_impl_transparent">if_Some2_impl_transparent</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>) (<span class="id">P</span> <span class="id">Q</span> : <span class="id">A</span> -&gt; <span class="id">B</span> -&gt; <span class="kwd">Prop</span>) (<span class="id">x</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span>) (<span class="id">y</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">B</span>), (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>, <span class="id">P</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id">Q</span> <span class="id">x</span> <span class="id">y</span>) -&gt; <span class="id"><a href="GenInd.html#if_Some2">if_Some2</a></span> <span class="id">P</span> <span class="id">x</span> <span class="id">y</span> -&gt; <span class="id"><a href="GenInd.html#if_Some2">if_Some2</a></span> <span class="id">Q</span> <span class="id">x</span> <span class="id">y</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">x</span> <span class="id">y</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">apply</span> <span class="id">H1</span>. <span class="id">assumption</span>.<br/>
Defined.</details>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="if_Some3">if_Some3</a></span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> : <span class="kwd">Type</span>} (<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="id">B</span> -&gt; <span class="id">C</span> -&gt; <span class="kwd">Prop</span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">B</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">C</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="if_Some3_None">if_Some3_None</a></span> : <span class="id">if_Some3</span> <span class="id">P</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a name="if_Some3_Some">if_Some3_Some</a></span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">P</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> -&gt; <span class="id">if_Some3</span> <span class="id">P</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">z</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="if_Some3_impl_transparent">if_Some3_impl_transparent</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> : <span class="kwd">Type</span>) (<span class="id">P</span> <span class="id">Q</span> : <span class="id">A</span> -&gt; <span class="id">B</span> -&gt; <span class="id">C</span> -&gt; <span class="kwd">Prop</span>) (<span class="id">x</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span>) (<span class="id">y</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">B</span>) (<span class="id">z</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">C</span>), (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>, <span class="id">P</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> -&gt; <span class="id">Q</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>) -&gt; <span class="id"><a href="GenInd.html#if_Some3">if_Some3</a></span> <span class="id">P</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> -&gt; <span class="id"><a href="GenInd.html#if_Some3">if_Some3</a></span> <span class="id">Q</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">apply</span> <span class="id">H1</span>. <span class="id">assumption</span>.<br/>
Defined.</details>
<br/>
<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">msg_list_concat</span> (<span class="id">l</span> : <span class="id">message</span> <span class="id">list</span>) (<span class="id">sep</span> : <span class="id">message</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id">Message.of_string</span> ""<br/>
&nbsp;&nbsp;| <span class="id">x</span> :: <span class="id">l</span> =&gt; <span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">m</span> <span class="id">x</span> =&gt; <span class="id">Message.concat</span> <span class="id">m</span> (<span class="id">Message.concat</span> <span class="id">sep</span> <span class="id">x</span>)) <span class="id">l</span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">message_concat_list</span> (<span class="id">l</span> : <span class="id">message</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">m1</span> <span class="id">m2</span> =&gt; <span class="id">Message.concat</span> <span class="id">m1</span> <span class="id">m2</span>) <span class="id">l</span> (<span class="id">Message.of_string</span> "").<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">message_of_hyps</span> () :=<br/>
&nbsp;&nbsp;<span class="id">message_concat_list</span> (<span class="id">List.map</span> (<span class="kwd">fun</span> (<span class="id">id</span>, <span class="id">_</span>, <span class="id">c</span>) =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_ident</span> <span class="id">id</span>; <span class="id">Message.of_string</span> " : "; <span class="id">Message.of_constr</span> <span class="id">c</span>; <span class="id">Message.of_string</span> "<br/>
"]) (<span class="id">Control.hyps</span> ())).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">typed_constr_message</span> (<span class="id">c</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">Message.concat</span> (<span class="id">Message.concat</span> (<span class="id">Message.of_constr</span> <span class="id">c</span>) (<span class="id">Message.of_string</span> " : ")) (<span class="id">Message.of_constr</span> (<span class="id">Constr.type</span> <span class="id">c</span>)).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">msg_of_binder</span> (<span class="id">b</span> : <span class="id">binder</span>) :=<br/>
&nbsp;&nbsp;<span class="id">Message.concat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">match</span> <span class="id">Constr.Binder.name</span> <span class="id">b</span> <span class="kwd">with</span> <span class="id">None</span> =&gt; <span class="id">Message.of_string</span> "<span class="id">_</span>" | <span class="id">Some</span> <span class="id">x</span> =&gt; <span class="id">Message.of_ident</span> <span class="id">x</span> <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Message.concat</span> (<span class="id">Message.of_string</span> " : ")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">typed_constr_message</span> (<span class="id">Constr.Binder.type</span> <span class="id">b</span>))).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">msg_of_list</span> (<span class="id">l</span> : <span class="id">message</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "[" ; <span class="id">msg_list_concat</span> <span class="id">l</span> (<span class="id">Message.of_string</span> "; "); <span class="id">Message.of_string</span> "]"].<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">msg_of_array</span> (<span class="id">a</span> : <span class="id">message</span> <span class="id">array</span>) :=<br/>
&nbsp;&nbsp;<span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "[|" ; <span class="id">msg_list_concat</span> (<span class="id">Array.to_list</span> <span class="id">a</span>) (<span class="id">Message.of_string</span> "; "); <span class="id">Message.of_string</span> "|]"].<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">show_constr_kind</span> (<span class="id">c</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">sp</span> := <span class="id">Message.of_string</span> " " <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Constr.Unsafe.kind</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Rel</span> <span class="id">n</span> =&gt; <span class="id">Message.concat</span> (<span class="id">Message.of_string</span> "<span class="id">Rel</span> ") (<span class="id">Message.of_int</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Var</span> <span class="id">x</span> =&gt; <span class="id">Message.concat</span> (<span class="id">Message.of_string</span> "<span class="id">Var</span> ") (<span class="id">Message.of_ident</span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Meta</span> <span class="id">_</span> =&gt; <span class="id">Message.of_string</span> "<span class="id">Meta</span> <span class="id">_</span>"<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Evar</span> <span class="id">e</span> <span class="id">ca</span> =&gt; <span class="id">Message.concat</span> (<span class="id">Message.of_string</span> "<span class="id">Evar</span> <span class="id">_</span> ") (<span class="id">msg_of_array</span> (<span class="id">Array.map</span> <span class="id">Message.of_constr</span> <span class="id">ca</span>))<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Sort</span> <span class="id">_</span> =&gt; <span class="id">Message.of_string</span> "<span class="id">Sort</span> <span class="id">_</span>"<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Cast</span> <span class="id">c1</span> <span class="id">_</span> <span class="id">c2</span> =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "<span class="id">Cast</span> " ; <span class="id">Message.of_constr</span> <span class="id">c1</span> ; <span class="id">Message.of_string</span> " <span class="id">_</span> " ; <span class="id">Message.of_constr</span> <span class="id">c2</span>]<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Prod</span> <span class="id">b</span> <span class="id">c</span> =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "<span class="id">Prod</span> " ; <span class="id">msg_of_binder</span> <span class="id">b</span> ; <span class="id">sp</span> ; <span class="id">Message.of_constr</span> <span class="id">c</span>]<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Lambda</span>  <span class="id">b</span> <span class="id">c</span> =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "<span class="id">Lambda</span> " ; <span class="id">msg_of_binder</span> <span class="id">b</span> ; <span class="id">sp</span> ; <span class="id">Message.of_constr</span> <span class="id">c</span>]<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.LetIn</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "<span class="id">LetIn</span> " ; <span class="id">msg_of_binder</span> <span class="id">b</span> ; <span class="id">sp</span> ; <span class="id">Message.of_constr</span> <span class="id">c1</span> ; <span class="id">sp</span> ; <span class="id">Message.of_constr</span> <span class="id">c2</span>]<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.App</span> <span class="id">c</span> <span class="id">ca</span> =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "<span class="id">App</span> " ; <span class="id">Message.of_constr</span> <span class="id">c</span> ; <span class="id">sp</span>; <span class="id">msg_of_array</span> (<span class="id">Array.map</span> <span class="id">Message.of_constr</span> <span class="id">ca</span>)]<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Constant</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">Message.of_string</span> "<span class="id">Constant</span> <span class="id">_</span> <span class="id">_</span>"<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Ind</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">Message.of_string</span> "<span class="id">Ind</span> <span class="id">_</span> <span class="id">_</span>"<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Constructor</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">Message.of_string</span> "<span class="id">Constructor</span> <span class="id">_</span> <span class="id">_</span>"<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Case</span> <span class="id">_</span> <span class="id">c1</span> <span class="id">ci</span> <span class="id">c2</span> <span class="id">ca</span> =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "<span class="id">Case</span> <span class="id">_</span> " ; <span class="id">Message.of_constr</span> <span class="id">c1</span> ; <span class="id">sp</span> ; <span class="kwd">match</span> <span class="id">ci</span> <span class="kwd">with</span> <span class="id">Constr.Unsafe.NoInvert</span> =&gt; <span class="id">Message.of_string</span> "<span class="id">NoInvert</span>" | <span class="id">Constr.Unsafe.CaseInvert</span> <span class="id">ca</span> =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "(<span class="id">CaseInvert</span> "; <span class="id">msg_of_array</span> (<span class="id">Array.map</span> <span class="id">Message.of_constr</span> <span class="id">ca</span>); <span class="id">Message.of_string</span> ")"] <span class="kwd">end</span> ; <span class="id">sp</span> ; <span class="id">Message.of_constr</span> <span class="id">c2</span> ; <span class="id">sp</span> ; <span class="id">msg_of_array</span> (<span class="id">Array.map</span> <span class="id">Message.of_constr</span> <span class="id">ca</span>) ]<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Fix</span> <span class="id">ia</span> <span class="id">i</span> <span class="id">ba</span> <span class="id">ca</span> =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "<span class="id">Fix</span> "; <span class="id">msg_of_array</span> (<span class="id">Array.map</span> <span class="id">Message.of_int</span> <span class="id">ia</span>); <span class="id">sp</span> ; <span class="id">Message.of_int</span> <span class="id">i</span> ; <span class="id">sp</span> ; <span class="id">msg_of_array</span> (<span class="id">Array.map</span> <span class="id">msg_of_binder</span> <span class="id">ba</span>) ; <span class="id">sp</span> ; <span class="id">msg_of_array</span> (<span class="id">Array.map</span> <span class="id">Message.of_constr</span> <span class="id">ca</span>)]<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.CoFix</span> <span class="id">i</span> <span class="id">ba</span> <span class="id">ca</span> =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "<span class="id">CoFix</span> "; <span class="id">Message.of_int</span> <span class="id">i</span> ; <span class="id">sp</span> ; <span class="id">msg_of_array</span> (<span class="id">Array.map</span> <span class="id">msg_of_binder</span> <span class="id">ba</span>) ; <span class="id">sp</span> ; <span class="id">msg_of_array</span> (<span class="id">Array.map</span> <span class="id">Message.of_constr</span> <span class="id">ca</span>)]<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Proj</span> <span class="id">_</span> <span class="id">c</span> =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "<span class="id">Proj</span> <span class="id">_</span> "; <span class="id">Message.of_constr</span> <span class="id">c</span>]<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Uint63</span> <span class="id">_</span> =&gt; <span class="id">Message.of_string</span> "<span class="id">Uint63</span> <span class="id">_</span>"<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Float</span> <span class="id">_</span> =&gt; <span class="id">Message.of_string</span> "<span class="id">Float</span> <span class="id">_</span>"<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Array</span> <span class="id">_</span> <span class="id">ca</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">message_concat_list</span> [<span class="id">Message.of_string</span> "<span class="id">Array</span> <span class="id">_</span> "; <span class="id">msg_of_array</span> (<span class="id">Array.map</span> <span class="id">Message.of_constr</span> <span class="id">ca</span>) ; <span class="id">sp</span> ; <span class="id">Message.of_constr</span> <span class="id">c1</span> ; <span class="id">sp</span> ; <span class="id">Message.of_constr</span> <span class="id">c2</span>]<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Ltac2</span> <span class="id">get_binder_maybe</span> (<span class="id">c</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Constr.Unsafe.kind</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Prod</span> <span class="id">b</span> <span class="id">_</span> =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Lambda</span> <span class="id">b</span> <span class="id">_</span> =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.LetIn</span> <span class="id">b</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">get_binder</span> (<span class="id">c</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">get_binder_maybe</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">b</span> =&gt; <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">Control.throw</span> (<span class="id">Invalid_argument</span> (<span class="id">Some</span> (<span class="id">Message.of_constr</span> <span class="id">c</span>)))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">head_binder_ident</span> (<span class="id">c</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">Fresh.in_goal</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">get_binder_maybe</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; @<span class="id">_x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">b</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Constr.Binder.name</span> <span class="id">b</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; @<span class="id">_x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span> =&gt; <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">rebuild_lam</span> (<span class="id">t</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Constr.Unsafe.kind</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Lambda</span> <span class="id">b</span> <span class="id">t1</span> =&gt; <span class="id">Constr.Unsafe.make</span> (<span class="id">Constr.Unsafe.Lambda</span> <span class="id">b</span> (<span class="id">rebuild_lam</span> <span class="id">t1</span>))<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">rebuild_prod_cast</span> (<span class="id">t</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Constr.Unsafe.kind</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Prod</span> <span class="id">b</span> <span class="id">t1</span> =&gt; <span class="id">Constr.Unsafe.make</span> (<span class="id">Constr.Unsafe.Prod</span> <span class="id">b</span> (<span class="id">rebuild_prod_cast</span> <span class="id">t1</span>))<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Lambda</span> <span class="id">b</span> <span class="id">t1</span> =&gt; <span class="id">Constr.Unsafe.make</span> (<span class="id">Constr.Unsafe.Lambda</span> <span class="id">b</span> (<span class="id">rebuild_prod_cast</span> <span class="id">t1</span>))<br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Cast</span> <span class="id">t1</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">rebuild_prod_cast</span> <span class="id">t1</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">force_prop</span> (<span class="id">tac</span> : <span class="id">unit</span> -&gt; <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;'(<span class="id">ltac2</span>:(<span class="id">Control.refine</span> <span class="id">tac</span>) : <span class="kwd">Prop</span>).<br/>
<span class="kwd">Ltac2</span> <span class="id">force_prop_t</span> (<span class="id">tac</span> : <span class="id">unit</span> -&gt; <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;'(<span class="id">ltac2</span>:(<span class="id">Control.refine</span> <span class="id">tac</span>) : <span class="id">_</span> : <span class="kwd">Prop</span>).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">inctx</span> (<span class="id">name</span> : <span class="id">ident</span>) (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">body</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">rebuild_lam</span> (<span class="id">Constr.in_context</span> <span class="id">name</span> <span class="id">t</span> (<span class="kwd">fun</span> () =&gt; <span class="id">Control.refine</span> (<span class="kwd">fun</span> () =&gt; <span class="id">body</span> (<span class="id">Control.hyp</span> <span class="id">name</span>)))).<br/>
<span class="kwd">Ltac2</span> <span class="id">inctx_p</span> (<span class="id">name</span> : <span class="id">ident</span>) (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">body</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">force_prop_t</span> (<span class="kwd">fun</span> () =&gt; <span class="id">inctx</span> <span class="id">name</span> <span class="id">t</span> <span class="id">body</span>).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">make_forall</span> (<span class="id">c</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Constr.Unsafe.kind</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Lambda</span> <span class="id">b</span> <span class="id">t</span> =&gt; <span class="id">Constr.Unsafe.make</span> (<span class="id">Constr.Unsafe.Prod</span> <span class="id">b</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Control.throw</span> (<span class="id">Invalid_argument</span> (<span class="id">Some</span> (<span class="id">Message.of_constr</span> <span class="id">c</span>)))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_app</span> (<span class="id">u</span> : <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) := '($<span class="id">u</span> $<span class="id">v</span>).<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_app2</span> (<span class="id">u</span> : <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) (<span class="id">w</span> : <span class="id">constr</span>) := '($<span class="id">u</span> $<span class="id">v</span> $<span class="id">w</span>).<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_app3</span> (<span class="id">u</span> : <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) (<span class="id">w</span> : <span class="id">constr</span>) (<span class="id">x</span> : <span class="id">constr</span>) := '($<span class="id">u</span> $<span class="id">v</span> $<span class="id">w</span> $<span class="id">x</span>).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_forall_proof_smart</span> (<span class="id">x</span> : <span class="id">ident</span>) (<span class="id">u</span> : <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> <span class="id">u</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> =&gt; <span class="id">v</span> '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;| ?<span class="id">u</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">vx</span> := <span class="id">inctx_p</span> <span class="id">x</span> <span class="id">u</span> <span class="id">v</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">vx</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">_</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) =&gt; '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">vx</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_Forall_proof_smart</span> (<span class="id">x</span> : <span class="id">ident</span>) (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">u</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ux</span> := <span class="id">inctx_p</span> <span class="id">x</span> <span class="id">t</span> <span class="id">u</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">ux</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="id">_</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) =&gt; '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; '(<span class="id"><a href="Misc.html#Forall_True_transparent">Forall_True_transparent</a></span> $<span class="id">t</span> <span class="id">_</span> $<span class="id">v</span> $<span class="id">ux</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_and_proof_smart</span> (<span class="id">u</span> : <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ut</span> := <span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">u</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">vt</span> := <span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">v</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! '($<span class="id">ut</span> /\ $<span class="id">vt</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> /\ <span class="id">_</span> =&gt; <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> =&gt; <span class="id">u</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; '(<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> $<span class="id">u</span> $<span class="id">v</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_Forall_impl_smart</span> (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">p</span> : <span class="id">constr</span>) (<span class="id">l</span> : <span class="id">constr</span>) (<span class="id">u</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ux</span> := <span class="id">inctx_p</span> (<span class="id">head_binder_ident</span> <span class="id">p</span>) <span class="id">t</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt; <span class="id">inctx</span> (<span class="id">Fresh.in_goal</span> @<span class="id">H</span>) (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>) <span class="id">u</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">ux</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">H</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) =&gt; '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; '(<span class="id"><a href="Misc.html#Forall_impl_transparent">Forall_impl_transparent</a></span> $<span class="id">t</span> <span class="id">_</span> <span class="id">_</span> $<span class="id">l</span> $<span class="id">ux</span> $<span class="id">v</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_Forall2_impl_smart</span> (<span class="id">t1</span> : <span class="id">constr</span>) (<span class="id">t2</span> : <span class="id">constr</span>) (<span class="id">p</span> : <span class="id">constr</span>) (<span class="id">l1</span> : <span class="id">constr</span>) (<span class="id">l2</span> : <span class="id">constr</span>) (<span class="id">u</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ux</span> := <span class="id">inctx_p</span> (<span class="id">head_binder_ident</span> <span class="id">p</span>) <span class="id">t1</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">y</span> := <span class="id">head_binder_ident</span> (<span class="id">Std.eval_hnf</span> (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> <span class="id">y</span> <span class="id">t2</span> (<span class="kwd">fun</span> <span class="id">yy</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> (<span class="id">Fresh.in_goal</span> @<span class="id">H</span>) (<span class="id">mk_app</span> (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>) <span class="id">yy</span>) <span class="id">u</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">ux</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">H</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) =&gt; '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; '(<span class="id"><a href="Misc.html#Forall2_impl_transparent">Forall2_impl_transparent</a></span> $<span class="id">t1</span> $<span class="id">t2</span> <span class="id">_</span> <span class="id">_</span> $<span class="id">l1</span> $<span class="id">l2</span> $<span class="id">ux</span> $<span class="id">v</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_Forall3_impl_smart</span> (<span class="id">t1</span> : <span class="id">constr</span>) (<span class="id">t2</span> : <span class="id">constr</span>) (<span class="id">t3</span> : <span class="id">constr</span>) (<span class="id">p</span> : <span class="id">constr</span>) (<span class="id">l1</span> : <span class="id">constr</span>) (<span class="id">l2</span> : <span class="id">constr</span>) (<span class="id">l3</span> : <span class="id">constr</span>) (<span class="id">u</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ux</span> := <span class="id">inctx_p</span> (<span class="id">head_binder_ident</span> <span class="id">p</span>) <span class="id">t1</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">y</span> := <span class="id">head_binder_ident</span> (<span class="id">Std.eval_hnf</span> (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> <span class="id">y</span> <span class="id">t2</span> (<span class="kwd">fun</span> <span class="id">yy</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">z</span> := <span class="id">head_binder_ident</span> (<span class="id">Std.eval_hnf</span> (<span class="id">mk_app</span> (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>) <span class="id">yy</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> <span class="id">z</span> <span class="id">t3</span> (<span class="kwd">fun</span> <span class="id">zz</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> (<span class="id">Fresh.in_goal</span> @<span class="id">H</span>) (<span class="id">mk_app</span> (<span class="id">mk_app</span> (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>) <span class="id">yy</span>) <span class="id">zz</span>) <span class="id">u</span>))) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">ux</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">H</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) =&gt; '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; '(<span class="id"><a href="GenInd.html#Forall3_impl_transparent">Forall3_impl_transparent</a></span> $<span class="id">t1</span> $<span class="id">t2</span> $<span class="id">t3</span> <span class="id">_</span> <span class="id">_</span> $<span class="id">l1</span> $<span class="id">l2</span> $<span class="id">l3</span> $<span class="id">ux</span> $<span class="id">v</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_if_Some_impl_smart</span> (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">p</span> : <span class="id">constr</span>) (<span class="id">o</span> : <span class="id">constr</span>) (<span class="id">u</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ux</span> := <span class="id">inctx_p</span> (<span class="id">head_binder_ident</span> <span class="id">p</span>) <span class="id">t</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt; <span class="id">inctx</span> (<span class="id">Fresh.in_goal</span> @<span class="id">H</span>) (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>) <span class="id">u</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">ux</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">H</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) =&gt; '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; '(<span class="id"><a href="GenInd.html#if_Some_impl_transparent">if_Some_impl_transparent</a></span> $<span class="id">t</span> <span class="id">_</span> <span class="id">_</span> $<span class="id">o</span> $<span class="id">ux</span> $<span class="id">v</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_if_Some2_impl_smart</span> (<span class="id">t1</span> : <span class="id">constr</span>) (<span class="id">t2</span> : <span class="id">constr</span>) (<span class="id">p</span> : <span class="id">constr</span>) (<span class="id">o1</span> : <span class="id">constr</span>) (<span class="id">o2</span> : <span class="id">constr</span>) (<span class="id">u</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ux</span> := <span class="id">inctx_p</span> (<span class="id">head_binder_ident</span> <span class="id">p</span>) <span class="id">t1</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">y</span> := <span class="id">head_binder_ident</span> (<span class="id">Std.eval_hnf</span> (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> <span class="id">y</span> <span class="id">t2</span> (<span class="kwd">fun</span> <span class="id">yy</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> (<span class="id">Fresh.in_goal</span> @<span class="id">H</span>) (<span class="id">mk_app</span> (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>) <span class="id">yy</span>) <span class="id">u</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">ux</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">H</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) =&gt; '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; '(<span class="id"><a href="GenInd.html#if_Some2_impl_transparent">if_Some2_impl_transparent</a></span> $<span class="id">t1</span> $<span class="id">t2</span> <span class="id">_</span> <span class="id">_</span> $<span class="id">o1</span> $<span class="id">o2</span> $<span class="id">ux</span> $<span class="id">v</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_if_Some3_impl_smart</span> (<span class="id">t1</span> : <span class="id">constr</span>) (<span class="id">t2</span> : <span class="id">constr</span>) (<span class="id">t3</span> : <span class="id">constr</span>) (<span class="id">p</span> : <span class="id">constr</span>) (<span class="id">o1</span> : <span class="id">constr</span>) (<span class="id">o2</span> : <span class="id">constr</span>) (<span class="id">o3</span> : <span class="id">constr</span>) (<span class="id">u</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ux</span> := <span class="id">inctx_p</span> (<span class="id">head_binder_ident</span> <span class="id">p</span>) <span class="id">t1</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">y</span> := <span class="id">head_binder_ident</span> (<span class="id">Std.eval_hnf</span> (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> <span class="id">y</span> <span class="id">t2</span> (<span class="kwd">fun</span> <span class="id">yy</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">z</span> := <span class="id">head_binder_ident</span> (<span class="id">Std.eval_hnf</span> (<span class="id">mk_app</span> (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>) <span class="id">yy</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> <span class="id">z</span> <span class="id">t3</span> (<span class="kwd">fun</span> <span class="id">zz</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> (<span class="id">Fresh.in_goal</span> @<span class="id">H</span>) (<span class="id">mk_app</span> (<span class="id">mk_app</span> (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>) <span class="id">yy</span>) <span class="id">zz</span>) <span class="id">u</span>))) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">ux</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">H</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) =&gt; '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; '(<span class="id"><a href="GenInd.html#if_Some3_impl_transparent">if_Some3_impl_transparent</a></span> $<span class="id">t1</span> $<span class="id">t2</span> $<span class="id">t3</span> <span class="id">_</span> <span class="id">_</span> $<span class="id">o1</span> $<span class="id">o2</span> $<span class="id">o3</span> $<span class="id">ux</span> $<span class="id">v</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_step_one_impl_smart</span> (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">r</span> : <span class="id">constr</span>) (<span class="id">l1</span> : <span class="id">constr</span>) (<span class="id">l2</span> : <span class="id">constr</span>) (<span class="id">u</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ux</span> := <span class="id">inctx_p</span> (<span class="id">head_binder_ident</span> <span class="id">r</span>) <span class="id">t</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">y</span> := <span class="id">head_binder_ident</span> (<span class="id">Std.eval_hnf</span> (<span class="id">mk_app</span> <span class="id">r</span> <span class="id">xx</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> <span class="id">y</span> <span class="id">t</span> (<span class="kwd">fun</span> <span class="id">yy</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> (<span class="id">Fresh.in_goal</span> @<span class="id">H</span>) (<span class="id">mk_app</span> (<span class="id">mk_app</span> <span class="id">r</span> <span class="id">xx</span>) <span class="id">yy</span>) <span class="id">u</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">ux</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">H</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) =&gt; '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; '(<span class="id"><a href="Rewrite.html#step_one_impl_strong_transparent">step_one_impl_strong_transparent</a></span> $<span class="id">t</span> <span class="id">_</span> <span class="id">_</span> $<span class="id">l1</span> $<span class="id">l2</span> $<span class="id">ux</span> $<span class="id">v</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mk_Exists_impl_smart</span> (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">p</span> : <span class="id">constr</span>) (<span class="id">l</span> : <span class="id">constr</span>) (<span class="id">u</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) (<span class="id">v</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ux</span> := <span class="id">inctx_p</span> (<span class="id">head_binder_ident</span> <span class="id">p</span>) <span class="id">t</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt; <span class="id">inctx</span> (<span class="id">Fresh.in_goal</span> @<span class="id">H</span>) (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>) <span class="id">u</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">ux</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">H</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) =&gt; '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; '(<span class="id"><a href="GenInd.html#Exists_impl_strong_transparent">Exists_impl_strong_transparent</a></span> $<span class="id">t</span> <span class="id">_</span> <span class="id">_</span> $<span class="id">l</span> $<span class="id">ux</span> $<span class="id">v</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">log</span> (<span class="id">c</span> : <span class="id">constr</span>) := <span class="id">Message.print</span> (<span class="id">typed_constr_message</span> <span class="id">c</span>).<br/>
<span class="kwd">Ltac2</span> <span class="id">logged</span> (<span class="id">r</span> : <span class="id">constr</span>) := <span class="id">log</span> <span class="id">r</span>; <span class="id">r</span>.<br/>
<span class="kwd">Ltac2</span> <span class="id">log_context</span> () := <span class="id">Message.print</span> (<span class="id">Message.of_string</span> "<span class="kwd">Context</span>:"); <span class="id">Message.print</span> (<span class="id">message_of_hyps</span> ()).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">is_ind_prefix</span> (<span class="id">ind</span> : <span class="id">constr</span>) (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">args</span> : <span class="id">constr</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Constr.equal</span> <span class="id">t</span> <span class="id">ind</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">List.rev</span> <span class="id">args</span>)<br/>
&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lazy_match</span>! <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| ?<span class="id">t1</span> ?<span class="id">t2</span> =&gt; <span class="id">is_ind_prefix</span> <span class="id">ind</span> <span class="id">t1</span> (<span class="id">t2</span> :: <span class="id">args</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">is_ind_prefix_l</span> (<span class="id">inds</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">l</span> : '<span class="id">a</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">inds</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;| <span class="id">ind</span> :: <span class="id">inds</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">is_ind_prefix</span> <span class="id">ind</span> <span class="id">t</span> [] <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">args</span> =&gt; <span class="id">Some</span> (<span class="id">args</span>, <span class="id">List.hd</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">is_ind_prefix_l</span> <span class="id">inds</span> <span class="id">t</span> (<span class="id">List.tl</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">applist</span> (<span class="id">c</span> : <span class="id">constr</span>) (<span class="id">l</span> : <span class="id">constr</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id">c</span><br/>
&nbsp;&nbsp;| <span class="id">x</span> :: <span class="id">l</span> =&gt; <span class="id">mk_app</span> (<span class="id">applist</span> <span class="id">c</span> <span class="id">l</span>) <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">constrind_hyp</span> (<span class="id">v</span> : <span class="id">constr</span>) (<span class="id">inds</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">hrecs</span> : <span class="id">constr</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t</span> := <span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">v</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">is_ind_prefix_l</span> <span class="id">inds</span> <span class="id">t</span> <span class="id">hrecs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">argshrec</span> =&gt; <span class="kwd">let</span> (<span class="id">args</span>, <span class="id">hrec</span>) := <span class="id">argshrec</span> <span class="kwd">in</span> <span class="id">mk_app</span> (<span class="id">applist</span> <span class="id">hrec</span> <span class="id">args</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lazy_match</span>! <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> ?<span class="id">a</span> =&gt; <span class="id">mk_Forall_proof_smart</span> (<span class="id">Fresh.in_goal</span> @<span class="id">x</span>) <span class="id">a</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">constrind_hyp</span> <span class="id">x</span> <span class="id">inds</span> <span class="id">hrecs</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| @<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> ?<span class="id">t</span> ?<span class="id">p</span> ?<span class="id">l</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mk_Forall_impl_smart</span> <span class="id">t</span> <span class="id">p</span> <span class="id">l</span> (<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">constrind_hyp</span> <span class="id">h</span> <span class="id">inds</span> <span class="id">hrecs</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| @<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> ?<span class="id">t1</span> ?<span class="id">t2</span> ?<span class="id">p</span> ?<span class="id">l1</span> ?<span class="id">l2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mk_Forall2_impl_smart</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">p</span> <span class="id">l1</span> <span class="id">l2</span> (<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">constrind_hyp</span> <span class="id">h</span> <span class="id">inds</span> <span class="id">hrecs</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| @<span class="id"><a href="Misc.html#Forall3">Forall3</a></span> ?<span class="id">t1</span> ?<span class="id">t2</span> ?<span class="id">t3</span> ?<span class="id">p</span> ?<span class="id">l1</span> ?<span class="id">l2</span> ?<span class="id">l3</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mk_Forall3_impl_smart</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span> <span class="id">p</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">l3</span> (<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">constrind_hyp</span> <span class="id">h</span> <span class="id">inds</span> <span class="id">hrecs</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| @<span class="id"><a href="GenInd.html#if_Some">if_Some</a></span> ?<span class="id">t</span> ?<span class="id">p</span> ?<span class="id">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mk_if_Some_impl_smart</span> <span class="id">t</span> <span class="id">p</span> <span class="id">x</span> (<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">constrind_hyp</span> <span class="id">h</span> <span class="id">inds</span> <span class="id">hrecs</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| @<span class="id"><a href="GenInd.html#if_Some2">if_Some2</a></span> ?<span class="id">t1</span> ?<span class="id">t2</span> ?<span class="id">p</span> ?<span class="id">x</span> ?<span class="id">y</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mk_if_Some2_impl_smart</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">p</span> <span class="id">x</span> <span class="id">y</span> (<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">constrind_hyp</span> <span class="id">h</span> <span class="id">inds</span> <span class="id">hrecs</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| @<span class="id"><a href="GenInd.html#if_Some3">if_Some3</a></span> ?<span class="id">t1</span> ?<span class="id">t2</span> ?<span class="id">t3</span> ?<span class="id">p</span> ?<span class="id">x</span> ?<span class="id">y</span> ?<span class="id">z</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mk_if_Some3_impl_smart</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span> <span class="id">p</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> (<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">constrind_hyp</span> <span class="id">h</span> <span class="id">inds</span> <span class="id">hrecs</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| @<span class="id"><a href="Rewrite.html#step_one">step_one</a></span> ?<span class="id">t</span> ?<span class="id">r</span> ?<span class="id">l1</span> ?<span class="id">l2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mk_step_one_impl_smart</span> <span class="id">t</span> <span class="id">r</span> <span class="id">l1</span> <span class="id">l2</span> (<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">constrind_hyp</span> <span class="id">h</span> <span class="id">inds</span> <span class="id">hrecs</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| @<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> ?<span class="id">t</span> ?<span class="id">p</span> ?<span class="id">l</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mk_Exists_impl_smart</span> <span class="id">t</span> <span class="id">p</span> <span class="id">l</span> (<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">constrind_hyp</span> <span class="id">h</span> <span class="id">inds</span> <span class="id">hrecs</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (?<span class="id">a</span> * ?<span class="id">b</span>)%<span class="id">type</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mk_and_proof_smart</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constrind_hyp</span> (<span class="id">mk_app</span> '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">v</span>) <span class="id">inds</span> <span class="id">hrecs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constrind_hyp</span> (<span class="id">mk_app</span> '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">v</span>) <span class="id">inds</span> <span class="id">hrecs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| ?<span class="id">a</span> /\ ?<span class="id">b</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mk_and_proof_smart</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constrind_hyp</span> (<span class="id">mk_app</span> '<span class="id"><a href="GenInd.html#proj1_transparent">proj1_transparent</a></span> <span class="id">v</span>) <span class="id">inds</span> <span class="id">hrecs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constrind_hyp</span> (<span class="id">mk_app</span> '<span class="id"><a href="GenInd.html#proj2_transparent">proj2_transparent</a></span> <span class="id">v</span>) <span class="id">inds</span> <span class="id">hrecs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="kwd">forall</span> (<span class="id">x</span> : ?<span class="id">t1</span>), @?<span class="id">t2</span> <span class="id">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mk_forall_proof_smart</span> (<span class="id">head_binder_ident</span> <span class="id">t</span>) <span class="id">t1</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">constrind_hyp</span> (<span class="id">mk_app</span> <span class="id">v</span> <span class="id">x</span>) <span class="id">inds</span> <span class="id">hrecs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; '<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">add1</span> (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">l</span> : <span class="id">constr</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> (<span class="id">Constr.type</span> <span class="id">t</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> =&gt; <span class="id">l</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">t</span> :: <span class="id">l</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">maybe_app</span> (<span class="id">t1</span> : <span class="id">constr</span>) (<span class="id">t2</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Constr.type</span> (<span class="id">Constr.type</span> <span class="id">t2</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="kwd">Prop</span> =&gt; <span class="id">t1</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">mk_app</span> <span class="id">t1</span> <span class="id">t2</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">constrind1</span> (<span class="id">c</span> : <span class="id">constr</span>) (<span class="id">cstr</span> : <span class="id">constr</span>) (<span class="id">cstrhyp</span> : <span class="id">constr</span>) (<span class="id">inds</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">ps</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">hrecs</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">args</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">args_recs</span> : <span class="id">constr</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">c</span> := <span class="id">Std.eval_hnf</span> <span class="id">c</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="kwd">forall</span> (<span class="id">x</span> : ?<span class="id">t1</span>), @?<span class="id">t2</span> <span class="id">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">x</span> := <span class="id">head_binder_ident</span> <span class="id">c</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx_p</span> <span class="id">x</span> <span class="id">t1</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constrind1</span> (<span class="id">mk_app</span> <span class="id">t2</span> <span class="id">xx</span>) <span class="id">cstr</span> <span class="id">cstrhyp</span> <span class="id">inds</span> <span class="id">ps</span> <span class="id">hrecs</span> (<span class="id">xx</span> :: <span class="id">args</span>) (<span class="id">add1</span> (<span class="id">constrind_hyp</span> <span class="id">xx</span> <span class="id">inds</span> <span class="id">hrecs</span>) <span class="id">args_recs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;| ?<span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nt</span> := <span class="id">applist</span> (<span class="id">applist</span> <span class="id">cstrhyp</span> <span class="id">args</span>) <span class="id">args_recs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">is_ind_prefix_l</span> <span class="id">inds</span> (<span class="id">Constr.type</span> (<span class="id">applist</span> <span class="id">cstr</span> <span class="id">args</span>)) <span class="id">ps</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">Control.throw</span> <span class="id">Assertion_failure</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">targsp</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">targs</span>, <span class="id">p</span>) := <span class="id">targsp</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Std.unify</span> (<span class="id">Constr.type</span> <span class="id">nt</span>) (<span class="id">maybe_app</span> (<span class="id">applist</span> <span class="id">p</span> <span class="id">targs</span>) (<span class="id">applist</span> <span class="id">cstr</span> <span class="id">args</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">get_constructors_base</span> (<span class="id">ind</span> : <span class="id">inductive</span>) (<span class="id">inst</span> : <span class="id">instance</span>) (<span class="id">args</span> : <span class="id">constr</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="id">List.init</span> (<span class="id">Ind.nconstructors</span> (<span class="id">Ind.data</span> <span class="id">ind</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">i</span> =&gt; <span class="kwd">let</span> <span class="id">c</span> := <span class="id">Ind.get_constructor</span> (<span class="id">Ind.data</span> <span class="id">ind</span>) <span class="id">i</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">applist</span> (<span class="id">Constr.Unsafe.make</span> (<span class="id">Constr.Unsafe.Constructor</span> <span class="id">c</span> <span class="id">inst</span>)) (<span class="id">List.rev</span> <span class="id">args</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">split_ind</span> (<span class="id">c</span> : <span class="id">constr</span>) (<span class="id">args</span> : <span class="id">constr</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Std.eval_hnf</span> <span class="id">c</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| ?<span class="id">t1</span> ?<span class="id">t2</span> =&gt; <span class="id">split_ind</span> <span class="id">t1</span> (<span class="id">t2</span> :: <span class="id">args</span>)<br/>
&nbsp;&nbsp;| ?<span class="id">c</span> =&gt; <span class="kwd">match</span> <span class="id">Constr.Unsafe.kind</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Ind</span> <span class="id">ind</span> <span class="id">inst</span> =&gt; (<span class="id">ind</span>, <span class="id">inst</span>, <span class="id">args</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Control.throw</span> (<span class="id">Invalid_argument</span> (<span class="id">Some</span> (<span class="id">Message.of_constr</span> <span class="id">c</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">get_constructors</span> (<span class="id">c</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">ind</span>, <span class="id">inst</span>, <span class="id">args</span>) := <span class="id">split_ind</span> <span class="id">c</span> [] <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">get_constructors_base</span> <span class="id">ind</span> <span class="id">inst</span> <span class="id">args</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">ncontext</span> (<span class="id">l</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">l2</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">tac</span> : <span class="id">constr</span> <span class="id">list</span> -&gt; <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id">tac</span> (<span class="id">List.rev</span> <span class="id">l2</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> :: <span class="id">l</span> =&gt; <span class="id">inctx_p</span> (<span class="id">Fresh.in_goal</span> @<span class="id">H</span>) '(<span class="id">_</span> : <span class="kwd">Prop</span>) (<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">ncontext</span> <span class="id">l</span> (<span class="id">h</span> :: <span class="id">l2</span>) <span class="id">tac</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">nabs</span> (<span class="id">n</span> : <span class="id">int</span>) (<span class="id">c</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.equal</span> <span class="id">n</span> 0 <span class="kwd">then</span> <span class="id">c</span> <span class="kwd">else</span> '(<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id">ltac2</span>:(<span class="id">Control.refine</span> (<span class="kwd">fun</span> () =&gt; <span class="id">nabs</span> (<span class="id">Int.sub</span> <span class="id">n</span> 1) <span class="id">c</span>))).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">ind_principle_p</span> (<span class="id">t</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Constr.type</span> <span class="id">t</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="kwd">forall</span> (<span class="id">x</span> : ?<span class="id">t1</span>), <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">x</span> := <span class="id">head_binder_ident</span> (<span class="id">Constr.type</span> <span class="id">t</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">make_forall</span> (<span class="id">inctx</span> <span class="id">x</span> <span class="id">t1</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt; <span class="id">ind_principle_p</span> (<span class="id">mk_app</span> <span class="id">t</span> <span class="id">xx</span>)))<br/>
&nbsp;&nbsp;| <span class="kwd">Set</span> =&gt; '(($<span class="id">t</span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;| <span class="kwd">Type</span> =&gt; '(($<span class="id">t</span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;| <span class="kwd">Prop</span> =&gt; '<span class="kwd">Prop</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">forall_principle</span> (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">p</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">force_prop</span> (<span class="kwd">fun</span> () =&gt;<br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Constr.type</span> <span class="id">t</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="kwd">forall</span> (<span class="id">x</span> : ?<span class="id">t1</span>), <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">x</span> := <span class="id">head_binder_ident</span> (<span class="id">Constr.type</span> <span class="id">t</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">make_forall</span> (<span class="id">inctx</span> <span class="id">x</span> <span class="id">t1</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt; <span class="id">forall_principle</span> (<span class="id">mk_app</span> <span class="id">t</span> <span class="id">xx</span>) (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>)))<br/>
&nbsp;&nbsp;| <span class="kwd">Set</span> =&gt; '(<span class="kwd">forall</span> (<span class="id">t</span> : $<span class="id">t</span>), $<span class="id">p</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="kwd">Type</span> =&gt; '(<span class="kwd">forall</span> (<span class="id">t</span> : $<span class="id">t</span>), $<span class="id">p</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="kwd">Prop</span> =&gt; '(($<span class="id">t</span> -&gt; $<span class="id">p</span>) : <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">intro_hyp</span> (<span class="id">name</span> : <span class="id">ident</span>) (<span class="id">c</span> : <span class="id">constr</span>) (<span class="id">tac</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">force_prop_t</span> (<span class="kwd">fun</span> () =&gt;<br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Constr.type</span> <span class="id">c</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="kwd">forall</span> (<span class="id">x</span> : ?<span class="id">t1</span>), <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx</span> (<span class="id">head_binder_ident</span> (<span class="id">Constr.type</span> <span class="id">c</span>)) <span class="id">t1</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt; <span class="id">intro_hyp</span> <span class="id">name</span> (<span class="id">mk_app</span> <span class="id">c</span> <span class="id">xx</span>) <span class="id">tac</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">inctx</span> <span class="id">name</span> <span class="id">c</span> <span class="id">tac</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">rec_pos</span> (<span class="id">t</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Constr.Unsafe.kind</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Prod</span> <span class="id">_</span> <span class="id">t</span> =&gt; <span class="id">Int.add</span> 1 (<span class="id">rec_pos</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; 0<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">eta_expand</span> (<span class="id">c</span> : <span class="id">constr</span>) (<span class="id">p</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">lazy_match</span>! (<span class="id">Constr.type</span> <span class="id">c</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="kwd">forall</span> (<span class="id">x</span> : ?<span class="id">t1</span>), <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">x</span> := <span class="id">head_binder_ident</span> (<span class="id">Constr.type</span> <span class="id">c</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inctx</span> <span class="id">x</span> <span class="id">t1</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt; <span class="id">eta_expand</span> (<span class="id">mk_app</span> <span class="id">c</span> <span class="id">xx</span>) (<span class="id">mk_app</span> <span class="id">p</span> <span class="id">xx</span>))<br/>
&nbsp;&nbsp;| <span class="kwd">Prop</span> =&gt; '(<span class="kwd">fun</span> (<span class="id">_</span> : $<span class="id">c</span>) =&gt; $<span class="id">p</span>)<br/>
&nbsp;&nbsp;| <span class="kwd">Set</span> =&gt; '(<span class="kwd">fun</span> (<span class="id">t</span> : $<span class="id">c</span>) =&gt; $<span class="id">p</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="kwd">Type</span> =&gt; '(<span class="kwd">fun</span> (<span class="id">t</span> : $<span class="id">c</span>) =&gt; $<span class="id">p</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">fresh_n</span> (<span class="id">n</span> : <span class="id">int</span>) (<span class="id">x</span> : <span class="id">ident</span>) (<span class="id">s</span> : <span class="id">Fresh.Free.t</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">Int.equal</span> <span class="id">n</span> 0 <span class="kwd">then</span> [] <span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">y</span> := <span class="id">Fresh.fresh</span> <span class="id">s</span> <span class="id">x</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">y</span> :: <span class="id">fresh_n</span> (<span class="id">Int.sub</span> <span class="id">n</span> 1) <span class="id">x</span> (<span class="id">Fresh.Free.union</span> <span class="id">s</span> (<span class="id">Fresh.Free.of_ids</span> [<span class="id">y</span>])).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">fresh_n_goal</span> (<span class="id">n</span> : <span class="id">int</span>) (<span class="id">x</span> : <span class="id">ident</span>) := <span class="id">fresh_n</span> <span class="id">n</span> <span class="id">x</span> (<span class="id">Fresh.Free.of_goal</span> ()).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">inctxn</span> (<span class="id">names</span> : <span class="id">ident</span> <span class="id">list</span>) (<span class="id">ts</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">body</span> : <span class="id">constr</span> <span class="id">list</span> -&gt; <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">List.fold_right2</span> (<span class="kwd">fun</span> <span class="id">name</span> <span class="id">t</span> <span class="id">tac</span> <span class="id">l</span> =&gt; <span class="id">inctx</span> <span class="id">name</span> <span class="id">t</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">tac</span> (<span class="id">x</span> :: <span class="id">l</span>))) (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id">body</span> (<span class="id">List.rev</span> <span class="id">l</span>)) <span class="id">names</span> <span class="id">ts</span> [].<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">ncontext_l</span> (<span class="id">cstrsl</span> : <span class="id">constr</span> <span class="id">list</span> <span class="id">list</span>) (<span class="id">body</span> : <span class="id">constr</span> <span class="id">list</span> <span class="id">list</span> -&gt; <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="id">List.fold_right</span> (<span class="kwd">fun</span> <span class="id">cstrs</span> <span class="id">tac</span> <span class="id">lhl</span> =&gt; <span class="id">ncontext</span> <span class="id">cstrs</span> [] (<span class="kwd">fun</span> <span class="id">lhyps</span> =&gt; <span class="id">tac</span> (<span class="id">lhyps</span> :: <span class="id">lhl</span>))) (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id">body</span> (<span class="id">List.rev</span> <span class="id">l</span>)) <span class="id">cstrsl</span> [].<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mkfix1</span> (<span class="id">guarded_arg</span> : <span class="id">int</span>) (<span class="id">name</span> : <span class="id">ident</span>) (<span class="id">t</span> : <span class="id">constr</span>) (<span class="id">body</span> : <span class="id">constr</span> -&gt; <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">b</span>, <span class="id">body</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Constr.Unsafe.kind</span> (<span class="id">inctx</span> <span class="id">name</span> <span class="id">t</span> <span class="id">body</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Lambda</span> <span class="id">b</span> <span class="id">body</span> =&gt; (<span class="id">b</span>, <span class="id">body</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Control.throw</span> <span class="id">Assertion_failure</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">Constr.Unsafe.make</span> (<span class="id">Constr.Unsafe.Fix</span> (<span class="id">Array.make</span> 1 <span class="id">guarded_arg</span>) 0 (<span class="id">Array.make</span> 1 <span class="id">b</span>) (<span class="id">Array.make</span> 1 <span class="id">body</span>)).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">get_body</span> (<span class="id">names</span> : <span class="id">ident</span> <span class="id">list</span>) (<span class="id">bds</span> : <span class="id">binder</span> <span class="id">list</span>) (<span class="id">t</span> : <span class="id">constr</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">names</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; (<span class="id">List.rev</span> <span class="id">bds</span>, <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="id">_</span> :: <span class="id">names</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">Constr.Unsafe.kind</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Constr.Unsafe.Lambda</span> <span class="id">b</span> <span class="id">body</span> =&gt; <span class="id">get_body</span> <span class="id">names</span> (<span class="id">b</span> :: <span class="id">bds</span>) <span class="id">body</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">Control.throw</span> <span class="id">Assertion_failure</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mkprod</span> <span class="id">u</span> <span class="id">v</span> :=<br/>
&nbsp;&nbsp;'(<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> $<span class="id">u</span> $<span class="id">v</span>).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rec</span> <span class="id">mkprodn</span> (<span class="id">l</span> : <span class="id">constr</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">List.tl</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id">List.hd</span> <span class="id">l</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">mkprod</span> (<span class="id">List.hd</span> <span class="id">l</span>) (<span class="id">mkprodn</span> (<span class="id">List.tl</span> <span class="id">l</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">rotate_left</span> (<span class="id">l</span> : '<span class="id">a</span> <span class="id">list</span>) (<span class="id">n</span> : <span class="id">int</span>) :=<br/>
&nbsp;&nbsp;<span class="id">List.append</span> (<span class="id">List.skipn</span> <span class="id">n</span> <span class="id">l</span>) (<span class="id">List.firstn</span> <span class="id">n</span> <span class="id">l</span>).<br/>
<span class="kwd">Ltac2</span> <span class="id">rotate_right</span> (<span class="id">l</span> : '<span class="id">a</span> <span class="id">list</span>) (<span class="id">n</span> : <span class="id">int</span>) :=<br/>
&nbsp;&nbsp;<span class="id">rotate_left</span> <span class="id">l</span> (<span class="id">Int.sub</span> (<span class="id">List.length</span> <span class="id">l</span>) <span class="id">n</span>).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mkfix_one</span> (<span class="id">guarded_arg</span> : <span class="id">int</span> <span class="id">list</span>) (<span class="id">names</span> : <span class="id">ident</span> <span class="id">list</span>) (<span class="id">ts</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">body</span> : (<span class="id">constr</span> <span class="id">list</span> -&gt; <span class="id">constr</span>) <span class="id">list</span>) (<span class="id">n</span> : <span class="id">int</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ts</span> := <span class="id">List.map</span> <span class="id">rebuild_prod_cast</span> <span class="id">ts</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">bodies</span> := <span class="id">List.map</span> <span class="id">rebuild_prod_cast</span> (<span class="id">List.map</span> (<span class="id">inctxn</span> <span class="id">names</span> <span class="id">ts</span>) <span class="id">body</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">binders</span>, <span class="id">_</span>) := <span class="id">get_body</span> <span class="id">names</span> [] (<span class="id">List.hd</span> <span class="id">bodies</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">binders</span> := <span class="id">Array.of_list</span> <span class="id">binders</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">guarded_arg</span> := <span class="id">Array.of_list</span> <span class="id">guarded_arg</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">bodies</span> := <span class="id">Array.of_list</span> (<span class="id">List.map</span> (<span class="kwd">fun</span> <span class="id">body</span> =&gt; <span class="kwd">let</span> (<span class="id">_</span>, <span class="id">body</span>) := (<span class="id">get_body</span> <span class="id">names</span> [] <span class="id">body</span>) <span class="kwd">in</span> <span class="id">body</span>) <span class="id">bodies</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">Constr.Unsafe.make</span> (<span class="id">Constr.Unsafe.Fix</span> <span class="id">guarded_arg</span> <span class="id">n</span> <span class="id">binders</span> <span class="id">bodies</span>).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mkfix_one</span>' (<span class="id">guarded_arg</span> : <span class="id">int</span> <span class="id">list</span>) (<span class="id">names</span> : <span class="id">ident</span> <span class="id">list</span>) (<span class="id">ts</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">body</span> : (<span class="id">constr</span> <span class="id">list</span> -&gt; <span class="id">constr</span>) <span class="id">list</span>) (<span class="id">n</span> : <span class="id">int</span>) :=<br/>
&nbsp;&nbsp;<span class="id">mkfix_one</span> (<span class="id">rotate_left</span> <span class="id">guarded_arg</span> <span class="id">n</span>) (<span class="id">rotate_left</span> <span class="id">names</span> <span class="id">n</span>) (<span class="id">rotate_left</span> <span class="id">ts</span> <span class="id">n</span>) (<span class="id">rotate_left</span> (<span class="id">List.map</span> (<span class="kwd">fun</span> <span class="id">f</span> <span class="id">l</span> =&gt; <span class="id">f</span> (<span class="id">rotate_right</span> <span class="id">l</span> <span class="id">n</span>)) <span class="id">body</span>) <span class="id">n</span>) 0.<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">mkfix</span> (<span class="id">guarded_arg</span> : <span class="id">int</span> <span class="id">list</span>) (<span class="id">names</span> : <span class="id">ident</span> <span class="id">list</span>) (<span class="id">ts</span> : <span class="id">constr</span> <span class="id">list</span>) (<span class="id">body</span> : (<span class="id">constr</span> <span class="id">list</span> -&gt; <span class="id">constr</span>) <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="id">mkprodn</span> (<span class="id">List.init</span> (<span class="id">List.length</span> <span class="id">names</span>) (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id">mkfix_one</span> <span class="id">guarded_arg</span> <span class="id">names</span> <span class="id">ts</span> <span class="id">body</span> <span class="id">n</span>)).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">map3</span> <span class="id">f</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">l3</span> := <span class="id">List.map2</span> (<span class="kwd">fun</span> <span class="id">a</span> (<span class="id">b</span>, <span class="id">c</span>) =&gt; <span class="id">f</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span>) <span class="id">l1</span> (<span class="id">List.combine</span> <span class="id">l2</span> <span class="id">l3</span>).<br/>
<span class="kwd">Ltac2</span> <span class="id">map4</span> <span class="id">f</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">l3</span> <span class="id">l4</span> := <span class="id">map3</span> (<span class="kwd">fun</span> <span class="id">a</span> <span class="id">b</span> (<span class="id">c</span>, <span class="id">d</span>) =&gt; <span class="id">f</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">d</span>) <span class="id">l1</span> <span class="id">l2</span> (<span class="id">List.combine</span> <span class="id">l3</span> <span class="id">l4</span>).<br/>
<span class="kwd">Ltac2</span> <span class="id">map5</span> <span class="id">f</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">l3</span> <span class="id">l4</span> <span class="id">l5</span> := <span class="id">map4</span> (<span class="kwd">fun</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> (<span class="id">d</span>, <span class="id">e</span>) =&gt; <span class="id">f</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">d</span> <span class="id">e</span>) <span class="id">l1</span> <span class="id">l2</span> <span class="id">l3</span> (<span class="id">List.combine</span> <span class="id">l4</span> <span class="id">l5</span>).<br/>
<br/>
<span class="kwd">Ltac2</span> <span class="id">gen_ind_principle</span> (<span class="id">cl</span> : <span class="id">constr</span> <span class="id">list</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">n</span> := <span class="id">List.length</span> <span class="id">cl</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">indstl</span> := <span class="id">List.map</span> (<span class="kwd">fun</span> <span class="id">c</span> =&gt; <span class="id">split_ind</span> <span class="id">c</span> []) <span class="id">cl</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cstrsl</span> := <span class="id">List.map</span> (<span class="kwd">fun</span> (<span class="id">ind</span>, <span class="id">inst</span>, <span class="id">args</span>) =&gt; <span class="id">get_constructors_base</span> <span class="id">ind</span> <span class="id">inst</span> <span class="id">args</span>) <span class="id">indstl</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">inctxn</span> (<span class="id">fresh_n_goal</span> <span class="id">n</span> @<span class="id">P</span>) (<span class="id">List.map</span> <span class="id">ind_principle_p</span> <span class="id">cl</span>) (<span class="kwd">fun</span> <span class="id">pl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ncontext_l</span> <span class="id">cstrsl</span> (<span class="kwd">fun</span> <span class="id">lhypsl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mkfix</span> (<span class="id">List.map</span> (<span class="kwd">fun</span> <span class="id">c</span> =&gt; <span class="id">rec_pos</span> (<span class="id">Constr.type</span> <span class="id">c</span>)) <span class="id">cl</span>) (<span class="id">fresh_n_goal</span> <span class="id">n</span> @<span class="id">Hrec</span>) (<span class="id">List.map2</span> <span class="id">forall_principle</span> <span class="id">cl</span> <span class="id">pl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">map5</span> (<span class="kwd">fun</span> <span class="id">c</span> (<span class="id">ind</span>, <span class="id">_</span>, <span class="id">_</span>) =&gt; <span class="kwd">fun</span> <span class="id">p</span> <span class="id">cstrs</span> <span class="id">lhyps</span> <span class="id">hrecs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intro_hyp</span> (<span class="id">Fresh.in_goal</span> @<span class="id">x</span>) <span class="id">c</span> (<span class="kwd">fun</span> <span class="id">xx</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">branches</span> := <span class="id">List.map2</span> (<span class="kwd">fun</span> <span class="id">cstr</span> <span class="id">hcstr</span> =&gt; <span class="id">force_prop_t</span> (<span class="kwd">fun</span> () =&gt; <span class="id">rebuild_lam</span> (<span class="id">constrind1</span> (<span class="id">Constr.type</span> <span class="id">cstr</span>) <span class="id">cstr</span> <span class="id">hcstr</span> <span class="id">cl</span> <span class="id">pl</span> <span class="id">hrecs</span> [] []))) <span class="id">cstrs</span> <span class="id">lhyps</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">force_prop_t</span> (<span class="kwd">fun</span> () =&gt; <span class="id">Constr.Unsafe.make</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Constr.Unsafe.Case</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Constr.Unsafe.case</span> <span class="id">ind</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rebuild_lam</span> (<span class="id">eta_expand</span> <span class="id">c</span> <span class="id">p</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Constr.Unsafe.NoInvert</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">xx</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Array.of_list</span> <span class="id">branches</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)) <span class="id">cl</span> <span class="id">indstl</span> <span class="id">pl</span> <span class="id">cstrsl</span> <span class="id">lhypsl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;).<br/>
<br/>
<span class="kwd">Notation</span> "'<span class="id">Induction</span>' '<span class="id">For</span>' [ <span class="id">x</span> ]" := <span class="id">ltac2</span>:(<span class="kwd">let</span> <span class="id">l</span> := [<span class="id">x</span>] <span class="kwd">in</span> <span class="id">Control.refine</span> (<span class="kwd">fun</span> () =&gt; <span class="id">gen_ind_principle</span> (<span class="id">List.map</span> <span class="id">Constr.pretype</span> <span class="id">l</span>))) (<span class="kwd">at</span> <span class="id">level</span> 0, <span class="id">only</span> <span class="id">parsing</span>).<br/>
<span class="kwd">Notation</span> "'<span class="id">Induction</span>' '<span class="id">For</span>' [ <span class="id">x</span> ; <span class="id">y</span> ]" :=<br/>
&nbsp;&nbsp;<span class="id">ltac2</span>:(<span class="kwd">let</span> <span class="id">l</span> := [<span class="id">x</span>; <span class="id">y</span>] <span class="kwd">in</span> <span class="id">Control.refine</span> (<span class="kwd">fun</span> () =&gt; <span class="id">gen_ind_principle</span> (<span class="id">List.map</span> <span class="id">Constr.pretype</span> <span class="id">l</span>))) (<span class="kwd">at</span> <span class="id">level</span> 0, <span class="id">only</span> <span class="id">parsing</span>).<br/>
<span class="kwd">Notation</span> "'<span class="id">Induction</span>' '<span class="id">For</span>' [ <span class="id">x</span> ; <span class="id">y</span> ; <span class="id">z</span> ]" :=<br/>
&nbsp;&nbsp;<span class="id">ltac2</span>:(<span class="kwd">let</span> <span class="id">l</span> := [<span class="id">x</span>; <span class="id">y</span>; <span class="id">z</span>] <span class="kwd">in</span> <span class="id">Control.refine</span> (<span class="kwd">fun</span> () =&gt; <span class="id">gen_ind_principle</span> (<span class="id">List.map</span> <span class="id">Constr.pretype</span> <span class="id">l</span>))) (<span class="kwd">at</span> <span class="id">level</span> 0, <span class="id">only</span> <span class="id">parsing</span>).<br/>
<span class="kwd">Notation</span> "'<span class="id">Induction</span>' '<span class="id">For</span>' [ <span class="id">x</span> ; <span class="id">y</span> ; <span class="id">z</span> ; <span class="id">w</span> ]" :=<br/>
&nbsp;&nbsp;<span class="id">ltac2</span>:(<span class="kwd">let</span> <span class="id">l</span> := [<span class="id">x</span>; <span class="id">y</span>; <span class="id">z</span>; <span class="id">w</span>] <span class="kwd">in</span> <span class="id">Control.refine</span> (<span class="kwd">fun</span> () =&gt; <span class="id">gen_ind_principle</span> (<span class="id">List.map</span> <span class="id">Constr.pretype</span> <span class="id">l</span>))) (<span class="kwd">at</span> <span class="id">level</span> 0, <span class="id">only</span> <span class="id">parsing</span>).<br/>
<span class="kwd">Notation</span> "'<span class="id">Induction</span>' '<span class="id">For</span>' [ <span class="id">x</span> ; <span class="id">y</span> ; <span class="id">z</span> ; <span class="id">w</span> ; <span class="id">t</span> ]" :=<br/>
&nbsp;&nbsp;<span class="id">ltac2</span>:(<span class="kwd">let</span> <span class="id">l</span> := [<span class="id">x</span>; <span class="id">y</span>; <span class="id">z</span>; <span class="id">w</span>; <span class="id">t</span>] <span class="kwd">in</span> <span class="id">Control.refine</span> (<span class="kwd">fun</span> () =&gt; <span class="id">gen_ind_principle</span> (<span class="id">List.map</span> <span class="id">Constr.pretype</span> <span class="id">l</span>))) (<span class="kwd">at</span> <span class="id">level</span> 0, <span class="id">only</span> <span class="id">parsing</span>).<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
