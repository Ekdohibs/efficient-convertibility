
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Convert</title>
<meta name="description" content="Documentation of Coq module Convert" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Convert</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Arith.html">Arith</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Freevar.html">Freevar</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Misc.html">Misc</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.micromega.Psatz.html">Psatz</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Star.html">Star</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Logic.Eqdep_dec.html">Coq.Logic.Eqdep_dec</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="FEnv.html">FEnv</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Rewrite.html">Rewrite</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="STerm.html">STerm</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="GenInd.html">GenInd</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Beta.html">Beta</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="fst3">fst3</a></span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> : <span class="kwd">Type</span>} (<span class="id">x</span> : <span class="id">A</span> * <span class="id">B</span> * <span class="id">C</span>) := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x</span>).<br/>
<span class="kwd">Definition</span> <span class="id"><a name="snd3">snd3</a></span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> : <span class="kwd">Type</span>} (<span class="id">x</span> : <span class="id">A</span> * <span class="id">B</span> * <span class="id">C</span>) := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">x</span>).<br/>
<span class="kwd">Definition</span> <span class="id"><a name="thd3">thd3</a></span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> : <span class="kwd">Type</span>} (<span class="id">x</span> : <span class="id">A</span> * <span class="id">B</span> * <span class="id">C</span>) := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">x</span>.<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="rthreadptr">rthreadptr</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="cthreadptr">cthreadptr</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="threadptr">threadptr</a></span> := (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)%<span class="id">type</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cont">cont</a></span> : <span class="kwd">Type</span> :=<br/>
| <span class="id"><a name="Kid">Kid</a></span> : <span class="id">cont</span><br/>
| <span class="id"><a name="Kapp">Kapp</a></span> : <span class="id">value</span> -&gt; <span class="id">cont</span> -&gt; <span class="id">cont</span><br/>
| <span class="id"><a name="Kswitch">Kswitch</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="STerm.html#term">term</a></span>) -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">value</span>  -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id">value</span>) -&gt; <span class="id">cont</span> -&gt; <span class="id">cont</span><br/>
<br/>
<span class="kwd">with</span> <span class="id"><a name="value">value</a></span> : <span class="kwd">Type</span> :=<br/>
| <span class="id"><a name="Thread">Thread</a></span> : <span class="id"><a href="Convert.html#rthreadptr">rthreadptr</a></span> -&gt; <span class="id">value</span><br/>
| <span class="id"><a name="Neutral">Neutral</a></span> : (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id">cont</span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">value</span>)  -&gt; <span class="id">value</span><br/>
| <span class="id"><a name="Clos">Clos</a></span> : <span class="id"><a href="STerm.html#term">term</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">value</span>  -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id">value</span> -&gt; <span class="id">value</span><br/>
| <span class="id"><a name="Block">Block</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">value</span> -&gt; <span class="id">value</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="env">env</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Convert.html#value">value</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="neutral">neutral</a></span> := (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="Convert.html#cont">cont</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Convert.html#value">value</a></span>)%<span class="id">type</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="n_var">n_var</a></span> (<span class="id">n</span> : <span class="id"><a href="Convert.html#neutral">neutral</a></span>) := <span class="id"><a href="Convert.html#fst3">fst3</a></span> <span class="id">n</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="n_cont">n_cont</a></span> (<span class="id">n</span> : <span class="id"><a href="Convert.html#neutral">neutral</a></span>) := <span class="id"><a href="Convert.html#snd3">snd3</a></span> <span class="id">n</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="n_unfold">n_unfold</a></span> (<span class="id">n</span> : <span class="id"><a href="Convert.html#neutral">neutral</a></span>) := <span class="id"><a href="Convert.html#thd3">thd3</a></span> <span class="id">n</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="code">code</a></span> :=<br/>
| <span class="id"><a name="Term">Term</a></span> : <span class="id"><a href="STerm.html#term">term</a></span> -&gt; <span class="id"><a href="Convert.html#env">env</a></span> -&gt; <span class="id">code</span><br/>
| <span class="id"><a name="Val">Val</a></span> : <span class="id"><a href="Convert.html#value">value</a></span> -&gt; <span class="id">code</span>.<br/>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="rthread">rthread</a></span> := <span class="id"><a name="mkrthread">mkrthread</a></span> {<br/>
&nbsp;&nbsp;<span class="id"><a name="rt_code">rt_code</a></span> : <span class="id"><a href="Convert.html#code">code</a></span> ;<br/>
&nbsp;&nbsp;<span class="id"><a name="rt_cont">rt_cont</a></span> : <span class="id"><a href="Convert.html#cont">cont</a></span> ;<br/>
}.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cthread">cthread</a></span> :=<br/>
| <span class="id"><a name="cthread_done">cthread_done</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> -&gt; <span class="id">cthread</span><br/>
| <span class="id"><a name="cthread_reduce">cthread_reduce</a></span> : <span class="id"><a href="Convert.html#value">value</a></span> -&gt; <span class="id"><a href="Convert.html#value">value</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id">cthread</span><br/>
| <span class="id"><a name="cthread_and">cthread_and</a></span> : <span class="id">cthread</span> -&gt; <span class="id">cthread</span> -&gt; <span class="id">cthread</span><br/>
| <span class="id"><a name="cthread_or">cthread_or</a></span> : <span class="id">cthread</span> -&gt; <span class="id">cthread</span> -&gt; <span class="id">cthread</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="addr">addr</a></span> := <span class="id"><a href="Convert.html#rthreadptr">rthreadptr</a></span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cont_points_to">cont_points_to</a></span> : <span class="id"><a href="Convert.html#cont">cont</a></span> -&gt; <span class="id"><a href="Convert.html#addr">addr</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="kapp_points_to_1">kapp_points_to_1</a></span> : <span class="kwd">forall</span> <span class="id">v</span> <span class="id">c</span> <span class="id">a</span>, <span class="id">val_points_to</span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id">cont_points_to</span> (<span class="id"><a href="Convert.html#Kapp">Kapp</a></span> <span class="id">v</span> <span class="id">c</span>) <span class="id">a</span><br/>
| <span class="id"><a name="kapp_points_to_2">kapp_points_to_2</a></span> : <span class="kwd">forall</span> <span class="id">v</span> <span class="id">c</span> <span class="id">a</span>, <span class="id">cont_points_to</span> <span class="id">c</span> <span class="id">a</span> -&gt; <span class="id">cont_points_to</span> (<span class="id"><a href="Convert.html#Kapp">Kapp</a></span> <span class="id">v</span> <span class="id">c</span>) <span class="id">a</span><br/>
| <span class="id"><a name="kswitch_points_to_1">kswitch_points_to_1</a></span> : <span class="kwd">forall</span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> <span class="id">c</span> <span class="id">a</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">val_points_to</span> <span class="id">v</span> <span class="id">a</span>) <span class="id">e</span> -&gt; <span class="id">cont_points_to</span> (<span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> <span class="id">c</span>) <span class="id">a</span><br/>
| <span class="id"><a name="kswitch_points_to_2">kswitch_points_to_2</a></span> : <span class="kwd">forall</span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> <span class="id">c</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> (<span class="kwd">fun</span> <span class="id">bd</span> =&gt; <span class="id">val_points_to</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">bd</span>) <span class="id">a</span>) <span class="id">bds</span> -&gt; <span class="id">cont_points_to</span> (<span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> <span class="id">c</span>) <span class="id">a</span><br/>
| <span class="id"><a name="kswitch_points_to_3">kswitch_points_to_3</a></span> : <span class="kwd">forall</span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> <span class="id">c</span> <span class="id">a</span>, <span class="id">cont_points_to</span> <span class="id">c</span> <span class="id">a</span> -&gt; <span class="id">cont_points_to</span> (<span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> <span class="id">c</span>) <span class="id">a</span><br/>
<br/>
<span class="kwd">with</span> <span class="id"><a name="val_points_to">val_points_to</a></span> : <span class="id"><a href="Convert.html#value">value</a></span> -&gt; <span class="id"><a href="Convert.html#addr">addr</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="thread_points_to">thread_points_to</a></span> : <span class="kwd">forall</span> <span class="id">rid</span>, <span class="id">val_points_to</span> (<span class="id"><a href="Convert.html#Thread">Thread</a></span> <span class="id">rid</span>) <span class="id">rid</span><br/>
| <span class="id"><a name="neutral_points_to_1">neutral_points_to_1</a></span> : <span class="kwd">forall</span> <span class="id">n</span> <span class="id">a</span>, <span class="id">cont_points_to</span> (<span class="id"><a href="Convert.html#n_cont">n_cont</a></span> <span class="id">n</span>) <span class="id">a</span> -&gt; <span class="id">val_points_to</span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> <span class="id">n</span>) <span class="id">a</span><br/>
| <span class="id"><a name="neutral_points_to_2">neutral_points_to_2</a></span> : <span class="kwd">forall</span> <span class="id">n</span> <span class="id">v</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#n_unfold">n_unfold</a></span> <span class="id">n</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt; <span class="id">val_points_to</span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id">val_points_to</span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> <span class="id">n</span>) <span class="id">a</span><br/>
| <span class="id"><a name="clos_points_to_1">clos_points_to_1</a></span> : <span class="kwd">forall</span> <span class="id">t</span> <span class="id">e</span> <span class="id">vn</span> <span class="id">vdeep</span> <span class="id">a</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">val_points_to</span> <span class="id">v</span> <span class="id">a</span>) <span class="id">e</span> -&gt; <span class="id">val_points_to</span> (<span class="id"><a href="Convert.html#Clos">Clos</a></span> <span class="id">t</span> <span class="id">e</span> <span class="id">vn</span> <span class="id">vdeep</span>) <span class="id">a</span><br/>
| <span class="id"><a name="clos_points_to_2">clos_points_to_2</a></span> : <span class="kwd">forall</span> <span class="id">t</span> <span class="id">e</span> <span class="id">vn</span> <span class="id">vdeep</span> <span class="id">a</span>, <span class="id">val_points_to</span> <span class="id">vdeep</span> <span class="id">a</span> -&gt; <span class="id">val_points_to</span> (<span class="id"><a href="Convert.html#Clos">Clos</a></span> <span class="id">t</span> <span class="id">e</span> <span class="id">vn</span> <span class="id">vdeep</span>) <span class="id">a</span><br/>
| <span class="id"><a name="block_points_to">block_points_to</a></span> : <span class="kwd">forall</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">a</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">val_points_to</span> <span class="id">v</span> <span class="id">a</span>) <span class="id">l</span> -&gt; <span class="id">val_points_to</span> (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> <span class="id">l</span>) <span class="id">a</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="cont_val_ind">cont_val_ind</a></span> := <span class="id">Induction</span> <span class="id">For</span> [<span class="id"><a href="Convert.html#cont_points_to">cont_points_to</a></span> ; <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span>].<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="env_points_to">env_points_to</a></span> <span class="id">e</span> <span class="id">a</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span>) <span class="id">e</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="code_points_to">code_points_to</a></span> : <span class="id"><a href="Convert.html#code">code</a></span> -&gt; <span class="id"><a href="Convert.html#addr">addr</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="term_points_to">term_points_to</a></span> : <span class="kwd">forall</span> <span class="id">t</span> <span class="id">e</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#env_points_to">env_points_to</a></span> <span class="id">e</span> <span class="id">a</span> -&gt; <span class="id">code_points_to</span> (<span class="id"><a href="Convert.html#Term">Term</a></span> <span class="id">t</span> <span class="id">e</span>) <span class="id">a</span><br/>
| <span class="id"><a name="cval_points_to">cval_points_to</a></span> : <span class="kwd">forall</span> <span class="id">v</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id">code_points_to</span> (<span class="id"><a href="Convert.html#Val">Val</a></span> <span class="id">v</span>) <span class="id">a</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="rthread_points_to">rthread_points_to</a></span> <span class="id">rt</span> <span class="id">a</span> := <span class="id"><a href="Convert.html#code_points_to">code_points_to</a></span> <span class="id">rt</span>.(<span class="id"><a href="Convert.html#rt_code">rt_code</a></span>) <span class="id">a</span> \/ <span class="id"><a href="Convert.html#cont_points_to">cont_points_to</a></span> <span class="id">rt</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>) <span class="id">a</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="points_to">points_to</a></span> <span class="id">rthreads</span> (<span class="id">a1</span> <span class="id">a2</span> : <span class="id"><a href="Convert.html#rthreadptr">rthreadptr</a></span>):=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">rthreads</span> <span class="id">a1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">rt</span> =&gt; <span class="id"><a href="Convert.html#rthread_points_to">rthread_points_to</a></span> <span class="id">rt</span> <span class="id">a2</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="state">state</a></span> := <span class="id"><a name="mkstate">mkstate</a></span> {<br/>
&nbsp;&nbsp;<span class="id"><a name="st_rthreads">st_rthreads</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Convert.html#rthread">rthread</a></span> ;<br/>
&nbsp;&nbsp;<span class="id"><a name="st_freename">st_freename</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> ;<br/>
}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="points">points</a></span> <span class="id">st</span> := <span class="id"><a href="Convert.html#points_to">points_to</a></span> <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>).<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="points_to_updatep_rthread">points_to_updatep_rthread</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rthreads</span> <span class="id">rid</span> <span class="id">rt</span> <span class="id">a1</span> <span class="id">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#points_to">points_to</a></span> (<span class="id"><a href="Misc.html#update">update</a></span> <span class="id">rthreads</span> <span class="id">rid</span> <span class="id">rt</span>) <span class="id">a1</span> <span class="id">a2</span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Rewrite.html#updatep">updatep</a></span> (<span class="id"><a href="Convert.html#points_to">points_to</a></span> <span class="id">rthreads</span>) <span class="id">rid</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">rid</span> &lt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">rthreads</span> /\ <span class="id"><a href="Convert.html#rthread_points_to">rthread_points_to</a></span> <span class="id">rt</span> <span class="id">a</span>) <span class="id">a1</span> <span class="id">a2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">rthreads</span> <span class="id">rid</span> <span class="id">rt</span> <span class="id">rid2</span> <span class="id">a</span>; <span class="id">unfold</span> <span class="id"><a href="Rewrite.html#updatep">updatep</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">rid</span> <span class="id">rid2</span>); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update2">nth_error_update2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">Hnth</span>; [<span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>|<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>]; <span class="id">intuition</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update3">nth_error_update3</a></span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intuition</span> <span class="id">congruence</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="points_to_updatep_rthread_extend">points_to_updatep_rthread_extend</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rthreads</span> <span class="id">rt</span> <span class="id">a1</span> <span class="id">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#points_to">points_to</a></span> (<span class="id">rthreads</span> ++ <span class="id">rt</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">a1</span> <span class="id">a2</span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Rewrite.html#updatep">updatep</a></span> (<span class="id"><a href="Convert.html#points_to">points_to</a></span> <span class="id">rthreads</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">rthreads</span>) (<span class="id"><a href="Convert.html#rthread_points_to">rthread_points_to</a></span> <span class="id">rt</span>) <span class="id">a1</span> <span class="id">a2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">rthreads</span> <span class="id">rt</span> <span class="id">rid</span> <span class="id">a</span>; <span class="id">unfold</span> <span class="id"><a href="Rewrite.html#updatep">updatep</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">rthreads</span>) <span class="id">rid</span>).<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">by</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">rid</span> - <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">rthreads</span>) <span class="kwd">as</span> <span class="id">n</span>. <span class="id">destruct</span> <span class="id">n</span> <span class="kwd">as</span> [|<span class="id">m</span>] <span class="id">eqn</span>:<span class="id">Hn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">assert</span> (<span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">rthreads</span>) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">intuition</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">do</span> 2 (<span class="id">replace</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">with</span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="Convert.html#rthread">rthread</a></span>) <span class="kwd">by</span> (<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">rid</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">rthreads</span>) <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">intuition</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app1">nth_error_app1</a></span> <span class="kwd">by</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">rid</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">rthreads</span>) <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span>; <span class="id">intuition</span> <span class="id">congruence</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="update_rthread">update_rthread</a></span> <span class="id">st</span> <span class="id">rid</span> <span class="id">rt</span> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> := <span class="id"><a href="Misc.html#update">update</a></span> <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">rid</span> <span class="id">rt</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> := <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_freename">st_freename</a></span>) ;<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="freevar">freevar</a></span> (<span class="id">st</span> : <span class="id"><a href="Convert.html#state">state</a></span>) :=<br/>
&nbsp;&nbsp;({|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> := <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">st</span>.(<span class="id"><a href="Convert.html#st_freename">st_freename</a></span>)) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}, <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_freename">st_freename</a></span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="freevars">freevars</a></span> (<span class="id">st</span> : <span class="id"><a href="Convert.html#state">state</a></span>) (<span class="id">n</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) :=<br/>
&nbsp;&nbsp;({|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> := <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> := <span class="id">n</span> + <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_freename">st_freename</a></span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_freename">st_freename</a></span>) <span class="id">n</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="extend_rthread">extend_rthread</a></span> <span class="id">st</span> <span class="id">rt</span> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> := <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) ++ <span class="id">rt</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> := <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_freename">st_freename</a></span>) ;<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="makelazy">makelazy</a></span> (<span class="id">st</span> : <span class="id"><a href="Convert.html#state">state</a></span>) (<span class="id">t</span> : <span class="id"><a href="STerm.html#term">term</a></span>) (<span class="id">e</span> : <span class="id"><a href="Convert.html#env">env</a></span>) :=<br/>
&nbsp;&nbsp;(<span class="id"><a href="Convert.html#extend_rthread">extend_rthread</a></span> <span class="id">st</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Term">Term</a></span> <span class="id">t</span> <span class="id">e</span> ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id"><a href="Convert.html#Kid">Kid</a></span> |}, <span class="id"><a href="Convert.html#Thread">Thread</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>))).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="exit_rthread">exit_rthread</a></span> (<span class="id">st</span> : <span class="id"><a href="Convert.html#state">state</a></span>) (<span class="id">rid</span> : <span class="id"><a href="Convert.html#rthreadptr">rthreadptr</a></span>) (<span class="id">v</span> : <span class="id"><a href="Convert.html#value">value</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> <span class="id">st</span> <span class="id">rid</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Val">Val</a></span> <span class="id">v</span> ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id"><a href="Convert.html#Kid">Kid</a></span> |}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="is_finished">is_finished</a></span> (<span class="id">st</span> : <span class="id"><a href="Convert.html#state">state</a></span>) (<span class="id">rid</span> : <span class="id"><a href="Convert.html#rthreadptr">rthreadptr</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">rid</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Convert.html#rthread">rthread</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_code">rt_code</a></span>), <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Val">Val</a></span> <span class="id">v</span>, <span class="id"><a href="Convert.html#Kid">Kid</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="compose_cont">compose_cont</a></span> (<span class="id">c</span> <span class="id">c2</span> : <span class="id"><a href="Convert.html#cont">cont</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kid">Kid</a></span> =&gt; <span class="id">c2</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kapp">Kapp</a></span> <span class="id">v</span> <span class="id">c</span> =&gt; <span class="id"><a href="Convert.html#Kapp">Kapp</a></span> <span class="id">v</span> (<span class="id">compose_cont</span> <span class="id">c</span> <span class="id">c2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> <span class="id">c</span> =&gt; <span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> (<span class="id">compose_cont</span> <span class="id">c</span> <span class="id">c2</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="makenlazy">makenlazy</a></span> (<span class="id">st</span> : <span class="id"><a href="Convert.html#state">state</a></span>) (<span class="id">ts</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="STerm.html#term">term</a></span>) (<span class="id">e</span> : <span class="id"><a href="Convert.html#env">env</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ts</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; (<span class="id">st</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;| <span class="id">t</span> :: <span class="id">ts</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st2v</span> := <span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="id">st</span> <span class="id">t</span> <span class="id">e</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st3vl</span> := <span class="id">makenlazy</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">st2v</span>) <span class="id">ts</span> <span class="id">e</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">st3vl</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st2v</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st3vl</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="makendeeps">makendeeps</a></span> (<span class="id">st</span> : <span class="id"><a href="Convert.html#state">state</a></span>) (<span class="id">bs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="STerm.html#term">term</a></span>)) (<span class="id">e</span> : <span class="id"><a href="Convert.html#env">env</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">bs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; (<span class="id">st</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;| (<span class="id">p</span>, <span class="id">t</span>) :: <span class="id">bs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st2xs</span> := <span class="id"><a href="Convert.html#freevars">freevars</a></span> <span class="id">st</span> <span class="id">p</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st3v</span> := <span class="id"><a href="Convert.html#makelazy">makelazy</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">st2xs</span>) <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x</span>, <span class="id"><a href="Convert.html#Kid">Kid</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st2xs</span>) ++ <span class="id">e</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st4vl</span> := <span class="id">makendeeps</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">st3v</span>) <span class="id">bs</span> <span class="id">e</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">st4vl</span>, (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st2xs</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st3v</span>) :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st4vl</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="step_r">step_r</a></span> (<span class="id">st</span> : <span class="id"><a href="Convert.html#state">state</a></span>) (<span class="id">rid</span> : <span class="id"><a href="Convert.html#rthreadptr">rthreadptr</a></span>) : <span class="id"><a href="Convert.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">rid</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id">st</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Convert.html#rthread">rthread</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_code">rt_code</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Term">Term</a></span> (<span class="id"><a href="STerm.html#app">app</a></span> <span class="id">u</span> <span class="id">v</span>) <span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st2v</span> := <span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="id">st</span> <span class="id">v</span> <span class="id">e</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">st2v</span>) <span class="id">rid</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Term">Term</a></span> <span class="id">u</span> <span class="id">e</span> ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id"><a href="Convert.html#Kapp">Kapp</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st2v</span>) <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>) |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Term">Term</a></span> (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">u</span>) <span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">st</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kid">Kid</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st2y</span> := <span class="id"><a href="Convert.html#freevar">freevar</a></span> <span class="id">st</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st3v</span> := <span class="id"><a href="Convert.html#makelazy">makelazy</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">st2y</span>) <span class="id">u</span> ((<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st2y</span>, <span class="id"><a href="Convert.html#Kid">Kid</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) :: <span class="id">e</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#exit_rthread">exit_rthread</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">st3v</span>) <span class="id">rid</span> (<span class="id"><a href="Convert.html#Clos">Clos</a></span> <span class="id">u</span> <span class="id">e</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st2y</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st3v</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kapp">Kapp</a></span> <span class="id">v</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> <span class="id">st</span> <span class="id">rid</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Term">Term</a></span> <span class="id">u</span> (<span class="id">v</span> :: <span class="id">e</span>) ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id">c</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Term">Term</a></span> (<span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span>) <span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">e</span> <span class="id">n</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id">st</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> <span class="id">st</span> <span class="id">rid</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Val">Val</a></span> <span class="id">v</span> ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>) |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Term">Term</a></span> (<span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span>) <span class="id">e</span> =&gt; <span class="id">st</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Term">Term</a></span> (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span>) <span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st2vl</span> := <span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">l</span> <span class="id">e</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">st2vl</span>) <span class="id">rid</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Val">Val</a></span> (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st2vl</span>)) ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>) |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Term">Term</a></span> (<span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">m</span>) <span class="id">e</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st2vl</span> := <span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">m</span> <span class="id">e</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">st2vl</span>) <span class="id">rid</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Term">Term</a></span> <span class="id">t</span> <span class="id">e</span> ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">m</span> <span class="id">e</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st2vl</span>) <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>) |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Val">Val</a></span> (<span class="id"><a href="Convert.html#Thread">Thread</a></span> <span class="id">rid2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Convert.html#is_finished">is_finished</a></span> <span class="id">st</span> <span class="id">rid2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id">st</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> <span class="id">st</span> <span class="id">rid</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Val">Val</a></span> <span class="id">v</span> ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>) |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Val">Val</a></span> (<span class="id"><a href="Convert.html#Clos">Clos</a></span> <span class="id">u</span> <span class="id">e</span> <span class="id">y</span> <span class="id">vdeep</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kid">Kid</a></span> =&gt; <span class="id">st</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>  =&gt; <span class="id">st</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kapp">Kapp</a></span> <span class="id">v</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> <span class="id">st</span> <span class="id">rid</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Term">Term</a></span> <span class="id">u</span> (<span class="id">v</span> :: <span class="id">e</span>) ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id">c</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Val">Val</a></span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x</span>, <span class="id">c</span>, <span class="id">uf</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">st2v</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">uf</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; (<span class="id">st</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">uf</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Convert.html#extend_rthread">extend_rthread</a></span> <span class="id">st</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Val">Val</a></span> <span class="id">uf</span> ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>) |},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Convert.html#Thread">Thread</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#exit_rthread">exit_rthread</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">st2v</span>) <span class="id">rid</span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x</span>, <span class="id"><a href="Convert.html#compose_cont">compose_cont</a></span> <span class="id">c</span> <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>), (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">st2v</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Val">Val</a></span> (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> <span class="id">l</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rthread</span>.(<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kid">Kid</a></span> =&gt; <span class="id">st</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kapp">Kapp</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">st</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">bs</span> <span class="id">tag</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id">st</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">p</span>, <span class="id">t</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">p</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> <span class="id">st</span> <span class="id">rid</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Term">Term</a></span> <span class="id">t</span> (<span class="id">l</span> ++ <span class="id">e</span>) ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id">c</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">st</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="cthread_andn">cthread_andn</a></span> (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Convert.html#cthread">cthread</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; <span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id">c</span> :: <span class="id">l</span> =&gt; <span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> <span class="id">c</span> (<span class="id">cthread_andn</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="cmp_cont">cmp_cont</a></span> (<span class="id">c1</span> <span class="id">c2</span> : <span class="id"><a href="Convert.html#cont">cont</a></span>) <span class="id">varmap1</span> <span class="id">varmap2</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c1</span>, <span class="id">c2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kid">Kid</a></span>, <span class="id"><a href="Convert.html#Kid">Kid</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kapp">Kapp</a></span> <span class="id">u1</span> <span class="id">c1</span>, <span class="id"><a href="Convert.html#Kapp">Kapp</a></span> <span class="id">u2</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">cmp_cont</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">u1</span> <span class="id">u2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> :: <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">l1</span> <span class="id">c1</span>, <span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">l2</span> <span class="id">c2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb">Nat.eqb</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l1</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l2</span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l12</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">l1</span> <span class="id">l2</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb">forallb</a></span> (<span class="kwd">fun</span> <span class="id">vv</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb">Nat.eqb</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vv</span>))) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">vv</span>)))) <span class="id">l12</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">cmp_cont</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">vv</span> =&gt; <span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vv</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">vv</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vv</span>) ++ <span class="id">varmap1</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">vv</span>) ++ <span class="id">varmap2</span>)) <span class="id">l12</span> ++ <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="cmp_cont_cthread">cmp_cont_cthread</a></span> (<span class="id">c1</span> <span class="id">c2</span> : <span class="id"><a href="Convert.html#cont">cont</a></span>) <span class="id">varmap1</span> <span class="id">varmap2</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="Convert.html#cthread_andn">cthread_andn</a></span> <span class="id">l</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cthread_red">cthread_red</a></span> (<span class="id">st</span> : <span class="id"><a href="Convert.html#state">state</a></span>) : <span class="id"><a href="Convert.html#cthread">cthread</a></span> -&gt; <span class="id"><a href="Convert.html#cthread">cthread</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="cthread_reduce_1">cthread_reduce_1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rid</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#is_finished">is_finished</a></span> <span class="id">st</span> <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Thread">Thread</a></span> <span class="id">rid</span>) <span class="id">v2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
| <span class="id"><a name="cthread_reduce_2">cthread_reduce_2</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rid</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#is_finished">is_finished</a></span> <span class="id">st</span> <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">v1</span> (<span class="id"><a href="Convert.html#Thread">Thread</a></span> <span class="id">rid</span>) <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
| <span class="id"><a name="cthread_reduce_clos_clos">cthread_reduce_clos_clos</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Clos">Clos</a></span> <span class="id">t1</span> <span class="id">e1</span> <span class="id">x1</span> <span class="id">v1</span>) (<span class="id"><a href="Convert.html#Clos">Clos</a></span> <span class="id">t2</span> <span class="id">e2</span> <span class="id">x2</span> <span class="id">v2</span>) <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">v1</span> <span class="id">v2</span> (<span class="id">x1</span> :: <span class="id">varmap1</span>) (<span class="id">x2</span> :: <span class="id">varmap2</span>))<br/>
| <span class="id"><a name="cthread_reduce_block_block_same">cthread_reduce_block_block_same</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tag</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> <span class="id">l1</span>) (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> <span class="id">l2</span>) <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Convert.html#cthread_andn">cthread_andn</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">v12</span> =&gt; <span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">v12</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">v12</span>) <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">l1</span> <span class="id">l2</span>)))<br/>
| <span class="id"><a name="cthread_reduce_block_block_different_lengths">cthread_reduce_block_block_different_lengths</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tag</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l1</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> <span class="id">l1</span>) (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> <span class="id">l2</span>) <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_reduce_block_block_different_tags">cthread_reduce_block_block_different_tags</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tag1</span> <span class="id">tag2</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tag1</span> &lt;&gt; <span class="id">tag2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag1</span> <span class="id">l1</span>) (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag2</span> <span class="id">l2</span>) <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_reduce_clos_block">cthread_reduce_clos_block</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">e</span> <span class="id">x</span> <span class="id">v</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Clos">Clos</a></span> <span class="id">t</span> <span class="id">e</span> <span class="id">x</span> <span class="id">v</span>) (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> <span class="id">l</span>) <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_reduce_block_clos">cthread_reduce_block_clos</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">t</span> <span class="id">e</span> <span class="id">x</span> <span class="id">v</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> <span class="id">l</span>) (<span class="id"><a href="Convert.html#Clos">Clos</a></span> <span class="id">t</span> <span class="id">e</span> <span class="id">x</span> <span class="id">v</span>) <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_reduce_var_unfold_1">cthread_reduce_var_unfold_1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">c</span> <span class="id">uf</span> <span class="id">v</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x</span>, <span class="id">c</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">uf</span>)) <span class="id">v</span> <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">uf</span> <span class="id">v</span> <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
| <span class="id"><a name="cthread_reduce_var_unfold_2">cthread_reduce_var_unfold_2</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">x</span> <span class="id">c</span> <span class="id">uf</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">v</span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x</span>, <span class="id">c</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">uf</span>)) <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">v</span> <span class="id">uf</span> <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
| <span class="id"><a name="cthread_reduce_same_var_unfold">cthread_reduce_same_var_unfold</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">uf1</span> <span class="id">uf2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x</span>, <span class="id">c1</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">uf1</span>)) (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x</span>, <span class="id">c2</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">uf2</span>)) <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">uf1</span> <span class="id">uf2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="Convert.html#cmp_cont_cthread">cmp_cont_cthread</a></span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>))<br/>
| <span class="id"><a name="cthread_reduce_var_nounfold">cthread_reduce_var_nounfold</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap1</span> <span class="id">x1</span> = <span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap2</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x1</span>, <span class="id">c1</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x2</span>, <span class="id">c2</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Convert.html#cmp_cont_cthread">cmp_cont_cthread</a></span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
| <span class="id"><a name="cthread_reduce_different_var_nounfold">cthread_reduce_different_var_nounfold</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap1</span> <span class="id">x1</span> &lt;&gt; <span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap2</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x1</span>, <span class="id">c1</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x2</span>, <span class="id">c2</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) <span class="id">varmap1</span> <span class="id">varmap2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_reduce_clos_var_nounfold">cthread_reduce_clos_var_nounfold</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">e</span> <span class="id">x</span> <span class="id">v</span> <span class="id">y</span> <span class="id">c</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Clos">Clos</a></span> <span class="id">t</span> <span class="id">e</span> <span class="id">x</span> <span class="id">v</span>) (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">y</span>, <span class="id">c</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_reduce_block_var_nounfold">cthread_reduce_block_var_nounfold</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">x</span> <span class="id">c</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> <span class="id">l</span>) (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x</span>, <span class="id">c</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_reduce_var_clos_nounfold">cthread_reduce_var_clos_nounfold</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">y</span> <span class="id">c</span> <span class="id">t</span> <span class="id">e</span> <span class="id">x</span> <span class="id">v</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">y</span>, <span class="id">c</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) (<span class="id"><a href="Convert.html#Clos">Clos</a></span> <span class="id">t</span> <span class="id">e</span> <span class="id">x</span> <span class="id">v</span>) <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_reduce_var_block_nounfold">cthread_reduce_var_block_nounfold</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">c</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x</span>, <span class="id">c</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> <span class="id">l</span>) <span class="id">varmap1</span> <span class="id">varmap2</span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_and_true">cthread_and_true</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>)) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>)<br/>
| <span class="id"><a name="cthread_and_false_1">cthread_and_false_1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct</span>, <span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="id">ct</span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_and_false_2">cthread_and_false_2</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct</span>, <span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> <span class="id">ct</span> (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_or_false">cthread_or_false</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
| <span class="id"><a name="cthread_or_true_1">cthread_or_true_1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct</span>, <span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) <span class="id">ct</span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>)<br/>
| <span class="id"><a name="cthread_or_true_2">cthread_or_true_2</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct</span>, <span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> <span class="id">ct</span> (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>)) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>)<br/>
| <span class="id"><a name="cthread_and_1">cthread_and_1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct1</span> <span class="id">ct2</span> <span class="id">ct3</span>, <span class="id">cthread_red</span> <span class="id">st</span> <span class="id">ct1</span> <span class="id">ct2</span> -&gt; <span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> <span class="id">ct1</span> <span class="id">ct3</span>) (<span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> <span class="id">ct2</span> <span class="id">ct3</span>)<br/>
| <span class="id"><a name="cthread_and_2">cthread_and_2</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct1</span> <span class="id">ct2</span> <span class="id">ct3</span>, <span class="id">cthread_red</span> <span class="id">st</span> <span class="id">ct1</span> <span class="id">ct2</span> -&gt; <span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> <span class="id">ct3</span> <span class="id">ct1</span>) (<span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> <span class="id">ct3</span> <span class="id">ct2</span>)<br/>
| <span class="id"><a name="cthread_or_1">cthread_or_1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct1</span> <span class="id">ct2</span> <span class="id">ct3</span>, <span class="id">cthread_red</span> <span class="id">st</span> <span class="id">ct1</span> <span class="id">ct2</span> -&gt; <span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> <span class="id">ct1</span> <span class="id">ct3</span>) (<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> <span class="id">ct2</span> <span class="id">ct3</span>)<br/>
| <span class="id"><a name="cthread_or_2">cthread_or_2</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct1</span> <span class="id">ct2</span> <span class="id">ct3</span>, <span class="id">cthread_red</span> <span class="id">st</span> <span class="id">ct1</span> <span class="id">ct2</span> -&gt; <span class="id">cthread_red</span> <span class="id">st</span> (<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> <span class="id">ct3</span> <span class="id">ct1</span>) (<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> <span class="id">ct3</span> <span class="id">ct2</span>)<br/>
.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="step">step</a></span> : (<span class="id"><a href="Convert.html#cthread">cthread</a></span> * <span class="id"><a href="Convert.html#state">state</a></span>) -&gt; (<span class="id"><a href="Convert.html#cthread">cthread</a></span> * <span class="id"><a href="Convert.html#state">state</a></span>) -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="step_rthread">step_rthread</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct</span> <span class="id">st</span> <span class="id">rid</span>, <span class="id">rid</span> &lt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) -&gt; <span class="id">step</span> (<span class="id">ct</span>, <span class="id">st</span>) (<span class="id">ct</span>, (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>))<br/>
| <span class="id"><a name="step_cthread">step_cthread</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct1</span> <span class="id">ct2</span> <span class="id">st</span>, <span class="id"><a href="Convert.html#cthread_red">cthread_red</a></span> <span class="id">st</span> <span class="id">ct1</span> <span class="id">ct2</span> -&gt; <span class="id">step</span> (<span class="id">ct1</span>, <span class="id">st</span>) (<span class="id">ct2</span>, <span class="id">st</span>).<br/>
<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="dvar_free">dvar_free</a></span> <span class="id">x</span> : <span class="id"><a href="STerm.html#term">term</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="dvar_free_var">dvar_free_var</a></span> : <span class="kwd">forall</span> <span class="id">n</span>, <span class="id">dvar_free</span> <span class="id">x</span> (<span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span>)<br/>
| <span class="id"><a name="dvar_free_dvar">dvar_free_dvar</a></span> : <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt; <span class="id">dvar_free</span> <span class="id">x</span> (<span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">y</span>)<br/>
| <span class="id"><a name="dvar_free_abs">dvar_free_abs</a></span> : <span class="kwd">forall</span> <span class="id">t</span>, <span class="id">dvar_free</span> <span class="id">x</span> <span class="id">t</span> -&gt; <span class="id">dvar_free</span> <span class="id">x</span> (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span>)<br/>
| <span class="id"><a name="dvar_free_app">dvar_free_app</a></span> : <span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id">dvar_free</span> <span class="id">x</span> <span class="id">t1</span> -&gt; <span class="id">dvar_free</span> <span class="id">x</span> <span class="id">t2</span> -&gt; <span class="id">dvar_free</span> <span class="id">x</span> (<span class="id"><a href="STerm.html#app">app</a></span> <span class="id">t1</span> <span class="id">t2</span>)<br/>
| <span class="id"><a name="dvar_free_constr">dvar_free_constr</a></span> : <span class="kwd">forall</span> <span class="id">tag</span> <span class="id">l</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id">dvar_free</span> <span class="id">x</span>) <span class="id">l</span> -&gt; <span class="id">dvar_free</span> <span class="id">x</span> (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span>)<br/>
| <span class="id"><a name="dvar_free_switch">dvar_free_switch</a></span> : <span class="kwd">forall</span> <span class="id">t</span> <span class="id">m</span>, <span class="id">dvar_free</span> <span class="id">x</span> <span class="id">t</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">pt</span> =&gt; <span class="id">dvar_free</span> <span class="id">x</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>)) <span class="id">m</span> -&gt; <span class="id">dvar_free</span> <span class="id">x</span> (<span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">m</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="no_dvar">no_dvar</a></span> <span class="id">t</span> := <span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> <span class="id">t</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">vars</span> <span class="id">n</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">p</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> (<span class="id">k</span> + <span class="id">p</span>) | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span> <span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#app">app</a></span> <span class="id">t1</span> <span class="id">t2</span> =&gt; <span class="id"><a href="STerm.html#app">app</a></span> (<span class="id">lift_dvars</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t1</span>) (<span class="id">lift_dvars</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span> =&gt; <span class="id"><a href="STerm.html#abs">abs</a></span> (<span class="id">lift_dvars</span> <span class="id">vars</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">k</span>) <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span> =&gt; <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id">lift_dvars</span> <span class="id">vars</span> <span class="id">k</span>) <span class="id">l</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">m</span> =&gt; <span class="id"><a href="STerm.html#switch">switch</a></span> (<span class="id">lift_dvars</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">pt</span> =&gt; (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span>, <span class="id">lift_dvars</span> <span class="id">vars</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span> + <span class="id">k</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>))) <span class="id">m</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="lift_dvars_hctx">lift_dvars_hctx</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">h</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> =&gt; <span class="id"><a href="Beta.html#h_hole">h_hole</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h</span> <span class="id">t</span> =&gt; <span class="id"><a href="Beta.html#h_app">h_app</a></span> (<span class="id">lift_dvars_hctx</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">h</span>) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h</span> <span class="id">m</span> =&gt; <span class="id"><a href="Beta.html#h_switch">h_switch</a></span> (<span class="id">lift_dvars_hctx</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">h</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">pt</span> =&gt; (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span>, <span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span> + <span class="id">k</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>))) <span class="id">m</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="no_delete">no_delete</a></span> <span class="id">st1</span> <span class="id">st2</span> := <span class="kwd">forall</span> <span class="id">rid</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st2</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st1</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="no_delete_refl">no_delete_refl</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span>, <span class="id"><a href="Convert.html#no_delete">no_delete</a></span> <span class="id">st</span> <span class="id">st</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">rid</span> <span class="id">H</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="no_delete_iff">no_delete_iff</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span>, <span class="id"><a href="Convert.html#no_delete">no_delete</a></span> <span class="id">st1</span> <span class="id">st2</span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">st1</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) &lt;= <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">st2</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span>. <span class="id">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">specialize</span> (<span class="id">H</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st2</span>))). <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Hlen</span> <span class="id">rid</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> *; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="Convert.html#rthreadptr">rthreadptr</a></span> -&gt; <span class="id"><a href="STerm.html#term">term</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="read_thread_val">read_thread_val</a></span> : <span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">v</span> <span class="id">c</span> <span class="id">t</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Val">Val</a></span> <span class="id">v</span> ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id">c</span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_cont</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_thread</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t</span>)<br/>
| <span class="id"><a name="read_thread_term">read_thread_term</a></span> : <span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">e</span> <span class="id">el</span> <span class="id">c</span> <span class="id">t</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Term">Term</a></span> <span class="id">t</span> <span class="id">e</span> ; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id">c</span> |} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_cont</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#no_dvar">no_dvar</a></span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_thread</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>) <span class="id">t</span>))<br/>
<br/>
<span class="kwd">with</span> <span class="id"><a name="read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="Convert.html#value">value</a></span> -&gt; <span class="id"><a href="STerm.html#term">term</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="read_val_thread">read_val_thread</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span>, <span class="id">read_thread</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> -&gt; <span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> (<span class="id"><a href="Convert.html#Thread">Thread</a></span> <span class="id">rid</span>) <span class="id">t</span><br/>
| <span class="id"><a name="read_val_clos">read_val_clos</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">t</span> <span class="id">e</span> <span class="id">el</span> <span class="id">x</span> <span class="id">vdeep</span> <span class="id">tdeep</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id">x</span> :: <span class="id">varmap</span>) <span class="id">vdeep</span> <span class="id">tdeep</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>)) <span class="id">t</span>) <span class="id">tdeep</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#no_dvar">no_dvar</a></span> <span class="id">t</span> -&gt;  <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id">x</span> &lt; <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_freename">st_freename</a></span>) -&gt; <span class="id">x</span> \<span class="id">notin</span> <span class="id">varmap</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> (<span class="id"><a href="Convert.html#Clos">Clos</a></span> <span class="id">t</span> <span class="id">e</span> <span class="id">x</span> <span class="id">vdeep</span>) (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>) (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span>))<br/>
| <span class="id"><a name="read_val_block">read_val_block</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">tag</span> <span class="id">e</span> <span class="id">el</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> (<span class="id"><a href="Convert.html#Block">Block</a></span> <span class="id">tag</span> <span class="id">e</span>) (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">el</span>)<br/>
| <span class="id"><a name="read_val_neutral">read_val_neutral</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">x</span> <span class="id">c</span> <span class="id">h</span> <span class="id">uf</span> <span class="id">tuf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_cont</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="GenInd.html#if_Some3">if_Some3</a></span> (<span class="kwd">fun</span> <span class="id">v2</span> <span class="id">t2</span> <span class="id">def</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v2</span> <span class="id">t2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">def</span>) <span class="id">t2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">def</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uf</span> <span class="id">tuf</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">defs</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt; <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_freename">st_freename</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">defs</span> <span class="id">x</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">varmap</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x</span>, <span class="id">c</span>, <span class="id">uf</span>)) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> (<span class="kwd">match</span> <span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">x</span> | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> <span class="kwd">end</span>))<br/>
<br/>
<span class="kwd">with</span> <span class="id"><a name="read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="Convert.html#cont">cont</a></span> -&gt; <span class="id"><a href="Beta.html#hctx">hctx</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="read_cont_kid">read_cont_kid</a></span> : <span class="kwd">forall</span> <span class="id">varmap</span>, <span class="id">read_cont</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id"><a href="Convert.html#Kid">Kid</a></span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span><br/>
| <span class="id"><a name="read_cont_kapp">read_cont_kapp</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">c</span> <span class="id">t</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_cont</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_cont</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> (<span class="id"><a href="Convert.html#Kapp">Kapp</a></span> <span class="id">v</span> <span class="id">c</span>) (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h</span> (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> <span class="id">t</span>))<br/>
| <span class="id"><a name="read_cont_kswitch">read_cont_kswitch</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> <span class="id">tdeeps</span> <span class="id">c</span> <span class="id">el</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_cont</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Misc.html#Forall3">Forall3</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vdeeps</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_val</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vdeeps</span> ++ <span class="id">varmap</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">vdeeps</span>) <span class="id">tdeep</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span>) (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>)) <span class="id">tdeep</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="STerm.html#closed_at">closed_at</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id">x</span> &lt; <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_freename">st_freename</a></span>) /\ <span class="id">x</span> \<span class="id">notin</span> <span class="id">varmap</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vdeeps</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vdeeps</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#no_dvar">no_dvar</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id">bs</span> <span class="id">bds</span> <span class="id">tdeeps</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_cont</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> (<span class="id"><a href="Convert.html#Kswitch">Kswitch</a></span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> <span class="id">c</span>) (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h</span> (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">p</span>, <span class="id">t</span>) =&gt; (<span class="id">p</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>)) <span class="id">t</span>)) <span class="id">bs</span>))).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="read_ind">read_ind</a></span> <span class="id">st</span> <span class="id">defs</span> := <span class="id">Induction</span> <span class="id">For</span> [ <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> ; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> ; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> ].<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">read_thread_val_intro</span> :=<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">v</span> <span class="id">c</span> <span class="id">t</span> <span class="id">h</span> <span class="id">Hnth</span> <span class="id">Hv</span> <span class="id">Hc</span> <span class="id">IHv</span> <span class="id">IHc</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">read_thread_term_intro</span> :=<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">e</span> <span class="id">el</span> <span class="id">c</span> <span class="id">t</span> <span class="id">h</span> <span class="id">Hnth</span> <span class="id">Hclosed</span> <span class="id">He</span> <span class="id">Hc</span> <span class="id">Hdv</span> <span class="id">IHe</span> <span class="id">IHc</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">read_val_thread_intro</span> :=<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> <span class="id">Hrid</span> <span class="id">IH</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">read_val_clos_intro</span> :=<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">varmap</span> <span class="id">t</span> <span class="id">e</span> <span class="id">el</span> <span class="id">x</span> <span class="id">vdeep</span> <span class="id">tdeep</span> <span class="id">He</span> <span class="id">Hvdeep</span> <span class="id">Hconv</span> <span class="id">Hdv</span> <span class="id">Hfree1</span> <span class="id">Hfree2</span> <span class="id">Hclosed</span> <span class="id">IHe</span> <span class="id">IHdeep</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">read_val_block_intro</span> :=<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">varmap</span> <span class="id">tag</span> <span class="id">e</span> <span class="id">el</span> <span class="id">He</span> <span class="id">IHe</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">read_val_neutral_intro</span> :=<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">varmap</span> <span class="id">x</span> <span class="id">c</span> <span class="id">h</span> <span class="id">uf</span> <span class="id">tuf</span> <span class="id">Hc</span> <span class="id">Huf</span> <span class="id">Hfree</span> <span class="id">Hin</span> <span class="id">IHc</span> <span class="id">IHuf</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">read_cont_kid_intro</span> :=<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">varmap</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">read_cont_kapp_intro</span> :=<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">c</span> <span class="id">t</span> <span class="id">h</span> <span class="id">Hv</span> <span class="id">Hc</span> <span class="id">IHv</span> <span class="id">IHc</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">read_cont_kswitch_intro</span> :=<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">varmap</span> <span class="id">bs</span> <span class="id">e</span> <span class="id">bds</span> <span class="id">tdeeps</span> <span class="id">c</span> <span class="id">el</span> <span class="id">h</span> <span class="id">He</span> <span class="id">Hc</span> <span class="id">Hdeeps</span> <span class="id">IHe</span> <span class="id">IHc</span> <span class="id">IHdeep</span>.<br/>
<span class="kwd">Ltac</span> <span class="id">read_ind</span> :=<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#read_ind">read_ind</a></span>; [<span class="id">read_thread_val_intro</span>|<span class="id">read_thread_term_intro</span>|<span class="id">read_val_thread_intro</span>|<span class="id">read_val_clos_intro</span>|<span class="id">read_val_block_intro</span>|<span class="id">read_val_neutral_intro</span>|<span class="id">read_cont_kid_intro</span>|<span class="id">read_cont_kapp_intro</span>|<span class="id">read_cont_kswitch_intro</span>].<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_Acc_aux">read_Acc_aux</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span>, (<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc">Acc</a></span> (<span class="id"><a href="Rewrite.html#flip">flip</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>)) <span class="id">a</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc">Acc</a></span> (<span class="id"><a href="Rewrite.html#flip">flip</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>)) <span class="id">a</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#cont_points_to">cont_points_to</a></span> <span class="id">c</span> <span class="id">a</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc">Acc</a></span> (<span class="id"><a href="Rewrite.html#flip">flip</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>)) <span class="id">a</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span>. <span class="id">read_ind</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hpoint</span>. <span class="id">unfold</span> <span class="id"><a href="Rewrite.html#flip">flip</a></span>, <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span> <span class="kwd">in</span> <span class="id">Hpoint</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hpoint</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hnth</span> <span class="kwd">in</span> <span class="id">Hpoint</span>. <span class="id">destruct</span> <span class="id">Hpoint</span> <span class="kwd">as</span> [<span class="id">Hpoint</span> | <span class="id">Hpoint</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHv</span>. <span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hpoint</span>. <span class="id">unfold</span> <span class="id"><a href="Rewrite.html#flip">flip</a></span>, <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span> <span class="kwd">in</span> <span class="id">Hpoint</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hpoint</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hnth</span> <span class="kwd">in</span> <span class="id">Hpoint</span>. <span class="id">destruct</span> <span class="id">Hpoint</span> <span class="kwd">as</span> [<span class="id">Hpoint</span> | <span class="id">Hpoint</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_Exists_left_transparent">Forall2_Exists_left_transparent</a></span>; [|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v1</span> <span class="id">t1</span> <span class="id">IH</span> <span class="id">Hpoint2</span>; <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hpoint2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>, <span class="id">Hpoint</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>; <span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_Exists_left_transparent">Forall2_Exists_left_transparent</a></span>; [|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v1</span> <span class="id">t1</span> <span class="id">IH</span> <span class="id">Hpoint2</span>; <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hpoint2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHdeep</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>. <span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_Exists_left_transparent">Forall2_Exists_left_transparent</a></span>; [|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">t</span> <span class="id">IH</span> <span class="id">Hpoint2</span>; <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hpoint2</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>. <span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">IHuf</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id">H3</span>, <span class="id">H1</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>. <span class="id">inversion</span> <span class="id">Hpoint</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>; <span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHv</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_Exists_left_transparent">Forall2_Exists_left_transparent</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v1</span> <span class="id">t1</span> <span class="id">IH</span> <span class="id">Hpoint2</span>; <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hpoint2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_Exists_2_transparent">Forall3_Exists_2_transparent</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">pt1</span> <span class="id">vd1</span> <span class="id">t1</span> <span class="id">IH</span> <span class="id">Hpoint2</span>. <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hpoint2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_thread_Acc">read_thread_Acc</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc">Acc</a></span> (<span class="id"><a href="Rewrite.html#flip">flip</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>)) <span class="id">a</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">eapply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="Convert.html#read_Acc_aux">read_Acc_aux</a></span> <span class="id">st</span> <span class="id">defs</span>)); <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_val_Acc">read_val_Acc</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc">Acc</a></span> (<span class="id"><a href="Rewrite.html#flip">flip</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>)) <span class="id">a</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">eapply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#read_Acc_aux">read_Acc_aux</a></span> <span class="id">st</span> <span class="id">defs</span>))); <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_cont_Acc">read_cont_Acc</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="id"><a href="Convert.html#cont_points_to">cont_points_to</a></span> <span class="id">c</span> <span class="id">a</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Wf.html#Acc">Acc</a></span> (<span class="id"><a href="Rewrite.html#flip">flip</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>)) <span class="id">a</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">eapply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#read_Acc_aux">read_Acc_aux</a></span> <span class="id">st</span> <span class="id">defs</span>))); <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_points_aux">read_points_aux</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span>, (<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="kwd">exists</span> <span class="id">t</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id">varmap2</span> ++ <span class="id">varmap</span>) <span class="id">a</span> <span class="id">t</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#cont_points_to">cont_points_to</a></span> <span class="id">c</span> <span class="id">a</span> -&gt; <span class="kwd">exists</span> <span class="id">t</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id">varmap2</span> ++ <span class="id">varmap</span>) <span class="id">a</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span>. <span class="id">read_ind</span>.<br/>
&nbsp;&nbsp;- <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>; <span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>. <span class="id">eexists</span>; <span class="kwd">exists</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_Exists_left_transparent">Forall2_Exists_left_transparent</a></span>; [|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v1</span> <span class="id">t1</span> <span class="id">IH</span> <span class="id">Hpoint2</span>; <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hpoint2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id">IHdeep</span> <span class="id">_</span> <span class="id">H4</span>) <span class="kwd">as</span> (<span class="id">t1</span> &amp; <span class="id">varmap2</span> &amp; <span class="id">IH</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t1</span>. <span class="kwd">exists</span> (<span class="id">varmap2</span> ++ (<span class="id">x</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)). <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_Exists_left_transparent">Forall2_Exists_left_transparent</a></span>; [|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">t</span> <span class="id">IH</span> <span class="id">Hpoint2</span>; <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hpoint2</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>. <span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">IHuf</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id">H3</span>, <span class="id">H1</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>. <span class="id">inversion</span> <span class="id">Hpoint</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>; <span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHv</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a</span> <span class="id">Hpoint</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hpoint</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_Exists_left_transparent">Forall2_Exists_left_transparent</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v1</span> <span class="id">t1</span> <span class="id">IH</span> <span class="id">Hpoint2</span>; <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hpoint2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_Exists_2_transparent">Forall3_Exists_2_transparent</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">pt1</span> <span class="id">vd1</span> <span class="id">t1</span> <span class="id">IH</span> <span class="id">Hpoint2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IH</span> <span class="id">_</span> <span class="id">Hpoint2</span>) <span class="kwd">as</span> (<span class="id">t2</span> &amp; <span class="id">varmap2</span> &amp; <span class="id">IH2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t2</span>. <span class="kwd">exists</span> (<span class="id">varmap2</span> ++ <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vd1</span>). <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_val_points">read_val_points</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id">varmap2</span> ++ <span class="id">varmap</span>) <span class="id">a</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> <span class="id">a</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#read_points_aux">read_points_aux</a></span> <span class="id">st</span> <span class="id">defs</span>))); <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_cont_points">read_cont_points</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="id"><a href="Convert.html#cont_points_to">cont_points_to</a></span> <span class="id">c</span> <span class="id">a</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id">varmap2</span> ++ <span class="id">varmap</span>) <span class="id">a</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> <span class="id">a</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#read_points_aux">read_points_aux</a></span> <span class="id">st</span> <span class="id">defs</span>))); <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_thread_points">read_thread_points</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a1</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span> <span class="id">a1</span> <span class="id">a2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id">varmap2</span> ++ <span class="id">varmap</span>) <span class="id">a2</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">t</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span> <span class="kwd">in</span> *; <span class="id">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">destruct</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>. <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_points">read_val_points</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cont_points">read_cont_points</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_Exists_left_transparent">Forall2_Exists_left_transparent</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_points">read_val_points</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cont_points">read_cont_points</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="every_reachable">every_reachable</a></span> <span class="id">st</span> <span class="id">a</span> (<span class="id">P</span> : <span class="id"><a href="Convert.html#addr">addr</a></span> -&gt; <span class="kwd">Prop</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a2</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>) <span class="id">a</span> <span class="id">a2</span> -&gt; <span class="id">P</span> <span class="id">a2</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="every_reachable_plus">every_reachable_plus</a></span> <span class="id">st</span> <span class="id">a</span> (<span class="id">P</span> : <span class="id"><a href="Convert.html#addr">addr</a></span> -&gt; <span class="kwd">Prop</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a2</span>, <span class="id"><a href="Rewrite.html#plus">plus</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>) <span class="id">a</span> <span class="id">a2</span> -&gt; <span class="id">P</span> <span class="id">a2</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="every_reachable_impl">every_reachable_impl</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">a</span> (<span class="id">P</span> <span class="id">Q</span> : <span class="id"><a href="Convert.html#addr">addr</a></span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a2</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>) <span class="id">a</span> <span class="id">a2</span> -&gt; <span class="id">P</span> <span class="id">a2</span> -&gt; <span class="id">Q</span> <span class="id">a2</span>) -&gt; <span class="id"><a href="Convert.html#every_reachable">every_reachable</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> -&gt; <span class="id"><a href="Convert.html#every_reachable">every_reachable</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">Q</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">a2</span> <span class="id">Hstar</span>; <span class="id">apply</span> <span class="id">H1</span>; [<span class="id">assumption</span>|]; <span class="id">apply</span> <span class="id">H2</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="every_reachable_plus_impl">every_reachable_plus_impl</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">a</span> (<span class="id">P</span> <span class="id">Q</span> : <span class="id"><a href="Convert.html#addr">addr</a></span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a2</span>, <span class="id"><a href="Rewrite.html#plus">plus</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>) <span class="id">a</span> <span class="id">a2</span> -&gt; <span class="id">P</span> <span class="id">a2</span> -&gt; <span class="id">Q</span> <span class="id">a2</span>) -&gt; <span class="id"><a href="Convert.html#every_reachable_plus">every_reachable_plus</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> -&gt; <span class="id"><a href="Convert.html#every_reachable_plus">every_reachable_plus</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">Q</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">a2</span> <span class="id">Hplus</span>; <span class="id">apply</span> <span class="id">H1</span>; [<span class="id">assumption</span>|]; <span class="id">apply</span> <span class="id">H2</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="every_reachable_star">every_reachable_star</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">a</span> <span class="id">a2</span> <span class="id">P</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>) <span class="id">a</span> <span class="id">a2</span> -&gt; <span class="id"><a href="Convert.html#every_reachable">every_reachable</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> -&gt; <span class="id"><a href="Convert.html#every_reachable">every_reachable</a></span> <span class="id">st</span> <span class="id">a2</span> <span class="id">P</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">a</span> <span class="id">a2</span> <span class="id">P</span> <span class="id">Hstar</span> <span class="id">H</span> <span class="id">a3</span> <span class="id">Hstar2</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="every_reachable_plus_star">every_reachable_plus_star</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">a</span> <span class="id">a2</span> <span class="id">P</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>) <span class="id">a</span> <span class="id">a2</span> -&gt; <span class="id"><a href="Convert.html#every_reachable_plus">every_reachable_plus</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> -&gt; <span class="id"><a href="Convert.html#every_reachable_plus">every_reachable_plus</a></span> <span class="id">st</span> <span class="id">a2</span> <span class="id">P</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">a</span> <span class="id">a2</span> <span class="id">P</span> <span class="id">Hstar</span> <span class="id">H</span> <span class="id">a3</span> <span class="id">Hplus</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#plus_compose_star_left">plus_compose_star_left</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="every_reachable_star_plus">every_reachable_star_plus</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">a</span> <span class="id">a2</span> <span class="id">P</span>, <span class="id"><a href="Rewrite.html#plus">plus</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>) <span class="id">a</span> <span class="id">a2</span> -&gt; <span class="id"><a href="Convert.html#every_reachable_plus">every_reachable_plus</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> -&gt; <span class="id"><a href="Convert.html#every_reachable">every_reachable</a></span> <span class="id">st</span> <span class="id">a2</span> <span class="id">P</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">a</span> <span class="id">a2</span> <span class="id">P</span> <span class="id">Hplus</span> <span class="id">H</span> <span class="id">a3</span> <span class="id">Hstar</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#plus_compose_star_right">plus_compose_star_right</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="every_reachable_plus_iff">every_reachable_plus_iff</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span>, <span class="id"><a href="Convert.html#every_reachable_plus">every_reachable_plus</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> &lt;-&gt; (<span class="kwd">forall</span> <span class="id">a2</span>, <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">a2</span> -&gt; <span class="id"><a href="Convert.html#every_reachable">every_reachable</a></span> <span class="id">st</span> <span class="id">a2</span> <span class="id">P</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span>. <span class="id">split</span>; <span class="id">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a2</span> <span class="id">Ha2</span> <span class="id">a3</span> <span class="id">Ha3</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">rewrite</span> (<span class="id"><a href="Rewrite.html#plus_star_iff">plus_star_iff</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>). <span class="kwd">exists</span> <span class="id">a2</span>. <span class="id">split</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a3</span> <span class="id">Ha3</span>. <span class="id">rewrite</span> (<span class="id"><a href="Rewrite.html#plus_star_iff">plus_star_iff</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">in</span> <span class="id">Ha3</span>; <span class="id">destruct</span> <span class="id">Ha3</span> <span class="kwd">as</span> (<span class="id">a2</span> &amp; <span class="id">Ha2</span> &amp; <span class="id">Ha3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> (<span class="id">H</span> <span class="id">a2</span> <span class="id">Ha2</span> <span class="id">a3</span> <span class="id">Ha3</span>).<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="every_reachable_same">every_reachable_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span>, <span class="id"><a href="Convert.html#every_reachable">every_reachable</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> -&gt; <span class="id">P</span> <span class="id">a</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> <span class="id">H</span>; <span class="id">apply</span> <span class="id">H</span>, <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="every_reachable_is_plus">every_reachable_is_plus</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span>, <span class="id"><a href="Convert.html#every_reachable">every_reachable</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> -&gt; <span class="id"><a href="Convert.html#every_reachable_plus">every_reachable_plus</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">a</span> <span class="id">P</span> <span class="id">H</span> <span class="id">a2</span> <span class="id">Ha2</span>. <span class="id">apply</span> <span class="id">H</span>, <span class="id"><a href="Rewrite.html#plus_star">plus_star</a></span>, <span class="id">Ha2</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="every_reachable_iff">every_reachable_iff</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">a1</span> <span class="id">P</span>, <span class="id"><a href="Convert.html#every_reachable">every_reachable</a></span> <span class="id">st</span> <span class="id">a1</span> <span class="id">P</span> &lt;-&gt; <span class="id">P</span> <span class="id">a1</span> /\ <span class="id"><a href="Convert.html#every_reachable_plus">every_reachable_plus</a></span> <span class="id">st</span> <span class="id">a1</span> <span class="id">P</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">a1</span> <span class="id">P</span>. <span class="id">split</span>; <span class="id">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">split</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#every_reachable_same">every_reachable_same</a></span>|<span class="id">eapply</span> <span class="id"><a href="Convert.html#every_reachable_is_plus">every_reachable_is_plus</a></span>]; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">a2</span> <span class="id">Ha2</span>. <span class="id">inversion</span> <span class="id">Ha2</span>; <span class="id">subst</span>; [<span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H</span>. <span class="id">rewrite</span> (<span class="id"><a href="Rewrite.html#plus_star_iff">plus_star_iff</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>); <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span> := <span class="id"><a href="Convert.html#every_reachable">every_reachable</a></span> <span class="id">st1</span> <span class="id">a</span> (<span class="kwd">fun</span> <span class="id">a2</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st1</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">a2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st2</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">a2</span>).<br/>
<span class="kwd">Definition</span> <span class="id"><a name="unchanged_from_plus">unchanged_from_plus</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span> := <span class="id"><a href="Convert.html#every_reachable_plus">every_reachable_plus</a></span> <span class="id">st1</span> <span class="id">a</span> (<span class="kwd">fun</span> <span class="id">a2</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st1</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">a2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st2</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">a2</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_from_same">unchanged_from_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st1</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">a</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">st2</span>.(<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span>) <span class="id">a</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#every_reachable_same">every_reachable_same</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_from_points">unchanged_from_points</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a1</span> <span class="id">a2</span>, <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a1</span> -&gt; <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st1</span> <span class="id">a1</span> <span class="id">a2</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">Hchanged</span> <span class="id">Hpoint</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#every_reachable_is_plus">every_reachable_is_plus</a></span> <span class="kwd">in</span> <span class="id">Hchanged</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#every_reachable_plus_iff">every_reachable_plus_iff</a></span> <span class="kwd">in</span> <span class="id">Hchanged</span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_same_aux">read_same_aux</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st1</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; (<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span>) -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt; (<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#cont_points_to">cont_points_to</a></span> <span class="id">c</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span>) -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">Hst12</span>. <span class="id">read_ind</span>; <span class="id">intros</span> <span class="id">Hunchanged</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_val">read_thread_val</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> <span class="id"><a href="Convert.html#unchanged_from_same">unchanged_from_same</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHv</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_points">unchanged_from_points</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">Hnth</span>. <span class="id">left</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_points">unchanged_from_points</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">Hnth</span>. <span class="id">right</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> <span class="id"><a href="Convert.html#unchanged_from_same">unchanged_from_same</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl_In_left_transparent">Forall2_impl_In_left_transparent</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v2</span> <span class="id">t2</span> <span class="id">Hin</span> <span class="id">IH</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IH</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_points">unchanged_from_points</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">Hnth</span>. <span class="id">left</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_points">unchanged_from_points</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">Hnth</span>. <span class="id">right</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_thread">read_val_thread</a></span>. <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hunchanged</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_clos">read_val_clos</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl_In_left_transparent">Forall2_impl_In_left_transparent</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v2</span> <span class="id">t2</span> <span class="id">Hin</span> <span class="id">IH</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IH</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hunchanged</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#clos_points_to_1">clos_points_to_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>. <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHdeep</span>. <span class="id">intros</span>; <span class="id">apply</span> <span class="id">Hunchanged</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#clos_points_to_2">clos_points_to_2</a></span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#read_val_block">read_val_block</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl_In_left_transparent">Forall2_impl_In_left_transparent</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">t</span> <span class="id">Hin</span> <span class="id">IH</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IH</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hunchanged</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#block_points_to">block_points_to</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>. <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_neutral">read_val_neutral</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hunchanged</span>, <span class="id"><a href="Convert.html#neutral_points_to_1">neutral_points_to_1</a></span>, <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">IHuf</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>. <span class="id">inversion</span> <span class="id">Huf</span>; <span class="id">subst</span>. <span class="id">assert</span> (<span class="id">z0</span> = <span class="id">z</span>) <span class="kwd">by</span> <span class="id">congruence</span>; <span class="id">subst</span>. <span class="id">split</span>; [|<span class="id">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H2</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">eapply</span> <span class="id">Hunchanged</span>, <span class="id"><a href="Convert.html#neutral_points_to_2">neutral_points_to_2</a></span>, <span class="id">Ha</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cont_kapp">read_cont_kapp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHv</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hunchanged</span>, <span class="id"><a href="Convert.html#kapp_points_to_1">kapp_points_to_1</a></span>, <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hunchanged</span>, <span class="id"><a href="Convert.html#kapp_points_to_2">kapp_points_to_2</a></span>, <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cont_kswitch">read_cont_kswitch</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl_In_left_transparent">Forall2_impl_In_left_transparent</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v2</span> <span class="id">t2</span> <span class="id">Hin</span> <span class="id">IH</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IH</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hunchanged</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#kswitch_points_to_1">kswitch_points_to_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>. <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">eapply</span> <span class="id">Hunchanged</span>, <span class="id"><a href="Convert.html#kswitch_points_to_3">kswitch_points_to_3</a></span>, <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl_In">Forall3_impl_In</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_and">Forall3_and</a></span>; [<span class="id">apply</span> <span class="id">Hdeeps</span>|<span class="id">apply</span> <span class="id">IHdeep</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> <span class="id">Hin1</span> <span class="id">Hin2</span> <span class="id">Hin3</span> [<span class="id">Hdeep</span> <span class="id">IH</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">split</span>; <span class="id">try</span> <span class="id">tauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id">IH</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">eapply</span> <span class="id">Hunchanged</span>, <span class="id"><a href="Convert.html#kswitch_points_to_2">kswitch_points_to_2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>. <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">apply</span> <span class="id">Hdeep</span>]. <span class="id">intros</span> <span class="id">x</span> [<span class="id">Hfree1</span> <span class="id">Hfree2</span>]; <span class="id">split</span>; [<span class="id">lia</span>|<span class="id">assumption</span>].<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_thread_same">read_thread_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st1</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> <span class="id">Hst12</span>. <span class="id">apply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="Convert.html#read_same_aux">read_same_aux</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">Hst12</span>)).<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_val_same">read_val_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st1</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; (<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span>) -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> <span class="id">Hst12</span>. <span class="id">apply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#read_same_aux">read_same_aux</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">Hst12</span>))).<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_cont_same">read_cont_same</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st1</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt; (<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#cont_points_to">cont_points_to</a></span> <span class="id">c</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span>) -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> <span class="id">Hst12</span>. <span class="id">apply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#read_same_aux">read_same_aux</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">Hst12</span>))).<br/>
Qed.</details>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_from_trans">unchanged_from_trans</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">st3</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st2</span> <span class="id">st3</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st3</span> <span class="id">a</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">st3</span> <span class="id">a</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">rid</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;<span class="id">etransitivity</span>; [<span class="id">eapply</span> <span class="id">H1</span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">H2</span>. <span class="id">clear</span> <span class="id">H2</span>. <span class="id">induction</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">econstructor</span>; [|<span class="id">eapply</span> <span class="id">IHHa</span>, <span class="id"><a href="Convert.html#unchanged_from_points">unchanged_from_points</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_same">unchanged_from_same</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_from_plus_trans">unchanged_from_plus_trans</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">st3</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from_plus">unchanged_from_plus</a></span> <span class="id">st2</span> <span class="id">st3</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from_plus">unchanged_from_plus</a></span> <span class="id">st1</span> <span class="id">st3</span> <span class="id">a</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">st3</span> <span class="id">a</span> <span class="id">H12</span> <span class="id">H23</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#every_reachable_plus_iff">every_reachable_plus_iff</a></span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a2</span> <span class="id">Ha2</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#every_reachable_plus_iff">every_reachable_plus_iff</a></span> <span class="kwd">in</span> <span class="id">H23</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_trans">unchanged_from_trans</a></span>; [|<span class="id">eassumption</span>]|].<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_points">unchanged_from_points</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span> <span class="kwd">in</span> *. <span class="id">rewrite</span> &lt;- (<span class="id"><a href="Convert.html#unchanged_from_same">unchanged_from_same</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H12</span>). <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="only_extended">only_extended</a></span> <span class="id">st1</span> <span class="id">st2</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rid</span> <span class="id">rt</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st1</span>) <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">rt</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st2</span>) <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">rt</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="only_changed">only_changed</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">rid</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rid2</span> <span class="id">rt</span>, <span class="id">rid</span> &lt;&gt; <span class="id">rid2</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st1</span>) <span class="id">rid2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">rt</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st2</span>) <span class="id">rid2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">rt</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_extended_refl">only_extended_refl</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span>, <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st</span> <span class="id">st</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">rid</span> <span class="id">rt</span> <span class="id">H</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_changed_refl">only_changed_refl</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">rid</span>, <span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st</span> <span class="id">st</span> <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">rid</span> <span class="id">rid2</span> <span class="id">rt</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_changed_refl_eq">only_changed_refl_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">rid</span>, <span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span> = <span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st</span> <span class="id">st2</span> <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">rid</span> <span class="id">Heq</span> <span class="id">rid2</span> <span class="id">rt</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">rewrite</span> &lt;- <span class="id">Heq</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_extended_trans">only_extended_trans</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">st3</span>, <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st1</span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st2</span> <span class="id">st3</span> -&gt; <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st1</span> <span class="id">st3</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">st3</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">rid</span> <span class="id">rt</span> <span class="id">H</span>; <span class="id">apply</span> <span class="id">H2</span>, <span class="id">H1</span>, <span class="id">H</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_changed_trans">only_changed_trans</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">st3</span> <span class="id">rid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">rid</span> -&gt; <span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st2</span> <span class="id">st3</span> <span class="id">rid</span> -&gt; <span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st1</span> <span class="id">st3</span> <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">st3</span> <span class="id">rid</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">rid2</span> <span class="id">rt</span> <span class="id">Hneq</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H2</span>, <span class="id">H1</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_extended_changed">only_extended_changed</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">rid</span>, <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st1</span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">rid</span> <span class="id">H</span> <span class="id">rid2</span> <span class="id">rt</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">apply</span> <span class="id">H</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_changed_update">only_changed_update</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">rid</span> <span class="id">rt</span>, <span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st</span> (<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> <span class="id">st</span> <span class="id">rid</span> <span class="id">rt</span>) <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">rid</span> <span class="id">rt</span> <span class="id">rid2</span> <span class="id">rt2</span> <span class="id">Hneq</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update3">nth_error_update3</a></span> <span class="kwd">by</span> <span class="id">assumption</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_extended_extend">only_extended_extend</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">rt</span>, <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st</span> (<span class="id"><a href="Convert.html#extend_rthread">extend_rthread</a></span> <span class="id">st</span> <span class="id">rt</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">rt</span> <span class="id">rid</span> <span class="id">rt2</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_app_Some">nth_error_app_Some</a></span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_extended_makelazy">only_extended_makelazy</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">t</span> <span class="id">e</span>, <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="id">st</span> <span class="id">t</span> <span class="id">e</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">t</span> <span class="id">e</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_extend">only_extended_extend</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_extended_makenlazy">only_extended_makenlazy</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>, <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>; <span class="id">revert</span> <span class="id">st</span>; <span class="id">induction</span> <span class="id">ts</span> <span class="kwd">as</span> [|<span class="id">t</span> <span class="id">ts</span>]; <span class="id">intros</span> <span class="id">st</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_refl">only_extended_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_trans">only_extended_trans</a></span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHts</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_changed_extend">only_changed_extend</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">rt</span> <span class="id">rid</span>, <span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st</span> (<span class="id"><a href="Convert.html#extend_rthread">extend_rthread</a></span> <span class="id">st</span> <span class="id">rt</span>) <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_changed">only_extended_changed</a></span>, <span class="id"><a href="Convert.html#only_extended_extend">only_extended_extend</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_changed_makelazy">only_changed_makelazy</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">t</span> <span class="id">e</span> <span class="id">rid</span>, <span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="id">st</span> <span class="id">t</span> <span class="id">e</span>)) <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_changed">only_extended_changed</a></span>, <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_changed_makenlazy">only_changed_makenlazy</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span> <span class="id">rid</span>, <span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>)) <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_changed">only_extended_changed</a></span>, <span class="id"><a href="Convert.html#only_extended_makenlazy">only_extended_makenlazy</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_thread_star_points">read_thread_star_points</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a1</span> <span class="id">t</span> -&gt; <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>) <span class="id">a1</span> <span class="id">a2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t2</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id">varmap2</span> ++ <span class="id">varmap</span>) <span class="id">a2</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">t</span> <span class="id">H1</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_preserve">star_preserve</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="kwd">exists</span> <span class="id">t3</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id">varmap2</span> ++ <span class="id">varmap</span>) <span class="id">a</span> <span class="id">t3</span>); [|<span class="id">eexists</span>; <span class="kwd">exists</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>; <span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span> ? ? ? (? &amp; <span class="id">varmap2</span> &amp; <span class="id">H3</span>). <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_points">read_thread_points</a></span> <span class="kwd">in</span> <span class="id">H3</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (? &amp; <span class="id">varmap3</span> &amp; <span class="id">H3</span>).<br/>
&nbsp;&nbsp;<span class="id">eexists</span>; <span class="kwd">exists</span> (<span class="id">varmap3</span> ++ <span class="id">varmap2</span>); <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_from_only_extended">unchanged_from_only_extended</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st</span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st</span> <span class="id">st2</span> <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t2</span> <span class="id">Hread</span> <span class="id">Hext</span> <span class="id">a</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;<span class="id">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">H</span>; [<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id">Hext</span>; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_star_points">read_thread_star_points</a></span> <span class="kwd">in</span> <span class="id">Ha</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">varmap2</span> &amp; <span class="id">Ha</span>). <span class="id">inversion</span> <span class="id">Ha</span>; <span class="id">subst</span>; <span class="id">congruence</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_from_extend">unchanged_from_extend</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rt</span> <span class="id">rid</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st</span> (<span class="id"><a href="Convert.html#extend_rthread">extend_rthread</a></span> <span class="id">st</span> <span class="id">rt</span>) <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_only_extended">unchanged_from_only_extended</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_extend">only_extended_extend</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_from_makelazy">unchanged_from_makelazy</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">t</span> <span class="id">e</span> <span class="id">rid</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="id">st</span> <span class="id">t</span> <span class="id">e</span>)) <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_extend">unchanged_from_extend</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_from_freevar">unchanged_from_freevar</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">rid</span>, <span class="id"><a href="Convert.html#unchanged_from">unchanged_from</a></span> <span class="id">st</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#freevar">freevar</a></span> <span class="id">st</span>)) <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">rid</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_from_plus_only_changed">unchanged_from_plus_only_changed</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st</span> <span class="id">st2</span> <span class="id">rid</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from_plus">unchanged_from_plus</a></span> <span class="id">st</span> <span class="id">st2</span> <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t2</span> <span class="id">Hread</span> <span class="id">Hchg</span> <span class="id">a</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;<span class="id">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">H</span>; [<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id">Hchg</span>; [|<span class="id">assumption</span>]|<span class="id">exfalso</span>].<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Heq</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#Acc_cycle">Acc_cycle</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_Acc">read_thread_Acc</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#plus_star">plus_star</a></span>, <span class="id"><a href="Convert.html#read_thread_star_points">read_thread_star_points</a></span> <span class="kwd">in</span> <span class="id">Ha</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">varmap2</span> &amp; <span class="id">Ha</span>). <span class="id">inversion</span> <span class="id">Ha</span>; <span class="id">subst</span>; <span class="id">congruence</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unchanged_from_plus_update">unchanged_from_plus_update</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from_plus">unchanged_from_plus</a></span> <span class="id">st</span> (<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> <span class="id">st</span> <span class="id">a</span> <span class="id">v</span>) <span class="id">a</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_only_changed">unchanged_from_plus_only_changed</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="same_read_plus">same_read_plus</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Convert.html#every_reachable_plus">every_reachable_plus</a></span> <span class="id">st1</span> <span class="id">rid</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="same_read_plus_aux">same_read_plus_aux</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st1</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; (<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="Rewrite.html#plus">plus</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st1</span>) <span class="id">rid</span> <span class="id">a</span>) -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt; (<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#cont_points_to">cont_points_to</a></span> <span class="id">c</span> <span class="id">a</span> -&gt; <span class="id"><a href="Rewrite.html#plus">plus</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st1</span>) <span class="id">rid</span> <span class="id">a</span>) -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid1</span> <span class="id">Hst12</span> <span class="id">H</span>. <span class="id">read_ind</span>; <span class="id">try</span> <span class="id">intros</span> <span class="id">Hplus</span>.<br/>
&nbsp;&nbsp;- <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H</span>; [|<span class="id">assumption</span>]. <span class="id">apply</span> <span class="id">Hplus</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_clos">read_val_clos</a></span>; [| |<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">lia</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl_In_left_transparent">Forall2_impl_In_left_transparent</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v1</span> <span class="id">t1</span> <span class="id">Hin</span> <span class="id">IH</span>. <span class="id">apply</span> <span class="id">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hplus</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#clos_points_to_1">clos_points_to_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHdeep</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hplus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#clos_points_to_2">clos_points_to_2</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_block">read_val_block</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl_In_left_transparent">Forall2_impl_In_left_transparent</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v1</span> <span class="id">t1</span> <span class="id">Hin</span> <span class="id">IH</span>. <span class="id">apply</span> <span class="id">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hplus</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#block_points_to">block_points_to</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_neutral">read_val_neutral</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hplus</span>, <span class="id"><a href="Convert.html#neutral_points_to_1">neutral_points_to_1</a></span>, <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">IHuf</span>; <span class="id">subst</span>; [<span class="id">inversion</span> <span class="id">Huf</span>; <span class="id">subst</span>; <span class="id">constructor</span>|]. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Huf</span>; <span class="id">subst</span>. <span class="id">assert</span> (<span class="id">z0</span> = <span class="id">z</span>) <span class="kwd">by</span> <span class="id">congruence</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H3</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">eapply</span> <span class="id">Hplus</span>, <span class="id"><a href="Convert.html#neutral_points_to_2">neutral_points_to_2</a></span>; [<span class="id">reflexivity</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cont_kid">read_cont_kid</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cont_kapp">read_cont_kapp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHv</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hplus</span>, <span class="id"><a href="Convert.html#kapp_points_to_1">kapp_points_to_1</a></span>, <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hplus</span>, <span class="id"><a href="Convert.html#kapp_points_to_2">kapp_points_to_2</a></span>, <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cont_kswitch">read_cont_kswitch</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl_In_left_transparent">Forall2_impl_In_left_transparent</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v1</span> <span class="id">t1</span> <span class="id">Hin</span> <span class="id">IH</span>. <span class="id">apply</span> <span class="id">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hplus</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#kswitch_points_to_1">kswitch_points_to_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hplus</span>, <span class="id"><a href="Convert.html#kswitch_points_to_3">kswitch_points_to_3</a></span>, <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl_In">Forall3_impl_In</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_and">Forall3_and</a></span>; [<span class="id">apply</span> <span class="id">Hdeeps</span>|<span class="id">apply</span> <span class="id">IHdeep</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? ? ? ? ? ? [? ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">split</span>; <span class="id">try</span> <span class="id">tauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id">H4</span>. <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id">Hplus</span>, <span class="id"><a href="Convert.html#kswitch_points_to_2">kswitch_points_to_2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">apply</span> <span class="id">H3</span>]. <span class="id">intros</span> ? [<span class="id">Hfree1</span> <span class="id">Hfree2</span>]; <span class="id">split</span>; [<span class="id">lia</span>|<span class="id">assumption</span>].<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="same_read_plus_val">same_read_plus_val</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">v</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st1</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="Rewrite.html#plus">plus</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st1</span>) <span class="id">rid</span> <span class="id">a</span>) -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">v</span> <span class="id">t</span> <span class="id">Hst12</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#same_read_plus_aux">same_read_plus_aux</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">Hst12</span> <span class="id">H</span>))).<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="same_read_plus_cont">same_read_plus_cont</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">c</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st1</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#cont_points_to">cont_points_to</a></span> <span class="id">c</span> <span class="id">a</span> -&gt; <span class="id"><a href="Rewrite.html#plus">plus</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st1</span>) <span class="id">rid</span> <span class="id">a</span>) -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">c</span> <span class="id">h</span> <span class="id">Hst12</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#same_read_plus_aux">same_read_plus_aux</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">Hst12</span> <span class="id">H</span>))).<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="same_read_plus_val_1">same_read_plus_val_1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">v</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st1</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st1</span> <span class="id">rid</span> <span class="id">a</span>) -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">v</span> <span class="id">t</span> <span class="id">Hst12</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val">same_read_plus_val</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="Rewrite.html#plus_1">plus_1</a></span>, <span class="id">H3</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="same_read_plus_cont_1">same_read_plus_cont_1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">c</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st1</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#cont_points_to">cont_points_to</a></span> <span class="id">c</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st1</span> <span class="id">rid</span> <span class="id">a</span>) -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">v</span> <span class="id">t</span> <span class="id">Hst12</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont">same_read_plus_cont</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="Rewrite.html#plus_1">plus_1</a></span>, <span class="id">H3</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="same_read_plus_val_Forall2">same_read_plus_val_Forall2</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">e</span> <span class="id">el</span> <span class="id">rid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st1</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span> <span class="id">a</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">e</span> -&gt; <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="Rewrite.html#plus">plus</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st1</span>) <span class="id">rid</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">e</span> <span class="id">el</span> <span class="id">rid</span> <span class="id">Hst12</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl_In_left_transparent">Forall2_impl_In_left_transparent</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val">same_read_plus_val</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">eapply</span> <span class="id">H3</span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="same_read_plus_val_Forall2_1">same_read_plus_val_Forall2_1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">e</span> <span class="id">el</span> <span class="id">rid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st1</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span> <span class="id">a</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">e</span> -&gt; <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st1</span> <span class="id">rid</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">e</span> <span class="id">el</span> <span class="id">rid</span> <span class="id">Hst12</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_Forall2">same_read_plus_val_Forall2</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#plus_1">plus_1</a></span>, <span class="id">H3</span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="same_read_unchanged">same_read_unchanged</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span>, <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#unchanged_from_plus">unchanged_from_plus</a></span> <span class="id">st</span> <span class="id">st2</span> <span class="id">rid</span> -&gt; <span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">Hst12</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#every_reachable_plus_impl">every_reachable_plus_impl</a></span>; [|<span class="id">apply</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span> <span class="id">Heq</span> <span class="id">varmap</span> <span class="id">t</span> <span class="id">Ht</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_same">read_thread_same</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#every_reachable_star_plus">every_reachable_star_plus</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="same_read_update">same_read_update</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> <span class="id">rt</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st</span> (<span class="id"><a href="Convert.html#update_rthread">update_rthread</a></span> <span class="id">st</span> <span class="id">rid</span> <span class="id">rt</span>) <span class="id">defs</span> <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> <span class="id">rt</span> <span class="id">Hread</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_unchanged">same_read_unchanged</a></span>, <span class="id"><a href="Convert.html#unchanged_from_plus_update">unchanged_from_plus_update</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_extended_makendeeps">only_extended_makendeeps</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">bs</span> <span class="id">e</span>, <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">bs</span> <span class="id">e</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">bs</span> <span class="id">e</span>; <span class="id">revert</span> <span class="id">st</span>; <span class="id">induction</span> <span class="id">bs</span> <span class="kwd">as</span> [|[<span class="id">p</span> <span class="id">t</span>] <span class="id">bs</span>]; <span class="id">intros</span> <span class="id">st</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_refl">only_extended_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_trans">only_extended_trans</a></span>; [|<span class="id">eapply</span> <span class="id">IHbs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_trans">only_extended_trans</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">rid</span> <span class="id">rt</span> <span class="id">H</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_changed_step_r">only_changed_step_r</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">rid</span>, <span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st</span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">rid</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">rid</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#step_r">step_r</a></span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) <span class="id">rid</span>) <span class="id">eqn</span>:<span class="id">H</span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_refl">only_changed_refl</a></span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Convert.html#rt_code">rt_code</a></span> <span class="id">r</span>).<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">e</span> <span class="id">n</span>); [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_refl">only_changed_refl</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_refl">only_changed_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> <span class="id">r</span>); <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_trans">only_changed_trans</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_trans">only_changed_trans</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_makelazy">only_changed_makelazy</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_refl_eq">only_changed_refl_eq</a></span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_refl">only_changed_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_trans">only_changed_trans</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_makelazy">only_changed_makelazy</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_trans">only_changed_trans</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_makenlazy">only_changed_makenlazy</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_trans">only_changed_trans</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_changed">only_extended_changed</a></span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_makendeeps">only_extended_makendeeps</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id"><a href="Convert.html#is_finished">is_finished</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">simpl</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_refl">only_changed_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">p</span> <span class="kwd">as</span> [[<span class="id">x</span> <span class="id">c</span>] [<span class="id">uf</span>|]]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_trans">only_changed_trans</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_extend">only_changed_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> <span class="id">r</span>); <span class="id">try</span> <span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_refl">only_changed_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> <span class="id">r</span>); <span class="id">try</span> <span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_refl">only_changed_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l0</span> <span class="id">n</span>) <span class="kwd">as</span> [[<span class="id">p</span> <span class="id">t</span>]|] <span class="id">eqn</span>:<span class="id">Hn</span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_refl">only_changed_refl</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_refl">only_changed_refl</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="defs_ok">defs_ok</a></span> (<span class="id">defs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="STerm.html#term">term</a></span>) <span class="id">st</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id">st</span>.(<span class="id"><a href="Convert.html#st_freename">st_freename</a></span>).<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="init_at">init_at</a></span> (<span class="id">k</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">t</span> : <span class="id"><a href="STerm.html#term">term</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">i</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> (<span class="id">k</span> + <span class="id">i</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#app">app</a></span> <span class="id">t1</span> <span class="id">t2</span> =&gt; <span class="id"><a href="STerm.html#app">app</a></span> (<span class="id">init_at</span> <span class="id">k</span> <span class="id">t1</span>) (<span class="id">init_at</span> <span class="id">k</span> <span class="id">t2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span> =&gt; <span class="id"><a href="STerm.html#abs">abs</a></span> (<span class="id">init_at</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">k</span>) <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span> =&gt; <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id">init_at</span> <span class="id">k</span>) <span class="id">l</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">m</span> =&gt; <span class="id"><a href="STerm.html#switch">switch</a></span> (<span class="id">init_at</span> <span class="id">k</span> <span class="id">t</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">p</span>, <span class="id">t</span>) =&gt; (<span class="id">p</span>, <span class="id">init_at</span> (<span class="id">p</span> + <span class="id">k</span>) <span class="id">t</span>)) <span class="id">m</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_at_no_dvar">init_at_no_dvar</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">k</span>, <span class="id"><a href="Convert.html#no_dvar">no_dvar</a></span> (<span class="id"><a href="Convert.html#init_at">init_at</a></span> <span class="id">k</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">simpl</span>; <span class="id">intros</span> <span class="id">k</span> <span class="id">x</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHt</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHt1</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHt2</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span> <span class="id">t</span> <span class="id">H1</span>; <span class="id">apply</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHt</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">H1</span>; <span class="id">apply</span> <span class="id">H1</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="dvar_below">dvar_below</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="STerm.html#term">term</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="dvar_below_var">dvar_below_var</a></span> : <span class="kwd">forall</span> <span class="id">k</span> <span class="id">n</span>, <span class="id">dvar_below</span> <span class="id">k</span> (<span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span>)<br/>
| <span class="id"><a name="dvar_below_dvar">dvar_below_dvar</a></span> : <span class="kwd">forall</span> <span class="id">k</span> <span class="id">k2</span>, <span class="id">k2</span> &lt; <span class="id">k</span> -&gt; <span class="id">dvar_below</span> <span class="id">k</span> (<span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">k2</span>)<br/>
| <span class="id"><a name="dvar_below_app">dvar_below_app</a></span> : <span class="kwd">forall</span> <span class="id">k</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id">dvar_below</span> <span class="id">k</span> <span class="id">t1</span> -&gt; <span class="id">dvar_below</span> <span class="id">k</span> <span class="id">t2</span> -&gt; <span class="id">dvar_below</span> <span class="id">k</span> (<span class="id"><a href="STerm.html#app">app</a></span> <span class="id">t1</span> <span class="id">t2</span>)<br/>
| <span class="id"><a name="dvar_below_abs">dvar_below_abs</a></span> : <span class="kwd">forall</span> <span class="id">k</span> <span class="id">t</span>, <span class="id">dvar_below</span> <span class="id">k</span> <span class="id">t</span> -&gt; <span class="id">dvar_below</span> <span class="id">k</span> (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span>)<br/>
| <span class="id"><a name="dvar_below_constr">dvar_below_constr</a></span> : <span class="kwd">forall</span> <span class="id">k</span> <span class="id">tag</span> <span class="id">l</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id">dvar_below</span> <span class="id">k</span>) <span class="id">l</span> -&gt; <span class="id">dvar_below</span> <span class="id">k</span> (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span>)<br/>
| <span class="id"><a name="dvar_below_switch">dvar_below_switch</a></span> : <span class="kwd">forall</span> <span class="id">k</span> <span class="id">t</span> <span class="id">m</span>, <span class="id">dvar_below</span> <span class="id">k</span> <span class="id">t</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">pt</span> =&gt; <span class="id">dvar_below</span> <span class="id">k</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>)) <span class="id">m</span> -&gt; <span class="id">dvar_below</span> <span class="id">k</span> (<span class="id"><a href="STerm.html#switch">switch</a></span> <span class="id">t</span> <span class="id">m</span>).<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_at_correct_aux">init_at_correct_aux</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">p</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> <span class="id">p</span> -&gt; <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span> <span class="id">t</span> -&gt; <span class="id">t</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="STerm.html#dvar">dvar</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> 0 <span class="id">k</span>)))) (<span class="id"><a href="Convert.html#init_at">init_at</a></span> <span class="id">p</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">k</span> <span class="id">p</span> <span class="id">t</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">revert</span> <span class="id">p</span> <span class="id">H1</span>; <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">p</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>, <span class="id"><a href="STerm.html#read_env">read_env</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [<span class="id">lia</span>|]. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>, <span class="id"><a href="STerm.html#read_env">read_env</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">lia</span>]. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_map">nth_error_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">nth_error_nth</span>' <span class="kwd">with</span> (<span class="id">d</span> := 0) <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_length">seq_length</a></span>; <span class="id">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_nth">seq_nth</a></span> <span class="kwd">by</span> <span class="id">lia</span>. <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [|<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id"><a href="STerm.html#liftn_subst_1">liftn_subst_1</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [|<span class="id">apply</span> <span class="id"><a href="STerm.html#liftn_subst_add">liftn_subst_add</a></span>]. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHt</span>; [<span class="id">inversion</span> <span class="id">H2</span>|<span class="id">inversion</span> <span class="id">H1</span>]; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt1</span>|<span class="id">apply</span> <span class="id">IHt2</span>]; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_Forall">map_ext_Forall</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_id">map_id</a></span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H1</span>; <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H8</span>|<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>, <span class="id">H5</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> (<span class="id">Ht1</span> &amp; <span class="id">Ht2</span> &amp; <span class="id">Ht3</span>); <span class="id">simpl</span>. <span class="id">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Ht1</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHt</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_Forall">map_ext_Forall</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_id">map_id</a></span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H11</span>|<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">with</span> (<span class="id">P</span> := (<span class="kwd">fun</span> <span class="id">pt</span> =&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span> + <span class="id">p</span>))); <span class="id">intros</span> [? ?]; <span class="id">apply</span> <span class="id">H6</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p2</span> <span class="id">t2</span>] (<span class="id">Hpt1</span> &amp; <span class="id">Hpt2</span> &amp; <span class="id">Hpt3</span>). <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [|<span class="id">apply</span> <span class="id"><a href="STerm.html#liftn_subst_add">liftn_subst_add</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Hpt1</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_at_correct">init_at_correct</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> 0 -&gt; <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span> <span class="id">t</span> -&gt; <span class="id">t</span> = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="STerm.html#dvar">dvar</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> 0 <span class="id">k</span>))) (<span class="id"><a href="Convert.html#init_at">init_at</a></span> 0 <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">k</span> <span class="id">t</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">etransitivity</span>; [<span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_correct_aux">init_at_correct_aux</a></span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>, <span class="id"><a href="STerm.html#liftn_subst_0">liftn_subst_0</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_at_closed">init_at_closed</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">p</span> <span class="id">k</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> <span class="id">p</span> -&gt; <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span> <span class="id">t</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> (<span class="id"><a href="Convert.html#init_at">init_at</a></span> <span class="id">p</span> <span class="id">t</span>) (<span class="id">p</span> + <span class="id">k</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">p</span> <span class="id">k</span> <span class="id">t</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">revert</span> <span class="id">p</span> <span class="id">H1</span>; <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">p</span> <span class="id">H1</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">IHt</span>; [<span class="id">inversion</span> <span class="id">H2</span>|<span class="id">inversion</span> <span class="id">H1</span>]; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>; <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>; [<span class="id">apply</span> <span class="id">IHt1</span>|<span class="id">apply</span> <span class="id">IHt2</span>]; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H1</span>; <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H8</span>|<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>, <span class="id">H5</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> (<span class="id">Ht1</span> &amp; <span class="id">Ht2</span> &amp; <span class="id">Ht3</span>); <span class="id">simpl</span>. <span class="id">apply</span> <span class="id">Ht1</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHt</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">p2</span> <span class="id">t3</span>. <span class="id">remember</span> (<span class="id">p2</span>, <span class="id">t3</span>) <span class="kwd">as</span> <span class="id">pt3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> <span class="id">p2</span> <span class="kwd">with</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt3</span>) <span class="kwd">by</span> (<span class="id">subst</span>; <span class="id">reflexivity</span>). <span class="id">replace</span> <span class="id">t3</span> <span class="kwd">with</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt3</span>) <span class="kwd">by</span> (<span class="id">subst</span>; <span class="id">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clear</span> <span class="id">p2</span> <span class="id">t3</span> <span class="id">Heqpt3</span>. <span class="id">revert</span> <span class="id">pt3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H11</span>|<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">with</span> (<span class="id">P</span> := (<span class="kwd">fun</span> <span class="id">pt</span> =&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span> + <span class="id">p</span>))); <span class="id">intros</span> [? ?]; <span class="id">apply</span> <span class="id">H6</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p2</span> <span class="id">t3</span>] (<span class="id">Hpt1</span> &amp; <span class="id">Hpt2</span> &amp; <span class="id">Hpt3</span>); <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Plus.html#plus_assoc">plus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Hpt1</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="init_all">init_all</a></span> (<span class="id">st</span> : <span class="id"><a href="Convert.html#state">state</a></span>) (<span class="id">l</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Convert.html#value">value</a></span>) (<span class="id">defs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="STerm.html#term">term</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">defs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> =&gt; (<span class="id">st</span>, <span class="id">l</span>)<br/>
&nbsp;&nbsp;| <span class="id">t</span> :: <span class="id">defs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">st2</span>, <span class="id">v</span>) := <span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="id">st</span> (<span class="id"><a href="Convert.html#init_at">init_at</a></span> 0 <span class="id">t</span>) <span class="id">l</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">init_all</span> <span class="id">st2</span> (<span class="id">l</span> ++ <span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>, <span class="id"><a href="Convert.html#Kid">Kid</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>) :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">defs</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="init_term">init_term</a></span> (<span class="id">defs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="STerm.html#term">term</a></span>) (<span class="id">t</span> : <span class="id"><a href="STerm.html#term">term</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">st</span>, <span class="id">vs</span>) := <span class="id"><a href="Convert.html#init_all">init_all</a></span> {| <span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> |} <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id">defs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="id">st</span> (<span class="id"><a href="Convert.html#init_at">init_at</a></span> 0 <span class="id">t</span>) <span class="id">vs</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_all_correct">init_all_correct</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs1</span> <span class="id">defs2</span> <span class="id">l</span> <span class="id">l2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">t</span> <span class="id">i</span> =&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> 0 /\ <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">i</span> <span class="id">t</span>) <span class="id">defs2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs1</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs2</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> (<span class="id">defs1</span> ++ <span class="id">defs2</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">l</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="STerm.html#dvar">dvar</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> 0 (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs1</span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs1</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs2</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#init_all">init_all</a></span> <span class="id">st</span> <span class="id">l</span> <span class="id">defs2</span> = (<span class="id">st2</span>, <span class="id">l2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> (<span class="id">defs1</span> ++ <span class="id">defs2</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">l2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="STerm.html#dvar">dvar</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> 0 (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs1</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs2</span>))).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs1</span> <span class="id">defs2</span>. <span class="id">revert</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs1</span>; <span class="id">induction</span> <span class="id">defs2</span> <span class="kwd">as</span> [|<span class="id">t</span> <span class="id">defs2</span>]; <span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs1</span> <span class="id">l</span> <span class="id">l2</span> <span class="id">Hclosed</span> <span class="id">H1</span> <span class="id">Hfree</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">injection</span> <span class="id">H2</span> <span class="kwd">as</span> <span class="id">H2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs1</span> + 0) <span class="kwd">with</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs1</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Peano.html#plus_n_O">plus_n_O</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id">IHdefs2</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">t</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>), <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Plus.html#plus_assoc_reverse">plus_assoc_reverse</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Plus.html#plus_comm">plus_comm</a></span>; <span class="id">simpl</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_app">seq_app</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_app">Forall2_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v2</span> <span class="id">t2</span> <span class="id">H</span>; <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_same">read_val_same</a></span>; [|<span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="id">eassumption</span>|]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_points">read_val_points</a></span> <span class="kwd">in</span> <span class="id">Ha</span>; [|<span class="id">eassumption</span>]. <span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> (? &amp; ? &amp; ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_makelazy">unchanged_from_makelazy</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>; [|<span class="id">constructor</span>]. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hlen</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs1</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_length">seq_length</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">apply</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_neutral">read_val_neutral</a></span> <span class="kwd">with</span> (<span class="id">h</span> := <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>); [<span class="id">constructor</span>| |<span class="id">simpl</span>; <span class="id">lia</span>|<span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>, <span class="id">Hlen</span>; <span class="id">simpl</span>; <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_select">nth_error_select</a></span>; <span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app1">nth_error_app1</a></span> <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.sub_diag">Nat.sub_diag</a></span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">split</span>; [<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>|<span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>; <span class="id">tauto</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span> <span class="id">_</span> (<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> <span class="id">t</span> <span class="id">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span> <span class="kwd">with</span> (<span class="id">h</span> := <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>)|<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_correct">init_at_correct</a></span>]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>. <span class="id">rewrite</span> &lt;- <span class="id">Hlen</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_closed">init_at_closed</a></span> <span class="kwd">with</span> (<span class="id">p</span> := 0); <span class="id">apply</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v2</span> <span class="id">t2</span> <span class="id">H</span>; <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_same">read_val_same</a></span>; [|<span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="id">eassumption</span>|]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_points">read_val_points</a></span> <span class="kwd">in</span> <span class="id">Ha</span>; [|<span class="id">eassumption</span>]. <span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> (? &amp; ? &amp; ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_makelazy">unchanged_from_makelazy</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_no_dvar">init_at_no_dvar</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>; <span class="id">simpl</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="defs_wf">defs_wf</a></span> <span class="id">defs</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">t</span> <span class="id">i</span> =&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> 0 /\ <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">i</span> <span class="id">t</span>) <span class="id">defs</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> 0 (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span>)).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_term_correct">init_term_correct</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">t</span> <span class="id">st</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_wf">defs_wf</a></span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span>) <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#init_term">init_term</a></span> <span class="id">defs</span> <span class="id">t</span> = (<span class="id">st</span>, <span class="id">v</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id">v</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">t</span> <span class="id">st</span> <span class="id">v</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#init_term">init_term</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Convert.html#init_all">init_all</a></span> <span class="kwd">as</span> [<span class="id">st2</span> <span class="id">vs</span>] <span class="id">eqn</span>:<span class="id">Hinit</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#init_all_correct">init_all_correct</a></span> <span class="kwd">with</span> (<span class="id">defs1</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="kwd">in</span> <span class="id">Hinit</span>.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">injection</span> <span class="id">H4</span> <span class="kwd">as</span> <span class="id">H4</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span> <span class="id">_</span> (<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> <span class="id">t</span> <span class="id">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span> <span class="kwd">with</span> (<span class="id">h</span> := <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>)|<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_correct">init_at_correct</a></span>]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hinit</span>. <span class="id">rewrite</span> <span class="id">Hinit</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_length">seq_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_closed">init_at_closed</a></span> <span class="kwd">with</span> (<span class="id">p</span> := 0); <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v2</span> <span class="id">t2</span> <span class="id">H</span>; <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_same">read_val_same</a></span>; [|<span class="id">eassumption</span>|]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_points">read_val_points</a></span> <span class="kwd">in</span> <span class="id">Ha</span>; [|<span class="id">eassumption</span>]. <span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> (? &amp; ? &amp; ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_makelazy">unchanged_from_makelazy</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_no_dvar">init_at_no_dvar</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="compose_hctx_hole_r">compose_hctx_hole_r</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span>, <span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h</span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> = <span class="id">h</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">h</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">f_equal</span>; (<span class="id">reflexivity</span> || <span class="id">assumption</span>).<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="compose_hctx_assoc">compose_hctx_assoc</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span>, <span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h1</span> <span class="id">h2</span>) <span class="id">h3</span> = <span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h1</span> (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h2</span> <span class="id">h3</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span>; <span class="id">induction</span> <span class="id">h1</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">f_equal</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="compose_cont_ctx">compose_cont_ctx</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">h1</span> <span class="id">h2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c1</span> <span class="id">h1</span> -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c2</span> <span class="id">h2</span> -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> (<span class="id"><a href="Convert.html#compose_cont">compose_cont</a></span> <span class="id">c1</span> <span class="id">c2</span>) (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h2</span> <span class="id">h1</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">Hread1</span> <span class="id">Hread2</span>. <span class="id">induction</span> <span class="id">Hread1</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="Convert.html#compose_hctx_hole_r">compose_hctx_hole_r</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Convert.html#compose_hctx_assoc">compose_hctx_assoc</a></span>. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="Convert.html#compose_hctx_assoc">compose_hctx_assoc</a></span>. <span class="id">econstructor</span>; <span class="id">try</span> <span class="id">eassumption</span>. <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="beta_fill">beta_fill</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">h</span>, <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t1</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">h</span> <span class="id">H</span>; <span class="id">induction</span> <span class="id">h</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="convertible_fill">convertible_fill</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">h</span>, <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t1</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">h</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t3</span> <span class="id">t4</span> [<span class="id">Ht34</span> | <span class="id">Ht34</span>]; [<span class="id">left</span> | <span class="id">right</span>]; <span class="id">apply</span> <span class="id"><a href="Convert.html#beta_fill">beta_fill</a></span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_val_only_extended">read_val_only_extended</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st</span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> <span class="id">Hst12</span> <span class="id">H1</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_same">read_val_same</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_points">read_val_points</a></span> <span class="kwd">in</span> <span class="id">Ha</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> (? &amp; ? &amp; ?); <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_only_extended">unchanged_from_only_extended</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_thread_only_extended">read_thread_only_extended</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st</span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> <span class="id">Hst12</span> <span class="id">H1</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_same">read_thread_same</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_only_extended">unchanged_from_only_extended</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_val_makelazy">read_val_makelazy</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">t</span> <span class="id">e</span> <span class="id">el</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#no_dvar">no_dvar</a></span> <span class="id">t</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_val">read_val</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="id">st</span> <span class="id">t</span> <span class="id">e</span>)) <span class="id">defs</span> <span class="id">varmap</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="id">st</span> <span class="id">t</span> <span class="id">e</span>)) (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">t</span> <span class="id">e</span> <span class="id">el</span> <span class="id">Hdv</span> <span class="id">Hclosed</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span> <span class="kwd">with</span> (<span class="id">h</span> := <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>).<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t2</span> <span class="id">v2</span> <span class="id">H2</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_only_extended">read_val_only_extended</a></span>; [| |<span class="id">eassumption</span>]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_extend">only_extended_extend</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="makenlazy_freename">makenlazy_freename</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>, <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">ts</span>; <span class="id">revert</span> <span class="id">st</span>; <span class="id">induction</span> <span class="id">ts</span>; <span class="id">intros</span> <span class="id">st</span> <span class="id">e</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">etransitivity</span>; [|<span class="id">apply</span> <span class="id">IHts</span>]. <span class="id">simpl</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_val_makenlazy">read_val_makenlazy</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">ts</span> <span class="id">e</span> <span class="id">el</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="Convert.html#no_dvar">no_dvar</a></span> <span class="id">ts</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">t</span> =&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>)) <span class="id">ts</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>)) <span class="id">defs</span> <span class="id">varmap</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>)) <span class="id">ts</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">ts</span> <span class="id">e</span> <span class="id">el</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">st</span>; <span class="id">induction</span> <span class="id">ts</span> <span class="kwd">as</span> [|<span class="id">t</span> <span class="id">ts</span>].<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">st</span> <span class="id">Hdv</span> <span class="id">Hclosed</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">st</span> <span class="id">Hdv</span> <span class="id">Hclosed</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_only_extended">read_val_only_extended</a></span>; [<span class="id">simpl</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#makenlazy_freename">makenlazy_freename</a></span>|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_makenlazy">only_extended_makenlazy</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#read_val_makelazy">read_val_makelazy</a></span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHts</span>; [<span class="id">assumption</span>|<span class="id">assumption</span>|]. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v2</span> <span class="id">t2</span> <span class="id">H6</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_only_extended">read_val_only_extended</a></span>; [| |<span class="id">eassumption</span>]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_val_makenlazy_new">read_val_makenlazy_new</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">ts</span> <span class="id">e</span> <span class="id">el</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="Convert.html#no_dvar">no_dvar</a></span> <span class="id">ts</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">t</span> =&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>)) <span class="id">ts</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rid</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>))) <span class="id">rid</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="kwd">exists</span> <span class="id">t2</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>)) <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">ts</span> <span class="id">e</span> <span class="id">el</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">st</span>; <span class="id">induction</span> <span class="id">ts</span> <span class="kwd">as</span> [|<span class="id">t</span> <span class="id">ts</span>].<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">st</span> <span class="id">Hdv</span> <span class="id">Hclosed</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">intros</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">st</span> <span class="id">Hdv</span> <span class="id">Hclosed</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">rid</span> <span class="id">Hrid1</span> <span class="id">Hrid2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> (<span class="id"><a href="Convert.html#extend_rthread">extend_rthread</a></span> <span class="id">st</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Term">Term</a></span> <span class="id">t</span> <span class="id">e</span>; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id"><a href="Convert.html#Kid">Kid</a></span> |})) <span class="id">rid</span>) <span class="id">eqn</span>:<span class="id">Hrid3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hrid3</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">in</span> <span class="id">Hrid3</span>; [|<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid1</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">rid</span> - <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">as</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n</span>; [|<span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>]. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hrid3</span>. <span class="id">injection</span> <span class="id">Hrid3</span> <span class="kwd">as</span> <span class="id">Hrid3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid1</span>; <span class="id">lia</span>). <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">eexists</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_only_extended">read_thread_only_extended</a></span>; [<span class="id">simpl</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#makenlazy_freename">makenlazy_freename</a></span>|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_makenlazy">only_extended_makenlazy</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_only_extended">read_val_only_extended</a></span>; [| |<span class="id">eassumption</span>]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHts</span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_only_extended">read_val_only_extended</a></span>; [| |<span class="id">eassumption</span>]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="makenlazy_points">makenlazy_points</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span> <span class="id">v</span> <span class="id">a</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>)) -&gt; <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) &lt;= <span class="id">a</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">ts</span>; <span class="id">revert</span> <span class="id">st</span>; <span class="id">induction</span> <span class="id">ts</span> <span class="kwd">as</span> [|<span class="id">t</span> <span class="id">ts</span>]; <span class="id">intros</span> <span class="id">st</span> <span class="id">e</span> <span class="id">v</span> <span class="id">a</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">H1</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">H2</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHts</span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">eassumption</span>]. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_extended_points">only_extended_points</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">a1</span> <span class="id">a2</span>, <span class="id"><a href="Convert.html#only_extended">only_extended</a></span> <span class="id">st</span> <span class="id">st2</span> -&gt; <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span> <span class="id">a1</span> <span class="id">a2</span> -&gt; <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st2</span> <span class="id">a1</span> <span class="id">a2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">a1</span> <span class="id">a2</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">H3</span>; [|<span class="id">tauto</span>].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">rewrite</span> <span class="id">H3</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_changed_read_thread_ind">only_changed_read_thread_ind</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">varmap2</span> <span class="id">rid</span> <span class="id">rid2</span> <span class="id">t</span> <span class="id">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st</span> <span class="id">st2</span> <span class="id">rid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rid</span> &lt;&gt; <span class="id">rid2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span> <span class="id">rid2</span> <span class="id">a</span> -&gt; <span class="id"><a href="Rewrite.html#plus">plus</a></span> (<span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span>) <span class="id">rid</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">varmap2</span> <span class="id">rid</span> <span class="id">rid2</span> <span class="id">t</span> <span class="id">t2</span> <span class="id">Hst12</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">H4</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_val">read_thread_val</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">H1</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_same">read_val_same</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_only_changed">unchanged_from_plus_only_changed</a></span> <span class="kwd">in</span> <span class="id">H1</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#every_reachable_star_plus">every_reachable_star_plus</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H5</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">left</span>. <span class="id">constructor</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cont_same">read_cont_same</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_only_changed">unchanged_from_plus_only_changed</a></span> <span class="kwd">in</span> <span class="id">H1</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#every_reachable_star_plus">every_reachable_star_plus</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H5</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">right</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">H1</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl_In_left_transparent">Forall2_impl_In_left_transparent</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">t2</span> <span class="id">Hv</span> <span class="id">Hread</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_same">read_val_same</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_only_changed">unchanged_from_plus_only_changed</a></span> <span class="kwd">in</span> <span class="id">H1</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#every_reachable_star_plus">every_reachable_star_plus</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H5</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">left</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cont_same">read_cont_same</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_only_changed">unchanged_from_plus_only_changed</a></span> <span class="kwd">in</span> <span class="id">H1</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#every_reachable_star_plus">every_reachable_star_plus</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H5</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">right</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="only_changed_read_thread_ind_1">only_changed_read_thread_ind_1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">varmap2</span> <span class="id">rid</span> <span class="id">rid2</span> <span class="id">t</span> <span class="id">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st</span> <span class="id">st2</span> <span class="id">rid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rid</span> &lt;&gt; <span class="id">rid2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span> <span class="id">rid2</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span> <span class="id">rid</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_read_thread_ind">only_changed_read_thread_ind</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">apply</span> <span class="id"><a href="Rewrite.html#plus_1">plus_1</a></span>, <span class="id">H4</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_val_makenlazy_changed">read_val_makenlazy_changed</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">ts</span> <span class="id">e</span> <span class="id">el</span> <span class="id">rid</span> <span class="id">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="Convert.html#no_dvar">no_dvar</a></span> <span class="id">ts</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">t</span> =&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>)) <span class="id">ts</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span> <span class="id">rid</span> <span class="id">a</span>) <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#only_changed">only_changed</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>)) <span class="id">st2</span> <span class="id">rid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>)) <span class="id">ts</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">ts</span> <span class="id">e</span> <span class="id">el</span> <span class="id">rid</span> <span class="id">t2</span> <span class="id">Hst12</span> <span class="id">Hdv</span> <span class="id">Hclosed</span> <span class="id">Hread</span> <span class="id">Hpoint</span> <span class="id">Hchange</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">Hst12</span> <span class="id">Hread</span> <span class="id">Hpoint</span> <span class="id">Hchange</span> <span class="id">H</span>; <span class="id">induction</span> <span class="id">ts</span> <span class="kwd">as</span> [|<span class="id">t</span> <span class="id">ts</span>]; <span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">Hst12</span> <span class="id">Hread</span> <span class="id">Hpoint</span> <span class="id">Hchange</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_read_thread_ind_1">only_changed_read_thread_ind_1</a></span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_trans">only_changed_trans</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_changed">only_extended_changed</a></span>, <span class="id"><a href="Convert.html#only_extended_makenlazy">only_extended_makenlazy</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_only_extended">read_thread_only_extended</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_extend">only_extended_extend</a></span>|<span class="id">eassumption</span>]; <span class="id">simpl</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span> <span class="kwd">with</span> (<span class="id">h</span> := <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>); [<span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span>|<span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>; <span class="id">assumption</span>| |<span class="id">constructor</span>|<span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_only_extended">read_val_only_extended</a></span>; [| |<span class="id">eassumption</span>]; [<span class="id">simpl</span>; <span class="id">lia</span>|]. <span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_extend">only_extended_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">Hread</span>; <span class="id">subst</span>; <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_points">only_extended_points</a></span>; [<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span> <span class="kwd">in</span> <span class="id">Ha</span>. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Ha</span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span> <span class="kwd">in</span> <span class="id">Ha</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">Ha</span> | <span class="id">Ha</span>]; <span class="id">inversion</span> <span class="id">Ha</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall_Exists">Forall_Exists</a></span>; [|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">H4</span> <span class="id">H5</span>; <span class="id">apply</span> <span class="id">H4</span>, <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHts</span>; <span class="id">cycle</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_only_extended">read_thread_only_extended</a></span>; [| |<span class="id">eassumption</span>]; [<span class="id">simpl</span>; <span class="id">lia</span>|]. <span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_extend">only_extended_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">Hv</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">apply</span> <span class="id">Hv</span> <span class="kwd">in</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_points">only_extended_points</a></span>; [|<span class="id">eassumption</span>]. <span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_extend">only_extended_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_only_extended">read_val_only_extended</a></span>; [| |<span class="id">eassumption</span>]; [<span class="id">simpl</span>; <span class="id">lia</span>|]. <span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_extend">only_extended_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="makendeeps_freename">makendeeps_freename</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">bs</span> <span class="id">e</span>, <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">bs</span> <span class="id">e</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">bs</span> <span class="id">e</span>; <span class="id">revert</span> <span class="id">st</span> <span class="id">e</span>; <span class="id">induction</span> <span class="id">bs</span> <span class="kwd">as</span> [|[? ?] ?]; <span class="id">intros</span> <span class="id">st</span> <span class="id">e</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">etransitivity</span>; [|<span class="id">apply</span> <span class="id">IHbs</span>]. <span class="id">simpl</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="subst_hctx">subst_hctx</a></span> <span class="id">us</span> <span class="id">h</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> =&gt; <span class="id"><a href="Beta.html#h_hole">h_hole</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h</span> <span class="id">t</span> =&gt; <span class="id"><a href="Beta.html#h_app">h_app</a></span> (<span class="id">subst_hctx</span> <span class="id">us</span> <span class="id">h</span>) (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h</span> <span class="id">m</span> =&gt; <span class="id"><a href="Beta.html#h_switch">h_switch</a></span> (<span class="id">subst_hctx</span> <span class="id">us</span> <span class="id">h</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">pt</span> =&gt; (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span>) <span class="id">us</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>))) <span class="id">m</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst_hctx_fill">subst_hctx_fill</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">h</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t</span>) = <span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> (<span class="id"><a href="Convert.html#subst_hctx">subst_hctx</a></span> <span class="id">us</span> <span class="id">h</span>) (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">h</span> <span class="id">t</span>; <span class="id">induction</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst_liftn_closed_at">subst_liftn_closed_at</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">k</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> <span class="id">k</span> -&gt; <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">k</span> <span class="id">us</span>) <span class="id">t</span> = <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">k</span> <span class="id">t</span> <span class="id">Ht</span>. <span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_closed_at_ext">subst_closed_at_ext</a></span>, <span class="id"><a href="STerm.html#subst_id">subst_id</a></span>; [<span class="id">reflexivity</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span> <span class="id">Hn</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [<span class="id">lia</span>|<span class="id">reflexivity</span>].<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="remap">remap</a></span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">n</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">varmap1</span> <span class="id">n</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="Misc.html#option_default">option_default</a></span> (<span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap2</span> <span class="id">x</span>) 0<br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id">n</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="remap_subst">remap_subst</a></span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">n</span> := <span class="id"><a href="STerm.html#var">var</a></span> (<span class="id"><a href="Convert.html#remap">remap</a></span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">n</span>).<br/>
<span class="kwd">Definition</span> <span class="id"><a name="is_remap_ok">is_remap_ok</a></span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">varmap2</span>) <span class="id">varmap1</span> /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">freename</span> &lt;= <span class="id">x</span> \/ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">varmap1</span>) <span class="id">varmap2</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="is_remap_ok_cons">is_remap_ok_cons</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">x</span>, <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> -&gt; <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> <span class="id">freename</span> (<span class="id">x</span> :: <span class="id">varmap1</span>) (<span class="id">x</span> :: <span class="id">varmap2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">x</span> [<span class="id">H1</span> <span class="id">H2</span>]. <span class="id">split</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="is_remap_ok_app">is_remap_ok_app</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">varmap3</span>, <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> <span class="id">freename</span> <span class="id">varmap2</span> <span class="id">varmap3</span> -&gt; <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> <span class="id">freename</span> (<span class="id">varmap1</span> ++ <span class="id">varmap2</span>) (<span class="id">varmap1</span> ++ <span class="id">varmap3</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">freename</span> <span class="id">varmap1</span>; <span class="id">induction</span> <span class="id">varmap1</span>; <span class="id">intros</span> <span class="id">varmap2</span> <span class="id">varmap3</span> <span class="id">H</span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#is_remap_ok_cons">is_remap_ok_cons</a></span>. <span class="id">apply</span> <span class="id">IHvarmap1</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="remap_cons_S">remap_cons_S</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">n</span>, <span class="id">x</span> \<span class="id">notin</span> <span class="id">varmap1</span> -&gt; <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> -&gt; <span class="id"><a href="Convert.html#remap">remap</a></span> (<span class="id">x</span> :: <span class="id">varmap1</span>) (<span class="id">x</span> :: <span class="id">varmap2</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id"><a href="Convert.html#remap">remap</a></span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">n</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">n</span> <span class="id">Hx</span> <span class="id">Hok</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#remap">remap</a></span>.<br/>
&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">Hn</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span> <span class="kwd">in</span> <span class="id">Hn</span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="Misc.html#index">index</a></span> <span class="id">eqn</span>:<span class="id">Hidx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Misc.html#index_in_not_None">index_in_not_None</a></span> <span class="kwd">in</span> <span class="id">Hidx</span>; [<span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hok</span> <span class="kwd">as</span> [<span class="id">Hok1</span> <span class="id">Hok2</span>]. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hok1</span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span> <span class="kwd">in</span> <span class="id">Hn</span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="remap_cons_subst_ren">remap_cons_subst_ren</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">x</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> \<span class="id">notin</span> <span class="id">varmap1</span> -&gt; <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> (<span class="id">x</span> :: <span class="id">varmap1</span>) (<span class="id">x</span> :: <span class="id">varmap2</span>)) (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> 1) <span class="id">t</span>) = <span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> 1) (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> <span class="id">varmap1</span> <span class="id">varmap2</span>) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">x</span> <span class="id">t</span> <span class="id">Hx</span> <span class="id">Hok</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>, !<span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>. <span class="id">intros</span> <span class="id">n</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span>, <span class="id"><a href="STerm.html#ren">ren</a></span>. <span class="id">f_equal</span>. <span class="id">erewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>, <span class="id"><a href="Convert.html#remap_cons_S">remap_cons_S</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="remap_app_1">remap_app_1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">varmap3</span> <span class="id">n</span>, <span class="id">n</span> &lt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap1</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">varmap1</span> -&gt; <span class="id"><a href="Convert.html#remap">remap</a></span> (<span class="id">varmap1</span> ++ <span class="id">varmap2</span>) (<span class="id">varmap1</span> ++ <span class="id">varmap3</span>) <span class="id">n</span> = <span class="id">n</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">varmap3</span> <span class="id">n</span> <span class="id">Hn</span> <span class="id">Hvarmap1</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#remap">remap</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app1">nth_error_app1</a></span> <span class="kwd">by</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="kwd">as</span> [<span class="id">x</span>|] <span class="id">eqn</span>:<span class="id">Hx</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_app">index_app</a></span>. <span class="id">erewrite</span> <span class="id"><a href="Misc.html#index_nth_error">index_nth_error</a></span> <span class="kwd">by</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="remap_app_2">remap_app_2</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">varmap3</span> <span class="id">n</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap1</span> &lt;= <span class="id">n</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span> \<span class="id">notin</span> <span class="id">varmap2</span>) <span class="id">varmap1</span> -&gt; <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> <span class="id">freename</span> <span class="id">varmap2</span> <span class="id">varmap3</span> -&gt; <span class="id"><a href="Convert.html#remap">remap</a></span> (<span class="id">varmap1</span> ++ <span class="id">varmap2</span>) (<span class="id">varmap1</span> ++ <span class="id">varmap3</span>) <span class="id">n</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap1</span> + <span class="id"><a href="Convert.html#remap">remap</a></span> <span class="id">varmap2</span> <span class="id">varmap3</span> (<span class="id">n</span> - <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap1</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">varmap3</span> <span class="id">n</span> <span class="id">Hn</span> <span class="id">Hvarmap1</span> <span class="id">Hok</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#remap">remap</a></span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">by</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="kwd">as</span> [<span class="id">x</span>|] <span class="id">eqn</span>:<span class="id">Hx</span>; [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_app">index_app</a></span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="Misc.html#index">index</a></span> <span class="id">eqn</span>:<span class="id">Hx2</span>; <span class="id">simpl</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#index_in_not_None">index_in_not_None</a></span> <span class="kwd">in</span> <span class="id">Hx2</span>; [<span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hok</span> <span class="kwd">as</span> [<span class="id">Hok1</span> <span class="id">Hok2</span>]. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hok1</span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span> <span class="kwd">in</span> <span class="id">Hx</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Hx2</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hvarmap1</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span> <span class="kwd">in</span> <span class="id">Hx</span>; <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="remap_app_subst_ren">remap_app_subst_ren</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">varmap3</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span> \<span class="id">notin</span> <span class="id">varmap2</span>) <span class="id">varmap1</span> -&gt; <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> <span class="id">freename</span> <span class="id">varmap2</span> <span class="id">varmap3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> (<span class="id">varmap1</span> ++ <span class="id">varmap2</span>) (<span class="id">varmap1</span> ++ <span class="id">varmap3</span>)) (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap1</span>)) <span class="id">t</span>) = <span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap1</span>)) (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> <span class="id">varmap2</span> <span class="id">varmap3</span>) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">varmap3</span> <span class="id">t</span> <span class="id">Hvarmap1</span> <span class="id">Hok</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>, !<span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>. <span class="id">intros</span> <span class="id">n</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span>, <span class="id"><a href="STerm.html#ren">ren</a></span>. <span class="id">f_equal</span>. <span class="id">erewrite</span> !<span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>, <span class="id"><a href="Convert.html#remap_app_2">remap_app_2</a></span>; <span class="id">try</span> <span class="id">eassumption</span>; [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="beta_convertible_subst">beta_convertible_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t1</span>) (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t3</span> <span class="id">t4</span> [<span class="id">H1</span> | <span class="id">H1</span>]; <span class="id">constructor</span>; <span class="id">apply</span> <span class="id"><a href="Beta.html#beta_subst1">beta_subst1</a></span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="betaiota_convertible_subst">betaiota_convertible_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">us</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t1</span>) (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">us</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t3</span> <span class="id">t4</span> [<span class="id">H1</span> | <span class="id">H1</span>]; <span class="id">destruct</span> <span class="id">H1</span>; <span class="id">constructor</span>; <span class="id">constructor</span>; ((<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_subst1">beta_subst1</a></span>; <span class="id">assumption</span>) || (<span class="id">apply</span> <span class="id"><a href="Beta.html#iota_subst_left">iota_subst_left</a></span>; <span class="id">assumption</span>)).<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="subst_hctx_compose">subst_hctx_compose</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">us</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#subst_hctx">subst_hctx</a></span> <span class="id">us</span> (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h1</span> <span class="id">h2</span>) = <span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> (<span class="id"><a href="Convert.html#subst_hctx">subst_hctx</a></span> <span class="id">us</span> <span class="id">h1</span>) (<span class="id"><a href="Convert.html#subst_hctx">subst_hctx</a></span> <span class="id">us</span> <span class="id">h2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">us</span> <span class="id">h1</span> <span class="id">h2</span>; <span class="id">induction</span> <span class="id">h1</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">f_equal</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_extend_varmap_aux">read_extend_varmap_aux</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="kwd">forall</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> <span class="id">varmap2</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">a</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> <span class="id">varmap</span> <span class="id">varmap2</span>) <span class="id">t</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="kwd">forall</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> <span class="id">varmap2</span> -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">v</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> <span class="id">varmap</span> <span class="id">varmap2</span>) <span class="id">t</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="kwd">forall</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> <span class="id">varmap2</span> -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c</span> (<span class="id"><a href="Convert.html#subst_hctx">subst_hctx</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> <span class="id">varmap</span> <span class="id">varmap2</span>) <span class="id">h</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span>. <span class="id">read_ind</span>; <span class="id">intros</span> <span class="id">varmap2</span> <span class="id">Hremap</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Convert.html#subst_hctx_fill">subst_hctx_fill</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_val">read_thread_val</a></span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Convert.html#subst_hctx_fill">subst_hctx_fill</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_read_env">subst_read_env</a></span>, <span class="id"><a href="Convert.html#subst_liftn_closed_at">subst_liftn_closed_at</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">He</span>; <span class="id">rewrite</span> &lt;- <span class="id">He</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>; <span class="id">try</span> <span class="id">solve</span> [<span class="id">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_read_env">subst_read_env</a></span>, <span class="id"><a href="Convert.html#subst_liftn_closed_at">subst_liftn_closed_at</a></span>; [|<span class="id">constructor</span>; <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">He</span>; <span class="id">rewrite</span> &lt;- <span class="id">He</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_clos">read_val_clos</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHdeep</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#is_remap_ok_cons">is_remap_ok_cons</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#beta_convertible_subst">beta_convertible_subst</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_same">star_same</a></span>. <span class="id">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>. <span class="id">eapply</span> <span class="id"><a href="STerm.html#subst_closed_at_ext">subst_closed_at_ext</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>] <span class="id">Hn</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span>; <span class="id">simpl</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">unfold</span> <span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span>. <span class="id">f_equal</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#remap">remap</a></span>. <span class="id">simpl</span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span>; [<span class="id">reflexivity</span>|<span class="id">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>; <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_map">nth_error_map</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Convert.html#remap_cons_subst_ren">remap_cons_subst_ren</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">simpl</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">He</span>; <span class="id">rewrite</span> <span class="id">He</span> <span class="kwd">in</span> <span class="id">Hn</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">Hremap</span> <span class="kwd">as</span> [<span class="id">Hremap1</span> <span class="id">Hremap2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hx</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hremap2</span>; [|<span class="id">eassumption</span>]. <span class="id">destruct</span> <span class="id">Hremap2</span>; [<span class="id">lia</span>|<span class="id">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_block">read_val_block</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v1</span> <span class="id">t1</span> <span class="id">IH</span>. <span class="id">apply</span> <span class="id">IH</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="Convert.html#subst_hctx_fill">subst_hctx_fill</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> <span class="id">varmap</span> <span class="id">varmap2</span>) (<span class="kwd">match</span> <span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">x</span> <span class="kwd">end</span>)) <span class="kwd">with</span> (<span class="kwd">match</span> <span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap2</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">x</span> <span class="kwd">end</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_neutral">read_val_neutral</a></span> <span class="kwd">with</span> (<span class="id">tuf</span> := <span class="kwd">match</span> <span class="id">tuf</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">tuf</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> <span class="id">varmap</span> <span class="id">varmap2</span>) <span class="id">tuf</span>) <span class="kwd">end</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inversion</span> <span class="id">Huf</span>; <span class="id">subst</span>; <span class="id">inversion</span> <span class="id">IHuf</span>; <span class="id">subst</span>; [<span class="id">constructor</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H4</span>; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#beta_convertible_subst">beta_convertible_subst</a></span>; <span class="id">apply</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Convert.html#subst_hctx_fill">subst_hctx_fill</a></span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_fill">convertible_fill</a></span>, <span class="id"><a href="Rewrite.html#star_same">star_same</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">symmetry</span>; <span class="id">eapply</span> <span class="id"><a href="STerm.html#subst_closed_at_id">subst_closed_at_id</a></span>; [<span class="id">apply</span> <span class="id">H2</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span> <span class="id">Hn</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">intros</span> <span class="id">Hndef</span>. <span class="id">apply</span> <span class="id">Hin</span> <span class="kwd">in</span> <span class="id">Hndef</span>. <span class="id">destruct</span> <span class="id">Hremap</span> <span class="kwd">as</span> [<span class="id">Hremap1</span> <span class="id">Hremap2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hremap1</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap</span> <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">n</span>|] <span class="id">eqn</span>:<span class="id">Hx</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">unfold</span> <span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span>, <span class="id"><a href="Convert.html#remap">remap</a></span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_index">nth_error_index</a></span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="id">rewrite</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Misc.html#index">index</a></span> <span class="id">eqn</span>:<span class="id">Hx2</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#index_in_not_None">index_in_not_None</a></span> <span class="kwd">in</span> <span class="id">Hx2</span>; [<span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hremap</span> <span class="kwd">as</span> [<span class="id">Hremap1</span> <span class="id">Hremap2</span>]. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hremap1</span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span> <span class="kwd">in</span> <span class="id">Hx</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hx2</span>. <span class="id">destruct</span> <span class="id">Hremap</span> <span class="kwd">as</span> [<span class="id">Hremap1</span> <span class="id">Hremap2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hremap2</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hremap2</span> <span class="kwd">as</span> [<span class="id">Hremap2</span> | <span class="id">Hremap2</span>]; [<span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#index_in_not_None">index_in_not_None</a></span> <span class="kwd">in</span> <span class="id">Hx</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#read_cont_kid">read_cont_kid</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Convert.html#subst_hctx_compose">subst_hctx_compose</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cont_kapp">read_cont_kapp</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHv</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Convert.html#subst_hctx_compose">subst_hctx_compose</a></span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cont_kswitch">read_cont_kswitch</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v1</span> <span class="id">t1</span> <span class="id">IH</span>; <span class="id">apply</span> <span class="id">IH</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">erewrite</span> <span class="id"><a href="Misc.html#Forall3_map3">Forall3_map3</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="kwd">fun</span> '(<span class="id">vdeeps</span>, <span class="id">tdeep</span>) =&gt; <span class="id">_</span>). <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_combine23_3">Forall3_combine23_3</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_and">Forall3_and</a></span>; [<span class="id">apply</span> <span class="id">Hdeeps</span>|<span class="id">apply</span> <span class="id">IHdeep</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> [<span class="id">Hdeep</span> <span class="id">IH</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> (<span class="id">split</span>; <span class="id">try</span> <span class="id">tauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> (<span class="id">IH</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vdeeps</span> ++ <span class="id">varmap2</span>)). <span class="id">apply</span> <span class="id"><a href="Convert.html#is_remap_ok_app">is_remap_ok_app</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#beta_convertible_subst">beta_convertible_subst</a></span>; <span class="id">apply</span> <span class="id">Hdeep</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_same">star_same</a></span>. <span class="id">symmetry</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="STerm.html#subst_closed_at_ext">subst_closed_at_ext</a></span>; [<span class="id">apply</span> <span class="id">Hdeep</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span> <span class="id">Hn</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_map">nth_error_map</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">rewrite</span> &lt;- !(<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> <span class="id">Hdeep</span>). <span class="id">eapply</span> <span class="id"><a href="Convert.html#remap_app_subst_ren">remap_app_subst_ren</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">apply</span> <span class="id">Hdeep</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">simpl</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">He</span>; <span class="id">rewrite</span> <span class="id">He</span> <span class="kwd">in</span> <span class="id">Hn</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">simpl</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span>. <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#remap_app_1">remap_app_1</a></span>; [<span class="id">lia</span>|<span class="id">apply</span> <span class="id">Hdeep</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">apply</span> <span class="id">Hdeep</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> [<span class="id">Hx1</span> <span class="id">Hx2</span>]; <span class="id">split</span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hx3</span>. <span class="id">destruct</span> <span class="id">Hremap</span> <span class="kwd">as</span> [<span class="id">Hremap1</span> <span class="id">Hremap2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hremap2</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hremap2</span>; [<span class="id">lia</span>|<span class="id">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>. <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [|<span class="id">apply</span> <span class="id"><a href="STerm.html#liftn_subst_comp">liftn_subst_comp</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id"><a href="Misc.html#Forall3_select1">Forall3_select1</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hdeeps</span>; [|<span class="id">apply</span> <span class="id">Hpt2</span>|<span class="id">intros</span> ? ? ? (? &amp; ? &amp; ? &amp; <span class="id">Hclosed</span> &amp; ?); <span class="id">exact</span> <span class="id">Hclosed</span>]. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hdeeps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="STerm.html#subst_closed_at_ext">subst_closed_at_ext</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span> <span class="id">Hn</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_map">nth_error_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">Hnth</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">He</span>; <span class="id">rewrite</span> <span class="id">He</span> <span class="kwd">in</span> <span class="id">Hn</span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_extend_varmap_thread">read_extend_varmap_thread</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">varmap2</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> <span class="id">varmap2</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">a</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> <span class="id">varmap</span> <span class="id">varmap2</span>) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">varmap2</span> <span class="id">a</span> <span class="id">t</span> <span class="id">H</span>. <span class="id">apply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="Convert.html#read_extend_varmap_aux">read_extend_varmap_aux</a></span> <span class="id">st</span> <span class="id">defs</span>)); <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_extend_varmap_val">read_extend_varmap_val</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> <span class="id">varmap2</span> -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">v</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> <span class="id">varmap</span> <span class="id">varmap2</span>) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t</span> <span class="id">H</span>. <span class="id">apply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#read_extend_varmap_aux">read_extend_varmap_aux</a></span> <span class="id">st</span> <span class="id">defs</span>))); <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_extend_varmap_cont">read_extend_varmap_cont</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">varmap2</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> <span class="id">varmap2</span> -&gt; <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c</span> (<span class="id"><a href="Convert.html#subst_hctx">subst_hctx</a></span> (<span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span> <span class="id">varmap</span> <span class="id">varmap2</span>) <span class="id">h</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">varmap2</span> <span class="id">c</span> <span class="id">h</span> <span class="id">H</span>. <span class="id">apply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#read_extend_varmap_aux">read_extend_varmap_aux</a></span> <span class="id">st</span> <span class="id">defs</span>))); <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="prefix_varmap_ok">prefix_varmap_ok</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">freename</span> &lt;= <span class="id">x</span>) <span class="id">varmap2</span> -&gt; <span class="id"><a href="Convert.html#is_remap_ok">is_remap_ok</a></span> <span class="id">freename</span> <span class="id">varmap1</span> (<span class="id">varmap2</span> ++ <span class="id">varmap1</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">H</span>. <span class="id">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="prefix_varmap_remap">prefix_varmap_remap</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">n</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">freename</span> &lt;= <span class="id">x</span>) <span class="id">varmap2</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span> &lt; <span class="id">freename</span>) <span class="id">varmap1</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">varmap1</span> -&gt; <span class="id">n</span> &lt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap1</span> -&gt; <span class="id"><a href="Convert.html#remap">remap</a></span> <span class="id">varmap1</span> (<span class="id">varmap2</span> ++ <span class="id">varmap1</span>) <span class="id">n</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap2</span> + <span class="id">n</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">freename</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">n</span> <span class="id">H2</span> <span class="id">H1</span> <span class="id">Hnodup</span> <span class="id">Hn</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#remap">remap</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="kwd">as</span> [<span class="id">x</span>|] <span class="id">eqn</span>:<span class="id">Hx</span>; [|<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hx</span>; <span class="id">lia</span>].<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_app">index_app</a></span>, <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">erewrite</span> <span class="id"><a href="Misc.html#index_nth_error">index_nth_error</a></span> <span class="kwd">by</span> <span class="id">eassumption</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Hx2</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H1</span>, <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id">_</span> <span class="id">Hx2</span>); <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">_</span> <span class="id">Hx</span>). <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_closed_at_aux">read_closed_at_aux</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap</span>) -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span>. <span class="id">read_ind</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHc</span>, <span class="id">IHv</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">apply</span> <span class="id"><a href="STerm.html#closed_at_subst_read_env">closed_at_subst_read_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_select2">Forall2_select2</a></span>, <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="STerm.html#closed_at_mono">closed_at_mono</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">He</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="STerm.html#closed_at_subst_read_env">closed_at_subst_read_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_select2">Forall2_select2</a></span>, <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="STerm.html#closed_at_mono">closed_at_mono</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">He</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_select2">Forall2_select2</a></span>, <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHc</span>. <span class="id">destruct</span> <span class="id"><a href="Misc.html#index">index</a></span> <span class="id">eqn</span>:<span class="id">Hidx</span>; [|<span class="id">constructor</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#index_length">index_length</a></span> <span class="kwd">in</span> <span class="id">Hidx</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">t1</span> <span class="id">Ht1</span>. <span class="id">rewrite</span> <span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span>. <span class="id">apply</span> <span class="id">IHc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>. <span class="id">rewrite</span> <span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span>. <span class="id">apply</span> <span class="id">IHc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">constructor</span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">p</span> <span class="id">t2</span> <span class="id">Hpt2</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hpt2</span>; <span class="id">destruct</span> <span class="id">Hpt2</span> <span class="kwd">as</span> [[<span class="id">p2</span> <span class="id">t3</span>] [<span class="id">Hpt2</span> <span class="id">Hpt3</span>]]; <span class="id">injection</span> <span class="id">Hpt2</span> <span class="kwd">as</span> <span class="id">Hpt2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="STerm.html#closed_at_subst_read_env_lift">closed_at_subst_read_env_lift</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_select2">Forall2_select2</a></span>, <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">apply</span> <span class="id">IHe</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span> <span class="kwd">in</span> <span class="id">Hdeeps</span>; [|<span class="id">intros</span> ? ? ? (? &amp; ? &amp; ? &amp; <span class="id">H</span> &amp; ?); <span class="id">exact</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span>, <span class="id"><a href="Misc.html#Forall2_select1">Forall2_select1</a></span> <span class="kwd">in</span> <span class="id">Hdeeps</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hdeeps</span>; <span class="id">specialize</span> (<span class="id">Hdeeps</span> <span class="id">_</span> <span class="id">Hpt3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hdeeps</span>. <span class="id">eapply</span> <span class="id"><a href="STerm.html#closed_at_mono">closed_at_mono</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">He</span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_closed_at_thread">read_closed_at_thread</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span>. <span class="id">apply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="Convert.html#read_closed_at_aux">read_closed_at_aux</a></span> <span class="id">st</span> <span class="id">defs</span>)).<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_closed_at_val">read_closed_at_val</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span>. <span class="id">apply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#read_closed_at_aux">read_closed_at_aux</a></span> <span class="id">st</span> <span class="id">defs</span>))).<br/>
Qed.</details>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_prefix_varmap_thread">read_prefix_varmap_thread</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id">x</span>) <span class="id">varmap2</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span> &lt; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap1</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">varmap1</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id">varmap2</span> ++ <span class="id">varmap1</span>) <span class="id">a</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#ren">ren</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap2</span>))) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">a</span> <span class="id">t</span> <span class="id">Hread</span> <span class="id">H2</span> <span class="id">H1</span> <span class="id">Hnodup</span>.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hread2</span> := <span class="id">Hread</span>).<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_extend_varmap_thread">read_extend_varmap_thread</a></span> <span class="kwd">in</span> <span class="id">Hread</span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#prefix_varmap_ok">prefix_varmap_ok</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_closed_at_ext">subst_closed_at_ext</a></span>; [<span class="id">eassumption</span>|<span class="id">apply</span> <span class="id"><a href="Convert.html#read_closed_at_thread">read_closed_at_thread</a></span> <span class="kwd">in</span> <span class="id">Hread2</span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span> <span class="id">Hn</span>; <span class="id">simpl</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#ren">ren</a></span>, <span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>. <span class="id">erewrite</span> <span class="id"><a href="Convert.html#prefix_varmap_remap">prefix_varmap_remap</a></span>; <span class="id">try</span> <span class="id">eassumption</span>. <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_prefix_varmap_val">read_prefix_varmap_val</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id">x</span>) <span class="id">varmap2</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span> &lt; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap1</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">varmap1</span> -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id">varmap2</span> ++ <span class="id">varmap1</span>) <span class="id">v</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#ren">ren</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap2</span>))) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t</span> <span class="id">Hread</span> <span class="id">H2</span> <span class="id">H1</span> <span class="id">Hnodup</span>.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hread2</span> := <span class="id">Hread</span>).<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_extend_varmap_val">read_extend_varmap_val</a></span> <span class="kwd">in</span> <span class="id">Hread</span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#prefix_varmap_ok">prefix_varmap_ok</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_closed_at_ext">subst_closed_at_ext</a></span>; [<span class="id">eassumption</span>|<span class="id">apply</span> <span class="id"><a href="Convert.html#read_closed_at_val">read_closed_at_val</a></span> <span class="kwd">in</span> <span class="id">Hread2</span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span> <span class="id">Hn</span>; <span class="id">simpl</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#ren">ren</a></span>, <span class="id"><a href="Convert.html#remap_subst">remap_subst</a></span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>. <span class="id">erewrite</span> <span class="id"><a href="Convert.html#prefix_varmap_remap">prefix_varmap_remap</a></span>; <span class="id">try</span> <span class="id">eassumption</span>. <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_val_makendeeps_changed">read_val_makendeeps_changed</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">bs</span> <span class="id">e</span> <span class="id">el</span> <span class="id">rid</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">bs</span> <span class="id">e</span>)) &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">pt</span> =&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>) /\ <span class="id"><a href="Convert.html#no_dvar">no_dvar</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>)) <span class="id">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="Convert.html#val_points_to">val_points_to</a></span> <span class="id">v</span> <span class="id">a</span> -&gt; <span class="id"><a href="Convert.html#points">points</a></span> <span class="id">st</span> <span class="id">rid</span> <span class="id">a</span>) <span class="id">e</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#only_changed">only_changed</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">bs</span> <span class="id">e</span>)) <span class="id">st2</span> <span class="id">rid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span>) <span class="id">e</span> <span class="id">el</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span> &lt; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">varmap</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> <span class="id">pt</span> <span class="id">vdeeps</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vdeeps</span>) = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> <span class="id">defs</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vdeeps</span> ++ <span class="id">varmap</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">vdeeps</span>) (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt</span>) (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bs</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">bs</span> <span class="id">e</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">bs</span>. <span class="id">revert</span> <span class="id">st</span> <span class="id">st2</span>.<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">bs</span> <span class="kwd">as</span> [|[<span class="id">p</span> <span class="id">t2</span>]]; <span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">e</span> <span class="id">el</span> <span class="id">rid</span> <span class="id">t</span> <span class="id">Hst12</span> <span class="id">Hbs</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">H4</span> <span class="id">H5</span> <span class="id">Hvarmap1</span> <span class="id">Hvarmap2</span>; <span class="id">simpl</span>; <span class="id">constructor</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">split</span>; [<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_length">seq_length</a></span>|]. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_read_thread_ind_1">only_changed_read_thread_ind_1</a></span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_trans">only_changed_trans</a></span>; [|<span class="id">eassumption</span>]. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_changed">only_extended_changed</a></span>, <span class="id"><a href="Convert.html#only_extended_makendeeps">only_extended_makendeeps</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_only_extended">read_thread_only_extended</a></span>; [| |<span class="id">eassumption</span>]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_trans">only_extended_trans</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? ? ?; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">Hbs</span>; <span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_subst_read_env">liftn_subst_read_env</a></span> <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">rewrite</span> &lt;- <span class="id">H4</span>; <span class="id">tauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span> <span class="kwd">with</span> (<span class="id">h</span> := <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>); [<span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span>| |<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_app">Forall2_app</a></span>|<span class="id">constructor</span>|<span class="id">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_length">seq_length</a></span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="Misc.html#seq_is_shiftn">seq_is_shiftn</a></span>, !<span class="id"><a href="Misc.html#Forall2_map_left">Forall2_map_left</a></span>, <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span>, <span class="id"><a href="Misc.html#Forall2_map_same">Forall2_map_same</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Misc.html#seq_is_shiftn">seq_is_shiftn</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_seq">in_seq</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (<span class="id"><a href="STerm.html#var">var</a></span> <span class="id">x</span>) <span class="kwd">with</span> (<span class="kwd">match</span> <span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">p</span> ++ <span class="id">varmap</span>) (<span class="id">x</span> + <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="STerm.html#dvar">dvar</a></span> (<span class="id">x</span> + <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> <span class="kwd">end</span>) <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_app">index_app</a></span>, <span class="id"><a href="Misc.html#index_seq">index_seq</a></span>; [<span class="id">f_equal</span>|]; <span class="id">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_neutral">read_val_neutral</a></span> <span class="kwd">with</span> (<span class="id">h</span> := <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>); [<span class="id">constructor</span>| |<span class="id">simpl</span>; <span class="id">lia</span>|<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_seq">in_seq</a></span>; <span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_None_rw">nth_error_None_rw</a></span> <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_only_extended">read_val_only_extended</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[| |<span class="id">replace</span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> <span class="id">p</span>) <span class="kwd">with</span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq">seq</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">p</span>))) <span class="kwd">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_length">seq_length</a></span>; <span class="id">reflexivity</span>); <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_prefix_varmap_val">read_prefix_varmap_val</a></span>]; [| |<span class="id">eassumption</span>| | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_trans">only_extended_trans</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? ? ?; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">u</span> <span class="id">Hu</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_seq">in_seq</a></span> <span class="kwd">in</span> <span class="id">Hu</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>; <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_points">only_extended_points</a></span>; [<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span> <span class="kwd">in</span> <span class="id">Ha</span>. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Ha</span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span> <span class="kwd">in</span> <span class="id">Ha</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">Ha</span> | <span class="id">Ha</span>]; <span class="id">inversion</span> <span class="id">Ha</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#env_points_to">env_points_to</a></span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_app">Exists_app</a></span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H7</span> <span class="kwd">as</span> [<span class="id">H7</span> | <span class="id">H7</span>]; [<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_map">Exists_map</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="id">destruct</span> <span class="id">H7</span> <span class="kwd">as</span> (<span class="id">x</span> &amp; <span class="id">H7</span> &amp; <span class="id">H8</span>); <span class="id">inversion</span> <span class="id">H8</span>; <span class="id">subst</span>; <span class="id">inversion</span> <span class="id">H0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall_Exists">Forall_Exists</a></span>; [|<span class="id">apply</span> <span class="id">H2</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">H8</span> <span class="id">H9</span>; <span class="id">apply</span> <span class="id">H8</span>, <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">etransitivity</span>; [|<span class="id">eassumption</span>]. <span class="id">simpl</span>. <span class="id">etransitivity</span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#makendeeps_freename">makendeeps_freename</a></span>]. <span class="id">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id">IHbs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">Hbs</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_only_extended">read_thread_only_extended</a></span>; [| |<span class="id">eassumption</span>]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_trans">only_extended_trans</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? ? ?; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span> <span class="id">v</span> <span class="id">Hv</span> <span class="id">a</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_points">only_extended_points</a></span>; [|<span class="id">apply</span> <span class="id">Hv</span>, <span class="id">Ha</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_trans">only_extended_trans</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? ? ?; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">t3</span> <span class="id">H</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_only_extended">read_val_only_extended</a></span>; [| |<span class="id">eassumption</span>]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_trans">only_extended_trans</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> ? ? ?; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="step_r_freename">step_r_freename</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">rid</span>, <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">rid</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#step_r">step_r</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span>; [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> <span class="kwd">as</span> [<span class="id">t</span> <span class="id">e</span>|<span class="id">v</span>]; [<span class="id">destruct</span> <span class="id">t</span> | <span class="id">destruct</span> <span class="id">v</span>].<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#makenlazy_freename">makenlazy_freename</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#makendeeps_freename">makendeeps_freename</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="Convert.html#is_finished">is_finished</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">p</span> <span class="kwd">as</span> [[<span class="id">x</span> <span class="id">c</span>] <span class="id">uf</span>]. <span class="id">destruct</span> <span class="id">uf</span>; <span class="id">simpl</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>; <span class="id">try</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="kwd">as</span> [[<span class="id">p</span> <span class="id">t</span>]|]; [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_below_free">dvar_below_free</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span> <span class="id">t</span> &lt;-&gt; (<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">k</span> &lt;= <span class="id">x</span> -&gt; <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">k</span> <span class="id">t</span>; <span class="id">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">H1</span>; <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>; <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHt</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHt1</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHt2</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">apply</span> <span class="id">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">intros</span> <span class="id">t</span> [<span class="id">H4</span> <span class="id">H5</span>]; <span class="id">apply</span> <span class="id">H4</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHt</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">apply</span> <span class="id">H5</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] [<span class="id">H6</span> <span class="id">H7</span>]; <span class="id">apply</span> <span class="id">H6</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">H1</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">n</span>). <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> <span class="id">k</span> <span class="id">n</span>) <span class="kwd">as</span> [<span class="id">Hkn</span> | <span class="id">Hkn</span>]; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> <span class="id">Hkn</span>); <span class="id">inversion</span> <span class="id">H1</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHt</span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">x</span> <span class="id">Hx</span>); <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHt1</span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">x</span> <span class="id">Hx</span>); <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHt2</span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">x</span> <span class="id">Hx</span>); <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>; <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H</span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">x</span> <span class="id">Hx</span>); <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHt</span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">x</span> <span class="id">Hx</span>); <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>; <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">apply</span> <span class="id">H</span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">x</span> <span class="id">Hx</span>); <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H4</span>; [|<span class="id">eassumption</span>]. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_free_ren">dvar_free_ren</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">t</span> <span class="id">r</span>, <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> <span class="id">r</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">t</span>. <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">r</span> <span class="id">Ht</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">IHt</span>. <span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; [<span class="id">apply</span> <span class="id">IHt1</span> | <span class="id">apply</span> <span class="id">IHt2</span>]; <span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>. <span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">apply</span> <span class="id">H1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> [<span class="id">H2</span> <span class="id">H3</span>]; <span class="id">apply</span> <span class="id">H2</span>, <span class="id">H3</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>. <span class="id">constructor</span>; [<span class="id">apply</span> <span class="id">IHt</span>; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">apply</span> <span class="id">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] [<span class="id">H4</span> <span class="id">H5</span>]; <span class="id">apply</span> <span class="id">H4</span>, <span class="id">H5</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_free_liftn_subst">dvar_free_liftn_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">us</span> <span class="id">p</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> (<span class="id">us</span> <span class="id">n</span>)) -&gt; (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> <span class="id">us</span> <span class="id">n</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">us</span> <span class="id">p</span> <span class="id">H</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">constructor</span>].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#dvar_free_ren">dvar_free_ren</a></span>, <span class="id">H</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_free_lift_subst">dvar_free_lift_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">us</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> (<span class="id">us</span> <span class="id">n</span>)) -&gt; (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> (<span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span> <span class="id">us</span> <span class="id">n</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">us</span> <span class="id">H</span> <span class="id">n</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="STerm.html#liftn_subst_1">liftn_subst_1</a></span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#dvar_free_liftn_subst">dvar_free_liftn_subst</a></span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_below_liftn_subst">dvar_below_liftn_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">us</span> <span class="id">p</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span> (<span class="id">us</span> <span class="id">n</span>)) -&gt; (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> <span class="id">us</span> <span class="id">n</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">k</span> <span class="id">us</span> <span class="id">p</span> <span class="id">H</span> <span class="id">n</span>. <span class="id">rewrite</span> <span class="id"><a href="Convert.html#dvar_below_free">dvar_below_free</a></span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#dvar_free_liftn_subst">dvar_free_liftn_subst</a></span>. <span class="id">intros</span> <span class="id">n1</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#dvar_below_free">dvar_below_free</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_free_subst">dvar_free_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">t</span> <span class="id">us</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> (<span class="id">us</span> <span class="id">n</span>)) -&gt; <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">t</span>. <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">us</span> <span class="id">Hus</span> <span class="id">Ht</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">Hus</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">IHt</span>; [|<span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#dvar_free_lift_subst">dvar_free_lift_subst</a></span>, <span class="id">Hus</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; [<span class="id">apply</span> <span class="id">IHt1</span> | <span class="id">apply</span> <span class="id">IHt2</span>]; <span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">apply</span> <span class="id">H1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> [<span class="id">H2</span> <span class="id">H3</span>]; <span class="id">apply</span> <span class="id">H2</span>, <span class="id">H3</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>. <span class="id">constructor</span>; [<span class="id">apply</span> <span class="id">IHt</span>; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">apply</span> <span class="id">H3</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] [<span class="id">H4</span> <span class="id">H5</span>]. <span class="id">simpl</span>. <span class="id">apply</span> <span class="id">H4</span>, <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#dvar_free_liftn_subst">dvar_free_liftn_subst</a></span>, <span class="id">Hus</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_below_subst">dvar_below_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">t</span> <span class="id">us</span>, (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span> (<span class="id">us</span> <span class="id">n</span>)) -&gt; <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> <span class="id">us</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">k</span> <span class="id">t</span> <span class="id">us</span> <span class="id">Hus</span> <span class="id">Ht</span>. <span class="id">rewrite</span> <span class="id"><a href="Convert.html#dvar_below_free">dvar_below_free</a></span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#dvar_free_subst">dvar_free_subst</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">n</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#dvar_below_free">dvar_below_free</a></span>; [|<span class="id">eassumption</span>]. <span class="id">apply</span> <span class="id">Hus</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#dvar_below_free">dvar_below_free</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_below_no_dvar">dvar_below_no_dvar</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">k</span>, <span class="id"><a href="Convert.html#no_dvar">no_dvar</a></span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">k</span> <span class="id">Ht</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#dvar_below_free">dvar_below_free</a></span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>. <span class="id">apply</span> <span class="id">Ht</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_free_read_env">dvar_free_read_env</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">l</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span>) <span class="id">l</span> -&gt; (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">l</span> <span class="id">n</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">l</span> <span class="id">H</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">H1</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_below_read_env">dvar_below_read_env</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">k</span> <span class="id">l</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span>) <span class="id">l</span> -&gt; (<span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k</span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">l</span> <span class="id">n</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">k</span> <span class="id">l</span> <span class="id">H</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">H1</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="makendeeps_dvar_below">makendeeps_dvar_below</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">st</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">vdeep</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id">x</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vdeep</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">l</span> <span class="id">e</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">l</span>; <span class="id">induction</span> <span class="id">l</span> <span class="kwd">as</span> [|[<span class="id">p</span> <span class="id">t2</span>] <span class="id">l</span>]; <span class="id">intros</span> <span class="id">st</span> <span class="id">e</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_seq">in_seq</a></span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">apply</span> <span class="id">IHl</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">vs</span> <span class="id">v</span>] <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="makendeeps_dvar_above">makendeeps_dvar_above</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">st</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">vdeep</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span> &lt; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">l</span> <span class="id">e</span>))) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vdeep</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">l</span> <span class="id">e</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">l</span>; <span class="id">induction</span> <span class="id">l</span> <span class="kwd">as</span> [|[<span class="id">p</span> <span class="id">t2</span>] <span class="id">l</span>]; <span class="id">intros</span> <span class="id">st</span> <span class="id">e</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">constructor</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_seq">in_seq</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Lt.html#lt_le_trans">lt_le_trans</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#makendeeps_freename">makendeeps_freename</a></span>]. <span class="id">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHl</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="makendeeps_dvar_nodup">makendeeps_dvar_nodup</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">st</span> <span class="id">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">vdeep</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">vdeep</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">l</span> <span class="id">e</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">l</span>; <span class="id">induction</span> <span class="id">l</span> <span class="kwd">as</span> [|[<span class="id">p</span> <span class="id">t2</span>] <span class="id">l</span>]; <span class="id">intros</span> <span class="id">st</span> <span class="id">e</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">constructor</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_NoDup">seq_NoDup</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHl</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="makenlazy_new_threads">makenlazy_new_threads</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span> <span class="id">rid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>))) <span class="id">rid</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="Convert.html#Thread">Thread</a></span> <span class="id">rid</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#makenlazy">makenlazy</a></span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">ts</span> <span class="id">e</span> <span class="id">rid</span>; <span class="id">revert</span> <span class="id">st</span>; <span class="id">induction</span> <span class="id">ts</span> <span class="kwd">as</span> [|<span class="id">t</span> <span class="id">ts</span>]; <span class="id">intros</span> <span class="id">st</span> <span class="id">Hrid1</span> <span class="id">Hrid2</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> (<span class="id"><a href="Convert.html#extend_rthread">extend_rthread</a></span> <span class="id">st</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Term">Term</a></span> <span class="id">t</span> <span class="id">e</span>; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id"><a href="Convert.html#Kid">Kid</a></span> |})) <span class="id">rid</span>) <span class="id">eqn</span>:<span class="id">Hrid3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hrid3</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">in</span> <span class="id">Hrid3</span>; [|<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid1</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">rid</span> - <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">as</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n</span>; [|<span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>]. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hrid3</span>. <span class="id">injection</span> <span class="id">Hrid3</span> <span class="kwd">as</span> <span class="id">Hrid3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid1</span>; <span class="id">lia</span>). <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="id">apply</span> <span class="id">IHts</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="makendeeps_new_threads">makendeeps_new_threads</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">l</span> <span class="id">e</span> <span class="id">rid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">l</span> <span class="id">e</span>))) <span class="id">rid</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">vs</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">vs</span> /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id">v</span> &lt; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">l</span> <span class="id">e</span>))) <span class="id">vs</span> /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">vs</span>, <span class="id"><a href="Convert.html#Thread">Thread</a></span> <span class="id">rid</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#makendeeps">makendeeps</a></span> <span class="id">st</span> <span class="id">l</span> <span class="id">e</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">l</span> <span class="id">e</span> <span class="id">rid</span>; <span class="id">revert</span> <span class="id">st</span>; <span class="id">induction</span> <span class="id">l</span> <span class="kwd">as</span> [|[<span class="id">p</span> <span class="id">t2</span>] <span class="id">l</span>]; <span class="id">intros</span> <span class="id">st</span> <span class="id">Hrid1</span> <span class="id">Hrid2</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> [ |- <span class="id">context</span>[ <span class="id"><a href="Convert.html#extend_rthread">extend_rthread</a></span> ?<span class="id">st</span> ?<span class="id">t</span> ] ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> (<span class="id"><a href="Convert.html#extend_rthread">extend_rthread</a></span> <span class="id">st</span> <span class="id">t</span>)) <span class="id">rid</span>) <span class="id">eqn</span>:<span class="id">Hrid3</span> <span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hrid3</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">in</span> <span class="id">Hrid3</span>; [|<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid1</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">rid</span> - <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">as</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">n</span>; [|<span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>]. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hrid3</span>. <span class="id">injection</span> <span class="id">Hrid3</span> <span class="kwd">as</span> <span class="id">Hrid3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid1</span>; <span class="id">lia</span>). <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">repeat</span> <span class="id">split</span>; [<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_NoDup">seq_NoDup</a></span>| |<span class="id">left</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_seq">in_seq</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">lia</span>|]. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Lt.html#lt_le_trans">lt_le_trans</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#makendeeps_freename">makendeeps_freename</a></span>]. <span class="id">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id">IHl</span> <span class="id">_</span> <span class="id">Hrid3</span>) <span class="kwd">as</span> (<span class="id">vs</span> &amp; <span class="id">Hvs1</span> &amp; <span class="id">Hvs2</span> &amp; <span class="id">Hvs3</span>); [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">vs</span>. <span class="id">repeat</span> <span class="id">split</span>; [<span class="id">assumption</span>| |<span class="id">right</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="varmap_ok">varmap_ok</a></span> <span class="id">freename</span> <span class="id">varmap</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span> &lt; <span class="id">freename</span>) <span class="id">varmap</span> /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">varmap</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="varmap_ok_cons">varmap_ok_cons</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">freename</span> <span class="id">varmap</span> <span class="id">x</span>, <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> <span class="id">freename</span> <span class="id">varmap</span> -&gt; <span class="id">x</span> &lt; <span class="id">freename</span> -&gt; <span class="id">x</span> \<span class="id">notin</span> <span class="id">varmap</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> <span class="id">freename</span> (<span class="id">x</span> :: <span class="id">varmap</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">freename</span> <span class="id">varmap</span> <span class="id">x</span> [<span class="id">H1</span> <span class="id">H2</span>] <span class="id">H3</span> <span class="id">H4</span>; <span class="id">split</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="varmap_ok_app">varmap_ok_app</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">freename</span> <span class="id">varmap</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> <span class="id">freename</span> <span class="id">varmap</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span> &lt; <span class="id">freename</span> /\ <span class="id">x</span> \<span class="id">notin</span> <span class="id">varmap</span>) <span class="id">varmap2</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">varmap2</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> <span class="id">freename</span> (<span class="id">varmap2</span> ++ <span class="id">varmap</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">freename</span> <span class="id">varmap</span> <span class="id">varmap2</span> <span class="id">Hok</span> <span class="id">Hvarmap2</span> <span class="id">Hnodup</span>. <span class="id">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>; <span class="id">split</span>; [|<span class="id">apply</span> <span class="id">Hok</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Misc.html#NoDup_app">NoDup_app</a></span>; [<span class="id">assumption</span>|<span class="id">apply</span> <span class="id">Hok</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="step_r_beta_hnf">step_r_beta_hnf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span> <span class="id">defs</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">x</span> &lt; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">varmap</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span> = <span class="id">st2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">rid2</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) <span class="id">rid2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st2</span>) <span class="id">rid2</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t2</span> <span class="id">varmap2</span>, <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span>) <span class="id">varmap2</span> /\ <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t2</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t2</span> /\ <span class="id"><a href="Rewrite.html#reflc">reflc</a></span> <span class="id"><a href="Beta.html#beta_hnf">beta_hnf</a></span> <span class="id">t</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> <span class="id">Hdefsok</span> <span class="id">Hvarmap1</span> <span class="id">Hvarmap2</span> &lt;- <span class="id">Hread</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> [ |- ?<span class="id">G1</span> /\ ?<span class="id">G2</span> /\ ?<span class="id">G3</span> ] =&gt;<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hsame</span> : <span class="id"><a href="Convert.html#every_reachable">every_reachable</a></span> <span class="id">st</span> <span class="id">rid</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="kwd">forall</span> <span class="id">varmap2</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">a</span> <span class="id">t</span>) -&gt; <span class="id">G2</span> -&gt; <span class="id">G1</span> /\ <span class="id">G2</span> /\ <span class="id">G3</span>) <span class="kwd">end</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">H</span> <span class="id">Hnew</span>. <span class="id">rewrite</span> <span class="id"><a href="Convert.html#every_reachable_iff">every_reachable_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H1</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">apply</span> <span class="id">H2</span>|]. <span class="id">split</span>; [<span class="id">assumption</span>|]. <span class="id">eexists</span>; <span class="id">split</span>; [|<span class="id">right</span>; <span class="id">reflexivity</span>]. <span class="id">apply</span> <span class="id">H1</span>, <span class="id">Hread</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> [ |- ?<span class="id">G</span> ] =&gt; <span class="id">assert</span> (<span class="id">Hid</span> : <span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span> = <span class="id">st</span> -&gt; <span class="id">G</span>) <span class="kwd">end</span>.<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Heq</span>; <span class="id">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *. <span class="id">apply</span> <span class="id">Hsame</span>; [<span class="id">intros</span> ? ? ? ? ?; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hfree</span> := <span class="id"><a href="Convert.html#step_r_freename">step_r_freename</a></span> <span class="id">st</span> <span class="id">rid</span>).<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hread</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id"><a href="Convert.html#is_finished">is_finished</a></span> <span class="id">eqn</span>:<span class="id">Hfinished</span>; [|<span class="id">apply</span> <span class="id">Hid</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">and_left</span> <span class="kwd">as</span> <span class="id">Hreach</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_update">same_read_update</a></span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#is_finished">is_finished</a></span> <span class="kwd">in</span> <span class="id">Hfinished</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">Hfinished</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; [|<span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H5</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">subst</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">injection</span> <span class="id">Hfinished</span> <span class="kwd">as</span> <span class="id">Hfinished</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2a</span> <span class="id">Hrid2b</span>; <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update_None">nth_error_update_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; <span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">split</span>; [|<span class="id">right</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_val">read_thread_val</a></span>; [<span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span>; <span class="id">eassumption</span>| |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val">same_read_plus_val</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#plus_S">plus_S</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Rewrite.html#plus_1">plus_1</a></span>]; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">left</span>. <span class="id">constructor</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">rewrite</span> <span class="id">H3</span>. <span class="id">left</span>. <span class="id">constructor</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont_1">same_read_plus_cont_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">right</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>; <span class="id">try</span> (<span class="id">apply</span> <span class="id">Hid</span>; <span class="id">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">and_left</span> <span class="kwd">as</span> <span class="id">Hreach</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_update">same_read_update</a></span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">simpl</span>; <span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2a</span> <span class="id">Hrid2b</span>; <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update_None">nth_error_update_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; <span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="id">split</span>; [|<span class="id">left</span>; <span class="id">rewrite</span> <span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span>; <span class="id">simpl</span>; <span class="id">apply</span> <span class="id"><a href="Beta.html#beta_hnf_ctx">beta_hnf_ctx</a></span>, <span class="id"><a href="Beta.html#beta_hnf_red">beta_hnf_red</a></span>, <span class="id"><a href="Beta.html#beta_red_lam">beta_red_lam</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#subst1">subst1</a></span>, <span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">simpl</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_1">same_read_plus_val_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">right</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#kapp_points_to_1">kapp_points_to_1</a></span>, <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_Forall2_1">same_read_plus_val_Forall2_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">left</span>; <span class="id">constructor</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#clos_points_to_1">clos_points_to_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont_1">same_read_plus_cont_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">right</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#kapp_points_to_2">kapp_points_to_2</a></span>, <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>; [<span class="id">rewrite</span> <span class="id"><a href="STerm.html#read_env_0">read_env_0</a></span>; <span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#read_env_S">read_env_S</a></span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_ren">subst_ren</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [<span class="id">apply</span> <span class="id"><a href="STerm.html#subst_id">subst_id</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n2</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>. <span class="id">destruct</span> <span class="id">n2</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">c</span>; <span class="id">try</span> (<span class="id">apply</span> <span class="id">Hid</span>; <span class="id">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l</span> <span class="id">tag</span>) <span class="kwd">as</span> [[<span class="id">p</span> <span class="id">t</span>]|] <span class="id">eqn</span>:<span class="id">Hpt</span>; [|<span class="id">apply</span> <span class="id">Hid</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span>; [|<span class="id">apply</span> <span class="id">Hid</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">and_left</span> <span class="kwd">as</span> <span class="id">Hreach</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_update">same_read_update</a></span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2a</span> <span class="id">Hrid2b</span>; <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update_None">nth_error_update_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; <span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="id">split</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="id">apply</span> <span class="id"><a href="Beta.html#beta_hnf_ctx">beta_hnf_ctx</a></span>, <span class="id"><a href="Beta.html#beta_hnf_red">beta_hnf_red</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_decompose">nth_error_decompose</a></span> <span class="kwd">in</span> <span class="id">Hpt</span>; <span class="id">destruct</span> <span class="id">Hpt</span> <span class="kwd">as</span> (<span class="id">l2</span> &amp; <span class="id">l3</span> &amp; <span class="id">Hpt1</span> &amp; <span class="id">Hpt2</span>); <span class="id">rewrite</span> <span class="id">Hpt1</span>, &lt;- <span class="id">Hpt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">e</span>) <span class="kwd">with</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">el</span>) <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="id">symmetry</span>; <span class="id">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_red_switch">beta_red_switch</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>, &lt;- <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [|<span class="id">apply</span> <span class="id"><a href="STerm.html#read_env_app">read_env_app</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>; [<span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span>; <span class="id">eassumption</span>| |<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_app">Forall2_app</a></span>| |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span> <span class="kwd">in</span> <span class="id">H11</span>; [|<span class="id">intros</span> ? ? ? (? &amp; ? &amp; ? &amp; <span class="id">Hclosed</span> &amp; ?); <span class="id">exact</span> <span class="id">Hclosed</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span>, <span class="id"><a href="Misc.html#Forall2_select1">Forall2_select1</a></span> <span class="kwd">in</span> <span class="id">H11</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>, <span class="id">H11</span> <span class="kwd">in</span> <span class="id">Hpt</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_Forall2_1">same_read_plus_val_Forall2_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">left</span>; <span class="id">constructor</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#block_points_to">block_points_to</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_Forall2_1">same_read_plus_val_Forall2_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">right</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#kswitch_points_to_1">kswitch_points_to_1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont_1">same_read_plus_cont_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">right</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#kswitch_points_to_3">kswitch_points_to_3</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span>, <span class="id"><a href="Misc.html#Forall2_select1">Forall2_select1</a></span> <span class="kwd">in</span> <span class="id">H11</span>; [|<span class="id">intros</span> ? ? ? (? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; <span class="id">Hdv</span>); <span class="id">exact</span> <span class="id">Hdv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H11</span>; [|<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>; <span class="id">eassumption</span>]. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">and_left</span> <span class="kwd">as</span> <span class="id">Hreach</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">uf</span> <span class="kwd">as</span> [<span class="id">uf</span>|]; <span class="id">simpl</span> <span class="kwd">in</span> *; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_update">same_read_update</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_unchanged">same_read_unchanged</a></span>; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dedup</span> <span class="id">common</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_trans">unchanged_from_plus_trans</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_update">unchanged_from_plus_update</a></span>, <span class="id"><a href="Convert.html#read_thread_same">read_thread_same</a></span>; [|<span class="id">eapply</span> <span class="id">Hread</span>|]; [<span class="id">simpl</span>; <span class="id">lia</span>|]]; <span class="id">exact</span> <span class="id">common</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_extend">unchanged_from_extend</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">split</span>; [<span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2a</span> <span class="id">Hrid2b</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#exit_rthread">exit_rthread</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update_None">nth_error_update_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; <span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="id">split</span>; [|<span class="id">right</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_val">read_thread_val</a></span> <span class="kwd">with</span> (<span class="id">h</span> := <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>); [<span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span>; <span class="id">eassumption</span>| |<span class="id">constructor</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">apply</span> <span class="id"><a href="Convert.html#compose_cont_ctx">compose_cont_ctx</a></span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont_1">same_read_plus_cont_1</a></span>; <span class="id">try</span> <span class="id">eassumption</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">left</span>; <span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>) || (<span class="id">right</span>; <span class="id">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">rewrite</span> &lt;- <span class="id">H9</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">simpl</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">simpl</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">refine</span> ((<span class="kwd">fun</span> (<span class="id">Hreadnew</span> : <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">varmap</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="id">_</span>) =&gt; <span class="id">_</span>) <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">split</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2a</span> <span class="id">Hrid2b</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#exit_rthread">exit_rthread</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hrid2b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update3">nth_error_update3</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span> <span class="kwd">by</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span> <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2a</span>; <span class="id">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">rid2</span> - <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">as</span> [|<span class="id">n</span>] <span class="id">eqn</span>:<span class="id">Hr</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; [|<span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">rid2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2a</span>; <span class="id">lia</span>). <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">eexists</span>. <span class="id">split</span>; [|<span class="id">apply</span> <span class="id">Hreadnew</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="id">split</span>; [|<span class="id">right</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_val">read_thread_val</a></span> <span class="kwd">with</span> (<span class="id">h</span> := <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span>; <span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_app_Some">nth_error_app_Some</a></span>; <span class="id">eassumption</span>| |<span class="id">constructor</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">try</span> (<span class="id">apply</span> <span class="id"><a href="Convert.html#compose_cont_ctx">compose_cont_ctx</a></span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont_1">same_read_plus_cont_1</a></span>; <span class="id">try</span> <span class="id">eassumption</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">left</span>; <span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>) || (<span class="id">right</span>; <span class="id">assumption</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">try</span> (<span class="id">simpl</span>; <span class="id">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">H6</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">split</span>; [<span class="id">rewrite</span> <span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_fill">convertible_fill</a></span>, <span class="id">H9</span>|<span class="id">tauto</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#read_val_thread">read_val_thread</a></span>. <span class="id">apply</span> <span class="id">Hreadnew</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_val">read_thread_val</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">unfold</span> <span class="id"><a href="Convert.html#exit_rthread">exit_rthread</a></span>; <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update3">nth_error_update3</a></span>; [<span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_1">same_read_plus_val_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">apply</span> <span class="id">H9</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">left</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#neutral_points_to_2">neutral_points_to_2</a></span>; [<span class="id">reflexivity</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont_1">same_read_plus_cont_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">right</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *; <span class="id">cbv</span> <span class="id">beta</span> <span class="id">delta</span> [<span class="id"><a href="Convert.html#rt_code">rt_code</a></span>] <span class="id">iota</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">t0</span>; <span class="id">cbv</span> <span class="id">delta</span> [<span class="id"><a href="Convert.html#rt_code">rt_code</a></span> <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span>] <span class="id">iota</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">e</span> <span class="id">n</span>) <span class="id">eqn</span>:<span class="id">He</span>; [|<span class="id">apply</span> <span class="id">Hid</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">and_left</span> <span class="kwd">as</span> <span class="id">Hreach</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_update">same_read_update</a></span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">simpl</span>; <span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2a</span> <span class="id">Hrid2b</span>; <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update_None">nth_error_update_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; <span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="id">split</span>; [|<span class="id">right</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">in</span> <span class="id">H1</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">vv</span> &amp; <span class="id">Hvv1</span> &amp; <span class="id">Hvv2</span>). <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>; <span class="id">rewrite</span> <span class="id">Hvv1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_1">same_read_plus_val_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">left</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; [<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_In">nth_error_In</a></span>|]; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont_1">same_read_plus_cont_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">right</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">Hid</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">and_left</span> <span class="kwd">as</span> <span class="id">Hreach</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_unchanged">same_read_unchanged</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dedup</span> <span class="id">common</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_trans">unchanged_from_plus_trans</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_update">unchanged_from_plus_update</a></span>, <span class="id"><a href="Convert.html#read_thread_same">read_thread_same</a></span>; [|<span class="id">eapply</span> <span class="id">Hread</span>|]; [<span class="id">simpl</span>; <span class="id">lia</span>|]]; <span class="id">exact</span> <span class="id">common</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dedup</span> <span class="id">common</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_trans">unchanged_from_trans</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_makelazy">unchanged_from_makelazy</a></span>, <span class="id"><a href="Convert.html#read_thread_same">read_thread_same</a></span>; [|<span class="id">eapply</span> <span class="id">Hread</span>|]; [<span class="id">simpl</span>; <span class="id">lia</span>|]]; <span class="id">exact</span> <span class="id">common</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_freevar">unchanged_from_freevar</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> [ <span class="id">Hreach</span> : <span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st</span> ?<span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refine</span> ((<span class="kwd">fun</span> (<span class="id">Hreadnew</span> : <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> :: <span class="id">varmap</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="id">_</span>) =&gt; <span class="id">_</span>) <span class="id">_</span>) <span class="kwd">end</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">unfold</span> <span class="id"><a href="Convert.html#exit_rthread">exit_rthread</a></span>; <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update3">nth_error_update3</a></span>; [<span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">simpl</span>. <span class="id">inversion</span> <span class="id">H0</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_neutral">read_val_neutral</a></span>; [<span class="id">constructor</span>| |<span class="id">simpl</span>; <span class="id">lia</span>|<span class="id">simpl</span>; <span class="id">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_None_rw">nth_error_None_rw</a></span>; [|<span class="id">apply</span> <span class="id">Hdefsok</span>]. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_Forall2_1">same_read_plus_val_Forall2_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>| |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">t</span> <span class="id">Hvt</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_prefix_varmap_val">read_prefix_varmap_val</a></span> <span class="kwd">with</span> (<span class="id">varmap2</span> := <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>); <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; [<span class="id">lia</span>|]. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">left</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">intros</span> <span class="id">x</span>; <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">x</span>); <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2a</span> <span class="id">Hrid2b</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#exit_rthread">exit_rthread</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hrid2b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update3">nth_error_update3</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span> <span class="kwd">by</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span> <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2a</span>; <span class="id">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">rid2</span> - <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">as</span> [|<span class="id">n</span>] <span class="id">eqn</span>:<span class="id">Hr</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; [|<span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">rid2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2a</span>; <span class="id">lia</span>). <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">eexists</span>. <span class="id">split</span>; [|<span class="id">apply</span> <span class="id">Hreadnew</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#varmap_ok_cons">varmap_ok_cons</a></span>; [<span class="id">split</span>; [<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]; <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">lia</span>|<span class="id">assumption</span>]|<span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hin</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hvarmap1</span>. <span class="id">apply</span> <span class="id">Hvarmap1</span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="id">split</span>; [|<span class="id">right</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_val">read_thread_val</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span>, <span class="id"><a href="Misc.html#nth_error_app_Some">nth_error_app_Some</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_clos">read_val_clos</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_Forall2_1">same_read_plus_val_Forall2_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">left</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">apply</span> <span class="id"><a href="Convert.html#read_val_thread">read_val_thread</a></span>, <span class="id">Hreadnew</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">simpl</span> <span class="id">index</span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span>; [|<span class="id">tauto</span>]. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_same">star_same</a></span>. <span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [|<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id"><a href="STerm.html#liftn_subst_1">liftn_subst_1</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="STerm.html#liftn_subst_read_env">liftn_subst_read_env</a></span>. <span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">rewrite</span> &lt;- <span class="id">H1</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">intros</span> <span class="id">x</span>; <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">x</span>); <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">simpl</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span> <span class="kwd">in</span> <span class="id">Hdefsok</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">intros</span> <span class="id">Hin</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hvarmap1</span>. <span class="id">apply</span> <span class="id">Hvarmap1</span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;++&nbsp;eapply&nbsp;Forall2_select2.&nbsp;eapply&nbsp;Forall2_impl;&nbsp;[|eassumption].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;v&nbsp;t&nbsp;Hvt.&nbsp;apply&nbsp;read_dvar_below_val&nbsp;in&nbsp;Hvt.&nbsp;rewrite&nbsp;dvar_below_free&nbsp;in&nbsp;Hvt.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;Hvt;&nbsp;lia.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">and_left</span> <span class="kwd">as</span> <span class="id">Hreach</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_update">same_read_update</a></span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">simpl</span>; <span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2a</span> <span class="id">Hrid2b</span>; <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update_None">nth_error_update_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; <span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="id">split</span>; [|<span class="id">left</span>; <span class="id">rewrite</span> <span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span>; <span class="id">simpl</span>; <span class="id">apply</span> <span class="id"><a href="Beta.html#beta_hnf_ctx">beta_hnf_ctx</a></span>, <span class="id"><a href="Beta.html#beta_hnf_red">beta_hnf_red</a></span>, <span class="id"><a href="Beta.html#beta_red_lam">beta_red_lam</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#subst1">subst1</a></span>, <span class="id"><a href="STerm.html#lift_subst">lift_subst</a></span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_subst">subst_subst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_1">same_read_plus_val_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">right</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_Forall2_1">same_read_plus_val_Forall2_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">left</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont_1">same_read_plus_cont_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">right</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">intros</span> <span class="id">x</span>; <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">x</span>); <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>; [<span class="id">rewrite</span> <span class="id"><a href="STerm.html#read_env_0">read_env_0</a></span>; <span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#read_env_S">read_env_S</a></span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst_ren">subst_ren</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="STerm.html#subst_ext">subst_ext</a></span>; [<span class="id">apply</span> <span class="id"><a href="STerm.html#subst_id">subst_id</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n2</span>; <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>. <span class="id">destruct</span> <span class="id">n2</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">apply</span> <span class="id">Hid</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">and_left</span> <span class="kwd">as</span> <span class="id">Hreach</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_unchanged">same_read_unchanged</a></span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dedup</span> <span class="id">common</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_trans">unchanged_from_plus_trans</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_update">unchanged_from_plus_update</a></span>, <span class="id"><a href="Convert.html#read_thread_same">read_thread_same</a></span>; [|<span class="id">eapply</span> <span class="id">Hread</span>|]; [<span class="id">simpl</span>; <span class="id">lia</span>|]]; <span class="id">exact</span> <span class="id">common</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_makelazy">unchanged_from_makelazy</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> [ <span class="id">Hreach</span> : <span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st</span> ?<span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refine</span> ((<span class="kwd">fun</span> (<span class="id">Hreadnew</span> : <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="id">_</span>) =&gt; <span class="id">_</span>) <span class="id">_</span>) <span class="kwd">end</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update3">nth_error_update3</a></span> <span class="kwd">by</span> (<span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_Forall2_1">same_read_plus_val_Forall2_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">left</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">intros</span> <span class="id">x</span>; <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">x</span>); <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2a</span> <span class="id">Hrid2b</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#exit_rthread">exit_rthread</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hrid2b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update3">nth_error_update3</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span> <span class="kwd">by</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span> <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2a</span>; <span class="id">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">rid2</span> - <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">as</span> [|<span class="id">n</span>] <span class="id">eqn</span>:<span class="id">Hr</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; [|<span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">rid2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hrid2a</span>; <span class="id">lia</span>). <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">eexists</span>. <span class="id">split</span>; [|<span class="id">apply</span> <span class="id">Hreadnew</span>]. <span class="id">split</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>; [<span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span>, <span class="id"><a href="Misc.html#nth_error_app_Some">nth_error_app_Some</a></span>; <span class="id">eassumption</span>| | | |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_Forall2_1">same_read_plus_val_Forall2_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">left</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_thread">read_val_thread</a></span>. <span class="id">apply</span> <span class="id">Hreadnew</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont_1">same_read_plus_cont_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">right</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">intros</span> <span class="id">x</span>; <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">x</span>); <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="id">rewrite</span> <span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">and_left</span> <span class="kwd">as</span> <span class="id">Hreach</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_unchanged">same_read_unchanged</a></span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dedup</span> <span class="id">common</span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_trans">unchanged_from_plus_trans</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_update">unchanged_from_plus_update</a></span>, <span class="id"><a href="Convert.html#read_thread_same">read_thread_same</a></span>; [<span class="id">apply</span> <span class="id"><a href="Convert.html#makenlazy_freename">makenlazy_freename</a></span>|<span class="id">eapply</span> <span class="id">Hread</span>|]]; <span class="id">exact</span> <span class="id">common</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_only_extended">unchanged_from_only_extended</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_makenlazy">only_extended_makenlazy</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">and_right</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eexists</span>; <span class="id">split</span>; [|<span class="id">right</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_val">read_thread_val</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span>, <span class="id"><a href="Convert.html#only_extended_makenlazy">only_extended_makenlazy</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">simpl</span>. <span class="id">constructor</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_makenlazy_changed">read_val_makenlazy_changed</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span> <span class="id">x</span>; <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">x</span>); <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>; <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">v</span> <span class="id">Hv</span> <span class="id">a</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">simpl</span>. <span class="id">left</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont_1">same_read_plus_cont_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">right</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">intros</span> (<span class="id">t2</span> &amp; <span class="id">Ht2</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">erewrite</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">try</span> (<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_makenlazy">only_extended_makenlazy</a></span>; <span class="id">eassumption</span>); <span class="id">try</span> <span class="id">congruence</span>; <span class="id">injection</span> <span class="id">H4</span> <span class="kwd">as</span> <span class="id">H4</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H5</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2a</span> <span class="id">Hrid2b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update3">nth_error_update3</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span> <span class="kwd">by</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#makenlazy_new_threads">makenlazy_new_threads</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_In_left_transparent">Forall2_In_left_transparent</a></span>; [|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>. <span class="kwd">exists</span> <span class="id">t</span>. <span class="kwd">exists</span> <span class="id">varmap</span>. <span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>. <span class="id">split</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">eassumption</span>]. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Lt.html#lt_le_trans">lt_le_trans</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#makenlazy_freename">makenlazy_freename</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">and_left</span> <span class="kwd">as</span> <span class="id">Hreach</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_unchanged">same_read_unchanged</a></span>; [<span class="id">assumption</span>|]. <span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_plus_only_changed">unchanged_from_plus_only_changed</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_trans">only_changed_trans</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#only_extended_changed">only_extended_changed</a></span>, <span class="id"><a href="Convert.html#only_extended_makendeeps">only_extended_makendeeps</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">and_right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> (<span class="id">t2</span> &amp; <span class="id">Ht2</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">erewrite</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span> <span class="kwd">in</span> <span class="id">H4</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">try</span> (<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_makendeeps">only_extended_makendeeps</a></span>; <span class="id">eassumption</span>); <span class="id">try</span> <span class="id">congruence</span>. <span class="id">injection</span> <span class="id">H4</span> <span class="kwd">as</span> <span class="id">H4</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H7</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2a</span> <span class="id">Hrid2b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_update3">nth_error_update3</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span> <span class="kwd">by</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#makendeeps_new_threads">makendeeps_new_threads</a></span> <span class="kwd">in</span> <span class="id">Hrid2b</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hrid2b</span> <span class="kwd">as</span> (<span class="id">vs</span> &amp; <span class="id">Hvs1</span> &amp; <span class="id">Hvs2</span> &amp; <span class="id">Hvs3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span> <span class="kwd">in</span> <span class="id">H16</span>; [|<span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> (<span class="id">_</span> &amp; <span class="id">Hreaddeep</span> &amp; <span class="id">_</span>); <span class="id">exact</span> <span class="id">Hreaddeep</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_In_left_transparent">Forall2_In_left_transparent</a></span>; [|<span class="id">apply</span> <span class="id">H16</span>|<span class="id">apply</span> <span class="id">Hvs3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t3</span> <span class="id">Ht3</span>. <span class="id">inversion</span> <span class="id">Ht3</span>; <span class="id">subst</span>. <span class="id">eexists</span>; <span class="id">eexists</span>. <span class="id">split</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#varmap_ok_app">varmap_ok_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">split</span>; [|<span class="id">assumption</span>]. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Lt.html#lt_le_trans">lt_le_trans</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#makendeeps_freename">makendeeps_freename</a></span>]. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">split</span>; [<span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hx2</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hvarmap1</span>. <span class="id">apply</span> <span class="id">Hvarmap1</span> <span class="kwd">in</span> <span class="id">Hx2</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="id">split</span>; [|<span class="id">right</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span> <span class="id">_</span> (<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>); [|<span class="id">apply</span> <span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span> <span class="kwd">with</span> (<span class="id">h2</span> := <span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> <span class="id">_</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">simpl</span>. <span class="id">erewrite</span> <span class="id"><a href="Misc.html#nth_error_update">nth_error_update</a></span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_makendeeps">only_extended_makendeeps</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_Forall2_1">same_read_plus_val_Forall2_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">a</span> <span class="id">Ha1</span> <span class="id">Ha2</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">left</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext">map_ext</a></span>; [<span class="id">econstructor</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_val_Forall2_1">same_read_plus_val_Forall2_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v</span> <span class="id">a</span> <span class="id">Ha1</span> <span class="id">Ha2</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">left</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Convert.html#same_read_plus_cont_1">same_read_plus_cont_1</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>; <span class="id">rewrite</span> <span class="id">H</span>; <span class="id">right</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_map3">Forall3_map3</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="kwd">fun</span> '(<span class="id">pt</span>, <span class="id">vdeeps</span>) =&gt; <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_select12combine">Forall2_select12combine</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_and_Forall_left">Forall2_and_Forall_left</a></span>; [<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_and_Forall_right">Forall2_and_Forall_right</a></span>; [<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_makendeeps_changed">read_val_makendeeps_changed</a></span>|]|]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">simpl</span>. <span class="id">intros</span> <span class="id">pt2</span> <span class="id">vdeeps</span> [[[<span class="id">Hlen</span> <span class="id">Hreadval</span>] <span class="id">Hdeeps</span>] <span class="id">Hpt2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">cycle</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">eapply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> <span class="id">Hpt2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">eapply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> <span class="id">Hdeeps</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">eapply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> <span class="id">Hdeeps</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">eapply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> <span class="id">Hpt2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">apply</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">eapply</span> <span class="id">Hreadval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> <span class="id">pt</span> <span class="id">Hpt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id">H8</span>. <span class="id">destruct</span> <span class="id">pt</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">intros</span> <span class="id">x</span>. <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">x</span>); <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="id">apply</span> <span class="id">H7</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="id">intros</span> <span class="id">v</span> <span class="id">Hv</span> <span class="id">a</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#points">points</a></span>, <span class="id"><a href="Convert.html#points_to">points_to</a></span>. <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">left</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_changed_update">only_changed_update</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">apply</span> <span class="id">Hdefsok</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">apply</span> -&gt; <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#makendeeps_dvar_nodup">makendeeps_dvar_nodup</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">rewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id"><a href="Convert.html#makendeeps_dvar_below">makendeeps_dvar_below</a></span>|<span class="id">apply</span> <span class="id"><a href="Convert.html#makendeeps_dvar_above">makendeeps_dvar_above</a></span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">vs</span> <span class="id">v</span>] [<span class="id">Hvs1</span> <span class="id">Hvs2</span>]; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> -&gt; <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> -&gt; <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [|<span class="id">assumption</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">apply</span> <span class="id">Hvs1</span>]. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span> <span class="kwd">in</span> <span class="id">Hdefsok</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">apply</span> <span class="id">Hvs1</span>]. <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx1</span> <span class="id">Hx2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hvarmap1</span>; <span class="id">apply</span> <span class="id">Hvarmap1</span> <span class="kwd">in</span> <span class="id">Hx2</span>. <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">inversion</span> <span class="id">H0</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id">H8</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id">intros</span> <span class="id">x</span>. <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">x</span>); <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H7</span>. <span class="id">apply</span> <span class="id">H7</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>]; <span class="id">simpl</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">intros</span> <span class="id">x</span>; <span class="id">specialize</span> (<span class="id">H3</span> <span class="id">x</span>); <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="beta_hctx">beta_hctx</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t1</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">h</span>; <span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Hbeta</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">IHh</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">IHh</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="star_beta_hctx">star_beta_hctx</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t1</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">h</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="kwd">fun</span> <span class="id">t</span> =&gt; <span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t</span>); [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#beta_hctx">beta_hctx</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="star_beta_read_env">star_beta_read_env</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">e1</span> <span class="id">e2</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span>) <span class="id">e1</span> <span class="id">e2</span> -&gt; <span class="kwd">forall</span> <span class="id">n</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">e1</span> <span class="id">n</span>) (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">e2</span> <span class="id">n</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">H</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">e1</span> <span class="id">n</span>) <span class="id">eqn</span>:<span class="id">Hn</span>.<br/>
&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">in</span> <span class="id">Hn</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hn</span> <span class="kwd">as</span> (? &amp; -&gt; &amp; <span class="id">Hn</span>). <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;* <span class="id">replace</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">e2</span> <span class="id">n</span>) <span class="kwd">with</span> (@<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="STerm.html#term">term</a></span>) <span class="kwd">by</span> (<span class="id">symmetry</span>; <span class="id">apply</span> (<span class="id"><a href="Misc.html#nth_error_Forall2_None">nth_error_Forall2_None</a></span> <span class="id">H</span>); <span class="id">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_inj_aux">read_inj_aux</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span>, (<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t</span> -&gt; <span class="kwd">forall</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t2</span> -&gt; <span class="id">t</span> = <span class="id">t2</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="kwd">forall</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t2</span> -&gt; <span class="id">t</span> = <span class="id">t2</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="kwd">forall</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">c</span> <span class="id">h2</span> -&gt; <span class="id">h</span> = <span class="id">h2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span>. <span class="id">read_ind</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">t2</span> <span class="id">Ht2</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">v0</span> = <span class="id">v</span>) <span class="kwd">by</span> <span class="id">congruence</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">c0</span> = <span class="id">c</span>) <span class="kwd">by</span> <span class="id">congruence</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHc</span>|<span class="id">apply</span> <span class="id">IHv</span>]; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">t2</span> <span class="id">Ht2</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">t0</span> = <span class="id">t</span>) <span class="kwd">by</span> <span class="id">congruence</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">e0</span> = <span class="id">e</span>) <span class="kwd">by</span> <span class="id">congruence</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">c0</span> = <span class="id">c</span>) <span class="kwd">by</span> <span class="id">congruence</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHc</span>; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Heq</span> := <span class="id"><a href="Misc.html#Forall3_from_Forall2">Forall3_from_Forall2</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">IHe</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span> <span class="kwd">in</span> <span class="id">Heq</span>; [|<span class="id">intros</span> <span class="id">v</span> <span class="id">t1</span> <span class="id">t2</span> [<span class="id">IH</span> <span class="id">Hread</span>]; <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hread</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>, <span class="id"><a href="Misc.html#Forall2_eq">Forall2_eq</a></span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">t2</span> <span class="id">Ht2</span>; <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IH</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">t2</span> <span class="id">Ht2</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Heq</span> := <span class="id"><a href="Misc.html#Forall3_from_Forall2">Forall3_from_Forall2</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">IHe</span> <span class="id">H3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span> <span class="kwd">in</span> <span class="id">Heq</span>; [|<span class="id">intros</span> <span class="id">v</span> <span class="id">t1</span> <span class="id">t2</span> [<span class="id">IH</span> <span class="id">Hread</span>]; <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hread</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>, <span class="id"><a href="Misc.html#Forall2_eq">Forall2_eq</a></span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">t2</span> <span class="id">Ht2</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Heq</span> := <span class="id"><a href="Misc.html#Forall3_from_Forall2">Forall3_from_Forall2</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">IHe</span> <span class="id">H3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span> <span class="kwd">in</span> <span class="id">Heq</span>; [|<span class="id">intros</span> <span class="id">v</span> <span class="id">t1</span> <span class="id">t2</span> [<span class="id">IH</span> <span class="id">Hread</span>]; <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hread</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>, <span class="id"><a href="Misc.html#Forall2_eq">Forall2_eq</a></span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">t2</span> <span class="id">Ht2</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">IHc</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">h2</span> <span class="id">H</span>; <span class="id">inversion</span> <span class="id">H</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">h2</span> <span class="id">H</span>. <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHc</span>; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">apply</span> <span class="id">IHv</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">h2</span> <span class="id">H</span>. <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHc</span>; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Heq</span> := <span class="id"><a href="Misc.html#Forall3_from_Forall2">Forall3_from_Forall2</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">IHe</span> <span class="id">H6</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span> <span class="kwd">in</span> <span class="id">Heq</span>; [|<span class="id">intros</span> <span class="id">v</span> <span class="id">t1</span> <span class="id">t2</span> [<span class="id">IH</span> <span class="id">Hread</span>]; <span class="id">apply</span> <span class="id">IH</span>, <span class="id">Hread</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>, <span class="id"><a href="Misc.html#Forall2_eq">Forall2_eq</a></span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="id">subst</span>. <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_inj_thread">read_inj_thread</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t1</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t2</span> -&gt; <span class="id">t1</span> = <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">a</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">eapply</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="Convert.html#read_inj_aux">read_inj_aux</a></span> <span class="id">st</span> <span class="id">defs</span>)); <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_free_beta">dvar_free_beta</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> <span class="id">t1</span> -&gt; <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">H</span>; <span class="id">induction</span> <span class="id">H</span>; <span class="id">intros</span> <span class="id">Hdv</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#dvar_free_subst">dvar_free_subst</a></span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [|<span class="id">n</span>]; <span class="id">simpl</span>; [<span class="id">assumption</span>|<span class="id">constructor</span>].<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_app_iff">Forall_app_iff</a></span>, <span class="id"><a href="Misc.html#Forall_cons_iff">Forall_cons_iff</a></span> <span class="kwd">in</span> *. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>. <span class="id">constructor</span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_app_iff">Forall_app_iff</a></span>, <span class="id"><a href="Misc.html#Forall_cons_iff">Forall_cons_iff</a></span> <span class="kwd">in</span> *. <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hdv</span>; <span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_app_iff">Forall_app_iff</a></span>, <span class="id"><a href="Misc.html#Forall_cons_iff">Forall_cons_iff</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#dvar_free_subst">dvar_free_subst</a></span>; [|<span class="id">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#dvar_free_read_env">dvar_free_read_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_free_star_beta">dvar_free_star_beta</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> <span class="id">t1</span> -&gt; <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_preserve">star_preserve</a></span>; [|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#dvar_free_beta">dvar_free_beta</a></span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="stable_beta_hnf_aux">stable_beta_hnf_aux</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span> &lt;= <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#same_read_plus">same_read_plus</a></span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#only_changed">only_changed</a></span> <span class="id">st</span> <span class="id">st2</span> <span class="id">rid</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t2</span> /\ <span class="id"><a href="Rewrite.html#reflc">reflc</a></span> <span class="id"><a href="Beta.html#beta_hnf">beta_hnf</a></span> <span class="id">t</span> <span class="id">t2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt; <span class="kwd">exists</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t2</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t</span> <span class="id">t2</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt; <span class="kwd">exists</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t2</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t</span> <span class="id">t2</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap2</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt; <span class="kwd">exists</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c</span> <span class="id">h2</span> /\ (<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> <span class="id">t</span>))).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">rid2</span> <span class="id">Hst12</span> <span class="id">Hsame</span> <span class="id">Honly</span> <span class="id">Hred</span>.<br/>
&nbsp;&nbsp;<span class="id">read_ind</span>; <span class="id">intros</span> <span class="id">Hvok</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">rid2</span> <span class="id">rid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hread</span> : <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t</span>)) <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_val">read_thread_val</a></span>; <span class="id">eassumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Hred</span> <span class="kwd">in</span> <span class="id">Hread</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hread</span> <span class="kwd">as</span> (<span class="id">t2</span> &amp; <span class="id">Ht2a</span> &amp; <span class="id">Ht2b</span>); <span class="kwd">exists</span> <span class="id">t2</span>; <span class="id">split</span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ht2b</span>; [|<span class="id">subst</span>; <span class="id">constructor</span>]. <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>, <span class="id"><a href="Beta.html#beta_hnf_beta">beta_hnf_beta</a></span>, <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHv</span> <span class="kwd">as</span> (<span class="id">t2</span> &amp; <span class="id">IHv1</span> &amp; <span class="id">IHv2</span>); [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHc</span> <span class="kwd">as</span> (<span class="id">h2</span> &amp; <span class="id">IHc1</span> &amp; <span class="id">IHc2</span>); [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> <span class="id">t2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">Honly</span> <span class="kwd">in</span> <span class="id">Hnth</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_val">read_thread_val</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [<span class="id">apply</span> <span class="id">IHc2</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#star_beta_hctx">star_beta_hctx</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">rid2</span> <span class="id">rid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hread</span> : <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el</span>) <span class="id">t</span>))) <span class="kwd">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>; <span class="id">eassumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Hred</span> <span class="kwd">in</span> <span class="id">Hread</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hread</span> <span class="kwd">as</span> (<span class="id">t2</span> &amp; <span class="id">Ht2a</span> &amp; <span class="id">Ht2b</span>); <span class="kwd">exists</span> <span class="id">t2</span>; <span class="id">split</span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ht2b</span>; [|<span class="id">subst</span>; <span class="id">constructor</span>]. <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>, <span class="id"><a href="Beta.html#beta_hnf_beta">beta_hnf_beta</a></span>, <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHc</span> <span class="kwd">as</span> (<span class="id">h2</span> &amp; <span class="id">IHc1</span> &amp; <span class="id">IHc2</span>); [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span> <span class="kwd">in</span> <span class="id">IHe</span>; [|<span class="id">intros</span> ? ? <span class="id">IH</span>; <span class="id">exact</span> (<span class="id">IH</span> <span class="id">Hvok</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_exists_Forall3">Forall2_exists_Forall3</a></span> <span class="kwd">in</span> <span class="id">IHe</span>. <span class="id">destruct</span> <span class="id">IHe</span> <span class="kwd">as</span> (<span class="id">el2</span> &amp; <span class="id">IHe</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el2</span>) <span class="id">t</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">Honly</span> <span class="kwd">in</span> <span class="id">Hnth</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select13">Forall3_select13</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id">IHe</span>. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [<span class="id">apply</span> <span class="id">IHc2</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#star_beta_hctx">star_beta_hctx</a></span>. <span class="id">apply</span> <span class="id"><a href="Beta.html#beta_subst2">beta_subst2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#star_beta_read_env">star_beta_read_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id">IHe</span>. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">IH</span> <span class="kwd">as</span> (<span class="id">t2</span> &amp; <span class="id">IH1</span> &amp; <span class="id">IH2</span>); [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t2</span>. <span class="id">split</span>; [|<span class="id">assumption</span>]. <span class="id">constructor</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span> <span class="kwd">in</span> <span class="id">IHe</span>; [|<span class="id">intros</span> ? ? <span class="id">IH</span>; <span class="id">exact</span> (<span class="id">IH</span> <span class="id">Hvok</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_exists_Forall3">Forall2_exists_Forall3</a></span> <span class="kwd">in</span> <span class="id">IHe</span>. <span class="id">destruct</span> <span class="id">IHe</span> <span class="kwd">as</span> (<span class="id">el2</span> &amp; <span class="id">IHe</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHdeep</span> <span class="kwd">as</span> (<span class="id">tdeep2</span> &amp; <span class="id">IHdeep1</span> &amp; <span class="id">IHdeep2</span>); [<span class="id">apply</span> <span class="id"><a href="Convert.html#varmap_ok_cons">varmap_ok_cons</a></span>; <span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el2</span>) (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span>)). <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_clos">read_val_clos</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select13">Forall3_select13</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id">IHe</span>; <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">eassumption</span>]; <span class="id">intros</span>; <span class="id">left</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eassumption</span>]. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#convertible_sym">convertible_sym</a></span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [<span class="id">intros</span> ? ? <span class="id">H</span>; <span class="id">left</span>; <span class="id">exact</span> <span class="id">H</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Beta.html#beta_subst2">beta_subst2</a></span>. <span class="id">intros</span> [|<span class="id">n1</span>]; [<span class="id">constructor</span>|]. <span class="id">simpl</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#comp">comp</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span>; [<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="Beta.html#beta_subst1">beta_subst1</a></span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#star_beta_read_env">star_beta_read_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id">IHe</span>. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">lia</span>.<br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;eapply&nbsp;Forall2_select2,&nbsp;Forall2_impl;&nbsp;[|eapply&nbsp;Forall2_and_Forall_left;&nbsp;[eapply&nbsp;Forall3_select23,&nbsp;Forall3_impl;&nbsp;[|eassumption]|eassumption]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|intros&nbsp;v&nbsp;t5&nbsp;t6&nbsp;[?&nbsp;Hstar];&nbsp;exact&nbsp;Hstar].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;?&nbsp;?&nbsp;(?&nbsp;&amp;&nbsp;?);&nbsp;eapply&nbsp;dvar_free_star_beta;&nbsp;eassumption.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Beta.html#beta_subst2">beta_subst2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#star_beta_read_env">star_beta_read_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id">IHe</span>. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span> <span class="kwd">in</span> <span class="id">IHe</span>; [|<span class="id">intros</span> ? ? <span class="id">IH</span>; <span class="id">exact</span> (<span class="id">IH</span> <span class="id">Hvok</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_exists_Forall3">Forall2_exists_Forall3</a></span> <span class="kwd">in</span> <span class="id">IHe</span>. <span class="id">destruct</span> <span class="id">IHe</span> <span class="kwd">as</span> (<span class="id">el2</span> &amp; <span class="id">IHe</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">el2</span>). <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select13">Forall3_select13</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Beta.html#star_beta_constr">star_beta_constr</a></span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">IHc</span> <span class="kwd">as</span> (<span class="id">h2</span> &amp; <span class="id">IHc1</span> &amp; <span class="id">IHc2</span>); [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> (<span class="kwd">match</span> <span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">n</span> | <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">x</span> <span class="kwd">end</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">apply</span> <span class="id">IHc2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">IHuf</span>; <span class="id">subst</span>; [<span class="id">econstructor</span>; [<span class="id">eassumption</span>|<span class="id">rewrite</span> &lt;- <span class="id">H2</span>; <span class="id">constructor</span>|<span class="id">lia</span>|<span class="id">eassumption</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Huf</span>; <span class="id">subst</span>. <span class="id">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">tuf</span> &amp; <span class="id">IHuf1</span> &amp; <span class="id">IHuf2</span>); [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; [<span class="id">eassumption</span>| |<span class="id">lia</span>|<span class="id">congruence</span>]. <span class="id">rewrite</span> &lt;- <span class="id">H</span>. <span class="id">econstructor</span>; <span class="id">split</span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">eassumption</span>]; <span class="id">intros</span>; <span class="id">left</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">apply</span> <span class="id">H4</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#convertible_sym">convertible_sym</a></span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">apply</span> <span class="id">IHc2</span>]. <span class="id">intros</span>; <span class="id">left</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>. <span class="id">split</span>; [<span class="id">constructor</span>|]. <span class="id">intros</span>; <span class="id">simpl</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">IHv</span> <span class="kwd">as</span> (<span class="id">t2</span> &amp; <span class="id">IHv1</span> &amp; <span class="id">IHv2</span>); [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">IHc</span> <span class="kwd">as</span> (<span class="id">h2</span> &amp; <span class="id">IHc1</span> &amp; <span class="id">IHc2</span>); [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h2</span> (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> <span class="id">t2</span>)). <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">t5</span>. <span class="id">rewrite</span> !<span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [<span class="id">apply</span> <span class="id">IHc2</span>|]. <span class="id">apply</span> <span class="id"><a href="Convert.html#star_beta_hctx">star_beta_hctx</a></span>, <span class="id"><a href="Beta.html#star_beta_app">star_beta_app</a></span>; [<span class="id">constructor</span>|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">IHc</span> <span class="kwd">as</span> (<span class="id">h2</span> &amp; <span class="id">IHc1</span> &amp; <span class="id">IHc2</span>); [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span> <span class="kwd">in</span> <span class="id">IHe</span>; [|<span class="id">intros</span> ? ? <span class="id">IH</span>; <span class="id">exact</span> (<span class="id">IH</span> <span class="id">Hvok</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_exists_Forall3">Forall2_exists_Forall3</a></span> <span class="kwd">in</span> <span class="id">IHe</span>. <span class="id">destruct</span> <span class="id">IHe</span> <span class="kwd">as</span> (<span class="id">el2</span> &amp; <span class="id">IHe</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h2</span> (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> '(<span class="id">p</span>, <span class="id">t0</span>) =&gt; (<span class="id">p</span>, <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">el2</span>)) <span class="id">t0</span>)) <span class="id">bs</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_and">Forall3_and</a></span> <span class="kwd">in</span> <span class="id">IHdeep</span>; [|<span class="id">apply</span> <span class="id">Hdeeps</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span> <span class="kwd">in</span> <span class="id">IHdeep</span>; <span class="id">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">intros</span> ? ? ? [<span class="id">IH1</span> <span class="id">IH2</span>]. <span class="id">refine</span> (<span class="id">IH2</span> <span class="id">_</span>). <span class="id">apply</span> <span class="id"><a href="Convert.html#varmap_ok_app">varmap_ok_app</a></span>; <span class="id">try</span> <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">apply</span> <span class="id">IH1</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_exists_Forall4">Forall3_exists_Forall4</a></span> <span class="kwd">in</span> <span class="id">IHdeep</span>. <span class="id">destruct</span> <span class="id">IHdeep</span> <span class="kwd">as</span> (<span class="id">tdeeps2</span> &amp; <span class="id">IHdeep</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select13">Forall3_select13</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall4_select124">Forall4_select124</a></span>, <span class="id"><a href="Misc.html#Forall4_impl">Forall4_impl</a></span>, <span class="id"><a href="Misc.html#Forall4_and">Forall4_and</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall4_unselect123">Forall4_unselect123</a></span>; <span class="id">eassumption</span>|<span class="id">apply</span> <span class="id">IHdeep</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> <span class="id">tdeep2</span> ((<span class="id">Hlen</span> &amp; <span class="id">Hread</span> &amp; <span class="id">Hconv</span> &amp; <span class="id">Hclosed</span> &amp; <span class="id">Hvars1</span> &amp; <span class="id">Hvars2</span> &amp; <span class="id">Hdv</span>) &amp; (<span class="id">Hread2</span> &amp; <span class="id">Hstar</span>)); <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">try</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">eassumption</span>]; <span class="id">intros</span>; <span class="id">left</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eassumption</span>]. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#convertible_sym">convertible_sym</a></span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [<span class="id">intros</span> ? ? <span class="id">H</span>; <span class="id">left</span>; <span class="id">exact</span> <span class="id">H</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_subst2">beta_subst2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>. <span class="id">apply</span> <span class="id"><a href="Beta.html#star_beta_subst1">star_beta_subst1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#star_beta_read_env">star_beta_read_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id">IHe</span>. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> [<span class="id">Hx1</span> <span class="id">Hx2</span>]; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">split</span>; [<span class="id">lia</span>|<span class="id">assumption</span>].<br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;Forall2_select2,&nbsp;Forall2_impl;&nbsp;[|eapply&nbsp;Forall2_and_Forall_left;&nbsp;[eapply&nbsp;Forall3_select23,&nbsp;Forall3_impl;&nbsp;[|eassumption]|exact&nbsp;Hx]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|intros&nbsp;v&nbsp;t5&nbsp;t6&nbsp;[?&nbsp;Hstar];&nbsp;exact&nbsp;Hstar].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;?&nbsp;?&nbsp;(?&nbsp;&amp;&nbsp;?);&nbsp;eapply&nbsp;dvar_free_star_beta;&nbsp;eassumption.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> <span class="id">t5</span>. <span class="id">rewrite</span> !<span class="id"><a href="Beta.html#fill_compose">fill_compose</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [<span class="id">apply</span> <span class="id">IHc2</span>|]. <span class="id">apply</span> <span class="id"><a href="Convert.html#star_beta_hctx">star_beta_hctx</a></span>, <span class="id"><a href="Beta.html#star_beta_switch">star_beta_switch</a></span>; [<span class="id">constructor</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_left">Forall2_map_left</a></span>, <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span>, <span class="id"><a href="Misc.html#Forall2_map_same">Forall2_map_same</a></span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall_True">Forall_True</a></span>. <span class="id">intros</span> [<span class="id">p</span> <span class="id">t0</span>]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">reflexivity</span>|]. <span class="id">apply</span> <span class="id"><a href="Beta.html#beta_subst2">beta_subst2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">n</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="STerm.html#ren_term_is_subst">ren_term_is_subst</a></span>. <span class="id">apply</span> <span class="id"><a href="Beta.html#star_beta_subst1">star_beta_subst1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#star_beta_read_env">star_beta_read_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id">IHe</span>. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state_wf">state_wf</a></span> <span class="id">st</span> <span class="id">defs</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">rid</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) <span class="id">rid</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt; <span class="kwd">exists</span> <span class="id">t</span> <span class="id">varmap</span>, <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> /\ <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="stable_beta_hnf_aux2">stable_beta_hnf_aux2</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span> <span class="id">defs</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt; <span class="kwd">exists</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t2</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t</span> <span class="id">t2</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt; <span class="kwd">exists</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t2</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t</span> <span class="id">t2</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap2</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt; <span class="kwd">exists</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c</span> <span class="id">h2</span> /\ (<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> <span class="id">t</span>))).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#stable_beta_hnf_aux">stable_beta_hnf_aux</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#step_r_freename">step_r_freename</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#step_r_beta_hnf">step_r_beta_hnf</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#only_changed_step_r">only_changed_step_r</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">varmap2</span> <span class="id">t2</span> <span class="id">Hvarmap2</span> <span class="id">Hread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#step_r_beta_hnf">step_r_beta_hnf</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">Hvarmap2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">Hvarmap2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="stable_beta_hnf_aux3">stable_beta_hnf_aux3</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">rid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span> <span class="id">defs</span> <span class="id">st</span> -&gt; <span class="id"><a href="Convert.html#state_wf">state_wf</a></span> <span class="id">st</span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt; <span class="kwd">exists</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">rid2</span> <span class="id">t2</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t</span> <span class="id">t2</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt; <span class="kwd">exists</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">v</span> <span class="id">t2</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t</span> <span class="id">t2</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">varmap2</span> <span class="id">c</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt; <span class="kwd">exists</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#read_cont">read_cont</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c</span> <span class="id">h2</span> /\ (<span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> <span class="id">t</span>))).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">specialize</span> (<span class="id">H2</span> <span class="id">rid</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">Hrid</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">t</span> &amp; <span class="id">varmap</span> &amp; <span class="id">Hvarmap</span> &amp; <span class="id">Ht</span>); [<span class="id">congruence</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#stable_beta_hnf_aux2">stable_beta_hnf_aux2</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="Convert.html#step_r">step_r</a></span>; <span class="id">rewrite</span> <span class="id">Hrid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>; <span class="id">intros</span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">try</span> <span class="id">eassumption</span>; <span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_wf_preserve">state_wf_preserve</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">rid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span> <span class="id">defs</span> <span class="id">st</span> -&gt; <span class="id"><a href="Convert.html#state_wf">state_wf</a></span> <span class="id">st</span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#state_wf">state_wf</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">defs</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) <span class="id">rid</span>) <span class="id">eqn</span>:<span class="id">Hrid</span>; [|<span class="id">unfold</span> <span class="id"><a href="Convert.html#step_r">step_r</a></span>; <span class="id">rewrite</span> <span class="id">Hrid</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">H2</span> <span class="id">rid</span>) <span class="kwd">as</span> (<span class="id">t</span> &amp; <span class="id">varmap</span> &amp; <span class="id">Hvarmap</span> &amp; <span class="id">Ht</span>); [<span class="id">congruence</span>|].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">rid2</span> <span class="id">Hrid2</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) <span class="id">rid2</span>) <span class="id">eqn</span>:<span class="id">Hrid3</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> (<span class="id">H2</span> <span class="id">rid2</span>) <span class="kwd">as</span> (<span class="id">t2</span> &amp; <span class="id">varmap2</span> &amp; <span class="id">Hvarmap2</span> &amp; <span class="id">Ht2</span>); [<span class="id">congruence</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#stable_beta_hnf_aux2">stable_beta_hnf_aux2</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; <span class="id">try</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> (<span class="id">Ht</span> &amp; <span class="id">_</span> &amp; <span class="id">_</span>). <span class="id">apply</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">Ht2</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ht2</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">Ht3</span> &amp; <span class="id">_</span>). <span class="kwd">exists</span> <span class="id">t3</span>. <span class="kwd">exists</span> <span class="id">varmap2</span>. <span class="id">split</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">apply</span> <span class="id">Hvarmap2</span>]. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">apply</span> <span class="id">Hvarmap2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Lt.html#lt_le_trans">lt_le_trans</a></span>; [<span class="id">eassumption</span>|]. <span class="id">apply</span> <span class="id"><a href="Convert.html#step_r_freename">step_r_freename</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#step_r_beta_hnf">step_r_beta_hnf</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">Hvarmap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">Hvarmap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="step_r_correct_val">step_r_correct_val</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span> <span class="id">defs</span> <span class="id">st</span> -&gt; <span class="id"><a href="Convert.html#state_wf">state_wf</a></span> <span class="id">st</span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#read_val">read_val</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t2</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span> <span class="id">Hdefsok</span> <span class="id">Hwf</span> <span class="id">Hread</span> <span class="id">Hvarmap</span>.<br/>
&nbsp;&nbsp;<span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> (<span class="id"><a href="Convert.html#stable_beta_hnf_aux3">stable_beta_hnf_aux3</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">_</span> <span class="id">_</span>)) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hread</span> <span class="id">Hvarmap</span>); <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> : <span class="id"><a href="Convert.html#cthread">cthread</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="read_cthread_done">read_cthread_done</a></span> : <span class="kwd">forall</span> <span class="id">b</span>, <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id">b</span>) <span class="id">b</span><br/>
| <span class="id"><a name="read_cthread_and_true">read_cthread_and_true</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct1</span> <span class="id">ct2</span>, <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct2</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> <span class="id">ct1</span> <span class="id">ct2</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
| <span class="id"><a name="read_cthread_and_false_1">read_cthread_and_false_1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct1</span> <span class="id">ct2</span>, <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> <span class="id">ct1</span> <span class="id">ct2</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
| <span class="id"><a name="read_cthread_and_false_2">read_cthread_and_false_2</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct1</span> <span class="id">ct2</span>, <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct2</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> <span class="id">ct1</span> <span class="id">ct2</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
| <span class="id"><a name="read_cthread_or_false">read_cthread_or_false</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct1</span> <span class="id">ct2</span>, <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt; <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct2</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> <span class="id">ct1</span> <span class="id">ct2</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
| <span class="id"><a name="read_cthread_or_true_1">read_cthread_or_true_1</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct1</span> <span class="id">ct2</span>, <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> <span class="id">ct1</span> <span class="id">ct2</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
| <span class="id"><a name="read_cthread_or_true_2">read_cthread_or_true_2</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ct1</span> <span class="id">ct2</span>, <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct2</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> <span class="id">ct1</span> <span class="id">ct2</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
| <span class="id"><a name="read_cthread_reduce">read_cthread_reduce</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">v1</span> <span class="id">t1</span> -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">v2</span> <span class="id">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Misc.html#reflect">reflect</a></span> (<span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span>) <span class="id">b</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">read_cthread</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>) <span class="id">b</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_dvars_app">lift_dvars_app</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">k</span> <span class="id">vars1</span> <span class="id">vars2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> (<span class="id">vars1</span> ++ <span class="id">vars2</span>) <span class="id">k</span> <span class="id">t</span> = <span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars2</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vars1</span> + <span class="id">k</span>) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars1</span> <span class="id">k</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span>; <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">k</span> <span class="id">vars1</span> <span class="id">vars2</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_app">index_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Misc.html#index">index</a></span> <span class="id">_</span> <span class="id">vars1</span> <span class="id">n</span>); [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">destruct</span> (<span class="id"><a href="Misc.html#index">index</a></span> <span class="id">_</span> <span class="id">vars2</span> <span class="id">n</span>); <span class="id">simpl</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id">IHt</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt1</span>|<span class="id">apply</span> <span class="id">IHt2</span>].<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">intros</span>; <span class="id">apply</span> <span class="id">H</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>; <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> (<span class="id">p</span>, <span class="id">t2</span>) <span class="id">Hpt2</span>). <span class="id">rewrite</span> <span class="id">H</span>. <span class="id">f_equal</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_dvars_cons">lift_dvars_cons</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">k</span> <span class="id">x</span> <span class="id">vars</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> (<span class="id">x</span> :: <span class="id">vars</span>) <span class="id">k</span> <span class="id">t</span> = <span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">k</span>) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> (<span class="id">x</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">k</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#lift_dvars_app">lift_dvars_app</a></span> <span class="kwd">with</span> (<span class="id">vars1</span> := <span class="id">x</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="betaiota_abs_red">betaiota_abs_red</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span> (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t1</span>) <span class="id">t2</span> -&gt; <span class="kwd">exists</span> <span class="id">t3</span>, <span class="id">t2</span> = <span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t3</span> /\ <span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t3</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> [<span class="id">H</span> | <span class="id">H</span>]; <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">try</span> <span class="id">reflexivity</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="betaiota_star_abs_red">betaiota_star_abs_red</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t1</span>) <span class="id">t2</span> -&gt; <span class="kwd">exists</span> <span class="id">t3</span>, <span class="id">t2</span> = <span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t3</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t3</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">H</span>; <span class="id">remember</span> (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t1</span>) <span class="kwd">as</span> <span class="id">t3</span>; <span class="id">revert</span> <span class="id">t1</span> <span class="id">Heqt3</span>; <span class="id">induction</span> <span class="id">H</span>; <span class="id">intros</span> <span class="id">t1</span> -&gt;.<br/>
&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">t1</span>. <span class="id">split</span>; [<span class="id">reflexivity</span>|<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>].<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#betaiota_abs_red">betaiota_abs_red</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">t2</span> &amp; -&gt; &amp; <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHstar</span> <span class="id">_</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>) <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">Ht3</span> &amp; <span class="id">Hstar</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">t3</span>. <span class="id">split</span>; [<span class="id">assumption</span>|]. <span class="id">econstructor</span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="convertible_abs_iff">convertible_abs_iff</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t1</span>) (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t2</span>) &lt;-&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span>; <span class="id">split</span>; <span class="id">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_confluent_common_reduce">convertible_confluent_common_reduce</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_iota_confluent">beta_iota_confluent</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">Ht3a</span> &amp; <span class="id">Ht3b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#betaiota_star_abs_red">betaiota_star_abs_red</a></span> <span class="kwd">in</span> <span class="id">Ht3a</span>. <span class="id">destruct</span> <span class="id">Ht3a</span> <span class="kwd">as</span> (<span class="id">t4</span> &amp; -&gt; &amp; <span class="id">Ht4a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#betaiota_star_abs_red">betaiota_star_abs_red</a></span> <span class="kwd">in</span> <span class="id">Ht3b</span>. <span class="id">destruct</span> <span class="id">Ht3b</span> <span class="kwd">as</span> (<span class="id">t5</span> &amp; [=&lt;-] &amp; <span class="id">Ht4b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#common_reduce_convertible">common_reduce_convertible</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t3</span> <span class="id">t4</span> [<span class="id">H1</span> | <span class="id">H1</span>]; <span class="id">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">H1</span> | <span class="id">H1</span>]; <span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="betaiota_constr_red_weak">betaiota_constr_red_weak</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">tag</span> <span class="id">l1</span> <span class="id">t2</span>, <span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span> (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l1</span>) <span class="id">t2</span> -&gt; <span class="kwd">exists</span> <span class="id">l2</span>, <span class="id">t2</span> = <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l2</span> /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>)) <span class="id">l1</span> <span class="id">l2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">tag</span> <span class="id">l1</span> <span class="id">t2</span> [<span class="id">H</span> | <span class="id">H</span>]; <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>; <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">try</span> <span class="id">reflexivity</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_app">Forall2_app</a></span>; <span class="id">try</span> <span class="id">constructor</span>; <span class="id">try</span> <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_map_same">Forall2_map_same</a></span>, <span class="id"><a href="Misc.html#Forall_True">Forall_True</a></span>, <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="betaiota_star_constr_red">betaiota_star_constr_red</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">tag</span> <span class="id">l1</span> <span class="id">t2</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l1</span>) <span class="id">t2</span> -&gt; <span class="kwd">exists</span> <span class="id">l2</span>, <span class="id">t2</span> = <span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l2</span> /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>)) <span class="id">l1</span> <span class="id">l2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">tag</span> <span class="id">l1</span> <span class="id">t2</span> <span class="id">H</span>; <span class="id">remember</span> (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l1</span>) <span class="kwd">as</span> <span class="id">t3</span>; <span class="id">revert</span> <span class="id">l1</span> <span class="id">Heqt3</span>; <span class="id">induction</span> <span class="id">H</span>; <span class="id">intros</span> <span class="id">l1</span> -&gt;.<br/>
&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">l1</span>. <span class="id">split</span>; [<span class="id">reflexivity</span>|<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_map_same">Forall2_map_same</a></span>, <span class="id"><a href="Misc.html#Forall_True">Forall_True</a></span>, <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>].<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#betaiota_constr_red_weak">betaiota_constr_red_weak</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">l2</span> &amp; -&gt; &amp; <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHstar</span> <span class="id">_</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>) <span class="kwd">as</span> (<span class="id">l3</span> &amp; <span class="id">Hl3</span> &amp; <span class="id">Hstar</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">l3</span>. <span class="id">split</span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_from_Forall2">Forall3_from_Forall2</a></span>; [<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_comm">Forall2_comm</a></span> <span class="kwd">in</span> <span class="id">H</span>|]; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span> <span class="id">H123</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; <span class="id">apply</span> <span class="id">H123</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="star_betaiota_constr">star_betaiota_constr</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">tag</span> (<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="STerm.html#term">term</a></span>), <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>)) <span class="id">l1</span> <span class="id">l2</span> -&gt; <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l1</span>) (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">tag</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_list">star_list</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">l3</span> <span class="id">l4</span> <span class="id">x</span> <span class="id">y</span> [<span class="id">Hxy</span> | <span class="id">Hxy</span>]; [<span class="id">left</span>|<span class="id">right</span>]; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="convertible_constr_iff">convertible_constr_iff</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">tag1</span> <span class="id">tag2</span> <span class="id">l1</span> <span class="id">l2</span>, <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag1</span> <span class="id">l1</span>) (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag2</span> <span class="id">l2</span>) &lt;-&gt; (<span class="id">tag1</span> = <span class="id">tag2</span> /\ <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>)) <span class="id">l1</span> <span class="id">l2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">tag1</span> <span class="id">tag2</span> <span class="id">l1</span> <span class="id">l2</span>; <span class="id">split</span>; <span class="id">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_confluent_common_reduce">convertible_confluent_common_reduce</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_iota_confluent">beta_iota_confluent</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">Ht3a</span> &amp; <span class="id">Ht3b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#betaiota_star_constr_red">betaiota_star_constr_red</a></span> <span class="kwd">in</span> <span class="id">Ht3a</span>. <span class="id">destruct</span> <span class="id">Ht3a</span> <span class="kwd">as</span> (<span class="id">l4</span> &amp; -&gt; &amp; <span class="id">Ht5a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#betaiota_star_constr_red">betaiota_star_constr_red</a></span> <span class="kwd">in</span> <span class="id">Ht3b</span>. <span class="id">destruct</span> <span class="id">Ht3b</span> <span class="kwd">as</span> (<span class="id">l5</span> &amp; [=&lt;- &lt;-] &amp; <span class="id">Ht5b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_comm">Forall2_comm</a></span> <span class="kwd">in</span> <span class="id">Ht5a</span>, <span class="id">Ht5b</span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_from_Forall2">Forall3_from_Forall2</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span> <span class="id">Ht123</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#common_reduce_convertible">common_reduce_convertible</a></span>; <span class="id">apply</span> <span class="id">Ht123</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [-&gt; <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">H1</span> : <span class="kwd">exists</span> <span class="id">l3</span>, <span class="id"><a href="Misc.html#Forall3">Forall3</a></span> (<span class="kwd">fun</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span> =&gt; <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t3</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t2</span> <span class="id">t3</span>) <span class="id">l1</span> <span class="id">l2</span> <span class="id">l3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_exists_Forall3">Forall2_exists_Forall3</a></span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht12</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#convertible_confluent_common_reduce">convertible_confluent_common_reduce</a></span> <span class="kwd">in</span> <span class="id">Ht12</span>; [|<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_iota_confluent">beta_iota_confluent</a></span>]. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> (<span class="id">l3</span> &amp; <span class="id">Hl3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#common_reduce_convertible">common_reduce_convertible</a></span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#star_betaiota_constr">star_betaiota_constr</a></span>; [<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select13">Forall3_select13</a></span>|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>; <span class="id">try</span> <span class="id">eassumption</span>; <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="abs_constr_not_convertible">abs_constr_not_convertible</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">t</span>, ~ <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span>) (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">t</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_confluent_common_reduce">convertible_confluent_common_reduce</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_iota_confluent">beta_iota_confluent</a></span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">Ht3a</span> &amp; <span class="id">Ht3b</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#betaiota_star_abs_red">betaiota_star_abs_red</a></span> <span class="kwd">in</span> <span class="id">Ht3a</span>. <span class="id">destruct</span> <span class="id">Ht3a</span> <span class="kwd">as</span> (<span class="id">t4</span> &amp; -&gt; &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#betaiota_star_constr_red">betaiota_star_constr_red</a></span> <span class="kwd">in</span> <span class="id">Ht3b</span>. <span class="id">destruct</span> <span class="id">Ht3b</span> <span class="kwd">as</span> (<span class="id">l4</span> &amp; <span class="id">Habsurd</span> &amp; <span class="id">_</span>). <span class="id">congruence</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="constr_abs_not_convertible">constr_abs_not_convertible</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">t</span>, ~ <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span>) (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">t</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_sym">convertible_sym</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#abs_constr_not_convertible">abs_constr_not_convertible</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="hctx_red">hctx_red</a></span> <span class="id">defs</span> : <span class="id"><a href="Beta.html#hctx">hctx</a></span> -&gt; <span class="id"><a href="Beta.html#hctx">hctx</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="hctx_red_app_1">hctx_red_app_1</a></span> : <span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">t</span>, <span class="id">hctx_red</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id">hctx_red</span> <span class="id">defs</span> (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h1</span> <span class="id">t</span>) (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h2</span> <span class="id">t</span>)<br/>
| <span class="id"><a name="hctx_red_app_2">hctx_red_app_2</a></span> : <span class="kwd">forall</span> <span class="id">h</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id">hctx_red</span> <span class="id">defs</span> (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h</span> <span class="id">t1</span>) (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h</span> <span class="id">t2</span>)<br/>
| <span class="id"><a name="hctx_red_switch_1">hctx_red_switch_1</a></span> : <span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">m</span>, <span class="id">hctx_red</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id">hctx_red</span> <span class="id">defs</span> (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h1</span> <span class="id">m</span>) (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h2</span> <span class="id">m</span>)<br/>
| <span class="id"><a name="hctx_red_switch_2">hctx_red_switch_2</a></span> : <span class="kwd">forall</span> <span class="id">h</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">p</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id">hctx_red</span> <span class="id">defs</span> (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h</span> (<span class="id">m1</span> ++ (<span class="id">p</span>, <span class="id">t1</span>) :: <span class="id">m2</span>)) (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h</span> (<span class="id">m1</span> ++ (<span class="id">p</span>, <span class="id">t2</span>) :: <span class="id">m2</span>)).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_red_fill">hctx_red_fill</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="kwd">forall</span> <span class="id">t</span>, <span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h1</span> <span class="id">t</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">H</span> <span class="id">t</span>; <span class="id">induction</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">IHhctx_red</span>; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">IHhctx_red</span>; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="is_neutral_var">is_neutral_var</a></span> (<span class="id">defs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="STerm.html#term">term</a></span>) <span class="id">x</span> := <span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> | <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">defs</span> <span class="id">n</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> | <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="fill_hctx_var_red">fill_hctx_var_red</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#is_neutral_var">is_neutral_var</a></span> <span class="id">defs</span> <span class="id">x</span> -&gt; <span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">x</span>) <span class="id">t</span> -&gt; <span class="kwd">exists</span> <span class="id">h2</span>, <span class="id">t</span> = <span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> <span class="id">x</span> /\ <span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span> <span class="id">h</span> <span class="id">h2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">t</span> <span class="id">Hx</span> <span class="id">H</span>. <span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> | <span class="id">H</span>]; <span class="id">revert</span> <span class="id">t</span> <span class="id">H</span>; <span class="id">induction</span> <span class="id">h</span>; <span class="id">intros</span> <span class="id">t3</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">x</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">tauto</span>; <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHh</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">h2</span> &amp; -&gt; &amp; <span class="id">Hh2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h2</span> <span class="id">t</span>); <span class="id">split</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">exists</span> (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h</span> <span class="id">t2</span>). <span class="id">split</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHh</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">h2</span> &amp; -&gt; &amp; <span class="id">Hh2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h2</span> <span class="id">l</span>). <span class="id">split</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">exists</span> (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h</span> (<span class="id">l1</span> ++ (<span class="id">p</span>, <span class="id">t2</span>) :: <span class="id">l2</span>)). <span class="id">split</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">x</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">tauto</span>; <span class="id">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHh</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">h2</span> &amp; -&gt; &amp; <span class="id">Hh2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h2</span> <span class="id">t</span>); <span class="id">split</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">exists</span> (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h</span> <span class="id">t2</span>). <span class="id">split</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">h</span>; <span class="id">destruct</span> <span class="id">x</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">tauto</span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id">IHh</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">h2</span> &amp; -&gt; &amp; <span class="id">Hh2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h2</span> <span class="id">l</span>). <span class="id">split</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="kwd">exists</span> (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h</span> (<span class="id">l1</span> ++ (<span class="id">p</span>, <span class="id">t2</span>) :: <span class="id">l2</span>)). <span class="id">split</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">h</span>; <span class="id">destruct</span> <span class="id">x</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">tauto</span>; <span class="id">congruence</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="fill_hctx_var_star_red">fill_hctx_var_star_red</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#is_neutral_var">is_neutral_var</a></span> <span class="id">defs</span> <span class="id">x</span> -&gt; <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">x</span>) <span class="id">t</span> -&gt; <span class="kwd">exists</span> <span class="id">h2</span>, <span class="id">t</span> = <span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> <span class="id">x</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span>) <span class="id">h</span> <span class="id">h2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">t</span> <span class="id">Hx</span> <span class="id">H</span>; <span class="id">remember</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">x</span>) <span class="kwd">as</span> <span class="id">t3</span>; <span class="id">revert</span> <span class="id">h</span> <span class="id">Heqt3</span>; <span class="id">induction</span> <span class="id">H</span>; <span class="id">intros</span> <span class="id">h</span> -&gt;.<br/>
&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id">h</span>. <span class="id">split</span>; [<span class="id">reflexivity</span>|<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>].<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#fill_hctx_var_red">fill_hctx_var_red</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">assumption</span>]. <span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">h2</span> &amp; -&gt; &amp; <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">IHstar</span> <span class="id">_</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>) <span class="kwd">as</span> (<span class="id">h3</span> &amp; <span class="id">Hh3</span> &amp; <span class="id">Hstar</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">h3</span>. <span class="id">split</span>; [<span class="id">assumption</span>|]. <span class="id">econstructor</span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="is_var">is_var</a></span> <span class="id">x</span> := <span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id"><a href="STerm.html#var">var</a></span> <span class="id">_</span> | <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span> | <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="fill_hctx_var_eq">fill_hctx_var_eq</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#is_var">is_var</a></span> <span class="id">x1</span> -&gt; <span class="id"><a href="Convert.html#is_var">is_var</a></span> <span class="id">x2</span> -&gt; <span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h1</span> <span class="id">x1</span> = <span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> <span class="id">x2</span> &lt;-&gt; <span class="id">h1</span> = <span class="id">h2</span> /\ <span class="id">x1</span> = <span class="id">x2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x1</span> <span class="id">x2</span>; <span class="id">induction</span> <span class="id">h1</span>; <span class="id">intros</span> <span class="id">h2</span> <span class="id">Hx1</span> <span class="id">Hx2</span>; <span class="id">destruct</span> <span class="id">h2</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> (<span class="id">destruct</span> <span class="id">x1</span>; <span class="id">destruct</span> <span class="id">x2</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">intuition</span> <span class="id">congruence</span>).<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHh1</span> <span class="id">h2</span>). <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> [=]; <span class="id">intuition</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> [[=] ?]; <span class="id">intuition</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHh1</span> <span class="id">h2</span>). <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> [=]; <span class="id">intuition</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> [[=] ?]; <span class="id">intuition</span> <span class="id">congruence</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="hctx_convertible">hctx_convertible</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> := <span class="kwd">exists</span> <span class="id">h3</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span>) <span class="id">h1</span> <span class="id">h3</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span>) <span class="id">h2</span> <span class="id">h3</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="iota_hctx">iota_hctx</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Beta.html#iota">iota</a></span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Beta.html#iota">iota</a></span> <span class="id">defs</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t1</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">H</span>; <span class="id">induction</span> <span class="id">h</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="star_betaiota_hctx">star_betaiota_hctx</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t1</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t3</span> <span class="id">t4</span> [<span class="id">H1</span> | <span class="id">H1</span>]; [<span class="id">left</span> | <span class="id">right</span>].<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#iota_hctx">iota_hctx</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#beta_hctx">beta_hctx</a></span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="fill_hctx_star">fill_hctx_star</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span>) <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h1</span> <span class="id">t1</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht</span> <span class="id">Hh</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#star_betaiota_hctx">star_betaiota_hctx</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">_</span>); [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">h3</span> <span class="id">h4</span> <span class="id">H1</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_red_fill">hctx_red_fill</a></span>, <span class="id">H1</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="convertible_neutral_iff">convertible_neutral_iff</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">x1</span> <span class="id">x2</span>, <span class="id"><a href="Convert.html#is_neutral_var">is_neutral_var</a></span> <span class="id">defs</span> <span class="id">x1</span> -&gt; <span class="id"><a href="Convert.html#is_neutral_var">is_neutral_var</a></span> <span class="id">defs</span> <span class="id">x2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h1</span> <span class="id">x1</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> <span class="id">x2</span>) &lt;-&gt; (<span class="id">x1</span> = <span class="id">x2</span> /\ <span class="id"><a href="Convert.html#hctx_convertible">hctx_convertible</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">Hx1</span> <span class="id">Hx2</span>. <span class="id">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_confluent_common_reduce">convertible_confluent_common_reduce</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_iota_confluent">beta_iota_confluent</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">Ht3a</span> &amp; <span class="id">Ht3b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#fill_hctx_var_star_red">fill_hctx_var_star_red</a></span> <span class="kwd">in</span> <span class="id">Ht3a</span>; [|<span class="id">assumption</span>]. <span class="id">destruct</span> <span class="id">Ht3a</span> <span class="kwd">as</span> (<span class="id">h4</span> &amp; -&gt; &amp; <span class="id">Ht5a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#fill_hctx_var_star_red">fill_hctx_var_star_red</a></span> <span class="kwd">in</span> <span class="id">Ht3b</span>; [|<span class="id">assumption</span>]. <span class="id">destruct</span> <span class="id">Ht3b</span> <span class="kwd">as</span> (<span class="id">h5</span> &amp; <span class="id">Heq</span> &amp; <span class="id">Ht5b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#fill_hctx_var_eq">fill_hctx_var_eq</a></span> <span class="kwd">in</span> <span class="id">Heq</span>; [|<span class="id">destruct</span> <span class="id">x1</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>|<span class="id">destruct</span> <span class="id">x2</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>]. <span class="id">destruct</span> <span class="id">Heq</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">reflexivity</span>|]. <span class="id">eexists</span>; <span class="id">split</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> [-&gt; (<span class="id">h3</span> &amp; <span class="id">Hh3a</span> &amp; <span class="id">Hh3b</span>)]. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#common_reduce_convertible">common_reduce_convertible</a></span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#fill_hctx_star">fill_hctx_star</a></span>; <span class="id">try</span> <span class="id">eassumption</span>; <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="abs_neutral_not_convertible">abs_neutral_not_convertible</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#is_neutral_var">is_neutral_var</a></span> <span class="id">defs</span> <span class="id">x</span> -&gt; ~ <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">x</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">t</span> <span class="id">Hx</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_confluent_common_reduce">convertible_confluent_common_reduce</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_iota_confluent">beta_iota_confluent</a></span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">Ht3a</span> &amp; <span class="id">Ht3b</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#betaiota_star_abs_red">betaiota_star_abs_red</a></span> <span class="kwd">in</span> <span class="id">Ht3a</span>. <span class="id">destruct</span> <span class="id">Ht3a</span> <span class="kwd">as</span> (<span class="id">t4</span> &amp; -&gt; &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#fill_hctx_var_star_red">fill_hctx_var_star_red</a></span> <span class="kwd">in</span> <span class="id">Ht3b</span>; [|<span class="id">assumption</span>]. <span class="id">destruct</span> <span class="id">Ht3b</span> <span class="kwd">as</span> (<span class="id">h4</span> &amp; <span class="id">Habsurd</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">h4</span>; <span class="id">destruct</span> <span class="id">x</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">tauto</span>; <span class="id">congruence</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="neutral_abs_not_convertible">neutral_abs_not_convertible</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#is_neutral_var">is_neutral_var</a></span> <span class="id">defs</span> <span class="id">x</span> -&gt; ~ <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">x</span>) (<span class="id"><a href="STerm.html#abs">abs</a></span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">t</span> <span class="id">Hx</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_sym">convertible_sym</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#abs_neutral_not_convertible">abs_neutral_not_convertible</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="constr_neutral_not_convertible">constr_neutral_not_convertible</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">tag</span> <span class="id">l</span>, <span class="id"><a href="Convert.html#is_neutral_var">is_neutral_var</a></span> <span class="id">defs</span> <span class="id">x</span> -&gt; ~ <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">x</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">Hx</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_confluent_common_reduce">convertible_confluent_common_reduce</a></span> <span class="kwd">in</span> <span class="id">H</span>; [|<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_iota_confluent">beta_iota_confluent</a></span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">Ht3a</span> &amp; <span class="id">Ht3b</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#betaiota_star_constr_red">betaiota_star_constr_red</a></span> <span class="kwd">in</span> <span class="id">Ht3a</span>. <span class="id">destruct</span> <span class="id">Ht3a</span> <span class="kwd">as</span> (<span class="id">l4</span> &amp; -&gt; &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#fill_hctx_var_star_red">fill_hctx_var_star_red</a></span> <span class="kwd">in</span> <span class="id">Ht3b</span>; [|<span class="id">assumption</span>]. <span class="id">destruct</span> <span class="id">Ht3b</span> <span class="kwd">as</span> (<span class="id">h4</span> &amp; <span class="id">Habsurd</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">h4</span>; <span class="id">destruct</span> <span class="id">x</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">tauto</span>; <span class="id">congruence</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="neutral_constr_not_convertible">neutral_constr_not_convertible</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">tag</span> <span class="id">l</span>, <span class="id"><a href="Convert.html#is_neutral_var">is_neutral_var</a></span> <span class="id">defs</span> <span class="id">x</span> -&gt; ~ <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">x</span>) (<span class="id"><a href="STerm.html#constr">constr</a></span> <span class="id">tag</span> <span class="id">l</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">x</span> <span class="id">tag</span> <span class="id">l</span> <span class="id">Hx</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_sym">convertible_sym</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#constr_neutral_not_convertible">constr_neutral_not_convertible</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="convertible_convertible_left">convertible_convertible_left</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>) (<span class="id">R</span> : <span class="id">A</span> -&gt; <span class="id">A</span> -&gt; <span class="kwd">Prop</span>) <span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span>, <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id">R</span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id">R</span> <span class="id">t1</span> <span class="id">t3</span> &lt;-&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id">R</span> <span class="id">t2</span> <span class="id">t3</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">R</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span> <span class="id">H</span>. <span class="id">split</span>; <span class="id">intros</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_sym">star_sym</a></span>; [<span class="id">apply</span> <span class="id"><a href="Rewrite.html#symc_sym">symc_sym</a></span>|]. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="convertible_convertible_right">convertible_convertible_right</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>) (<span class="id">R</span> : <span class="id">A</span> -&gt; <span class="id">A</span> -&gt; <span class="kwd">Prop</span>) <span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span>, <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id">R</span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id">R</span> <span class="id">t3</span> <span class="id">t1</span> &lt;-&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id">R</span> <span class="id">t3</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">R</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span> <span class="id">H</span>. <span class="id">split</span>; <span class="id">intros</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_sym">star_sym</a></span>; [<span class="id">apply</span> <span class="id"><a href="Rewrite.html#symc_sym">symc_sym</a></span>|]. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="convertible_convertible_leftright">convertible_convertible_leftright</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> : <span class="kwd">Type</span>) (<span class="id">R</span> : <span class="id">A</span> -&gt; <span class="id">A</span> -&gt; <span class="kwd">Prop</span>) <span class="id">t1</span> <span class="id">t2</span> <span class="id">t3</span> <span class="id">t4</span>, <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id">R</span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id">R</span> <span class="id">t3</span> <span class="id">t4</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id">R</span> <span class="id">t1</span> <span class="id">t3</span> &lt;-&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id">R</span> <span class="id">t2</span> <span class="id">t4</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">etransitivity</span>; [<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_convertible_left">convertible_convertible_left</a></span>|<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_convertible_right">convertible_convertible_right</a></span>]; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_dvars_fill">lift_dvars_fill</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h</span> <span class="id">t</span>) = <span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> (<span class="id"><a href="Convert.html#lift_dvars_hctx">lift_dvars_hctx</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">h</span>) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t</span> <span class="id">h</span>; <span class="id">induction</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_dvars_ren_aux">lift_dvars_ren_aux</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vars</span> <span class="id">k1</span> <span class="id">k2</span> <span class="id">k3</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#liftn">liftn</a></span> <span class="id">k1</span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> <span class="id">k3</span>)) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> (<span class="id">k1</span> + <span class="id">k2</span>) <span class="id">t</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> (<span class="id">k3</span> + <span class="id">k1</span> + <span class="id">k2</span>) (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#liftn">liftn</a></span> <span class="id">k1</span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> <span class="id">k3</span>)) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">vars</span> <span class="id">k1</span> <span class="id">k2</span> <span class="id">k3</span> <span class="id">t</span>; <span class="id">revert</span> <span class="id">k1</span>; <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">k1</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="Misc.html#index">index</a></span>; [|<span class="id">reflexivity</span>]. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_renv_large">liftn_renv_large</a></span> <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#lift_liftn_1">lift_liftn_1</a></span>, <span class="id"><a href="STerm.html#liftn_liftn">liftn_liftn</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHt</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">k1</span>)). <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">IHt</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt1</span>|<span class="id">apply</span> <span class="id">IHt2</span>].<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> !<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">apply</span> <span class="id">H</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p2</span> <span class="id">t2</span>] <span class="id">Hpt2</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span>). <span class="id">simpl</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_liftn">liftn_liftn</a></span>. <span class="id">specialize</span> (<span class="id">H</span> (<span class="id">p2</span> + <span class="id">k1</span>)). <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Plus.html#plus_assoc">plus_assoc</a></span>, <span class="id">H</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_dvars_ren">lift_dvars_ren</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vars</span> <span class="id">k1</span> <span class="id">k2</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> <span class="id">k2</span>) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k1</span> <span class="id">t</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> (<span class="id">k2</span> + <span class="id">k1</span>) (<span class="id"><a href="STerm.html#ren_term">ren_term</a></span> (<span class="id"><a href="STerm.html#plus_ren">plus_ren</a></span> <span class="id">k2</span>) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">vars</span> <span class="id">k1</span> <span class="id">k2</span> <span class="id">t</span>. <span class="id">assert</span> (<span class="id">H</span> := <span class="id"><a href="Convert.html#lift_dvars_ren_aux">lift_dvars_ren_aux</a></span> <span class="id">vars</span> 0 <span class="id">k1</span> <span class="id">k2</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_0">liftn_0</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">H</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_dvars_read_env_aux">lift_dvars_read_env_aux</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">p</span> <span class="id">l</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> (<span class="id">p</span> + <span class="id">k</span>) (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">l</span>)) <span class="id">t</span>) = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">p</span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span>) <span class="id">l</span>))) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> (<span class="id">p</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span> + <span class="id">k</span>) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">p</span> <span class="id">l</span> <span class="id">t</span>; <span class="id">revert</span> <span class="id">p</span>; <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">p</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_map">nth_error_map</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span>; <span class="id">simpl</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Convert.html#lift_dvars_ren">lift_dvars_ren</a></span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="Misc.html#index">index</a></span>; <span class="id">simpl</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_map">nth_error_map</a></span>, <span class="id"><a href="Misc.html#nth_error_None_rw">nth_error_None_rw</a></span> <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#plus_ren_correct">plus_ren_correct</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- !<span class="id"><a href="STerm.html#liftn_subst_1_subst">liftn_subst_1_subst</a></span>, !<span class="id"><a href="STerm.html#liftn_subst_add_subst">liftn_subst_add_subst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHt</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">p</span>)); <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt1</span>|<span class="id">apply</span> <span class="id">IHt2</span>].<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>. <span class="id">rewrite</span> !<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id">H</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p2</span> <span class="id">t2</span>] <span class="id">Hpt2</span>. <span class="id">simpl</span>. <span class="id">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="STerm.html#liftn_subst_add_subst">liftn_subst_add_subst</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span> (<span class="id">p2</span> + <span class="id">p</span>)); <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Plus.html#plus_assoc">plus_assoc</a></span>, <span class="id">H</span>. <span class="id">f_equal</span>. <span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_dvars_read_env">lift_dvars_read_env</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">l</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> <span class="id">l</span>) <span class="id">t</span>) = <span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span>) <span class="id">l</span>)) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span> + <span class="id">k</span>) <span class="id">t</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">l</span> <span class="id">t</span>. <span class="id">assert</span> (<span class="id">H</span> := <span class="id"><a href="Convert.html#lift_dvars_read_env_aux">lift_dvars_read_env_aux</a></span> <span class="id">vars</span> <span class="id">k</span> 0 <span class="id">l</span> <span class="id">t</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="STerm.html#liftn_subst_0_subst">liftn_subst_0_subst</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="beta_lift_dvars">beta_lift_dvars</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">vars</span> <span class="id">k</span>, <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Beta.html#beta">beta</a></span> (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t1</span>) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">H</span>; <span class="id">revert</span> <span class="id">k</span>; <span class="id">induction</span> <span class="id">H</span>; <span class="id">intros</span> <span class="id">k</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">apply</span> <span class="id">IHbeta</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">apply</span> <span class="id">IHbeta</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">apply</span> <span class="id">IHbeta</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="STerm.html#subst1_read_env">subst1_read_env</a></span>, <span class="id"><a href="Convert.html#lift_dvars_read_env">lift_dvars_read_env</a></span>. <span class="id">simpl</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="STerm.html#subst1_read_env">subst1_read_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> !<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>; <span class="id">simpl</span>. <span class="id">constructor</span>; <span class="id">apply</span> <span class="id">IHbeta</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">constructor</span>; <span class="id">apply</span> <span class="id">IHbeta</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> !<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>; <span class="id">simpl</span>. <span class="id">constructor</span>; <span class="id">apply</span> <span class="id">IHbeta</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="Convert.html#lift_dvars_read_env">lift_dvars_read_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span> <span class="kwd">with</span> (<span class="id">l</span> := <span class="id">l</span>). <span class="id">erewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span> <span class="kwd">with</span> (<span class="id">l</span> := <span class="id">l1</span>). <span class="id">constructor</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_dvars_below">lift_dvars_below</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">n</span> <span class="id">t</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">n</span> &lt;= <span class="id">x</span>) <span class="id">vars</span> -&gt; <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">n</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t</span> = <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">n</span> <span class="id">t</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">revert</span> <span class="id">k</span>; <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">k</span>.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hn</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">Hn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">apply</span> <span class="id">IHt</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt1</span>|<span class="id">apply</span> <span class="id">IHt2</span>]; <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>; [<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_id">map_id</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">apply</span> <span class="id">H</span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">apply</span> <span class="id">H4</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt</span>; <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>; [<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_id">map_id</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>; <span class="id">f_equal</span>; <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">apply</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="id">apply</span> (<span class="id">H6</span> <span class="id">_</span> <span class="id">Hpt2</span>).<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="dvar_below_impl">dvar_below_impl</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">k1</span> <span class="id">k2</span>, <span class="id">k1</span> &lt;= <span class="id">k2</span> -&gt; <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k1</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> <span class="id">k2</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">k1</span> <span class="id">k2</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">revert</span> <span class="id">k2</span> <span class="id">H1</span>; <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">k3</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">apply</span> <span class="id">IHt</span>; <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; [<span class="id">apply</span> <span class="id">IHt1</span>|<span class="id">apply</span> <span class="id">IHt2</span>]; <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">apply</span> <span class="id">H4</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> [<span class="id">Ht1</span> <span class="id">Ht2</span>]; <span class="id">apply</span> <span class="id">Ht1</span>; [<span class="id">assumption</span>|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>; [<span class="id">apply</span> <span class="id">IHt</span>; <span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">erewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">H</span>|<span class="id">apply</span> <span class="id">H6</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] [<span class="id">Hpt1</span> <span class="id">Hpt2</span>]; <span class="id">apply</span> <span class="id">Hpt1</span>; [<span class="id">assumption</span>|<span class="id">lia</span>].<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="iota_lift_dvars">iota_lift_dvars</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">vars</span> <span class="id">k</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id">x</span>) <span class="id">vars</span> -&gt; <span class="id"><a href="Convert.html#defs_wf">defs_wf</a></span> <span class="id">defs</span> -&gt; <span class="id"><a href="Beta.html#iota">iota</a></span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Beta.html#iota">iota</a></span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t1</span>) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H</span>; <span class="id">revert</span> <span class="id">k</span>; <span class="id">induction</span> <span class="id">H</span>; <span class="id">intros</span> <span class="id">k1</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>; [|<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">intros</span> <span class="id">Hk</span>; <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">_</span> <span class="id">Hk</span>); <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">H3</span> : <span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k1</span> <span class="id">t</span> = <span class="id">t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#lift_dvars_below">lift_dvars_below</a></span>; [<span class="id">eassumption</span>|]. <span class="id">unfold</span> <span class="id"><a href="Convert.html#defs_wf">defs_wf</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_Forall2">nth_error_Forall2</a></span> <span class="kwd">in</span> <span class="id">H2</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> (<span class="id">y</span> &amp; <span class="id">Hy1</span> &amp; <span class="id">Hy2</span>). <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_nth">nth_error_nth</a></span> <span class="kwd">with</span> (<span class="id">d</span> := <span class="id">y</span>) <span class="kwd">in</span> <span class="id">Hy1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_nth">seq_nth</a></span> <span class="kwd">in</span> <span class="id">Hy1</span> <span class="kwd">by</span> (<span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span>; <span class="id">eassumption</span>). <span class="id">subst</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#dvar_below_impl">dvar_below_impl</a></span>; [|<span class="id">apply</span> <span class="id">Hy2</span>]. <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="id">rewrite</span> <span class="id">H3</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">IHiota</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">IHiota</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">IHiota</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> !<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">IHiota</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">IHiota</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> !<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="id">constructor</span>. <span class="id">apply</span> <span class="id">IHiota</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="convertible_lift_dvars">convertible_lift_dvars</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t1</span> <span class="id">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id">x</span>) <span class="id">vars</span> -&gt; <span class="id"><a href="Convert.html#defs_wf">defs_wf</a></span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t1</span>) (<span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t3</span> <span class="id">t4</span> [[<span class="id">Ht34</span> | <span class="id">Ht34</span>] | [<span class="id">Ht34</span> | <span class="id">Ht34</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">eapply</span> <span class="id"><a href="Convert.html#beta_lift_dvars">beta_lift_dvars</a></span> <span class="kwd">in</span> <span class="id">Ht34</span> || <span class="id">eapply</span> <span class="id"><a href="Convert.html#iota_lift_dvars">iota_lift_dvars</a></span> <span class="kwd">in</span> <span class="id">Ht34</span>; <span class="id">try</span> <span class="id">eassumption</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="convertible_beta_betaiota">convertible_beta_betaiota</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> <span class="id"><a href="Beta.html#beta">beta</a></span> <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t3</span> <span class="id">t4</span> [<span class="id">Ht34</span> | <span class="id">Ht34</span>]; <span class="id">constructor</span>; <span class="id">right</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_dvars_subst">lift_dvars_subst</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">vars</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id">k</span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vars</span>) -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> <span class="id">t</span>) <span class="id">vars</span> -&gt; <span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> <span class="id">k</span> (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span> <span class="id">k</span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">vars</span>))) <span class="id">t</span>) = <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">vars</span> <span class="id">k</span> <span class="id">t</span> <span class="id">Hdup</span>; <span class="id">revert</span> <span class="id">k</span>; <span class="id">induction</span> <span class="id">t</span> <span class="kwd">using</span> <span class="id"><a href="STerm.html#term_ind2">term_ind2</a></span>; <span class="id">intros</span> <span class="id">k</span> <span class="id">Hclosed</span> <span class="id">Hfree</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">unfold</span> <span class="id"><a href="STerm.html#read_env">read_env</a></span>, <span class="id"><a href="STerm.html#liftn_subst">liftn_subst</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#nth_error_map">nth_error_map</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>. <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">eqn</span>:<span class="id">Hnk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">erewrite</span> <span class="id"><a href="Misc.html#index_nth_error">index_nth_error</a></span>; [|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">Hnk</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hn</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hfree</span>; <span class="id">apply</span> <span class="id">Hfree</span> <span class="kwd">in</span> <span class="id">Hn</span>. <span class="id">inversion</span> <span class="id">Hn</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">rewrite</span> &lt;- <span class="id"><a href="STerm.html#liftn_subst_1_subst">liftn_subst_1_subst</a></span>, <span class="id"><a href="STerm.html#liftn_subst_add_subst">liftn_subst_add_subst</a></span>. <span class="id">simpl</span>. <span class="id">apply</span> <span class="id">IHt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">inversion</span> <span class="id">Hx</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>; <span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt1</span>|<span class="id">apply</span> <span class="id">IHt2</span>]; <span class="id">try</span> <span class="id">assumption</span>; <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; <span class="id">try</span> <span class="id">eassumption</span>; <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">inversion</span> <span class="id">Hx</span>; <span class="id">subst</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">f_equal</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>. <span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>; [<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_id">map_id</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">apply</span> <span class="id">H</span>; [<span class="id">assumption</span>| |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id">H3</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">inversion</span> <span class="id">Hx</span>; <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hclosed</span>; <span class="id">subst</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f_equal</span>; [<span class="id">apply</span> <span class="id">IHt</span>; [<span class="id">assumption</span>|<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]; <span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">inversion</span> <span class="id">Hx</span>; <span class="id">subst</span>; <span class="id">assumption</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_map">map_map</a></span>. <span class="id">erewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_ext_in">map_ext_in</a></span>; [<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_id">map_id</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p</span> <span class="id">t2</span>] <span class="id">Hpt2</span>. <span class="id">f_equal</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_subst_add_subst">liftn_subst_add_subst</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">Hpt2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">specialize</span> (<span class="id">H4</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hpt2</span>). <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Plus.html#plus_assoc">plus_assoc</a></span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="id">inversion</span> <span class="id">Hx</span>; <span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="id">apply</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">Hpt2</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_dvars_subst_0">lift_dvars_subst_0</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vars</span> <span class="id">t</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">vars</span> -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">vars</span>) -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> <span class="id">t</span>) <span class="id">vars</span> -&gt; <span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> <span class="id">vars</span> 0 (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">vars</span>)) <span class="id">t</span>) = <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">vars</span> <span class="id">t</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span>. <span class="id">assert</span> (<span class="id">H4</span> := <span class="id"><a href="Convert.html#lift_dvars_subst">lift_dvars_subst</a></span> <span class="id">vars</span> 0 <span class="id">t</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span>). <span class="id">rewrite</span> <span class="id"><a href="STerm.html#liftn_subst_0_subst">liftn_subst_0_subst</a></span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_dvars_subst_0_1">lift_dvars_subst_0_1</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span> <span class="id">t</span>, <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t</span> 1 -&gt; <span class="id"><a href="Convert.html#dvar_free">dvar_free</a></span> <span class="id">x</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#lift_dvars">lift_dvars</a></span> (<span class="id">x</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) 0 (<span class="id"><a href="STerm.html#subst">subst</a></span> (<span class="id"><a href="STerm.html#read_env">read_env</a></span> (<span class="id"><a href="STerm.html#dvar">dvar</a></span> <span class="id">x</span> :: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) <span class="id">t</span>) = <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">x</span> <span class="id">t</span> <span class="id">H1</span> <span class="id">H2</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#lift_dvars_subst_0">lift_dvars_subst_0</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; [|<span class="id">constructor</span>]. <span class="id">simpl</span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; [<span class="id">assumption</span>|<span class="id">constructor</span>].<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="cthread_wf">cthread_wf</a></span> <span class="id">st</span> (<span class="id">defs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="STerm.html#term">term</a></span>) : <span class="id"><a href="Convert.html#cthread">cthread</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="cthread_wf_done">cthread_wf_done</a></span> : <span class="kwd">forall</span> <span class="id">b</span>, <span class="id">cthread_wf</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id">b</span>)<br/>
| <span class="id"><a name="cthread_wf_and">cthread_wf_and</a></span> : <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c2</span>, <span class="id">cthread_wf</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> -&gt; <span class="id">cthread_wf</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c2</span> -&gt; <span class="id">cthread_wf</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_and">cthread_and</a></span> <span class="id">c1</span> <span class="id">c2</span>)<br/>
| <span class="id"><a name="cthread_wf_or">cthread_wf_or</a></span> : <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c2</span>, <span class="id">cthread_wf</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> -&gt; <span class="id">cthread_wf</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c2</span> -&gt; <span class="id">cthread_wf</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_or">cthread_or</a></span> <span class="id">c1</span> <span class="id">c2</span>)<br/>
| <span class="id"><a name="cthread_wf_reduce">cthread_wf_reduce</a></span> : <span class="kwd">forall</span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id">v</span>) <span class="id">varmap1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id">v</span>) <span class="id">varmap2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap1</span> -&gt; <span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">v1</span> <span class="id">t1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">v2</span> <span class="id">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cthread_wf</span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">v1</span> <span class="id">v2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cthread_andn_wf">cthread_andn_wf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">l</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Convert.html#cthread_wf">cthread_wf</a></span> <span class="id">st</span> <span class="id">defs</span>) <span class="id">l</span> -&gt; <span class="id"><a href="Convert.html#cthread_wf">cthread_wf</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_andn">cthread_andn</a></span> <span class="id">l</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">freename</span> <span class="id">defs</span> <span class="id">l</span> <span class="id">H</span>; <span class="id">induction</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="is_finished_read_thread">is_finished_read_thread</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">rid</span> <span class="id">v</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">t</span>, <span class="id"><a href="Convert.html#is_finished">is_finished</a></span> <span class="id">st</span> <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt; <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">rid</span> <span class="id">t</span> -&gt; <span class="id"><a href="Convert.html#read_val">read_val</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">v</span> <span class="id">t</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">rid</span> <span class="id">v</span> <span class="id">defs</span> <span class="id">varmap</span> <span class="id">t</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">unfold</span> <span class="id"><a href="Convert.html#is_finished">is_finished</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; [|<span class="id">congruence</span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">c</span>; <span class="id">try</span> <span class="id">congruence</span>. <span class="id">injection</span> <span class="id">H1</span> <span class="kwd">as</span> <span class="id">H1</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>. <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Forall_combine_lists">Forall_combine_lists</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>) (<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>) (<span class="id">Q</span> : <span class="id">B</span> -&gt; <span class="kwd">Prop</span>) <span class="id">l1</span> <span class="id">l2</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> <span class="id">l1</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">Q</span> <span class="id">l2</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">ab</span> =&gt; <span class="id">P</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ab</span>) /\ <span class="id">Q</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">ab</span>)) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#combine">combine</a></span> <span class="id">l1</span> <span class="id">l2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">revert</span> <span class="id">l2</span> <span class="id">H2</span>; <span class="id">induction</span> <span class="id">H1</span>; <span class="id">intros</span> <span class="id">l2</span> <span class="id">H2</span>; <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">simpl</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">split</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHForall</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cmp_cont_wf">cmp_cont_wf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id">v</span>) <span class="id">varmap1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id">v</span>) <span class="id">varmap2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">c1</span> <span class="id">h1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c2</span> <span class="id">h2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="Convert.html#cthread_wf">cthread_wf</a></span> <span class="id">st</span> <span class="id">defs</span>) <span class="id">l</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">l</span> <span class="id">Hdefs1</span> <span class="id">Hdefs2</span> <span class="id">Hok1</span> <span class="id">Hok2</span> <span class="id">Hlen</span> <span class="id">Hread1</span> <span class="id">Hread2</span> <span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">c2</span> <span class="id">h2</span> <span class="id">l</span> <span class="id">Hread2</span> <span class="id">Hcmp</span>; <span class="id">induction</span> <span class="id">Hread1</span>; <span class="id">intros</span> <span class="id">c2</span> <span class="id">h2</span> <span class="id">l</span> <span class="id">Hread2</span> <span class="id">Hcmp</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inversion</span> <span class="id">Hread2</span>; <span class="id">subst</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">injection</span> <span class="id">Hcmp</span> <span class="kwd">as</span> <span class="id">Hcmp</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">eqn</span>:<span class="id">Hcmp1</span>; [|<span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">injection</span> <span class="id">Hcmp</span> <span class="kwd">as</span> <span class="id">Hcmp</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econstructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHHread1</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb">Nat.eqb</a></span> <span class="id">eqn</span>:<span class="id">Heq</span>; [|<span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb">forallb</a></span> <span class="id">eqn</span>:<span class="id">Hforallb</span>; [|<span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">eqn</span>:<span class="id">Hcmp1</span>; [|<span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">injection</span> <span class="id">Hcmp</span> <span class="kwd">as</span> <span class="id">Hcmp</span>; <span class="id">subst</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>; [|<span class="id">eapply</span> <span class="id">IHHread1</span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb_forall">forallb_forall</a></span>, &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hforallb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span>, <span class="id"><a href="Misc.html#Forall2_select2">Forall2_select2</a></span> <span class="kwd">in</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> (<span class="id">_</span> &amp; <span class="id">Hpt1</span> &amp; <span class="id">_</span> &amp; <span class="id">_</span> &amp; <span class="id">Hpt2</span> &amp; <span class="id">Hpt3</span> &amp; <span class="id">_</span>); <span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#ex_intro">ex_intro</a></span> (<span class="kwd">fun</span> <span class="id">tdeep</span> =&gt; <span class="id">_</span>) <span class="id">tdeep</span> <span class="id">_</span>); <span class="id">exact</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Hpt1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Hpt2</span> <span class="id">Hpt3</span>))].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span>, <span class="id"><a href="Misc.html#Forall2_select2">Forall2_select2</a></span> <span class="kwd">in</span> <span class="id">H3</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> (<span class="id">_</span> &amp; <span class="id">Hpt1</span> &amp; <span class="id">_</span> &amp; <span class="id">_</span> &amp; <span class="id">Hpt2</span> &amp; <span class="id">Hpt3</span> &amp; <span class="id">_</span>); <span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#ex_intro">ex_intro</a></span> (<span class="kwd">fun</span> <span class="id">tdeep</span> =&gt; <span class="id">_</span>) <span class="id">tdeep</span> <span class="id">_</span>); <span class="id">exact</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Hpt1</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Hpt2</span> <span class="id">Hpt3</span>))].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">rewrite</span> &lt;- <span class="id"><a href="Misc.html#Forall_and">Forall_and</a></span>; <span class="id">split</span>; [<span class="id">apply</span> <span class="id">Hforallb</span>|<span class="id">apply</span> <span class="id"><a href="Convert.html#Forall_combine_lists">Forall_combine_lists</a></span>; <span class="id">eassumption</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">vdeeps1</span> <span class="id">vdeeps2</span>] (<span class="id">Heq1</span> &amp; (<span class="id">tdeep1</span> &amp; <span class="id">Hdeep1</span> &amp; <span class="id">Hvd1a</span> &amp; <span class="id">Hvd1b</span>) &amp; (<span class="id">tdeep2</span> &amp; <span class="id">Hdeep2</span> &amp; <span class="id">Hvd2a</span> &amp; <span class="id">Hvd2b</span>)). <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="id">split</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Convert.html#varmap_ok_app">varmap_ok_app</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Convert.html#varmap_ok_app">varmap_ok_app</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> !<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>. <span class="id">f_equal</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cmp_cont_cthread_wf">cmp_cont_cthread_wf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id">v</span>) <span class="id">varmap1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> &lt;= <span class="id">v</span>) <span class="id">varmap2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#varmap_ok">varmap_ok</a></span> (<span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>) <span class="id">varmap2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">varmap2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">c1</span> <span class="id">h1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c2</span> <span class="id">h2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#cthread_wf">cthread_wf</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cmp_cont_cthread">cmp_cont_cthread</a></span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#cmp_cont_cthread">cmp_cont_cthread</a></span>. <span class="id">destruct</span> <span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">eqn</span>:<span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#cthread_andn_wf">cthread_andn_wf</a></span>, <span class="id"><a href="Convert.html#cmp_cont_wf">cmp_cont_wf</a></span> <span class="kwd">with</span> (<span class="id">varmap1</span> := <span class="id">varmap1</span>) (<span class="id">varmap2</span> := <span class="id">varmap2</span>); <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cthread_red_wf">cthread_red_wf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id">ct2</span>, <span class="id"><a href="Convert.html#cthread_wf">cthread_wf</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct1</span> -&gt; <span class="id"><a href="Convert.html#cthread_red">cthread_red</a></span> <span class="id">st</span> <span class="id">ct1</span> <span class="id">ct2</span> -&gt; <span class="id"><a href="Convert.html#cthread_wf">cthread_wf</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id">ct2</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">induction</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>; <span class="id">try</span> (<span class="id">constructor</span>; <span class="id">tauto</span>).<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H10</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#is_finished_read_thread">is_finished_read_thread</a></span> <span class="kwd">in</span> <span class="id">H3</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H11</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#is_finished_read_thread">is_finished_read_thread</a></span> <span class="kwd">in</span> <span class="id">H3</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H9</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H10</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; [|<span class="id">assumption</span>]. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; [|<span class="id">assumption</span>]. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Convert.html#varmap_ok_cons">varmap_ok_cons</a></span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Convert.html#varmap_ok_cons">varmap_ok_cons</a></span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#cthread_andn_wf">cthread_andn_wf</a></span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H10</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H11</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="id">intros</span> [<span class="id">v1</span> <span class="id">v2</span>] <span class="id">Hv12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_In_left">Forall2_In_left</a></span> <span class="kwd">in</span> <span class="id">H12</span>; [|<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_combine_l">in_combine_l</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_In_left">Forall2_In_left</a></span> <span class="kwd">in</span> <span class="id">H13</span>; [|<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_combine_r">in_combine_r</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H12</span> <span class="kwd">as</span> (<span class="id">t1</span> &amp; <span class="id">Ht1a</span> &amp; <span class="id">Ht1b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H13</span> <span class="kwd">as</span> (<span class="id">t2</span> &amp; <span class="id">Ht2a</span> &amp; <span class="id">Ht2b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H9</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H12</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">try</span> <span class="id">eassumption</span>. <span class="id">apply</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H10</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H12</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">try</span> <span class="id">eassumption</span>. <span class="id">apply</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">H9</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H12</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H10</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H18</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">try</span> <span class="id">eassumption</span>; [<span class="id">apply</span> <span class="id">H11</span>|<span class="id">apply</span> <span class="id">H17</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">H9</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H10</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#cmp_cont_cthread_wf">cmp_cont_cthread_wf</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H10</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H11</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#cmp_cont_cthread_wf">cmp_cont_cthread_wf</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_cthread_andn_true">read_cthread_andn_true</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">l</span>, <span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_andn">cthread_andn</a></span> <span class="id">l</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">c</span> =&gt; <span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) <span class="id">l</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span>. <span class="id">induction</span> <span class="id">l</span>; <span class="id">split</span>; <span class="id">intros</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_cthread_andn_false">read_cthread_andn_false</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">l</span>, <span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cthread_andn">cthread_andn</a></span> <span class="id">l</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> &lt;-&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> (<span class="kwd">fun</span> <span class="id">c</span> =&gt; <span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="id">l</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span>. <span class="id">induction</span> <span class="id">l</span>; <span class="id">split</span>; <span class="id">intros</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_red_hole">hctx_red_hole</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> <span class="id">h</span> -&gt; <span class="id">h</span> = <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">H</span>. <span class="id">inversion</span> <span class="id">H</span>; <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_red_hole_star">hctx_red_hole_star</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span>) <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> <span class="id">h</span> -&gt; <span class="id">h</span> = <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h</span> <span class="id">H</span>. <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_preserve">star_preserve</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">h</span> = <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>) <span class="kwd">in</span> <span class="id">H</span>; [<span class="id">assumption</span>| |<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">subst</span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#hctx_red_hole">hctx_red_hole</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_red_app_star">hctx_red_app_star</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">t1</span> <span class="id">h</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span>) (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h1</span> <span class="id">t1</span>) <span class="id">h</span> -&gt; <span class="kwd">exists</span> <span class="id">h2</span> <span class="id">t2</span>, <span class="id">h</span> = <span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h2</span> <span class="id">t2</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span>) <span class="id">h1</span> <span class="id">h2</span> /\ <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">t1</span> <span class="id">h</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_preserve">star_preserve</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="kwd">exists</span> <span class="id">h2</span> <span class="id">t2</span>, <span class="id">h</span> = <span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h2</span> <span class="id">t2</span> /\ <span class="id">_</span> /\ <span class="id">_</span>); [| |<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">h3</span> <span class="id">h4</span> <span class="id">H34</span> (<span class="id">h2</span> &amp; <span class="id">t2</span> &amp; -&gt; &amp; <span class="id">Hh</span> &amp; <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H34</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eexists</span>; <span class="id">eexists</span>; <span class="id">split</span>; [<span class="id">reflexivity</span>|]. <span class="id">split</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [<span class="id">eassumption</span>|]. <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eexists</span>; <span class="id">eexists</span>; <span class="id">split</span>; [<span class="id">reflexivity</span>|]. <span class="id">split</span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [<span class="id">eassumption</span>|]. <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eexists</span>; <span class="id">eexists</span>; <span class="id">split</span>; [<span class="id">reflexivity</span>|]. <span class="id">split</span>; <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="hctx_conv">hctx_conv</a></span> <span class="id">defs</span> : <span class="id"><a href="Beta.html#hctx">hctx</a></span> -&gt; <span class="id"><a href="Beta.html#hctx">hctx</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id"><a name="hctx_conv_hole">hctx_conv_hole</a></span> : <span class="id">hctx_conv</span> <span class="id">defs</span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span><br/>
| <span class="id"><a name="hctx_conv_app">hctx_conv_app</a></span> : <span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id">hctx_conv</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id">hctx_conv</span> <span class="id">defs</span> (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h1</span> <span class="id">t1</span>) (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h2</span> <span class="id">t2</span>)<br/>
| <span class="id"><a name="hctx_conv_switch">hctx_conv_switch</a></span> : <span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">m1</span> <span class="id">m2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">hctx_conv</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2">Forall2</a></span> (<span class="kwd">fun</span> '(<span class="id">p1</span>, <span class="id">t1</span>) '(<span class="id">p2</span>, <span class="id">t2</span>) =&gt; <span class="id">p1</span> = <span class="id">p2</span> /\ <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span>) <span class="id">m1</span> <span class="id">m2</span> -&gt; <span class="id">hctx_conv</span> <span class="id">defs</span> (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h1</span> <span class="id">m1</span>) (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h2</span> <span class="id">m2</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_conv_refl">hctx_conv_refl</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h</span>, <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h</span> <span class="id">h</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h</span>; <span class="id">induction</span> <span class="id">h</span>; <span class="id">constructor</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_refl">convertible_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_map_same">Forall2_map_same</a></span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall_True">Forall_True</a></span>; <span class="id">intros</span> [<span class="id">p</span> <span class="id">t</span>]; <span class="id">simpl</span>; <span class="id">split</span>; [<span class="id">reflexivity</span>|<span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_refl">convertible_refl</a></span>].<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_conv_sym">hctx_conv_sym</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h2</span> <span class="id">h1</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">H</span>; <span class="id">induction</span> <span class="id">H</span>; <span class="id">constructor</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">try</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_sym">convertible_sym</a></span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_comm">Forall2_comm</a></span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p1</span> <span class="id">t1</span>] [<span class="id">p2</span> <span class="id">t2</span>] [<span class="id">H1</span> <span class="id">H2</span>]; <span class="id">simpl</span>; <span class="id">split</span>; [<span class="id">congruence</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_sym">convertible_sym</a></span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_conv_trans">hctx_conv_trans</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span>, <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h2</span> <span class="id">h3</span> -&gt; <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h3</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span> <span class="id">H12</span>; <span class="id">revert</span> <span class="id">h3</span>; <span class="id">induction</span> <span class="id">H12</span>; <span class="id">intros</span> <span class="id">h3</span> <span class="id">H23</span>; <span class="id">inversion</span> <span class="id">H23</span>; <span class="id">subst</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id">IHhctx_conv</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id">IHhctx_conv</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_comm">Forall2_comm</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id"><a href="Misc.html#Forall3_from_Forall2">Forall3_from_Forall2</a></span>; [|<span class="id">apply</span> <span class="id">H</span>|<span class="id">apply</span> <span class="id">H4</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p2</span> <span class="id">t2</span>] [<span class="id">p1</span> <span class="id">t1</span>] [<span class="id">p3</span> <span class="id">t3</span>] [[<span class="id">Heq12</span> <span class="id">Hconv12</span>] [<span class="id">Heq23</span> <span class="id">Hconv23</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">congruence</span>|]. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_red_is_conv">hctx_red_is_conv</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">H</span>. <span class="id">induction</span> <span class="id">H</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_refl">convertible_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_conv_refl">hctx_conv_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>. <span class="id">left</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_same">Forall2_map_same</a></span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall_True">Forall_True</a></span>; <span class="id">intros</span> [<span class="id">p</span> <span class="id">t</span>]; <span class="id">simpl</span>; <span class="id">split</span>; [<span class="id">reflexivity</span>|<span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_refl">convertible_refl</a></span>].<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_conv_refl">hctx_conv_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall2_app">Forall2_app</a></span>; [|<span class="id">constructor</span>]; <span class="id">try</span> (<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_same">Forall2_map_same</a></span>; <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall_True">Forall_True</a></span>; <span class="id">intros</span> [<span class="id">p3</span> <span class="id">t3</span>]; <span class="id">simpl</span>; <span class="id">split</span>; (<span class="id">reflexivity</span> || <span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_refl">convertible_refl</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>. <span class="id">left</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_star_red_is_conv">hctx_star_red_is_conv</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="Rewrite.html#star">star</a></span> (<span class="id"><a href="Convert.html#hctx_red">hctx_red</a></span> <span class="id">defs</span>) <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">H</span>. <span class="id">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_conv_refl">hctx_conv_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#hctx_conv_trans">hctx_conv_trans</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_red_is_conv">hctx_red_is_conv</a></span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_convertible_conv">hctx_convertible_conv</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#hctx_convertible">hctx_convertible</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> (<span class="id">h3</span> &amp; <span class="id">H1</span> &amp; <span class="id">H2</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_star_red_is_conv">hctx_star_red_is_conv</a></span> <span class="kwd">in</span> <span class="id">H1</span>, <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_conv_sym">hctx_conv_sym</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#hctx_conv_trans">hctx_conv_trans</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_conv_convertible">hctx_conv_convertible</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="Convert.html#hctx_convertible">hctx_convertible</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">H</span>. <span class="id">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="kwd">exists</span> <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>. <span class="id">split</span>; <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_refl">star_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">IHhctx_conv</span> <span class="kwd">as</span> (<span class="id">h3</span> &amp; <span class="id">H1</span> &amp; <span class="id">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#convertible_confluent_common_reduce">convertible_confluent_common_reduce</a></span> <span class="kwd">in</span> <span class="id">H0</span>; [|<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_iota_confluent">beta_iota_confluent</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">H3</span> &amp; <span class="id">H4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h3</span> <span class="id">t3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">constructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h</span> <span class="id">_</span>); [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">constructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">constructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h</span> <span class="id">_</span>); [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">constructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">IHhctx_conv</span> <span class="kwd">as</span> (<span class="id">h3</span> &amp; <span class="id">H1</span> &amp; <span class="id">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span> <span class="kwd">in</span> <span class="id">H0</span>; [<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_exists_Forall3">Forall2_exists_Forall3</a></span> <span class="kwd">in</span> <span class="id">H0</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">m3</span> &amp; <span class="id">Hm3</span>). <span class="kwd">exists</span> (<span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h3</span> <span class="id">m3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h</span> <span class="id">_</span>); [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">constructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_list">star_list</a></span> <span class="kwd">with</span> (<span class="id">RA</span> := <span class="kwd">fun</span> <span class="id">pt1</span> <span class="id">pt2</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt2</span> /\ <span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt1</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt2</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select13">Forall3_select13</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>; [|<span class="id">eassumption</span>]; <span class="id">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">Hxyz</span>; <span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> <span class="id">Hxyz</span>); <span class="id">shelve</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">l1</span> <span class="id">l2</span> [<span class="id">p1</span> <span class="id">t1</span>] [<span class="id">p2</span> <span class="id">t2</span>] [<span class="id">Hp</span> <span class="id">Ht</span>]; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">constructor</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h</span> <span class="id">_</span>); [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">constructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_list">star_list</a></span> <span class="kwd">with</span> (<span class="id">RA</span> := <span class="kwd">fun</span> <span class="id">pt1</span> <span class="id">pt2</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt1</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">pt2</span> /\ <span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt1</span>) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pt2</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select23">Forall3_select23</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>; [|<span class="id">eassumption</span>]; <span class="id">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">Hxyz</span>; <span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> <span class="id">Hxyz</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">l1</span> <span class="id">l2</span> [<span class="id">p1</span> <span class="id">t1</span>] [<span class="id">p2</span> <span class="id">t2</span>] [<span class="id">Hp</span> <span class="id">Ht</span>]; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subst</span>. <span class="id">constructor</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> [<span class="id">p1</span> <span class="id">t1</span>] [<span class="id">p2</span> <span class="id">t2</span>] [<span class="id">Hp</span> <span class="id">Hconv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#convertible_confluent_common_reduce">convertible_confluent_common_reduce</a></span> <span class="kwd">in</span> <span class="id">Hconv</span>; [|<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_iota_confluent">beta_iota_confluent</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hconv</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">Hconv1</span> &amp; <span class="id">Hconv2</span>); <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id">p2</span>, <span class="id">t3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_map_impl">star_map_impl</a></span> <span class="kwd">with</span> (<span class="id">f</span> := <span class="kwd">fun</span> <span class="id">t</span> =&gt; (<span class="id">p2</span>, <span class="id">t</span>)); <span class="id">try</span> <span class="id">eassumption</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">split</span>; <span class="id">try</span> <span class="id">reflexivity</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="hctx_length">hctx_length</a></span> <span class="id">h</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Beta.html#h_hole">h_hole</a></span> =&gt; 0<br/>
&nbsp;&nbsp;| <span class="id"><a href="Beta.html#h_app">h_app</a></span> <span class="id">h</span> <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">hctx_length</span> <span class="id">h</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Beta.html#h_switch">h_switch</a></span> <span class="id">h</span> <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">hctx_length</span> <span class="id">h</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_conv_length">hctx_conv_length</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="Convert.html#hctx_length">hctx_length</a></span> <span class="id">h1</span> = <span class="id"><a href="Convert.html#hctx_length">hctx_length</a></span> <span class="id">h2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">H</span>; <span class="id">induction</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_compose_length">hctx_compose_length</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="Convert.html#hctx_length">hctx_length</a></span> (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h1</span> <span class="id">h2</span>) = <span class="id"><a href="Convert.html#hctx_length">hctx_length</a></span> <span class="id">h1</span> + <span class="id"><a href="Convert.html#hctx_length">hctx_length</a></span> <span class="id">h2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">h1</span> <span class="id">h2</span>; <span class="id">induction</span> <span class="id">h1</span>; <span class="id">simpl</span>; <span class="id">lia</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_convertible_compose_r">hctx_convertible_compose_r</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span> <span class="id">h4</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#hctx_length">hctx_length</a></span> <span class="id">h1</span> = <span class="id"><a href="Convert.html#hctx_length">hctx_length</a></span> <span class="id">h2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h3</span> <span class="id">h1</span>) (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h4</span> <span class="id">h2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h3</span> <span class="id">h4</span> /\ <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span> <span class="id">h4</span> <span class="id">Hlen</span>; <span class="id">revert</span> <span class="id">h4</span>; <span class="id">induction</span> <span class="id">h3</span>; <span class="id">intros</span> <span class="id">h4</span> <span class="id">H</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">destruct</span> <span class="id">h4</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">split</span>; [<span class="id">constructor</span>|]. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_conv_length">hctx_conv_length</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">rewrite</span> <span class="id"><a href="Convert.html#hctx_compose_length">hctx_compose_length</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_conv_length">hctx_conv_length</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">rewrite</span> <span class="id"><a href="Convert.html#hctx_compose_length">hctx_compose_length</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_conv_length">hctx_conv_length</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">rewrite</span> <span class="id"><a href="Convert.html#hctx_compose_length">hctx_compose_length</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id">IHh3</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">tauto</span>]. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_conv_length">hctx_conv_length</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="id">rewrite</span> <span class="id"><a href="Convert.html#hctx_compose_length">hctx_compose_length</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id">IHh3</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">tauto</span>]. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hctx_convertible_compose">hctx_convertible_compose</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span> <span class="id">h4</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h3</span> <span class="id">h4</span> -&gt; <span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h3</span> <span class="id">h1</span>) (<span class="id"><a href="Beta.html#compose_hctx">compose_hctx</a></span> <span class="id">h4</span> <span class="id">h2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span> <span class="id">h4</span> <span class="id">H34</span> <span class="id">H12</span>; <span class="id">induction</span> <span class="id">H34</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cmp_cont_cthread_correct_None">cmp_cont_cthread_correct_None</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">h1</span> <span class="id">h2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">c1</span> <span class="id">h1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c2</span> <span class="id">h2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">Hread1</span> <span class="id">Hread2</span> <span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">c2</span> <span class="id">h2</span> <span class="id">Hread2</span> <span class="id">Hcmp</span>; <span class="id">induction</span> <span class="id">Hread1</span>; <span class="id">intros</span> <span class="id">c2</span> <span class="id">h2</span> <span class="id">Hread2</span> <span class="id">Hcmp</span>; <span class="id">inversion</span> <span class="id">Hread2</span>; <span class="id">subst</span>; <span class="id">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hcmp</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Hconv</span>; <span class="id">inversion</span> <span class="id">Hconv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">h</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Hconv</span>; <span class="id">inversion</span> <span class="id">Hconv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">h</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Hconv</span>; <span class="id">inversion</span> <span class="id">Hconv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">h</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Hconv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_convertible_compose_r">hctx_convertible_compose_r</a></span> <span class="kwd">in</span> <span class="id">Hconv</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">eqn</span>:<span class="id">Hcmp1</span>; [<span class="id">congruence</span>|]. <span class="id">eapply</span> <span class="id">IHHread1</span> <span class="kwd">in</span> <span class="id">Hcmp1</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Hconv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_convertible_compose_r">hctx_convertible_compose_r</a></span> <span class="kwd">in</span> <span class="id">Hconv</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hconv</span> <span class="kwd">as</span> [<span class="id">Hconv1</span> <span class="id">Hconv2</span>]; <span class="id">inversion</span> <span class="id">Hconv2</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Hconv</span>; <span class="id">inversion</span> <span class="id">Hconv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">h</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Hconv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_convertible_compose_r">hctx_convertible_compose_r</a></span> <span class="kwd">in</span> <span class="id">Hconv</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hconv</span> <span class="kwd">as</span> [<span class="id">Hconv1</span> <span class="id">Hconv2</span>]; <span class="id">inversion</span> <span class="id">Hconv2</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">Hconv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_convertible_compose_r">hctx_convertible_compose_r</a></span> <span class="kwd">in</span> <span class="id">Hconv</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hconv</span> <span class="kwd">as</span> [<span class="id">Hconv1</span> <span class="id">Hconv2</span>]; <span class="id">inversion</span> <span class="id">Hconv2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb">Nat.eqb</a></span> <span class="id">eqn</span>:<span class="id">Heq</span>; [|<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_neq">Nat.eqb_neq</a></span> <span class="kwd">in</span> <span class="id">Heq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb">forallb</a></span> <span class="id">eqn</span>:<span class="id">Hforallb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">destruct</span> <span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">eqn</span>:<span class="id">Hcmp1</span>; [<span class="id">congruence</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id">IHHread1</span> <span class="kwd">in</span> <span class="id">Hcmp1</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#not_true_iff_false">Bool.not_true_iff_false</a></span> <span class="kwd">in</span> <span class="id">Hforallb</span>. <span class="id">apply</span> <span class="id">Hforallb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb_forall">forallb_forall</a></span>, &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall_combine_from_Forall2">Forall_combine_from_Forall2</a></span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall_square">Forall_square</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id">H0</span>; <span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> <span class="id">Hpt</span>; <span class="id">exact</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> <span class="id">Hpt</span>)|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span>, <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id">H3</span>; <span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> <span class="id">Hpt</span>; <span class="id">exact</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> <span class="id">Hpt</span>)|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_left">Forall2_map_left</a></span>, <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span> <span class="kwd">in</span> <span class="id">H9</span>; <span class="id">apply</span> <span class="id">H9</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">vdeep1</span> <span class="id">vdeep2</span> ([<span class="id">p1</span> <span class="id">t1</span>] &amp; [<span class="id">p2</span> <span class="id">t2</span>] &amp; <span class="id">Hp1</span> &amp; <span class="id">Hp2</span> &amp; <span class="id">Hp</span> &amp; <span class="id">_</span>). <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_left">Forall2_map_left</a></span>, <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span> <span class="kwd">in</span> <span class="id">H9</span>; <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span>, <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H0</span>; [|<span class="id">intros</span>; <span class="id">exact</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span>, <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span>, <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H3</span>; [|<span class="id">intros</span>; <span class="id">exact</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congruence</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cmp_cont_cthread_correct_Some_false">cmp_cont_cthread_correct_Some_false</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">c1</span> <span class="id">h1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c2</span> <span class="id">h2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> (<span class="kwd">fun</span> <span class="id">c</span> =&gt; <span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ (<span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">l</span> <span class="id">Hread1</span> <span class="id">Hread2</span> <span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l</span> <span class="id">c2</span> <span class="id">h2</span> <span class="id">Hread2</span> <span class="id">Hcmp</span>; <span class="id">induction</span> <span class="id">Hread1</span>; <span class="id">intros</span> <span class="id">l</span> <span class="id">c2</span> <span class="id">h2</span> <span class="id">Hread2</span> <span class="id">Hcmp</span> <span class="id">Hexist</span>; <span class="id">inversion</span> <span class="id">Hread2</span>; <span class="id">subst</span>; <span class="id">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hcmp</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">injection</span> <span class="id">Hcmp</span> <span class="kwd">as</span> <span class="id">Hcmp</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Hexist</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">eqn</span>:<span class="id">Hcmp1</span>; [|<span class="id">congruence</span>]. <span class="id">injection</span> <span class="id">Hcmp</span> <span class="kwd">as</span> <span class="id">Hcmp</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hconv</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_convertible_compose_r">hctx_convertible_compose_r</a></span> <span class="kwd">in</span> <span class="id">Hconv</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hconv</span> <span class="kwd">as</span> [<span class="id">Hconv1</span> <span class="id">Hconv2</span>]; <span class="id">inversion</span> <span class="id">Hconv2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hexist</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>. <span class="id">specialize</span> (<span class="id">H10</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span> <span class="id">H0</span>). <span class="id">inversion</span> <span class="id">H10</span>; <span class="id">subst</span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHHread1</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">try</span> <span class="id">eassumption</span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb">Nat.eqb</a></span> <span class="id">eqn</span>:<span class="id">Heq</span>; [|<span class="id">congruence</span>]. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb">forallb</a></span> <span class="id">eqn</span>:<span class="id">Hforallb</span>; [|<span class="id">congruence</span>]. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb_forall">forallb_forall</a></span>, &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hforallb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_from_combine">Forall2_from_combine</a></span> <span class="kwd">in</span> <span class="id">Hforallb</span>; [|<span class="id">assumption</span>]. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hforallb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">eqn</span>:<span class="id">Hcmp1</span>; [|<span class="id">congruence</span>]. <span class="id">injection</span> <span class="id">Hcmp</span> <span class="kwd">as</span> <span class="id">Hcmp</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hconv</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_convertible_compose_r">hctx_convertible_compose_r</a></span> <span class="kwd">in</span> <span class="id">Hconv</span>; [|<span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hconv</span> <span class="kwd">as</span> [<span class="id">Hconv1</span> <span class="id">Hconv2</span>]; <span class="id">inversion</span> <span class="id">Hconv2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_app">Exists_app</a></span> <span class="kwd">in</span> <span class="id">Hexist</span>; <span class="id">destruct</span> <span class="id">Hexist</span> <span class="kwd">as</span> [<span class="id">Hexist</span> | <span class="id">Hexist</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_map">Exists_map</a></span> <span class="kwd">in</span> <span class="id">Hexist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_left">Forall2_map_left</a></span>, <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span> <span class="kwd">in</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span> <span class="kwd">in</span> <span class="id">H0</span>; [|<span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> (<span class="id">_</span> &amp; <span class="id">Hread</span> &amp; <span class="id">Hconv</span> &amp; <span class="id">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#ex_intro">ex_intro</a></span> (<span class="kwd">fun</span> <span class="id">tdeep</span> =&gt; <span class="id">_</span>) <span class="id">tdeep</span> <span class="id">_</span>); <span class="id">exact</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Hread</span> <span class="id">Hconv</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span> <span class="kwd">in</span> <span class="id">H3</span>; [|<span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> (<span class="id">_</span> &amp; <span class="id">Hread</span> &amp; <span class="id">Hconv</span> &amp; <span class="id">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#ex_intro">ex_intro</a></span> (<span class="kwd">fun</span> <span class="id">tdeep</span> =&gt; <span class="id">_</span>) <span class="id">tdeep</span> <span class="id">_</span>); <span class="id">exact</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Hread</span> <span class="id">Hconv</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_Exists_neg">Forall_Exists_neg</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall_combine_from_Forall2">Forall_combine_from_Forall2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall_square">Forall_square</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">vdeeps1</span> <span class="id">vdeeps2</span> ([<span class="id">p1</span> <span class="id">t1</span>] &amp; [<span class="id">p2</span> <span class="id">t2</span>] &amp; (<span class="id">tdeep1</span> &amp; <span class="id">Ht1a</span> &amp; <span class="id">Ht1b</span>) &amp; (<span class="id">tdeep2</span> &amp; <span class="id">Ht2a</span> &amp; <span class="id">Ht2b</span>) &amp; <span class="id">Hp</span> &amp; <span class="id">Hcv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hreadc</span>. <span class="id">inversion</span> <span class="id">Hreadc</span>; <span class="id">subst</span>. <span class="id">specialize</span> (<span class="id">H11</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Ht1a</span> <span class="id">Ht2a</span>). <span class="id">inversion</span> <span class="id">H11</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">H4</span>. <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_beta_betaiota">convertible_beta_betaiota</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [<span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_sym">convertible_sym</a></span>, <span class="id"><a href="Convert.html#convertible_beta_betaiota">convertible_beta_betaiota</a></span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHHread1</span> <span class="kwd">in</span> <span class="id">Hexist</span>; <span class="id">try</span> <span class="id">eassumption</span>. <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cmp_cont_cthread_correct_Some_true">cmp_cont_cthread_correct_Some_true</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">c1</span> <span class="id">h1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c2</span> <span class="id">h2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">c</span> =&gt; <span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#hctx_conv">hctx_conv</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">l</span> <span class="id">Hread1</span> <span class="id">Hread2</span> <span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l</span> <span class="id">c2</span> <span class="id">h2</span> <span class="id">Hread2</span> <span class="id">Hcmp</span>; <span class="id">induction</span> <span class="id">Hread1</span>; <span class="id">intros</span> <span class="id">l</span> <span class="id">c2</span> <span class="id">h2</span> <span class="id">Hread2</span> <span class="id">Hcmp</span> <span class="id">Hforall</span>; <span class="id">inversion</span> <span class="id">Hread2</span>; <span class="id">subst</span>; <span class="id">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hcmp</span>; <span class="id">try</span> <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">injection</span> <span class="id">Hcmp</span> <span class="kwd">as</span> <span class="id">Hcmp</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">eqn</span>:<span class="id">Hcmp1</span>; [|<span class="id">congruence</span>]. <span class="id">injection</span> <span class="id">Hcmp</span> <span class="kwd">as</span> <span class="id">Hcmp</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hforall</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_convertible_compose">hctx_convertible_compose</a></span>; [|<span class="id">constructor</span>; [<span class="id">constructor</span>|]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHHread1</span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">H4</span>; <span class="id">subst</span>. <span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span> <span class="id">H0</span>). <span class="id">inversion</span> <span class="id">H9</span>; <span class="id">subst</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb">Nat.eqb</a></span> <span class="id">eqn</span>:<span class="id">Heq</span>; [|<span class="id">congruence</span>]. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb">forallb</a></span> <span class="id">eqn</span>:<span class="id">Hforallb</span>; [|<span class="id">congruence</span>]. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#forallb_forall">forallb_forall</a></span>, &lt;- <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hforallb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_from_combine">Forall2_from_combine</a></span> <span class="kwd">in</span> <span class="id">Hforallb</span>; [|<span class="id">assumption</span>]. <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hforallb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">eqn</span>:<span class="id">Hcmp1</span>; [|<span class="id">congruence</span>]. <span class="id">injection</span> <span class="id">Hcmp</span> <span class="kwd">as</span> <span class="id">Hcmp</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_app_iff">Forall_app_iff</a></span> <span class="kwd">in</span> <span class="id">Hforall</span>; <span class="id">destruct</span> <span class="id">Hforall</span> <span class="kwd">as</span> [<span class="id">Hforall1</span> <span class="id">Hforall2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_convertible_compose">hctx_convertible_compose</a></span>; [|<span class="id">constructor</span>; [<span class="id">constructor</span>|]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHHread1</span> <span class="kwd">in</span> <span class="id">Hforall2</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span> <span class="kwd">in</span> <span class="id">Hforall1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall2_map_left">Forall2_map_left</a></span>, <span class="id"><a href="Misc.html#Forall2_map_right">Forall2_map_right</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span> <span class="kwd">in</span> <span class="id">H0</span>; [|<span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> (<span class="id">Hlen</span> &amp; <span class="id">Hread</span> &amp; <span class="id">Hconv</span> &amp; <span class="id">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#ex_intro">ex_intro</a></span> (<span class="kwd">fun</span> <span class="id">tdeep</span> =&gt; <span class="id">_</span>) <span class="id">tdeep</span> <span class="id">_</span>); <span class="id">exact</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Hlen</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Hread</span> <span class="id">Hconv</span>))].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span>, <span class="id"><a href="Misc.html#Forall2_comm">Forall2_comm</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall3_impl">Forall3_impl</a></span> <span class="kwd">in</span> <span class="id">H3</span>; [|<span class="id">intros</span> <span class="id">pt</span> <span class="id">vdeeps</span> <span class="id">tdeep</span> (<span class="id">Hlen</span> &amp; <span class="id">Hread</span> &amp; <span class="id">Hconv</span> &amp; <span class="id">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#ex_intro">ex_intro</a></span> (<span class="kwd">fun</span> <span class="id">tdeep</span> =&gt; <span class="id">_</span>) <span class="id">tdeep</span> <span class="id">_</span>); <span class="id">exact</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Hlen</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Hread</span> <span class="id">Hconv</span>))].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall3_select12">Forall3_select12</a></span>, <span class="id"><a href="Misc.html#Forall2_comm">Forall2_comm</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_from_combine">Forall2_from_combine</a></span> <span class="kwd">in</span> <span class="id">Hforall1</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall_square">Forall_square</a></span>; [<span class="id">eassumption</span>|<span class="id">eassumption</span>|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_and">Forall2_and</a></span>; [<span class="id">apply</span> <span class="id">Hforallb</span>|<span class="id">apply</span> <span class="id">Hforall1</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">p1</span> <span class="id">t1</span>] [<span class="id">p2</span> <span class="id">t2</span>] (<span class="id">vdeeps1</span> &amp; <span class="id">vdeeps2</span> &amp; (<span class="id">tdeep1</span> &amp; <span class="id">Hlen1</span> &amp; <span class="id">Ht1a</span> &amp; <span class="id">Ht1b</span>) &amp; (<span class="id">tdeep2</span> &amp; <span class="id">Hlen2</span> &amp; <span class="id">Ht2a</span> &amp; <span class="id">Ht2b</span>) &amp; (<span class="id">Hlen</span> &amp; <span class="id">Hreadc</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hreadc</span>; <span class="id">subst</span>. <span class="id">specialize</span> (<span class="id">H9</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Ht1a</span> <span class="id">Ht2a</span>). <span class="id">inversion</span> <span class="id">H9</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eqb_eq">Nat.eqb_eq</a></span> <span class="kwd">in</span> <span class="id">Hlen</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_beta_betaiota">convertible_beta_betaiota</a></span>; <span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_sym">convertible_sym</a></span>, <span class="id"><a href="Convert.html#convertible_beta_betaiota">convertible_beta_betaiota</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cmp_cont_cthread_correct">cmp_cont_cthread_correct</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap1</span> <span class="id">c1</span> <span class="id">h1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cont">read_cont</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">varmap2</span> <span class="id">c2</span> <span class="id">h2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> (<span class="id"><a href="Convert.html#cmp_cont_cthread">cmp_cont_cthread</a></span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span>) <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Misc.html#reflect">reflect</a></span> (<span class="id"><a href="Convert.html#hctx_convertible">hctx_convertible</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span>) <span class="id">b</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">varmap1</span> <span class="id">varmap2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">b</span> <span class="id">Hread1</span> <span class="id">Hread2</span> <span class="id">Hread</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#cmp_cont_cthread">cmp_cont_cthread</a></span> <span class="kwd">in</span> <span class="id">Hread</span>. <span class="id">destruct</span> <span class="id"><a href="Convert.html#cmp_cont">cmp_cont</a></span> <span class="id">eqn</span>:<span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_conv_convertible">hctx_conv_convertible</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#cmp_cont_cthread_correct_Some_true">cmp_cont_cthread_correct_Some_true</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#read_cthread_andn_true">read_cthread_andn_true</a></span> <span class="kwd">in</span> <span class="id">Hread</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="id">intros</span> <span class="id">Hconv</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_convertible_conv">hctx_convertible_conv</a></span> <span class="kwd">in</span> <span class="id">Hconv</span>; <span class="id">revert</span> <span class="id">Hconv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#cmp_cont_cthread_correct_Some_false">cmp_cont_cthread_correct_Some_false</a></span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#read_cthread_andn_false">read_cthread_andn_false</a></span> <span class="kwd">in</span> <span class="id">Hread</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hread</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hconv</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#hctx_convertible_conv">hctx_convertible_conv</a></span> <span class="kwd">in</span> <span class="id">Hconv</span>; <span class="id">revert</span> <span class="id">Hconv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#cmp_cont_cthread_correct_None">cmp_cont_cthread_correct_None</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="convertible_fill_betaiota">convertible_fill_betaiota</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">t1</span> <span class="id">t2</span>, <span class="id"><a href="Convert.html#hctx_convertible">hctx_convertible</a></span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span> -&gt; <span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h1</span> <span class="id">t1</span>) (<span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h2</span> <span class="id">t2</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Hh</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hh</span> <span class="kwd">as</span> (<span class="id">h3</span> &amp; <span class="id">Hh1</span> &amp; <span class="id">Hh2</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#convertible_confluent_common_reduce">convertible_confluent_common_reduce</a></span> <span class="kwd">in</span> <span class="id">Ht</span>; [|<span class="id">apply</span> <span class="id"><a href="Beta.html#beta_iota_confluent">beta_iota_confluent</a></span>].<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">Ht1</span> &amp; <span class="id">Ht2</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#common_reduce_convertible">common_reduce_convertible</a></span> <span class="kwd">with</span> (<span class="id">z</span> := <span class="id"><a href="Beta.html#fill_hctx">fill_hctx</a></span> <span class="id">h3</span> <span class="id">t3</span>); <span class="id">apply</span> <span class="id"><a href="Convert.html#fill_hctx_star">fill_hctx_star</a></span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cthread_red_correct">cthread_red_correct</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id">ct2</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_wf">defs_wf</a></span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#cthread_wf">cthread_wf</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#cthread_red">cthread_red</a></span> <span class="id">st</span> <span class="id">ct1</span> <span class="id">ct2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct2</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id">b</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id">ct2</span> <span class="id">b</span> <span class="id">Hdefs</span> <span class="id">Hwf</span> <span class="id">H1</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H2</span>; <span class="id">induction</span> <span class="id">H1</span>; <span class="id">intros</span> <span class="id">H2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>. <span class="id">apply</span> <span class="id">H6</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#is_finished_read_thread">is_finished_read_thread</a></span> <span class="kwd">in</span> <span class="id">H3</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>. <span class="id">apply</span> <span class="id">H6</span>; [<span class="id">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#is_finished_read_thread">is_finished_read_thread</a></span> <span class="kwd">in</span> <span class="id">H3</span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#cthread_red_wf">cthread_red_wf</a></span> <span class="kwd">in</span> <span class="id">Hwf</span>; [|<span class="id">constructor</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t3</span> <span class="id">t4</span> <span class="id">Ht3</span> <span class="id">Ht4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Ht3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Ht4</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H5</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H6</span> <span class="id">H10</span>). <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#reflect_iff">reflect_iff</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Convert.html#convertible_abs_iff">convertible_abs_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etransitivity</span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#convertible_convertible_left">convertible_convertible_left</a></span>, <span class="id"><a href="Convert.html#convertible_beta_betaiota">convertible_beta_betaiota</a></span>, <span class="id">H7</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etransitivity</span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#convertible_convertible_right">convertible_convertible_right</a></span>, <span class="id"><a href="Convert.html#convertible_beta_betaiota">convertible_beta_betaiota</a></span>, <span class="id">H14</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">intros</span> <span class="id">t3</span> <span class="id">t4</span> <span class="id">Ht3</span> <span class="id">Ht4</span>. <span class="id">inversion</span> <span class="id">Ht3</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Ht4</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#reflect_iff">reflect_iff</a></span>; [<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_constr_iff">convertible_constr_iff</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#reflect_iff">reflect_iff</a></span>; [<span class="id">split</span>; [<span class="id">intros</span> [<span class="id">Heq</span> <span class="id">Hconv</span>]; <span class="id">exact</span> <span class="id">Hconv</span>|<span class="id">tauto</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">b</span>; <span class="id">constructor</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="Convert.html#read_cthread_andn_true">read_cthread_andn_true</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">rewrite</span> <span class="id"><a href="Misc.html#Forall_map">Forall_map</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_from_combine">Forall2_from_combine</a></span> <span class="kwd">in</span> <span class="id">H2</span>; [|<span class="id">assumption</span>]; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall_square">Forall_square</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> (<span class="id">v1</span> &amp; <span class="id">v2</span> &amp; (<span class="id">Hread1</span> &amp; <span class="id">Hread2</span> &amp; <span class="id">Hread</span>)). <span class="id">inversion</span> <span class="id">Hread</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hread1</span> <span class="id">Hread2</span>). <span class="id">inversion</span> <span class="id">H8</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="Convert.html#read_cthread_andn_false">read_cthread_andn_false</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_map">Exists_map</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#Exists_neg_Forall2">Exists_neg_Forall2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Exists_impl">Exists_impl</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Misc.html#Exists_square">Exists_square</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">t1</span> <span class="id">t2</span>] (<span class="id">v1</span> &amp; <span class="id">v2</span> &amp; (<span class="id">Hread1</span> &amp; <span class="id">Hread2</span> &amp; <span class="id">Hread</span>)). <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">inversion</span> <span class="id">Hread</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H8</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hread1</span> <span class="id">Hread2</span>). <span class="id">inversion</span> <span class="id">H8</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>; <span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="Convert.html#convertible_constr_iff">convertible_constr_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> [<span class="id">_</span> <span class="id">Hconv</span>]. <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">H5</span>, <span class="id">H10</span>, <span class="id">Hconv</span>. <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>; <span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">rewrite</span> <span class="id"><a href="Convert.html#convertible_constr_iff">convertible_constr_iff</a></span>. <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>; <span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#abs_constr_not_convertible">abs_constr_not_convertible</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>; <span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#constr_abs_not_convertible">constr_abs_not_convertible</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H6</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#reflect_iff">reflect_iff</a></span>; [|<span class="id">apply</span> <span class="id">H5</span>; [<span class="id">apply</span> <span class="id">H4</span>|<span class="id">apply</span> <span class="id">Ht2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_convertible_left">convertible_convertible_left</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">apply</span> <span class="id">H4</span>]; <span class="id">intros</span> <span class="id">u1</span> <span class="id">u2</span> [<span class="id">Hu</span> | <span class="id">Hu</span>]; [<span class="id">left</span> | <span class="id">right</span>]; <span class="id">right</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>. <span class="id">left</span>. <span class="id">left</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#iota_hctx">iota_hctx</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>; [<span class="id">constructor</span>; [<span class="id">congruence</span>|<span class="id">tauto</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hx</span>. <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H11</span>. <span class="id">apply</span> <span class="id">H11</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H6</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#reflect_iff">reflect_iff</a></span>; [|<span class="id">apply</span> <span class="id">H5</span>; [<span class="id">apply</span> <span class="id">Ht1</span>|<span class="id">apply</span> <span class="id">H4</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_convertible_right">convertible_convertible_right</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">apply</span> <span class="id">H4</span>]; <span class="id">intros</span> <span class="id">u1</span> <span class="id">u2</span> [<span class="id">Hu</span> | <span class="id">Hu</span>]; [<span class="id">left</span> | <span class="id">right</span>]; <span class="id">right</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>. <span class="id">left</span>. <span class="id">left</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#iota_hctx">iota_hctx</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>; [<span class="id">constructor</span>; [<span class="id">congruence</span>|<span class="id">tauto</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hx</span>. <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H12</span>. <span class="id">apply</span> <span class="id">H12</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">H1</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H8</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H12</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#reflect_iff">reflect_iff</a></span>; [|<span class="id">apply</span> <span class="id">H7</span>; [<span class="id">apply</span> <span class="id">H9</span>|<span class="id">apply</span> <span class="id">H16</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_convertible_leftright">convertible_convertible_leftright</a></span>; <span class="id">try</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">apply</span> <span class="id">H9</span>]; <span class="id">intros</span> <span class="id">u1</span> <span class="id">u2</span> [<span class="id">Hu</span> | <span class="id">Hu</span>]; [<span class="id">left</span> | <span class="id">right</span>]; <span class="id">right</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>. <span class="id">left</span>. <span class="id">left</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#iota_hctx">iota_hctx</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>; [<span class="id">constructor</span>; [<span class="id">congruence</span>|<span class="id">tauto</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hx</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H19</span>. <span class="id">apply</span> <span class="id">H19</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">apply</span> <span class="id">H16</span>]; <span class="id">intros</span> <span class="id">u1</span> <span class="id">u2</span> [<span class="id">Hu</span> | <span class="id">Hu</span>]; [<span class="id">left</span> | <span class="id">right</span>]; <span class="id">right</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>. <span class="id">left</span>. <span class="id">left</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#iota_hctx">iota_hctx</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>; [<span class="id">constructor</span>; [<span class="id">congruence</span>|<span class="id">tauto</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hx</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H20</span>. <span class="id">apply</span> <span class="id">H20</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H7</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H11</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#reflect_iff">reflect_iff</a></span>; [|<span class="id">apply</span> <span class="id">H6</span>; [<span class="id">apply</span> <span class="id">H8</span>|<span class="id">apply</span> <span class="id">H15</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_convertible_leftright">convertible_convertible_leftright</a></span>; <span class="id">try</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">apply</span> <span class="id">H8</span>]; <span class="id">intros</span> <span class="id">u1</span> <span class="id">u2</span> [<span class="id">Hu</span> | <span class="id">Hu</span>]; [<span class="id">left</span> | <span class="id">right</span>]; <span class="id">right</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>. <span class="id">left</span>. <span class="id">left</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#iota_hctx">iota_hctx</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>; [<span class="id">constructor</span>; [<span class="id">congruence</span>|<span class="id">tauto</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hx</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H18</span>. <span class="id">apply</span> <span class="id">H18</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_compose">star_compose</a></span>; [|<span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">apply</span> <span class="id">H15</span>]; <span class="id">intros</span> <span class="id">u1</span> <span class="id">u2</span> [<span class="id">Hu</span> | <span class="id">Hu</span>]; [<span class="id">left</span> | <span class="id">right</span>]; <span class="id">right</span>; <span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_1">star_1</a></span>. <span class="id">left</span>. <span class="id">left</span>. <span class="id">apply</span> <span class="id"><a href="Convert.html#iota_hctx">iota_hctx</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>; [<span class="id">constructor</span>; [<span class="id">congruence</span>|<span class="id">tauto</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hx</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H19</span>. <span class="id">apply</span> <span class="id">H19</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#cmp_cont_cthread_correct">cmp_cont_cthread_correct</a></span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="id">try</span> <span class="id">eassumption</span>. <span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_fill_betaiota">convertible_fill_betaiota</a></span>; [<span class="id">assumption</span>|]. <span class="id">apply</span> <span class="id"><a href="Rewrite.html#star_same">star_same</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">x</span> &lt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span>) <span class="kwd">by</span> (<span class="id">inversion</span> <span class="id">H6</span>; <span class="id">subst</span>; <span class="id">eapply</span> <span class="id"><a href="Misc.html#nth_error_Some3">nth_error_Some3</a></span>; <span class="id">symmetry</span>; <span class="id">eassumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> !<span class="id"><a href="Misc.html#index_notin_None">index_notin_None</a></span>; [<span class="id">reflexivity</span>| |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">intros</span> <span class="id">Hx</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H15</span>. <span class="id">apply</span> <span class="id">H15</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">intros</span> <span class="id">Hx</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H14</span>. <span class="id">apply</span> <span class="id">H14</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>. <span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#reflect_iff">reflect_iff</a></span>; [<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_neutral_iff">convertible_neutral_iff</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>; <span class="id">destruct</span> (<span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap1</span> <span class="id">x1</span>); <span class="id">simpl</span>; [<span class="id">tauto</span>|]. <span class="id">inversion</span> <span class="id">H6</span>; <span class="id">subst</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>; <span class="id">destruct</span> (<span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap2</span> <span class="id">x2</span>); <span class="id">simpl</span>; [<span class="id">tauto</span>|]. <span class="id">inversion</span> <span class="id">H10</span>; <span class="id">subst</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Misc.html#reflect_iff">reflect_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">split</span>; [<span class="id">intros</span> [<span class="id">_</span> <span class="id">Hctx</span>]; <span class="id">exact</span> <span class="id">Hctx</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">Hctx</span>; <span class="id">split</span>; [|<span class="id">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H6</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H10</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">symmetry</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="id">apply</span> <span class="id">H9</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">apply</span> <span class="id">H13</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Misc.html#index">index</a></span> <span class="id">eqn</span>:<span class="id">Hidx1</span>; <span class="id">rewrite</span> &lt;- <span class="id">H</span>; [<span class="id">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#index_in_not_None">index_in_not_None</a></span> <span class="kwd">in</span> <span class="id">Hidx1</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eapply</span> <span class="id"><a href="Convert.html#cmp_cont_cthread_correct">cmp_cont_cthread_correct</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>. <span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="Convert.html#convertible_neutral_iff">convertible_neutral_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">intros</span> [<span class="id">Heq</span> <span class="id">Hconv</span>]. <span class="id">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap1</span> <span class="id">x1</span>); <span class="id">destruct</span> (<span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap2</span> <span class="id">x2</span>); <span class="id">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap1</span> <span class="id">x1</span>); <span class="id">simpl</span>; [<span class="id">tauto</span>|]. <span class="id">inversion</span> <span class="id">H6</span>; <span class="id">subst</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">destruct</span> (<span class="id"><a href="Misc.html#index">index</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.eq_dec">Nat.eq_dec</a></span> <span class="id">varmap2</span> <span class="id">x2</span>); <span class="id">simpl</span>; [<span class="id">tauto</span>|]. <span class="id">inversion</span> <span class="id">H10</span>; <span class="id">subst</span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>. <span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#abs_neutral_not_convertible">abs_neutral_not_convertible</a></span>. <span class="id">destruct</span> <span class="id"><a href="Misc.html#index">index</a></span>; <span class="id">simpl</span>; [<span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H9</span>; <span class="id">subst</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>. <span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#constr_neutral_not_convertible">constr_neutral_not_convertible</a></span>. <span class="id">destruct</span> <span class="id"><a href="Misc.html#index">index</a></span>; <span class="id">simpl</span>; [<span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H6</span>; <span class="id">subst</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>. <span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#neutral_abs_not_convertible">neutral_abs_not_convertible</a></span>. <span class="id">destruct</span> <span class="id"><a href="Misc.html#index">index</a></span>; <span class="id">simpl</span>; [<span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H5</span>; <span class="id">subst</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>. <span class="id">inversion</span> <span class="id">Ht1</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">Ht2</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#neutral_constr_not_convertible">neutral_constr_not_convertible</a></span>. <span class="id">destruct</span> <span class="id"><a href="Misc.html#index">index</a></span>; <span class="id">simpl</span>; [<span class="id">tauto</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H5</span>; <span class="id">subst</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H2</span>; <span class="id">subst</span>; <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="read_cthread_step_r">read_cthread_step_r</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">ct</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_wf">defs_wf</a></span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span> <span class="id">defs</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#state_wf">state_wf</a></span> <span class="id">st</span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#cthread_wf">cthread_wf</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">defs</span> <span class="id">ct</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct</span> <span class="id">b</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">ct</span> <span class="id">b</span> <span class="id">Hdefswf</span> <span class="id">Hdefsok</span> <span class="id">Hstwf</span> <span class="id">Hwf</span> <span class="id">Hread</span>. <span class="id">induction</span> <span class="id">Hread</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>. <span class="id">constructor</span>; <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="id">intros</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">Ht1</span> <span class="id">Ht2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hwf</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#step_r_correct_val">step_r_correct_val</a></span> <span class="kwd">in</span> <span class="id">Ht1</span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#step_r_correct_val">step_r_correct_val</a></span> <span class="kwd">in</span> <span class="id">Ht2</span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ht1</span> <span class="kwd">as</span> (<span class="id">t5</span> &amp; <span class="id">Hread5</span> &amp; <span class="id">Ht15</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Ht2</span> <span class="kwd">as</span> (<span class="id">t6</span> &amp; <span class="id">Hread6</span> &amp; <span class="id">Ht26</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hread5</span> <span class="id">Hread6</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#reflect_iff">reflect_iff</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#convertible_convertible_leftright">convertible_convertible_leftright</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Rewrite.html#star_impl">star_impl</a></span>; [|<span class="id">eassumption</span>]. <span class="id">intros</span>; <span class="id">constructor</span>; <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cthread_wf_step_r">cthread_wf_step_r</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">ct</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_wf">defs_wf</a></span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span> <span class="id">defs</span> <span class="id">st</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#state_wf">state_wf</a></span> <span class="id">st</span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#cthread_wf">cthread_wf</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">ct</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#cthread_wf">cthread_wf</a></span> (<span class="id"><a href="Convert.html#step_r">step_r</a></span> <span class="id">st</span> <span class="id">rid</span>) <span class="id">defs</span> <span class="id">ct</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs</span> <span class="id">rid</span> <span class="id">ct</span> <span class="id">Hdefswf</span> <span class="id">Hdefsok</span> <span class="id">Hstwf</span> <span class="id">Hwf</span>. <span class="id">induction</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#step_r_correct_val">step_r_correct_val</a></span> <span class="kwd">in</span> <span class="id">H4</span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> (<span class="id">t3</span> &amp; <span class="id">Ht3</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#step_r_correct_val">step_r_correct_val</a></span> <span class="kwd">in</span> <span class="id">H5</span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">H5</span> <span class="kwd">as</span> (<span class="id">t4</span> &amp; <span class="id">Ht4</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">split</span>; [|<span class="id">apply</span> <span class="id">H1</span>]. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">apply</span> <span class="id">H1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Lt.html#lt_le_trans">lt_le_trans</a></span>; [<span class="id">eassumption</span>|<span class="id">apply</span> <span class="id"><a href="Convert.html#step_r_freename">step_r_freename</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">split</span>; [|<span class="id">apply</span> <span class="id">H2</span>]. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#Forall_impl">Forall_impl</a></span>; [|<span class="id">apply</span> <span class="id">H2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Lt.html#lt_le_trans">lt_le_trans</a></span>; [<span class="id">eassumption</span>|<span class="id">apply</span> <span class="id"><a href="Convert.html#step_r_freename">step_r_freename</a></span>].<br/>
Qed.</details>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="complete_wf">complete_wf</a></span> <span class="id">defs</span> <span class="id">ctst</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_wf">defs_wf</a></span> <span class="id">defs</span> /\ <span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span> <span class="id">defs</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">ctst</span>) /\ <span class="id"><a href="Convert.html#state_wf">state_wf</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">ctst</span>) <span class="id">defs</span> /\ <span class="id"><a href="Convert.html#cthread_wf">cthread_wf</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">ctst</span>) <span class="id">defs</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ctst</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="step_wf">step_wf</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ctst1</span> <span class="id">ctst2</span> <span class="id">defs</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#step">step</a></span> <span class="id">ctst1</span> <span class="id">ctst2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#complete_wf">complete_wf</a></span> <span class="id">defs</span> <span class="id">ctst1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#complete_wf">complete_wf</a></span> <span class="id">defs</span> <span class="id">ctst2</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">ctst1</span> <span class="id">ctst2</span> <span class="id">defs</span> <span class="id">Hstep</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;- <span class="id">unfold</span> <span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span>. <span class="id">eapply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Le.html#le_trans">le_trans</a></span>; [<span class="id">apply</span> <span class="id">Hwf</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hstep</span>; <span class="id">subst</span>; <span class="id">simpl</span>; [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#step_r_freename">step_r_freename</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hstep</span>; <span class="id">subst</span>; <span class="id">simpl</span>; [|<span class="id">apply</span> <span class="id">Hwf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#state_wf_preserve">state_wf_preserve</a></span>; <span class="id">apply</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;- <span class="id">inversion</span> <span class="id">Hstep</span>; <span class="id">subst</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Convert.html#cthread_wf_step_r">cthread_wf_step_r</a></span>; <span class="id">apply</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#cthread_red_wf">cthread_red_wf</a></span>; [|<span class="id">eassumption</span>]. <span class="id">apply</span> <span class="id">Hwf</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="step_correct">step_correct</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id">ct2</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#complete_wf">complete_wf</a></span> <span class="id">defs</span> (<span class="id">ct1</span>, <span class="id">st1</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#step">step</a></span> (<span class="id">ct1</span>, <span class="id">st1</span>) (<span class="id">ct2</span>, <span class="id">st2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">ct2</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st1</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id">b</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st1</span> <span class="id">st2</span> <span class="id">defs</span> <span class="id">ct1</span> <span class="id">ct2</span> <span class="id">b</span> <span class="id">Hwf</span> <span class="id">Hstep</span> <span class="id">Hread</span>.<br/>
&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hstep</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_cthread_step_r">read_cthread_step_r</a></span>; <span class="id">try</span> <span class="id">eassumption</span>; <span class="id">apply</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#cthread_red_correct">cthread_red_correct</a></span>; <span class="id">try</span> <span class="id">eassumption</span>; <span class="id">apply</span> <span class="id">Hwf</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="star_step_correct">star_step_correct</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ctst1</span> <span class="id">ctst2</span> <span class="id">defs</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#complete_wf">complete_wf</a></span> <span class="id">defs</span> <span class="id">ctst1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Convert.html#step">step</a></span> <span class="id">ctst1</span> <span class="id">ctst2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">ctst2</span>) <span class="id">defs</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ctst2</span>) <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">ctst1</span>) <span class="id">defs</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">ctst1</span>) <span class="id">b</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">ctst1</span> <span class="id">ctst2</span> <span class="id">defs</span> <span class="id">b</span> <span class="id">Hwf</span> <span class="id">Hstep</span> <span class="id">Hread</span>.<br/>
&nbsp;&nbsp;<span class="id">induction</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> <span class="id">x</span>, <span class="id">y</span>, <span class="id">z</span>; <span class="id">simpl</span> <span class="kwd">in</span> *. <span class="id">apply</span> <span class="id">IHHstep</span> <span class="kwd">in</span> <span class="id">Hread</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#step_correct">step_correct</a></span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Convert.html#step_wf">step_wf</a></span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="init_conv">init_conv</a></span> (<span class="id">defs</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="STerm.html#term">term</a></span>) (<span class="id">t1</span> <span class="id">t2</span> : <span class="id"><a href="STerm.html#term">term</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">st</span>, <span class="id">vs</span>) := <span class="id"><a href="Convert.html#init_all">init_all</a></span> {| <span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> ; <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span> |} <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id">defs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">st1</span>, <span class="id">v1</span>) := <span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="id">st</span> (<span class="id"><a href="Convert.html#init_at">init_at</a></span> 0 <span class="id">t1</span>) <span class="id">vs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">st2</span>, <span class="id">v2</span>) := <span class="id"><a href="Convert.html#makelazy">makelazy</a></span> <span class="id">st1</span> (<span class="id"><a href="Convert.html#init_at">init_at</a></span> 0 <span class="id">t2</span>) <span class="id">vs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;(<span class="id"><a href="Convert.html#cthread_reduce">cthread_reduce</a></span> <span class="id">v1</span> <span class="id">v2</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id">st2</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_all_freename">init_all_freename</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">defs2</span>, <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#init_all">init_all</a></span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">defs2</span>)) = <span class="id"><a href="Convert.html#st_freename">st_freename</a></span> <span class="id">st</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">defs2</span>; <span class="id">revert</span> <span class="id">st</span> <span class="id">defs1</span>; <span class="id">induction</span> <span class="id">defs2</span>; <span class="id">intros</span> <span class="id">st</span> <span class="id">defs1</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">rewrite</span> <span class="id">IHdefs2</span>. <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_all_incl">init_all_incl</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">defs2</span> <span class="id">v</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">defs1</span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#init_all">init_all</a></span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">defs2</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">defs2</span> <span class="id">v</span>. <span class="id">revert</span> <span class="id">st</span> <span class="id">defs1</span>; <span class="id">induction</span> <span class="id">defs2</span>; <span class="id">intros</span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">H</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">apply</span> <span class="id">IHdefs2</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>; <span class="id">tauto</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_all_new_threads">init_all_new_threads</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">defs2</span> <span class="id">rid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>) <span class="id">rid</span> = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="Convert.html#init_all">init_all</a></span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">defs2</span>))) <span class="id">rid</span> &lt;&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">x</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="Convert.html#Neutral">Neutral</a></span> (<span class="id">x</span>, <span class="id"><a href="Convert.html#Kid">Kid</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Convert.html#Thread">Thread</a></span> <span class="id">rid</span>))) (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="Convert.html#init_all">init_all</a></span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">defs2</span>)).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">defs2</span> <span class="id">rid</span>; <span class="id">revert</span> <span class="id">st</span> <span class="id">defs1</span>; <span class="id">induction</span> <span class="id">defs2</span>; <span class="id">intros</span> <span class="id">st</span> <span class="id">defs1</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> (<span class="id"><a href="Convert.html#extend_rthread">extend_rthread</a></span> <span class="id">st</span> {| <span class="id"><a href="Convert.html#rt_code">rt_code</a></span> := <span class="id"><a href="Convert.html#Term">Term</a></span> (<span class="id"><a href="Convert.html#init_at">init_at</a></span> 0 <span class="id">a</span>) <span class="id">defs1</span>; <span class="id"><a href="Convert.html#rt_cont">rt_cont</a></span> := <span class="id"><a href="Convert.html#Kid">Kid</a></span> |})) <span class="id">rid</span>) <span class="id">eqn</span>:<span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>; [|<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span>; <span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">_</span> - <span class="id">_</span>) <span class="kwd">as</span> [|<span class="id">n</span>] <span class="id">eqn</span>:<span class="id">Hn</span>; [|<span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> <span class="id">rid</span> <span class="kwd">with</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st</span>)) <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#init_all_incl">init_all_incl</a></span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">left</span>. <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id">IHdefs2</span>; <span class="id">eassumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="init_conv_correct">init_conv_correct</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">st</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_wf">defs_wf</a></span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t1</span> 0 -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t2</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span>) <span class="id">t1</span> -&gt; <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span>) <span class="id">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#init_conv">init_conv</a></span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> = (<span class="id">c</span>, <span class="id">st</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#complete_wf">complete_wf</a></span> <span class="id">defs</span> (<span class="id">c</span>, <span class="id">st</span>) /\ (<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="Convert.html#read_cthread">read_cthread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id">c</span> <span class="id">b</span> -&gt; <span class="id"><a href="Misc.html#reflect">reflect</a></span> (<span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span>) <span class="id">b</span>).<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">st</span> <span class="id">c</span> <span class="id">Hdefswf</span> <span class="id">Hclosed1</span> <span class="id">Hclosed2</span> <span class="id">Hbelow1</span> <span class="id">Hbelow2</span> <span class="id">Hcv</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Convert.html#init_conv">init_conv</a></span> <span class="kwd">in</span> <span class="id">Hcv</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Convert.html#init_all">init_all</a></span> <span class="kwd">as</span> [<span class="id">st2</span> <span class="id">vs</span>] <span class="id">eqn</span>:<span class="id">Hinit</span>; <span class="id">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Hinit2</span> := <span class="id">Hinit</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#init_all_correct">init_all_correct</a></span> <span class="kwd">with</span> (<span class="id">defs1</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="kwd">in</span> <span class="id">Hinit</span>; <span class="id">simpl</span>; [|<span class="id">assumption</span>|<span class="id">constructor</span>|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Ht1</span> : <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st2</span>)) <span class="id">t1</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">injection</span> <span class="id">Hcv</span> <span class="kwd">as</span> <span class="id">Hcv</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span> <span class="id">_</span> (<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> <span class="id">t1</span> <span class="id">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span> <span class="kwd">with</span> (<span class="id">h</span> := <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>)|<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_correct">init_at_correct</a></span>]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app1">nth_error_app1</a></span>; [|<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Misc.html#nth_error_extend">nth_error_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hinit</span>. <span class="id">rewrite</span> <span class="id">Hinit</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_length">seq_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_closed">init_at_closed</a></span> <span class="kwd">with</span> (<span class="id">p</span> := 0); <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v3</span> <span class="id">t3</span> <span class="id">H</span>; <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_same">read_val_same</a></span>; [|<span class="id">eassumption</span>|]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_points">read_val_points</a></span> <span class="kwd">in</span> <span class="id">Ha</span>; [|<span class="id">eassumption</span>]. <span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> (? &amp; ? &amp; ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_only_extended">unchanged_from_only_extended</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_trans">only_extended_trans</a></span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_no_dvar">init_at_no_dvar</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">assert</span> (<span class="id">Ht2</span> : <span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">st</span> <span class="id">defs</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st2</span>) + 1) <span class="id">t2</span>).<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">injection</span> <span class="id">Hcv</span> <span class="kwd">as</span> <span class="id">Hcv</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">refine</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect">eq_rect</a></span> <span class="id">_</span> (<span class="id"><a href="Convert.html#read_thread">read_thread</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> <span class="id">t2</span> <span class="id">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_term">read_thread_term</a></span> <span class="kwd">with</span> (<span class="id">h</span> := <span class="id"><a href="Beta.html#h_hole">h_hole</a></span>)|<span class="id">symmetry</span>; <span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_correct">init_at_correct</a></span>]; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span>; [|<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>; <span class="id">simpl</span>. <span class="id">destruct</span> (<span class="id">_</span> - <span class="id">_</span>) <span class="id">eqn</span>:<span class="id">Heq</span>; [|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Misc.html#Forall2_length">Forall2_length</a></span> <span class="kwd">in</span> <span class="id">Hinit</span>. <span class="id">rewrite</span> <span class="id">Hinit</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#seq_length">seq_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_closed">init_at_closed</a></span> <span class="kwd">with</span> (<span class="id">p</span> := 0); <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_impl">Forall2_impl</a></span>; [|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">v3</span> <span class="id">t3</span> <span class="id">H</span>; <span class="id">simpl</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_same">read_val_same</a></span>; [|<span class="id">eassumption</span>|]; [<span class="id">simpl</span>; <span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">a</span> <span class="id">Ha</span>. <span class="id">eapply</span> <span class="id"><a href="Convert.html#read_val_points">read_val_points</a></span> <span class="kwd">in</span> <span class="id">Ha</span>; [|<span class="id">eassumption</span>]. <span class="id">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> (? &amp; ? &amp; ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#unchanged_from_only_extended">unchanged_from_only_extended</a></span>; [<span class="id">eassumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_trans">only_extended_trans</a></span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">apply</span> <span class="id"><a href="Convert.html#init_at_no_dvar">init_at_no_dvar</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">unfold</span> <span class="id"><a href="Convert.html#defs_ok">defs_ok</a></span>. <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">injection</span> <span class="id">Hcv</span> <span class="kwd">as</span> <span class="id">Hcv</span>; <span class="id">subst</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> <span class="id">st2</span> <span class="kwd">with</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id">st2</span>, <span class="id">vs</span>)) <span class="kwd">by</span> <span class="id">reflexivity</span>. <span class="id">rewrite</span> &lt;- <span class="id">Hinit2</span>, <span class="id"><a href="Convert.html#init_all_freename">init_all_freename</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">simpl</span>. <span class="id">intros</span> <span class="id">rid</span> <span class="id">Hrid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">injection</span> <span class="id">Hcv</span> <span class="kwd">as</span> <span class="id">Hcv</span>; <span class="id">subst</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hrid</span>. <span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st2</span>) + 1) <span class="id">rid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span> <span class="kwd">in</span> <span class="id">Hrid</span> <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span> <span class="kwd">in</span> <span class="id">Hrid</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hrid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id">_</span> - <span class="id">_</span>) <span class="kwd">as</span> [|<span class="id">n</span>] <span class="id">eqn</span>:<span class="id">Heq</span>; [|<span class="id">destruct</span> <span class="id">n</span>; <span class="id">simpl</span> <span class="kwd">in</span> *; <span class="id">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">eexists</span>. <span class="id">replace</span> <span class="id">rid</span> <span class="kwd">with</span>  (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st2</span>) + 1) <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">eassumption</span>]. <span class="id">split</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app1">nth_error_app1</a></span> <span class="kwd">in</span> <span class="id">Hrid</span> <span class="kwd">by</span> (<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>; <span class="id">simpl</span>; <span class="id">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_dec">le_lt_dec</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st2</span>)) <span class="id">rid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">replace</span> <span class="id">rid</span> <span class="kwd">with</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="Convert.html#st_rthreads">st_rthreads</a></span> <span class="id">st2</span>)) <span class="kwd">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>. <span class="id">eexists</span>. <span class="id">split</span>; [|<span class="id">eassumption</span>]. <span class="id">split</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app1">nth_error_app1</a></span> <span class="kwd">in</span> <span class="id">Hrid</span> <span class="kwd">by</span> <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">replace</span> <span class="id">st2</span> <span class="kwd">with</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id">st2</span>, <span class="id">vs</span>)) <span class="kwd">in</span> <span class="id">Hrid</span> <span class="kwd">by</span> <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> &lt;- <span class="id">Hinit2</span> <span class="kwd">in</span> <span class="id">Hrid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#init_all_new_threads">init_all_new_threads</a></span> <span class="kwd">in</span> <span class="id">Hrid</span>; [|<span class="id">simpl</span>; <span class="id">destruct</span> <span class="id">rid</span>; <span class="id">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hrid</span> <span class="kwd">as</span> (<span class="id">x</span> &amp; <span class="id">Hx</span>). <span class="id">rewrite</span> <span class="id">Hinit2</span> <span class="kwd">in</span> <span class="id">Hx</span>; <span class="id">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Misc.html#Forall2_In_left_transparent">Forall2_In_left_transparent</a></span>; [|<span class="id">eassumption</span>|<span class="id">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">intros</span> <span class="id">t</span> <span class="id">Ht</span>. <span class="id">inversion</span> <span class="id">Ht</span>; <span class="id">subst</span>. <span class="id">inversion</span> <span class="id">H4</span>; <span class="id">subst</span>. <span class="id">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">H3</span> &amp; <span class="id">_</span> &amp; <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">H3</span>; <span class="id">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; [|<span class="id">eapply</span> <span class="id"><a href="Convert.html#read_thread_only_extended">read_thread_only_extended</a></span>; [<span class="id">simpl</span>|<span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_trans">only_extended_trans</a></span>; <span class="id">eapply</span> <span class="id"><a href="Convert.html#only_extended_makelazy">only_extended_makelazy</a></span>|<span class="id">eassumption</span>]; <span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">injection</span> <span class="id">Hcv</span> <span class="kwd">as</span> <span class="id">Hcv</span>; <span class="id">subst</span>; <span class="id">simpl</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">split</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">split</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>; <span class="id">simpl</span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">intros</span> <span class="id">b</span> <span class="id">Hb</span>. <span class="id">injection</span> <span class="id">Hcv</span> <span class="kwd">as</span> <span class="id">Hcv</span>; <span class="id">subst</span>; <span class="id">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inversion</span> <span class="id">Hb</span>; <span class="id">subst</span>. <span class="id">apply</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="id">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Lists.List.html#app_length">app_length</a></span>; <span class="id">simpl</span>. <span class="id">assumption</span>.<br/>
Qed.</details>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="all_correct">all_correct</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">st</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#defs_wf">defs_wf</a></span> <span class="id">defs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t1</span> 0 -&gt; <span class="id"><a href="STerm.html#closed_at">closed_at</a></span> <span class="id">t2</span> 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span>) <span class="id">t1</span> -&gt; <span class="id"><a href="Convert.html#dvar_below">dvar_below</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">defs</span>) <span class="id">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Rewrite.html#star">star</a></span> <span class="id"><a href="Convert.html#step">step</a></span> (<span class="id"><a href="Convert.html#init_conv">init_conv</a></span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span>) (<span class="id"><a href="Convert.html#cthread_done">cthread_done</a></span> <span class="id">b</span>, <span class="id">st</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Misc.html#reflect">reflect</a></span> (<span class="id"><a href="Rewrite.html#convertible">convertible</a></span> (<span class="id"><a href="Beta.html#betaiota">betaiota</a></span> <span class="id">defs</span>) <span class="id">t1</span> <span class="id">t2</span>) <span class="id">b</span>.<br/>
<details><summary>Proof.</summary>
&nbsp;&nbsp;<span class="id">intros</span> <span class="id">defs</span> <span class="id">t1</span> <span class="id">t2</span> <span class="id">st</span> <span class="id">b</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">H3</span> <span class="id">H4</span> <span class="id">H5</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;<span class="id">eapply</span> <span class="id"><a href="Convert.html#star_step_correct">star_step_correct</a></span> <span class="kwd">in</span> <span class="id">H6</span>; <span class="id">simpl</span>; [| |<span class="id">constructor</span>].<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#init_conv_correct">init_conv_correct</a></span> <span class="kwd">in</span> <span class="id">H6</span>; <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Convert.html#init_conv">init_conv</a></span>; <span class="id">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">eapply</span> <span class="id"><a href="Convert.html#init_conv_correct">init_conv_correct</a></span> <span class="kwd">with</span> (<span class="id">t1</span> := <span class="id">t1</span>) (<span class="id">t2</span> := <span class="id">t2</span>); <span class="id">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct</span> <span class="id"><a href="Convert.html#init_conv">init_conv</a></span>; <span class="id">reflexivity</span>.<br/>
Qed.</details>
<br/>
<span class="id">Print</span> <span class="id">Assumptions</span> <span class="id"><a href="Convert.html#all_correct">all_correct</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
